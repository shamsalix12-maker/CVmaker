id: B21
name: "Dashboard Page"
phase: 5
phase_name: "Dashboard & Lists"

goal: |
  Create the main dashboard page that shows:
  - Summary statistics (applications count, CV status)
  - Recent applications
  - Quick actions (new application, update CV)
  - AI key status

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B15, B16, B17, B18]

files_to_create:
  - id: F153
    path: "src/components/dashboard/StatsCards.tsx"
    description: "Statistics cards component"

  - id: F154
    path: "src/components/dashboard/RecentApplications.tsx"
    description: "Recent applications list"

  - id: F155
    path: "src/components/dashboard/QuickActions.tsx"
    description: "Quick action buttons"

  - id: F156
    path: "src/components/dashboard/CVStatusCard.tsx"
    description: "CV completion status"

  - id: F157
    path: "src/components/dashboard/AIKeyStatus.tsx"
    description: "AI API key status"

  - id: F158
    path: "src/hooks/useDashboard.ts"
    description: "Dashboard data hook"

files_to_modify:
  - id: F012
    path: "src/app/[locale]/dashboard/page.tsx"
    description: "Dashboard page"

  - id: F087
    path: "src/i18n/en.json"
    description: "Dashboard translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Dashboard translations"

files_available:
  - id: F082
    path: "src/hooks/useCV.ts"
    from_block: B15
  - id: F081
    path: "src/hooks/useAIKeys.ts"
    from_block: B11
  - id: F084
    path: "src/hooks/useApplication.ts"
    from_block: B18
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07
  - id: F092
    path: "src/components/auth/AuthGuard.tsx"
    from_block: B07

commands: []

instructions: |
  1. Create useDashboard.ts:
     ```typescript
     // ============================================
     // [F158] src/hooks/useDashboard.ts
     // ============================================
     
     'use client';
     
     import { useState, useEffect, useCallback } from 'react';
     import { useAuth } from '@/context/AuthContext';
     import { JobApplication } from '@/lib/types';
     
     interface DashboardStats {
       totalApplications: number;
       completedApplications: number;
       draftApplications: number;
       recentApplications: JobApplication[];
     }
     
     export function useDashboard() {
       const { user } = useAuth();
       const [stats, setStats] = useState<DashboardStats>({
         totalApplications: 0,
         completedApplications: 0,
         draftApplications: 0,
         recentApplications: []
       });
       const [loading, setLoading] = useState(true);
       const [error, setError] = useState<string | null>(null);
       
       const fetchStats = useCallback(async () => {
         if (!user) return;
         
         setLoading(true);
         setError(null);
         
         try {
           const res = await fetch('/api/applications', {
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           if (data.error) throw new Error(data.error);
           
           const applications = data.applications || [];
           
           setStats({
             totalApplications: applications.length,
             completedApplications: applications.filter((a: JobApplication) => a.status === 'completed').length,
             draftApplications: applications.filter((a: JobApplication) => a.status === 'draft').length,
             recentApplications: applications.slice(0, 5)
           });
           
         } catch (err: any) {
           setError(err.message);
         } finally {
           setLoading(false);
         }
       }, [user]);
       
       useEffect(() => {
         fetchStats();
       }, [fetchStats]);
       
       return { stats, loading, error, refresh: fetchStats };
     }
     ```

  2. Create StatsCards.tsx:
     ```typescript
     // ============================================
     // [F153] src/components/dashboard/StatsCards.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { FileText, CheckCircle, Clock, TrendingUp } from 'lucide-react';
     
     interface StatsCardsProps {
       totalApplications: number;
       completedApplications: number;
       draftApplications: number;
       className?: string;
     }
     
     export function StatsCards({
       totalApplications,
       completedApplications,
       draftApplications,
       className
     }: StatsCardsProps) {
       const t = useTranslations('dashboard');
       
       const cards = [
         {
           title: t('total_applications'),
           value: totalApplications,
           icon: FileText,
           color: 'text-blue-600',
           bg: 'bg-blue-100'
         },
         {
           title: t('completed'),
           value: completedApplications,
           icon: CheckCircle,
           color: 'text-green-600',
           bg: 'bg-green-100'
         },
         {
           title: t('in_progress'),
           value: draftApplications,
           icon: Clock,
           color: 'text-yellow-600',
           bg: 'bg-yellow-100'
         },
         {
           title: t('success_rate'),
           value: totalApplications > 0 
             ? `${Math.round((completedApplications / totalApplications) * 100)}%`
             : '0%',
           icon: TrendingUp,
           color: 'text-purple-600',
           bg: 'bg-purple-100'
         }
       ];
       
       return (
         <div className={`grid gap-4 md:grid-cols-2 lg:grid-cols-4 ${className}`}>
           {cards.map((card, i) => {
             const Icon = card.icon;
             return (
               <Card key={i}>
                 <CardHeader className="flex flex-row items-center justify-between pb-2">
                   <CardTitle className="text-sm font-medium text-muted-foreground">
                     {card.title}
                   </CardTitle>
                   <div className={`p-2 rounded-full ${card.bg}`}>
                     <Icon className={`h-4 w-4 ${card.color}`} />
                   </div>
                 </CardHeader>
                 <CardContent>
                   <p className="text-2xl font-bold">{card.value}</p>
                 </CardContent>
               </Card>
             );
           })}
         </div>
       );
     }
     ```

  3. Create RecentApplications.tsx:
     ```typescript
     // ============================================
     // [F154] src/components/dashboard/RecentApplications.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { JobApplication } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { formatDate } from '@/lib/utils';
     import { FileText, ArrowRight, Clock, CheckCircle, AlertCircle } from 'lucide-react';
     
     interface RecentApplicationsProps {
       applications: JobApplication[];
       className?: string;
     }
     
     const statusConfig: Record<string, { icon: React.ElementType; color: string }> = {
       completed: { icon: CheckCircle, color: 'text-green-600' },
       draft: { icon: Clock, color: 'text-yellow-600' },
       processing: { icon: Clock, color: 'text-blue-600' },
       error: { icon: AlertCircle, color: 'text-red-600' }
     };
     
     export function RecentApplications({ applications, className }: RecentApplicationsProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       
       return (
         <Card className={className}>
           <CardHeader className="flex flex-row items-center justify-between">
             <CardTitle className="flex items-center gap-2">
               <FileText className="h-5 w-5" />
               {t('recent_applications')}
             </CardTitle>
             <Link href={`/${locale}/applications`}>
               <Button variant="ghost" size="sm">
                 {t('view_all')}
                 <ArrowRight className="h-4 w-4 ml-1" />
               </Button>
             </Link>
           </CardHeader>
           <CardContent>
             {applications.length === 0 ? (
               <p className="text-muted-foreground text-center py-8">
                 {t('no_applications_yet')}
               </p>
             ) : (
               <div className="space-y-4">
                 {applications.map((app) => {
                   const config = statusConfig[app.status] || statusConfig.draft;
                   const Icon = config.icon;
                   const jobTitle = app.job_description.slice(0, 50) + (app.job_description.length > 50 ? '...' : '');
                   
                   return (
                     <Link 
                       key={app.id}
                       href={`/${locale}/applications/${app.id}`}
                       className="block"
                     >
                       <div className="flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50 transition-colors">
                         <div className="flex items-center gap-3">
                           <Icon className={`h-5 w-5 ${config.color}`} />
                           <div>
                             <p className="font-medium line-clamp-1">{jobTitle}</p>
                             <p className="text-sm text-muted-foreground">
                               {formatDate(app.created_at, locale)}
                             </p>
                           </div>
                         </div>
                         <Badge variant="outline">
                           {t(`status_${app.status}`)}
                         </Badge>
                       </div>
                     </Link>
                   );
                 })}
               </div>
             )}
           </CardContent>
         </Card>
       );
     }
     ```

  4. Create QuickActions.tsx:
     ```typescript
     // ============================================
     // [F155] src/components/dashboard/QuickActions.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { PlusCircle, FileText, Settings, Sparkles } from 'lucide-react';
     
     interface QuickActionsProps {
       className?: string;
     }
     
     export function QuickActions({ className }: QuickActionsProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       
       const actions = [
         {
           label: t('new_application'),
           href: `/${locale}/new-application`,
           icon: PlusCircle,
           variant: 'default' as const
         },
         {
           label: t('manage_cv'),
           href: `/${locale}/cv-manager`,
           icon: FileText,
           variant: 'outline' as const
         },
         {
           label: t('manage_prompts'),
           href: `/${locale}/prompts`,
           icon: Sparkles,
           variant: 'outline' as const
         },
         {
           label: t('settings'),
           href: `/${locale}/settings`,
           icon: Settings,
           variant: 'outline' as const
         }
       ];
       
       return (
         <Card className={className}>
           <CardHeader>
             <CardTitle>{t('quick_actions')}</CardTitle>
           </CardHeader>
           <CardContent>
             <div className="grid gap-3 sm:grid-cols-2">
               {actions.map((action) => {
                 const Icon = action.icon;
                 return (
                   <Link key={action.href} href={action.href}>
                     <Button variant={action.variant} className="w-full justify-start">
                       <Icon className="h-4 w-4 mr-2" />
                       {action.label}
                     </Button>
                   </Link>
                 );
               })}
             </div>
           </CardContent>
         </Card>
       );
     }
     ```

  5. Create CVStatusCard.tsx:
     ```typescript
     // ============================================
     // [F156] src/components/dashboard/CVStatusCard.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { useCV } from '@/hooks/useCV';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { Progress } from '@/components/ui/progress';
     import { FileText, CheckCircle, AlertCircle, ArrowRight } from 'lucide-react';
     
     interface CVStatusCardProps {
       className?: string;
     }
     
     export function CVStatusCard({ className }: CVStatusCardProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       const { cv, loading, completionPercentage } = useCV();
       
       if (loading) {
         return (
           <Card className={className}>
             <CardContent className="py-6">
               <div className="animate-pulse space-y-3">
                 <div className="h-4 bg-muted rounded w-1/2" />
                 <div className="h-2 bg-muted rounded" />
               </div>
             </CardContent>
           </Card>
         );
       }
       
       return (
         <Card className={className}>
           <CardHeader className="flex flex-row items-center justify-between pb-2">
             <CardTitle className="flex items-center gap-2 text-base">
               <FileText className="h-5 w-5" />
               {t('cv_status')}
             </CardTitle>
             {cv ? (
               completionPercentage === 100 ? (
                 <CheckCircle className="h-5 w-5 text-green-600" />
               ) : (
                 <AlertCircle className="h-5 w-5 text-yellow-600" />
               )
             ) : null}
           </CardHeader>
           <CardContent>
             {cv ? (
               <div className="space-y-3">
                 <div className="flex items-center justify-between text-sm">
                   <span className="text-muted-foreground">{t('completion')}</span>
                   <span className="font-medium">{completionPercentage}%</span>
                 </div>
                 <Progress value={completionPercentage} />
                 <Link href={`/${locale}/cv-manager`}>
                   <Button variant="outline" size="sm" className="w-full mt-2">
                     {completionPercentage < 100 ? t('complete_cv') : t('update_cv')}
                     <ArrowRight className="h-4 w-4 ml-2" />
                   </Button>
                 </Link>
               </div>
             ) : (
               <div className="text-center py-4">
                 <p className="text-muted-foreground mb-3">{t('no_cv_yet')}</p>
                 <Link href={`/${locale}/cv-manager`}>
                   <Button>
                     {t('upload_cv')}
                     <ArrowRight className="h-4 w-4 ml-2" />
                   </Button>
                 </Link>
               </div>
             )}
           </CardContent>
         </Card>
       );
     }
     ```

  6. Create AIKeyStatus.tsx:
     ```typescript
     // ============================================
     // [F157] src/components/dashboard/AIKeyStatus.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { useAIKeys } from '@/hooks/useAIKeys';
     import { SUPPORTED_AI_PROVIDERS } from '@/lib/constants';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { Key, CheckCircle, XCircle, ArrowRight } from 'lucide-react';
     
     interface AIKeyStatusProps {
       className?: string;
     }
     
     export function AIKeyStatus({ className }: AIKeyStatusProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       const { keys, loading, hasValidKey, getValidProviders } = useAIKeys();
       
       const validProviders = getValidProviders();
       
       if (loading) {
         return (
           <Card className={className}>
             <CardContent className="py-6">
               <div className="animate-pulse space-y-2">
                 <div className="h-4 bg-muted rounded w-1/2" />
                 <div className="h-4 bg-muted rounded w-1/3" />
               </div>
             </CardContent>
           </Card>
         );
       }
       
       return (
         <Card className={className}>
           <CardHeader className="flex flex-row items-center justify-between pb-2">
             <CardTitle className="flex items-center gap-2 text-base">
               <Key className="h-5 w-5" />
               {t('ai_status')}
             </CardTitle>
           </CardHeader>
           <CardContent>
             <div className="space-y-2">
               {SUPPORTED_AI_PROVIDERS.map((provider) => {
                 const isValid = hasValidKey(provider.name);
                 return (
                   <div 
                     key={provider.name}
                     className="flex items-center justify-between py-2"
                   >
                     <span className="text-sm">{provider.label}</span>
                     {isValid ? (
                       <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
                         <CheckCircle className="h-3 w-3 mr-1" />
                         {t('connected')}
                       </Badge>
                     ) : (
                       <Badge variant="outline" className="bg-gray-50 text-gray-500">
                         <XCircle className="h-3 w-3 mr-1" />
                         {t('not_configured')}
                       </Badge>
                     )}
                   </div>
                 );
               })}
             </div>
             
             {validProviders.length === 0 && (
               <Link href={`/${locale}/settings`}>
                 <Button variant="outline" size="sm" className="w-full mt-4">
                   {t('configure_ai')}
                   <ArrowRight className="h-4 w-4 ml-2" />
                 </Button>
               </Link>
             )}
           </CardContent>
         </Card>
       );
     }
     ```

  7. Update dashboard/page.tsx:
     ```typescript
     // ============================================
     // [F012] src/app/[locale]/dashboard/page.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { AuthGuard } from '@/components/auth/AuthGuard';
     import { useDashboard } from '@/hooks/useDashboard';
     import { StatsCards } from '@/components/dashboard/StatsCards';
     import { RecentApplications } from '@/components/dashboard/RecentApplications';
     import { QuickActions } from '@/components/dashboard/QuickActions';
     import { CVStatusCard } from '@/components/dashboard/CVStatusCard';
     import { AIKeyStatus } from '@/components/dashboard/AIKeyStatus';
     import { useAuth } from '@/context/AuthContext';
     import { LayoutDashboard, Loader2 } from 'lucide-react';
     
     export default function DashboardPage() {
       const t = useTranslations('dashboard');
       const { user } = useAuth();
       const { stats, loading, error } = useDashboard();
       
       return (
         <AuthGuard>
           <div className="container mx-auto p-6 max-w-7xl">
             {/* Header */}
             <div className="mb-6">
               <h1 className="text-2xl font-bold flex items-center gap-2">
                 <LayoutDashboard className="h-6 w-6" />
                 {t('title')}
               </h1>
               <p className="text-muted-foreground mt-1">
                 {t('welcome', { name: user?.name || '' })}
               </p>
             </div>
             
             {loading ? (
               <div className="flex items-center justify-center py-12">
                 <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
               </div>
             ) : (
               <div className="space-y-6">
                 {/* Stats */}
                 <StatsCards
                   totalApplications={stats.totalApplications}
                   completedApplications={stats.completedApplications}
                   draftApplications={stats.draftApplications}
                 />
                 
                 {/* Main Grid */}
                 <div className="grid gap-6 lg:grid-cols-3">
                   {/* Left Column - Recent Applications */}
                   <div className="lg:col-span-2">
                     <RecentApplications applications={stats.recentApplications} />
                   </div>
                   
                   {/* Right Column - Status Cards */}
                   <div className="space-y-6">
                     <QuickActions />
                     <CVStatusCard />
                     <AIKeyStatus />
                   </div>
                 </div>
               </div>
             )}
           </div>
         </AuthGuard>
       );
     }
     ```

  8. Add translations to en.json under "dashboard":
     ```json
     {
       "dashboard": {
         "title": "Dashboard",
         "welcome": "Welcome back, {name}!",
         "total_applications": "Total Applications",
         "completed": "Completed",
         "in_progress": "In Progress",
         "success_rate": "Completion Rate",
         "recent_applications": "Recent Applications",
         "view_all": "View All",
         "no_applications_yet": "No applications yet. Create your first one!",
         "status_completed": "Completed",
         "status_draft": "Draft",
         "status_processing": "Processing",
         "status_error": "Error",
         "quick_actions": "Quick Actions",
         "new_application": "New Application",
         "manage_cv": "Manage CV",
         "manage_prompts": "Manage Prompts",
         "settings": "Settings",
         "cv_status": "CV Status",
         "completion": "Completion",
         "complete_cv": "Complete Your CV",
         "update_cv": "Update CV",
         "no_cv_yet": "You haven't uploaded your CV yet",
         "upload_cv": "Upload CV",
         "ai_status": "AI Services",
         "connected": "Connected",
         "not_configured": "Not Configured",
         "configure_ai": "Configure AI Keys"
       }
     }
     ```

  9. Add same translations to fa.json

checkpoint_tests:
  - id: T01
    description: "All dashboard component files exist"
    type: "files_exist"
    files:
      - "src/components/dashboard/StatsCards.tsx"
      - "src/components/dashboard/RecentApplications.tsx"
      - "src/components/dashboard/QuickActions.tsx"
      - "src/components/dashboard/CVStatusCard.tsx"
      - "src/components/dashboard/AIKeyStatus.tsx"
      - "src/hooks/useDashboard.ts"

  - id: T02
    description: "Dashboard page exists"
    type: "files_exist"
    files:
      - "src/app/[locale]/dashboard/page.tsx"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "Dashboard page uses all components"
    type: "grep"
    file: "src/app/[locale]/dashboard/page.tsx"
    patterns:
      - "StatsCards"
      - "RecentApplications"
      - "QuickActions"
      - "CVStatusCard"
      - "AIKeyStatus"

max_retries: 3