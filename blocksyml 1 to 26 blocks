B01.yaml
YAML

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BLOCK B01: Create Empty Next.js Project
# Phase 0: Foundation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

id: B01
name: "Create Empty Next.js Project"
phase: 0
phase_name: "Foundation"

goal: |
  Create a clean, running Next.js 14+ project with TypeScript and Tailwind CSS.
  This is the foundation of the entire application.

dependencies: []

files_to_create:
  - id: F001
    path: "package.json"
  - id: F002
    path: "tsconfig.json"
  - id: F003
    path: "next.config.js"
  - id: F004
    path: "tailwind.config.ts"
  - id: F005
    path: ".env.local"
  - id: F006
    path: ".env.example"
  - id: F007
    path: "src/app/layout.tsx"
  - id: F008
    path: "src/app/page.tsx"
  - id: F009
    path: "src/app/globals.css"

files_to_modify: []

files_available: []

commands:
  - |
    npx create-next-app@latest cv-tailor-app \
      --typescript \
      --tailwind \
      --eslint \
      --app \
      --src-dir \
      --import-alias "@/*"

instructions: |
  1. Run the create-next-app command with the EXACT flags specified above.
  2. Navigate into the created directory: cd cv-tailor-app
  3. Create .env.local with these empty placeholders:
     ```
     NEXT_PUBLIC_SUPABASE_URL=
     NEXT_PUBLIC_SUPABASE_ANON_KEY=
     ENCRYPTION_SECRET_KEY=
     ```
  4. Create .env.example with the same keys (for documentation):
     ```
     NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
     NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
     ENCRYPTION_SECRET_KEY=your_32_character_secret_key
     ```
  5. Verify the dev server runs: npm run dev
  6. Do NOT add any extra files or modify the default setup yet.

checkpoint_tests:
  - id: T01
    description: "package.json exists and has Next.js dependency"
    type: "grep"
    file: "package.json"
    patterns:
      - '"next":'
      - '"react":'
      - '"typescript":'

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "All required files exist"
    type: "files_exist"
    files:
      - "package.json"
      - "tsconfig.json"
      - "next.config.js"
      - "tailwind.config.ts"
      - ".env.local"
      - ".env.example"
      - "src/app/layout.tsx"
      - "src/app/page.tsx"
      - "src/app/globals.css"

  - id: T04
    description: "Tailwind is configured"
    type: "grep"
    file: "tailwind.config.ts"
    patterns:
      - "content:"
      - "./src/"

  - id: T05
    description: ".env.local has required placeholders"
    type: "grep"
    file: ".env.local"
    patterns:
      - "NEXT_PUBLIC_SUPABASE_URL"
      - "NEXT_PUBLIC_SUPABASE_ANON_KEY"
      - "ENCRYPTION_SECRET_KEY"

max_retries: 3
B02.yaml
YAML

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BLOCK B02: Install All Dependencies
# Phase 0: Foundation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

id: B02
name: "Install All Dependencies"
phase: 0
phase_name: "Foundation"

goal: |
  Install all npm packages required for the entire project.
  This includes UI components (shadcn), Supabase, AI SDKs, 
  file processing libraries, and utilities.

dependencies:
  - B01

files_to_create:
  - id: F027
    path: "src/components/ui/button.tsx"
  - id: F028
    path: "src/components/ui/input.tsx"
  - id: F029
    path: "src/components/ui/card.tsx"
  - id: F030
    path: "src/components/ui/dialog.tsx"
  - id: F031
    path: "src/components/ui/select.tsx"
  - id: F032
    path: "src/components/ui/textarea.tsx"
  - id: F033
    path: "src/components/ui/tabs.tsx"
  - id: F034
    path: "src/components/ui/badge.tsx"
  - id: F035
    path: "src/components/ui/toast.tsx"
  - id: F036
    path: "src/components/ui/dropdown-menu.tsx"
  - id: F090
    path: "src/lib/utils.ts"
  - id: F091
    path: "components.json"

files_to_modify:
  - id: F001
    path: "package.json"
  - id: F009
    path: "src/app/globals.css"
  - id: F004
    path: "tailwind.config.ts"

files_available:
  - id: F001
    path: "package.json"
    from_block: B01
  - id: F002
    path: "tsconfig.json"
    from_block: B01
  - id: F004
    path: "tailwind.config.ts"
    from_block: B01
  - id: F009
    path: "src/app/globals.css"
    from_block: B01

commands:
  - |
    # Initialize shadcn-ui
    npx shadcn-ui@latest init -y
  
  - |
    # Add shadcn components
    npx shadcn-ui@latest add button input card dialog select textarea tabs badge toast dropdown-menu
  
  - |
    # Supabase
    npm install @supabase/supabase-js @supabase/ssr
  
  - |
    # AI SDKs
    npm install openai @anthropic-ai/sdk @google/generative-ai
  
  - |
    # File Parsing & Generation
    npm install mammoth docx file-saver jszip
    npm install @types/file-saver --save-dev
  
  - |
    # Markdown Processing
    npm install remark remark-html remark-parse unified
  
  - |
    # Rich Text Editor
    npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-placeholder @tiptap/pm
  
  - |
    # Internationalization
    npm install next-intl
  
  - |
    # Encryption
    npm install crypto-js
    npm install @types/crypto-js --save-dev
  
  - |
    # Utilities
    npm install clsx tailwind-merge lucide-react zod uuid
    npm install @types/uuid --save-dev

instructions: |
  1. Run shadcn-ui init first. When prompted:
     - Style: Default
     - Base color: Slate
     - CSS variables: Yes
  
  2. Add all the shadcn components listed.
  
  3. Install all other dependencies in order.
  
  4. Verify no peer dependency conflicts.
  
  5. Do NOT modify any component code yet - just install.
  
  6. The shadcn init will create src/lib/utils.ts and modify globals.css and tailwind.config.ts - this is expected.

checkpoint_tests:
  - id: T01
    description: "shadcn components directory exists"
    type: "files_exist"
    files:
      - "src/components/ui/button.tsx"
      - "src/components/ui/input.tsx"
      - "src/components/ui/card.tsx"
      - "src/components/ui/dialog.tsx"
      - "src/components/ui/select.tsx"
      - "src/components/ui/textarea.tsx"
      - "src/components/ui/tabs.tsx"
      - "src/components/ui/badge.tsx"
      - "src/components/ui/dropdown-menu.tsx"

  - id: T02
    description: "Supabase packages installed"
    type: "grep"
    file: "package.json"
    patterns:
      - '"@supabase/supabase-js":'
      - '"@supabase/ssr":'

  - id: T03
    description: "AI SDK packages installed"
    type: "grep"
    file: "package.json"
    patterns:
      - '"openai":'
      - '"@anthropic-ai/sdk":'
      - '"@google/generative-ai":'

  - id: T04
    description: "File processing packages installed"
    type: "grep"
    file: "package.json"
    patterns:
      - '"mammoth":'
      - '"docx":'
      - '"file-saver":'

  - id: T05
    description: "Other required packages installed"
    type: "grep"
    file: "package.json"
    patterns:
      - '"next-intl":'
      - '"crypto-js":'
      - '"@tiptap/react":'
      - '"lucide-react":'
      - '"zod":'

  - id: T06
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T07
    description: "No npm audit high vulnerabilities"
    type: "command"
    command: "npm audit --audit-level=high || true"
    expected_exit_code: 0

max_retries: 3
B03.yaml
YAML

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BLOCK B03: Central TypeScript Types
# Phase 0: Foundation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

id: B03
name: "Central TypeScript Types"
phase: 0
phase_name: "Foundation"

goal: |
  Define ALL TypeScript types and interfaces for the entire project
  in a single central file. This becomes the source of truth for 
  all type definitions.

dependencies:
  - B01
  - B02

files_to_create:
  - id: F079
    path: "src/lib/types.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F079] src/lib/types.ts
      // Central TypeScript Type Definitions
      // ALL types for the entire application are defined here
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // USER TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export interface User {
        id: string;
        google_id: string | null;
        email: string;
        name: string;
        avatar_url: string | null;
        preferred_language: AppLocale;
        created_at: string;
        updated_at: string;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // CV TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export interface PersonalInfo {
        full_name: string;
        email: string;
        phone: string;
        location: string;
        linkedin_url: string;
        website_url: string;
        summary: string;
      }
      
      export interface WorkExperience {
        id: string;
        job_title: string;
        company: string;
        location: string;
        start_date: string;
        end_date: string | null;
        is_current: boolean;
        description: string;
        achievements: string[];
      }
      
      export interface Education {
        id: string;
        degree: string;
        field_of_study: string;
        institution: string;
        location: string;
        start_date: string;
        end_date: string;
        gpa: string | null;
        description: string;
      }
      
      export interface Certification {
        id: string;
        name: string;
        issuer: string;
        date_obtained: string;
        expiry_date: string | null;
        credential_id: string | null;
        credential_url: string | null;
      }
      
      export interface Language {
        language: string;
        proficiency: 'native' | 'fluent' | 'advanced' | 'intermediate' | 'beginner';
      }
      
      export interface Project {
        id: string;
        name: string;
        description: string;
        technologies: string[];
        url: string | null;
        start_date: string | null;
        end_date: string | null;
      }
      
      export interface AdditionalSection {
        id: string;
        title: string;
        content: string;
      }
      
      export interface ComprehensiveCV {
        id: string;
        user_id: string;
        personal_info: PersonalInfo;
        work_experience: WorkExperience[];
        education: Education[];
        skills: string[];
        certifications: Certification[];
        languages: Language[];
        projects: Project[];
        additional_sections: AdditionalSection[];
        raw_text: string;
        created_at: string;
        updated_at: string;
      }
      
      export interface CVFieldStatus {
        field_path: string;
        field_name: string;
        is_complete: boolean;
        is_required: boolean;
        current_value: unknown;
        message?: string;
      }
      
      export type CVSection = 
        | 'personal_info'
        | 'work_experience'
        | 'education'
        | 'skills'
        | 'certifications'
        | 'languages'
        | 'projects'
        | 'additional_sections';
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // PROMPT TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export interface Prompt {
        id: string;
        title_en: string;
        title_fa: string;
        description_en: string;
        description_fa: string;
        prompt_text: string;
        category: string;
        is_active: boolean;
        sort_order: number;
        created_at: string;
        updated_at: string;
      }
      
      export interface PromptCategory {
        id: string;
        name_en: string;
        name_fa: string;
        sort_order: number;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // AI TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export type AIProviderName = 'openai' | 'anthropic' | 'google';
      
      export interface AIModel {
        model_id: string;
        model_name: string;
        provider: AIProviderName;
        context_window?: number;
        supports_streaming: boolean;
      }
      
      export interface AIApiKey {
        id: string;
        user_id: string;
        provider_name: AIProviderName;
        api_key_encrypted: string;
        is_valid: boolean;
        available_models: AIModel[];
        token_balance: string | null;
        last_validated_at: string | null;
        created_at: string;
        updated_at: string;
      }
      
      export interface AISelection {
        provider: AIProviderName;
        model_id: string;
        role: 'draft' | 'final';
      }
      
      export interface AIChatMessage {
        id: string;
        role: 'system' | 'user' | 'assistant';
        content: string;
        timestamp: string;
      }
      
      export interface AIConnectionStatus {
        provider: AIProviderName;
        is_connected: boolean;
        error_message?: string;
        available_models: AIModel[];
        token_balance?: string;
        last_checked: string;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // APPLICATION TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export type OutputLanguage = 'en' | 'fa' | 'fr' | 'de' | 'es' | 'ar' | 'zh' | 'tr';
      
      export type ToneMode = 'preset' | 'custom';
      
      export type TonePreset = 
        | 'formal'
        | 'semi-formal'
        | 'professional'
        | 'friendly'
        | 'creative'
        | 'confident';
      
      export interface ToneSetting {
        mode: ToneMode;
        preset_value: TonePreset | null;
        custom_text: string | null;
      }
      
      export type ApplicationStatus =
        | 'input'
        | 'processing'
        | 'clarification'
        | 'draft_ready'
        | 'editing'
        | 'finalized';
      
      export interface DraftOutput {
        id: string;
        ai_provider: AIProviderName;
        ai_model: string;
        content: string;
        created_at: string;
      }
      
      export interface FinalOutput {
        tailored_cv: string;
        cover_letter: string;
        application_email: string;
      }
      
      export interface JobApplication {
        id: string;
        user_id: string;
        job_title: string;
        company_name: string;
        job_description: string;
        selected_prompt_ids: string[];
        ai_selections: AISelection[];
        output_language: OutputLanguage;
        tone_setting: ToneSetting;
        selected_template_ids: {
          cv: string | null;
          cover_letter: string | null;
          email: string | null;
        };
        conversation_history: AIChatMessage[];
        draft_outputs: DraftOutput[];
        final_output: FinalOutput | null;
        edited_output: FinalOutput | null;
        status: ApplicationStatus;
        created_at: string;
        updated_at: string;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // TEMPLATE TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export type TemplateType = 'cv' | 'cover_letter' | 'email';
      export type FileFormat = 'docx' | 'md';
      
      export interface Template {
        id: string;
        user_id: string;
        template_name: string;
        template_type: TemplateType;
        file_format: FileFormat;
        file_content: string;
        preview_url?: string;
        created_at: string;
        updated_at: string;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // UI / APP TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export type AppLocale = 'en' | 'fa';
      
      export interface NavigationItem {
        id: string;
        label_key: string;
        href: string;
        icon: string;
        badge?: number;
      }
      
      export interface BreadcrumbItem {
        label_key: string;
        href?: string;
      }
      
      export type ToastType = 'success' | 'error' | 'warning' | 'info';
      
      export interface ToastMessage {
        id: string;
        type: ToastType;
        title: string;
        description?: string;
        duration?: number;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // API RESPONSE TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export interface ApiResponse<T> {
        success: boolean;
        data?: T;
        error?: {
          code: string;
          message: string;
          details?: unknown;
        };
      }
      
      export interface PaginatedResponse<T> {
        items: T[];
        total: number;
        page: number;
        page_size: number;
        has_more: boolean;
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // FORM TYPES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export interface FormFieldError {
        field: string;
        message: string;
      }
      
      export interface FormState<T> {
        data: T;
        errors: FormFieldError[];
        isSubmitting: boolean;
        isValid: boolean;
      }

files_to_modify: []

files_available:
  - id: F001
    path: "package.json"
    from_block: B01
  - id: F002
    path: "tsconfig.json"
    from_block: B01

commands: []

instructions: |
  1. Create the file src/lib/types.ts with ALL the types defined above.
  
  2. This file is the SINGLE SOURCE OF TRUTH for all TypeScript types.
  
  3. All future files will import types from this file.
  
  4. Do NOT create any other files in this block.
  
  5. Make sure all interfaces and types are exported.
  
  6. Verify TypeScript compiles without errors.

checkpoint_tests:
  - id: T01
    description: "types.ts file exists"
    type: "files_exist"
    files:
      - "src/lib/types.ts"

  - id: T02
    description: "All core interfaces are exported"
    type: "grep"
    file: "src/lib/types.ts"
    patterns:
      - "export interface User"
      - "export interface ComprehensiveCV"
      - "export interface Prompt"
      - "export interface AIApiKey"
      - "export interface JobApplication"
      - "export interface Template"

  - id: T03
    description: "All core types are exported"
    type: "grep"
    file: "src/lib/types.ts"
    patterns:
      - "export type AIProviderName"
      - "export type OutputLanguage"
      - "export type ApplicationStatus"
      - "export type AppLocale"
      - "export type TemplateType"

  - id: T04
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

max_retries: 3
B04.yaml
YAML

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BLOCK B04: Constants and Utilities
# Phase 0: Foundation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

id: B04
name: "Constants and Utilities"
phase: 0
phase_name: "Foundation"

goal: |
  Create centralized constants and utility functions that will be 
  used throughout the application. This includes supported languages,
  AI providers, tone presets, and common helper functions.

dependencies:
  - B03

files_to_create:
  - id: F078
    path: "src/lib/constants.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F078] src/lib/constants.ts
      // Application Constants
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      import type { 
        OutputLanguage, 
        AIProviderName, 
        TonePreset,
        AppLocale,
        NavigationItem 
      } from './types';
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // APP INFO
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const APP_NAME = 'CV Tailor';
      export const APP_VERSION = '1.0.0';
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // SUPPORTED LOCALES (UI Language)
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const SUPPORTED_LOCALES: AppLocale[] = ['en', 'fa'];
      export const DEFAULT_LOCALE: AppLocale = 'en';
      
      export const LOCALE_CONFIG: Record<AppLocale, { 
        name: string; 
        nativeName: string; 
        dir: 'ltr' | 'rtl';
        flag: string;
      }> = {
        en: { name: 'English', nativeName: 'English', dir: 'ltr', flag: 'ğŸ‡¬ğŸ‡§' },
        fa: { name: 'Persian', nativeName: 'ÙØ§Ø±Ø³ÛŒ', dir: 'rtl', flag: 'ğŸ‡®ğŸ‡·' },
      };
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // OUTPUT LANGUAGES (Document output)
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const SUPPORTED_OUTPUT_LANGUAGES: {
        code: OutputLanguage;
        label_en: string;
        label_fa: string;
        flag: string;
      }[] = [
        { code: 'en', label_en: 'English', label_fa: 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ', flag: 'ğŸ‡¬ğŸ‡§' },
        { code: 'fa', label_en: 'Persian (Farsi)', label_fa: 'ÙØ§Ø±Ø³ÛŒ', flag: 'ğŸ‡®ğŸ‡·' },
        { code: 'fr', label_en: 'French', label_fa: 'ÙØ±Ø§Ù†Ø³ÙˆÛŒ', flag: 'ğŸ‡«ğŸ‡·' },
        { code: 'de', label_en: 'German', label_fa: 'Ø¢Ù„Ù…Ø§Ù†ÛŒ', flag: 'ğŸ‡©ğŸ‡ª' },
        { code: 'es', label_en: 'Spanish', label_fa: 'Ø§Ø³Ù¾Ø§Ù†ÛŒØ§ÛŒÛŒ', flag: 'ğŸ‡ªğŸ‡¸' },
        { code: 'ar', label_en: 'Arabic', label_fa: 'Ø¹Ø±Ø¨ÛŒ', flag: 'ğŸ‡¸ğŸ‡¦' },
        { code: 'zh', label_en: 'Chinese', label_fa: 'Ú†ÛŒÙ†ÛŒ', flag: 'ğŸ‡¨ğŸ‡³' },
        { code: 'tr', label_en: 'Turkish', label_fa: 'ØªØ±Ú©ÛŒ', flag: 'ğŸ‡¹ğŸ‡·' },
      ];
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // AI PROVIDERS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const SUPPORTED_AI_PROVIDERS: {
        name: AIProviderName;
        label: string;
        website: string;
        icon: string;
        keyPlaceholder: string;
      }[] = [
        { 
          name: 'openai', 
          label: 'OpenAI', 
          website: 'https://platform.openai.com',
          icon: 'brain',
          keyPlaceholder: 'sk-...'
        },
        { 
          name: 'anthropic', 
          label: 'Anthropic (Claude)', 
          website: 'https://console.anthropic.com',
          icon: 'bot',
          keyPlaceholder: 'sk-ant-...'
        },
        { 
          name: 'google', 
          label: 'Google AI (Gemini)', 
          website: 'https://aistudio.google.com',
          icon: 'sparkles',
          keyPlaceholder: 'AIza...'
        },
      ];
      
      export const DEFAULT_MODELS: Record<AIProviderName, string> = {
        openai: 'gpt-4o',
        anthropic: 'claude-3-5-sonnet-20241022',
        google: 'gemini-1.5-pro',
      };
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // TONE PRESETS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const TONE_PRESETS: {
        value: TonePreset;
        label_en: string;
        label_fa: string;
        description_en: string;
        description_fa: string;
      }[] = [
        { 
          value: 'formal', 
          label_en: 'Formal', 
          label_fa: 'Ø±Ø³Ù…ÛŒ',
          description_en: 'Professional and traditional tone',
          description_fa: 'Ù„Ø­Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ùˆ Ø³Ù†ØªÛŒ'
        },
        { 
          value: 'semi-formal', 
          label_en: 'Semi-Formal', 
          label_fa: 'Ù†ÛŒÙ…Ù‡â€ŒØ±Ø³Ù…ÛŒ',
          description_en: 'Balance between formal and casual',
          description_fa: 'ØªØ¹Ø§Ø¯Ù„ Ø¨ÛŒÙ† Ø±Ø³Ù…ÛŒ Ùˆ ØºÛŒØ±Ø±Ø³Ù…ÛŒ'
        },
        { 
          value: 'professional', 
          label_en: 'Professional', 
          label_fa: 'Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ',
          description_en: 'Business-appropriate and competent',
          description_fa: 'Ù…Ù†Ø§Ø³Ø¨ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ùˆ Ø´Ø§ÛŒØ³ØªÙ‡'
        },
        { 
          value: 'friendly', 
          label_en: 'Friendly', 
          label_fa: 'Ø¯ÙˆØ³ØªØ§Ù†Ù‡',
          description_en: 'Warm and approachable',
          description_fa: 'Ú¯Ø±Ù… Ùˆ ØµÙ…ÛŒÙ…ÛŒ'
        },
        { 
          value: 'creative', 
          label_en: 'Creative', 
          label_fa: 'Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡',
          description_en: 'Unique and imaginative',
          description_fa: 'Ù…Ù†Ø­ØµØ±Ø¨Ù‡â€ŒÙØ±Ø¯ Ùˆ ØªØ®ÛŒÙ„ÛŒ'
        },
        { 
          value: 'confident', 
          label_en: 'Confident', 
          label_fa: 'Ù…Ø·Ù…Ø¦Ù†',
          description_en: 'Assertive and self-assured',
          description_fa: 'Ù‚Ø§Ø·Ø¹ Ùˆ Ø¨Ø§ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¨Ù‡ Ù†ÙØ³'
        },
      ];
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // CV FIELDS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const CV_REQUIRED_FIELDS = [
        'personal_info.full_name',
        'personal_info.email',
        'personal_info.phone',
        'personal_info.summary',
      ] as const;
      
      export const CV_RECOMMENDED_FIELDS = [
        'personal_info.location',
        'personal_info.linkedin_url',
        'work_experience',
        'education',
        'skills',
      ] as const;
      
      export const CV_SECTION_LABELS: Record<string, { en: string; fa: string }> = {
        personal_info: { en: 'Personal Information', fa: 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ' },
        work_experience: { en: 'Work Experience', fa: 'Ø³ÙˆØ§Ø¨Ù‚ Ú©Ø§Ø±ÛŒ' },
        education: { en: 'Education', fa: 'ØªØ­ØµÛŒÙ„Ø§Øª' },
        skills: { en: 'Skills', fa: 'Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§' },
        certifications: { en: 'Certifications', fa: 'Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§' },
        languages: { en: 'Languages', fa: 'Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§' },
        projects: { en: 'Projects', fa: 'Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§' },
        additional_sections: { en: 'Additional', fa: 'Ø³Ø§ÛŒØ±' },
      };
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // FILE LIMITS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const MAX_FILE_SIZE_MB = 10;
      export const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;
      
      export const ACCEPTED_CV_FILE_TYPES = {
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],
        'text/markdown': ['.md'],
        'text/plain': ['.txt'],
      };
      
      export const ACCEPTED_TEMPLATE_FILE_TYPES = {
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': ['.docx'],
        'text/markdown': ['.md'],
      };
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // NAVIGATION
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const MAIN_NAVIGATION: NavigationItem[] = [
        { id: 'dashboard', label_key: 'nav.dashboard', href: '/dashboard', icon: 'LayoutDashboard' },
        { id: 'cv-manager', label_key: 'nav.cv_manager', href: '/cv-manager', icon: 'FileText' },
        { id: 'new-application', label_key: 'nav.new_application', href: '/new-application', icon: 'PlusCircle' },
        { id: 'applications', label_key: 'nav.applications', href: '/applications', icon: 'FolderOpen' },
        { id: 'prompts', label_key: 'nav.prompts', href: '/prompts', icon: 'MessageSquare' },
        { id: 'settings', label_key: 'nav.settings', href: '/settings', icon: 'Settings' },
      ];
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // PROMPT CATEGORIES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const PROMPT_CATEGORIES = [
        { id: 'general', label_en: 'General', label_fa: 'Ø¹Ù…ÙˆÙ…ÛŒ' },
        { id: 'tech', label_en: 'Technology', label_fa: 'ÙÙ†Ø§ÙˆØ±ÛŒ' },
        { id: 'creative', label_en: 'Creative', label_fa: 'Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡' },
        { id: 'academic', label_en: 'Academic', label_fa: 'Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ÛŒ' },
        { id: 'executive', label_en: 'Executive', label_fa: 'Ù…Ø¯ÛŒØ±ÛŒØªÛŒ' },
      ];
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // APPLICATION STATUS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      export const APPLICATION_STATUS_CONFIG: Record<string, {
        label_en: string;
        label_fa: string;
        color: string;
        icon: string;
      }> = {
        input: { label_en: 'Input', label_fa: 'ÙˆØ±ÙˆØ¯ÛŒ', color: 'gray', icon: 'Edit' },
        processing: { label_en: 'Processing', label_fa: 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´', color: 'blue', icon: 'Loader' },
        clarification: { label_en: 'Clarification', label_fa: 'Ù¾Ø±Ø³Ø´', color: 'yellow', icon: 'HelpCircle' },
        draft_ready: { label_en: 'Draft Ready', label_fa: 'Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡', color: 'purple', icon: 'FileCheck' },
        editing: { label_en: 'Editing', label_fa: 'ÙˆÛŒØ±Ø§ÛŒØ´', color: 'orange', icon: 'Pencil' },
        finalized: { label_en: 'Finalized', label_fa: 'Ù†Ù‡Ø§ÛŒÛŒ', color: 'green', icon: 'CheckCircle' },
      };

  - id: F080
    path: "src/lib/helpers.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F080] src/lib/helpers.ts
      // Utility Functions
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      import { type ClassValue, clsx } from 'clsx';
      import { twMerge } from 'tailwind-merge';
      import type { AppLocale } from './types';
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // CLASSNAMES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Merge Tailwind classes with clsx
       */
      export function cn(...inputs: ClassValue[]): string {
        return twMerge(clsx(inputs));
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // ID GENERATION
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Generate a unique UUID
       */
      export function generateId(): string {
        return crypto.randomUUID();
      }
      
      /**
       * Generate a short ID (8 characters)
       */
      export function generateShortId(): string {
        return crypto.randomUUID().split('-')[0];
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // DATE FORMATTING
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Format a date string for display
       */
      export function formatDate(
        dateString: string, 
        locale: AppLocale = 'en',
        options?: Intl.DateTimeFormatOptions
      ): string {
        const localeCode = locale === 'fa' ? 'fa-IR' : 'en-US';
        const defaultOptions: Intl.DateTimeFormatOptions = {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
        };
        return new Date(dateString).toLocaleDateString(localeCode, options || defaultOptions);
      }
      
      /**
       * Format a date for forms (YYYY-MM-DD)
       */
      export function formatDateForInput(dateString: string): string {
        return new Date(dateString).toISOString().split('T')[0];
      }
      
      /**
       * Get relative time (e.g., "2 hours ago")
       */
      export function getRelativeTime(dateString: string, locale: AppLocale = 'en'): string {
        const localeCode = locale === 'fa' ? 'fa-IR' : 'en-US';
        const rtf = new Intl.RelativeTimeFormat(localeCode, { numeric: 'auto' });
        const now = new Date();
        const date = new Date(dateString);
        const diffInSeconds = Math.floor((date.getTime() - now.getTime()) / 1000);
        
        const intervals: { unit: Intl.RelativeTimeFormatUnit; seconds: number }[] = [
          { unit: 'year', seconds: 31536000 },
          { unit: 'month', seconds: 2592000 },
          { unit: 'week', seconds: 604800 },
          { unit: 'day', seconds: 86400 },
          { unit: 'hour', seconds: 3600 },
          { unit: 'minute', seconds: 60 },
          { unit: 'second', seconds: 1 },
        ];
        
        for (const interval of intervals) {
          const count = Math.floor(Math.abs(diffInSeconds) / interval.seconds);
          if (count >= 1) {
            return rtf.format(diffInSeconds > 0 ? count : -count, interval.unit);
          }
        }
        return rtf.format(0, 'second');
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // TEXT UTILITIES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Truncate text to a maximum length
       */
      export function truncateText(text: string, maxLength: number): string {
        if (text.length <= maxLength) return text;
        return text.substring(0, maxLength).trim() + '...';
      }
      
      /**
       * Capitalize first letter
       */
      export function capitalize(text: string): string {
        return text.charAt(0).toUpperCase() + text.slice(1);
      }
      
      /**
       * Convert to title case
       */
      export function toTitleCase(text: string): string {
        return text
          .toLowerCase()
          .split(' ')
          .map(word => word.charAt(0).toUpperCase() + word.slice(1))
          .join(' ');
      }
      
      /**
       * Slugify a string
       */
      export function slugify(text: string): string {
        return text
          .toLowerCase()
          .replace(/[^\w\s-]/g, '')
          .replace(/[\s_-]+/g, '-')
          .replace(/^-+|-+$/g, '');
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // LOCALE UTILITIES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Check if locale is RTL
       */
      export function isRTL(locale: AppLocale): boolean {
        return locale === 'fa';
      }
      
      /**
       * Get direction for a locale
       */
      export function getDirection(locale: AppLocale): 'ltr' | 'rtl' {
        return isRTL(locale) ? 'rtl' : 'ltr';
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // VALIDATION
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Validate email format
       */
      export function isValidEmail(email: string): boolean {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
      }
      
      /**
       * Validate URL format
       */
      export function isValidUrl(url: string): boolean {
        try {
          new URL(url);
          return true;
        } catch {
          return false;
        }
      }
      
      /**
       * Check if string is empty or whitespace only
       */
      export function isEmpty(value: string | null | undefined): boolean {
        return value === null || value === undefined || value.trim() === '';
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // FILE UTILITIES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Format file size for display
       */
      export function formatFileSize(bytes: number): string {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
      
      /**
       * Get file extension from filename
       */
      export function getFileExtension(filename: string): string {
        return filename.slice(((filename.lastIndexOf('.') - 1) >>> 0) + 2).toLowerCase();
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // ASYNC UTILITIES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Sleep for a given number of milliseconds
       */
      export function sleep(ms: number): Promise<void> {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
      
      /**
       * Debounce a function
       */
      export function debounce<T extends (...args: unknown[]) => unknown>(
        func: T,
        wait: number
      ): (...args: Parameters<T>) => void {
        let timeoutId: ReturnType<typeof setTimeout> | null = null;
        
        return (...args: Parameters<T>) => {
          if (timeoutId) {
            clearTimeout(timeoutId);
          }
          timeoutId = setTimeout(() => {
            func(...args);
          }, wait);
        };
      }
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // OBJECT UTILITIES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      /**
       * Deep clone an object
       */
      export function deepClone<T>(obj: T): T {
        return JSON.parse(JSON.stringify(obj));
      }
      
      /**
       * Check if two objects are deeply equal
       */
      export function deepEqual(a: unknown, b: unknown): boolean {
        return JSON.stringify(a) === JSON.stringify(b);
      }
      
      /**
       * Pick specific keys from an object
       */
      export function pick<T extends object, K extends keyof T>(
        obj: T,
        keys: K[]
      ): Pick<T, K> {
        const result = {} as Pick<T, K>;
        for (const key of keys) {
          if (key in obj) {
            result[key] = obj[key];
          }
        }
        return result;
      }
      
      /**
       * Omit specific keys from an object
       */
      export function omit<T extends object, K extends keyof T>(
        obj: T,
        keys: K[]
      ): Omit<T, K> {
        const result = { ...obj };
        for (const key of keys) {
          delete result[key];
        }
        return result as Omit<T, K>;
      }

files_to_modify: []

files_available:
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03

commands: []

instructions: |
  1. Create src/lib/constants.ts with all application constants.
  
  2. Create src/lib/helpers.ts with all utility functions.
  
  3. Both files import types from [F079] src/lib/types.ts.
  
  4. Make sure all functions and constants are exported.
  
  5. Do NOT modify any existing files.
  
  6. Note: There's already a src/lib/utils.ts from shadcn (F090) - 
     we keep that and add helpers.ts separately.

checkpoint_tests:
  - id: T01
    description: "constants.ts file exists"
    type: "files_exist"
    files:
      - "src/lib/constants.ts"

  - id: T02
    description: "helpers.ts file exists"
    type: "files_exist"
    files:
      - "src/lib/helpers.ts"

  - id: T03
    description: "Key constants are exported"
    type: "grep"
    file: "src/lib/constants.ts"
    patterns:
      - "export const APP_NAME"
      - "export const SUPPORTED_LOCALES"
      - "export const SUPPORTED_OUTPUT_LANGUAGES"
      - "export const SUPPORTED_AI_PROVIDERS"
      - "export const TONE_PRESETS"
      - "export const CV_REQUIRED_FIELDS"
      - "export const MAIN_NAVIGATION"

  - id: T04
    description: "Key helpers are exported"
    type: "grep"
    file: "src/lib/helpers.ts"
    patterns:
      - "export function cn"
      - "export function generateId"
      - "export function formatDate"
      - "export function isRTL"
      - "export function truncateText"

  - id: T05
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

max_retries: 3
B05.yaml
YAML

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BLOCK B05: Internationalization (i18n) System
# Phase 0: Foundation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

id: B05
name: "Internationalization (i18n) System"
phase: 0
phase_name: "Foundation"

goal: |
  Set up the complete internationalization system using next-intl.
  This enables the app to work in both English and Farsi (Persian),
  with proper RTL support for Farsi.

dependencies:
  - B04

files_to_create:
  - id: F086
    path: "src/i18n/config.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F086] src/i18n/config.ts
      // i18n Configuration
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      export const locales = ['en', 'fa'] as const;
      export type Locale = (typeof locales)[number];
      
      export const defaultLocale: Locale = 'en';
      
      export const localeNames: Record<Locale, string> = {
        en: 'English',
        fa: 'ÙØ§Ø±Ø³ÛŒ',
      };
      
      export const localeDirections: Record<Locale, 'ltr' | 'rtl'> = {
        en: 'ltr',
        fa: 'rtl',
      };

  - id: F087
    path: "src/i18n/en.json"
    content: |
      {
        "common": {
          "app_name": "CV Tailor",
          "loading": "Loading...",
          "save": "Save",
          "cancel": "Cancel",
          "delete": "Delete",
          "edit": "Edit",
          "add": "Add",
          "confirm": "Confirm",
          "download": "Download",
          "upload": "Upload",
          "back": "Back",
          "next": "Next",
          "previous": "Previous",
          "submit": "Submit",
          "search": "Search",
          "filter": "Filter",
          "status": "Status",
          "actions": "Actions",
          "language": "Language",
          "settings": "Settings",
          "close": "Close",
          "open": "Open",
          "yes": "Yes",
          "no": "No",
          "or": "or",
          "and": "and",
          "optional": "Optional",
          "required": "Required",
          "success": "Success",
          "error": "Error",
          "warning": "Warning",
          "info": "Info",
          "view": "View",
          "copy": "Copy",
          "copied": "Copied!",
          "select": "Select",
          "select_all": "Select All",
          "deselect_all": "Deselect All",
          "no_results": "No results found",
          "try_again": "Try Again",
          "learn_more": "Learn More"
        },
        "nav": {
          "dashboard": "Dashboard",
          "cv_manager": "My CV",
          "new_application": "New Application",
          "applications": "My Applications",
          "prompts": "Prompt Management",
          "templates": "Templates",
          "settings": "Settings",
          "logout": "Logout",
          "login": "Login"
        },
        "auth": {
          "login": "Login",
          "login_with_google": "Login with Google",
          "logout": "Logout",
          "welcome": "Welcome",
          "welcome_back": "Welcome back",
          "login_title": "Sign in to your account",
          "login_subtitle": "Create tailored CVs, cover letters, and application emails",
          "logging_in": "Logging in...",
          "login_error": "Login failed. Please try again.",
          "dev_login_title": "Development Login",
          "dev_login_subtitle": "This is a temporary login for development only",
          "enter_email": "Enter your email",
          "enter_name": "Enter your name"
        },
        "dashboard": {
          "title": "Dashboard",
          "welcome_message": "Welcome to CV Tailor",
          "quick_actions": "Quick Actions",
          "recent_applications": "Recent Applications",
          "cv_status": "CV Status",
          "cv_complete": "Your CV is complete",
          "cv_incomplete": "Your CV needs attention",
          "cv_missing": "No CV uploaded yet",
          "create_first_application": "Create your first application",
          "view_all_applications": "View all applications",
          "total_applications": "Total Applications",
          "draft_applications": "Drafts",
          "completed_applications": "Completed"
        },
        "cv": {
          "title": "Comprehensive CV",
          "page_title": "My CV",
          "page_subtitle": "Manage your comprehensive CV that will be used for all applications",
          "upload_cv": "Upload CV",
          "upload_description": "Upload your comprehensive CV in Word or Markdown format",
          "upload_drag_drop": "Drag and drop your file here, or click to browse",
          "supported_formats": "Supported formats: .docx, .md",
          "or_enter_manually": "Or enter manually",
          "enter_manually": "Enter Manually",
          "personal_info": "Personal Information",
          "full_name": "Full Name",
          "email": "Email",
          "phone": "Phone",
          "location": "Location",
          "linkedin": "LinkedIn URL",
          "website": "Website URL",
          "summary": "Professional Summary",
          "work_experience": "Work Experience",
          "add_experience": "Add Experience",
          "job_title": "Job Title",
          "company": "Company",
          "start_date": "Start Date",
          "end_date": "End Date",
          "current_job": "I currently work here",
          "description": "Description",
          "achievements": "Key Achievements",
          "education": "Education",
          "add_education": "Add Education",
          "degree": "Degree",
          "field_of_study": "Field of Study",
          "institution": "Institution",
          "gpa": "GPA",
          "skills": "Skills",
          "add_skill": "Add Skill",
          "certifications": "Certifications",
          "add_certification": "Add Certification",
          "cert_name": "Certification Name",
          "issuer": "Issuer",
          "date_obtained": "Date Obtained",
          "expiry_date": "Expiry Date",
          "credential_id": "Credential ID",
          "credential_url": "Credential URL",
          "languages": "Languages",
          "add_language": "Add Language",
          "language_name": "Language",
          "proficiency": "Proficiency Level",
          "proficiency_native": "Native",
          "proficiency_fluent": "Fluent",
          "proficiency_advanced": "Advanced",
          "proficiency_intermediate": "Intermediate",
          "proficiency_beginner": "Beginner",
          "projects": "Projects",
          "add_project": "Add Project",
          "project_name": "Project Name",
          "project_description": "Project Description",
          "technologies_used": "Technologies Used",
          "project_url": "Project URL",
          "additional_sections": "Additional Sections",
          "add_section": "Add Section",
          "section_title": "Section Title",
          "section_content": "Section Content",
          "incomplete_fields": "Incomplete Fields",
          "please_complete": "Please complete the following fields for better results",
          "field_complete": "Complete",
          "field_incomplete": "Incomplete",
          "field_optional": "Optional",
          "save_cv": "Save CV",
          "saving": "Saving...",
          "saved_successfully": "CV saved successfully",
          "parsing_file": "Parsing file...",
          "parse_error": "Failed to parse file",
          "preview": "Preview",
          "raw_text": "Raw Text"
        },
        "prompts": {
          "title": "Prompt Management",
          "page_subtitle": "Create and manage prompts that control how your documents are generated",
          "add_new": "Add New Prompt",
          "edit_prompt": "Edit Prompt",
          "create_prompt": "Create Prompt",
          "delete_prompt": "Delete Prompt",
          "delete_confirm": "Are you sure you want to delete this prompt?",
          "prompt_title": "Title",
          "prompt_title_en": "Title (English)",
          "prompt_title_fa": "Title (ÙØ§Ø±Ø³ÛŒ)",
          "prompt_description": "Description",
          "prompt_description_en": "Description (English)",
          "prompt_description_fa": "Description (ÙØ§Ø±Ø³ÛŒ)",
          "prompt_text": "Prompt Text",
          "prompt_text_help": "The instructions that will be sent to the AI",
          "category": "Category",
          "active": "Active",
          "inactive": "Inactive",
          "sort_order": "Sort Order",
          "no_prompts": "No prompts yet",
          "create_first_prompt": "Create your first prompt to get started",
          "saved_successfully": "Prompt saved successfully",
          "deleted_successfully": "Prompt deleted successfully"
        },
        "ai": {
          "title": "AI Settings",
          "api_keys": "AI API Keys",
          "api_keys_subtitle": "Connect your AI provider API keys to enable document generation",
          "add_key": "Add API Key",
          "edit_key": "Edit API Key",
          "provider": "AI Provider",
          "api_key": "API Key",
          "enter_api_key": "Enter your API key",
          "model": "Model",
          "select_model": "Select a model",
          "status_connected": "Connected",
          "status_disconnected": "Disconnected",
          "status_invalid": "Invalid Key",
          "status_checking": "Checking...",
          "available_models": "Available Models",
          "token_balance": "Token Balance",
          "test_connection": "Test Connection",
          "testing": "Testing...",
          "connection_success": "Connection successful!",
          "connection_failed": "Connection failed",
          "select_for_draft": "Use for Draft",
          "select_for_final": "Use for Final Output",
          "draft_mode": "Draft Mode",
          "final_mode": "Final Mode",
          "no_keys": "No API keys configured",
          "add_first_key": "Add your first API key to get started",
          "key_saved": "API key saved successfully",
          "key_deleted": "API key deleted",
          "key_hidden": "Key hidden for security",
          "show_key": "Show key",
          "hide_key": "Hide key"
        },
        "application": {
          "new_title": "New Job Application",
          "page_subtitle": "Create a tailored CV, cover letter, and application email for a specific job",
          "step_job": "Job Details",
          "step_prompts": "Select Prompts",
          "step_ai": "AI Settings",
          "step_output": "Output Settings",
          "step_process": "Generate",
          "step_review": "Review & Edit",
          "step_download": "Download",
          "job_title": "Job Title",
          "company_name": "Company Name",
          "job_description": "Job Description",
          "enter_job_description": "Paste the job description here",
          "job_description_help": "The full job posting or description",
          "select_prompts": "Select Prompts",
          "select_prompts_help": "Choose one or more prompts to guide the AI",
          "no_prompts_selected": "No prompts selected",
          "select_ai": "Select AI Model",
          "select_ai_help": "Choose which AI models to use for generation",
          "no_ai_configured": "No AI providers configured",
          "go_to_settings": "Go to Settings",
          "select_language": "Output Language",
          "select_language_help": "The language for your generated documents",
          "select_tone": "Response Tone",
          "tone_preset": "Choose Preset",
          "tone_custom": "Describe Custom Tone",
          "custom_tone_placeholder": "Describe the tone you want (e.g., enthusiastic but professional)",
          "select_template": "Select Template",
          "template_optional": "Templates are optional",
          "no_templates": "No templates available",
          "start_processing": "Start Processing",
          "processing": "Processing...",
          "ai_thinking": "AI is thinking...",
          "ai_asking": "AI has a question",
          "your_answer": "Your Answer",
          "send_answer": "Send Answer",
          "skip_question": "Skip",
          "draft_ready": "Draft Ready",
          "edit_output": "Edit Output",
          "approve_output": "Approve & Generate Documents",
          "regenerate": "Regenerate",
          "generating_documents": "Generating Documents...",
          "documents_ready": "Documents Ready!",
          "tailored_cv": "Tailored CV",
          "cover_letter": "Cover Letter",
          "application_email": "Application Email",
          "download_word": "Download Word",
          "download_markdown": "Download Markdown",
          "download_all": "Download All",
          "copy_to_clipboard": "Copy to Clipboard",
          "view_application": "View Application",
          "application_saved": "Application saved",
          "continue_editing": "Continue Editing"
        },
        "applications": {
          "title": "My Applications",
          "page_subtitle": "View and manage all your job applications",
          "no_applications": "No applications yet",
          "create_first": "Create your first application",
          "filter_all": "All",
          "filter_drafts": "Drafts",
          "filter_completed": "Completed",
          "sort_newest": "Newest First",
          "sort_oldest": "Oldest First",
          "delete_confirm": "Are you sure you want to delete this application?",
          "deleted_successfully": "Application deleted"
        },
        "templates": {
          "title": "Template Management",
          "page_subtitle": "Upload and manage templates for your documents",
          "upload_template": "Upload Template",
          "template_name": "Template Name",
          "template_type": "Template Type",
          "type_cv": "CV Template",
          "type_cover_letter": "Cover Letter Template",
          "type_email": "Email Template",
          "select_template": "Select Template",
          "no_templates": "No templates uploaded",
          "upload_first": "Upload your first template",
          "preview": "Preview Template",
          "delete_confirm": "Are you sure you want to delete this template?",
          "uploaded_successfully": "Template uploaded successfully",
          "deleted_successfully": "Template deleted"
        },
        "settings": {
          "title": "Settings",
          "page_subtitle": "Configure your application preferences",
          "ui_language": "Interface Language",
          "ui_language_help": "The language used for the application interface",
          "profile": "Profile",
          "profile_info": "Profile Information",
          "name": "Name",
          "email": "Email",
          "save_profile": "Save Profile",
          "saved_successfully": "Settings saved successfully",
          "danger_zone": "Danger Zone",
          "delete_account": "Delete Account",
          "delete_account_warning": "This action cannot be undone. All your data will be permanently deleted."
        },
        "errors": {
          "generic": "Something went wrong. Please try again.",
          "network": "Network error. Please check your connection.",
          "not_found": "The requested resource was not found.",
          "unauthorized": "You are not authorized to perform this action.",
          "validation": "Please check your input and try again.",
          "file_too_large": "File is too large. Maximum size is {size}MB.",
          "invalid_file_type": "Invalid file type. Supported formats: {formats}",
          "required_field": "This field is required",
          "invalid_email": "Please enter a valid email address",
          "invalid_url": "Please enter a valid URL"
        }
      }

  - id: F088
    path: "src/i18n/fa.json"
    content: |
      {
        "common": {
          "app_name": "Ø³ÛŒâ€ŒÙˆÛŒ ØªÛŒÙ„ÙˆØ±",
          "loading": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...",
          "save": "Ø°Ø®ÛŒØ±Ù‡",
          "cancel": "Ø§Ù†ØµØ±Ø§Ù",
          "delete": "Ø­Ø°Ù",
          "edit": "ÙˆÛŒØ±Ø§ÛŒØ´",
          "add": "Ø§ÙØ²ÙˆØ¯Ù†",
          "confirm": "ØªØ£ÛŒÛŒØ¯",
          "download": "Ø¯Ø§Ù†Ù„ÙˆØ¯",
          "upload": "Ø¢Ù¾Ù„ÙˆØ¯",
          "back": "Ø¨Ø§Ø²Ú¯Ø´Øª",
          "next": "Ø¨Ø¹Ø¯ÛŒ",
          "previous": "Ù‚Ø¨Ù„ÛŒ",
          "submit": "Ø§Ø±Ø³Ø§Ù„",
          "search": "Ø¬Ø³ØªØ¬Ùˆ",
          "filter": "ÙÛŒÙ„ØªØ±",
          "status": "ÙˆØ¶Ø¹ÛŒØª",
          "actions": "Ø¹Ù…Ù„ÛŒØ§Øª",
          "language": "Ø²Ø¨Ø§Ù†",
          "settings": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª",
          "close": "Ø¨Ø³ØªÙ†",
          "open": "Ø¨Ø§Ø² Ú©Ø±Ø¯Ù†",
          "yes": "Ø¨Ù„Ù‡",
          "no": "Ø®ÛŒØ±",
          "or": "ÛŒØ§",
          "and": "Ùˆ",
          "optional": "Ø§Ø®ØªÛŒØ§Ø±ÛŒ",
          "required": "Ø§Ù„Ø²Ø§Ù…ÛŒ",
          "success": "Ù…ÙˆÙÙ‚ÛŒØª",
          "error": "Ø®Ø·Ø§",
          "warning": "Ù‡Ø´Ø¯Ø§Ø±",
          "info": "Ø§Ø·Ù„Ø§Ø¹Ø§Øª",
          "view": "Ù…Ø´Ø§Ù‡Ø¯Ù‡",
          "copy": "Ú©Ù¾ÛŒ",
          "copied": "Ú©Ù¾ÛŒ Ø´Ø¯!",
          "select": "Ø§Ù†ØªØ®Ø§Ø¨",
          "select_all": "Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡",
          "deselect_all": "Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡",
          "no_results": "Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯",
          "try_again": "ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯",
          "learn_more": "Ø¨ÛŒØ´ØªØ± Ø¨Ø¯Ø§Ù†ÛŒØ¯"
        },
        "nav": {
          "dashboard": "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯",
          "cv_manager": "Ø³ÛŒâ€ŒÙˆÛŒ Ù…Ù†",
          "new_application": "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯",
          "applications": "Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†",
          "prompts": "Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§",
          "templates": "Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§",
          "settings": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª",
          "logout": "Ø®Ø±ÙˆØ¬",
          "login": "ÙˆØ±ÙˆØ¯"
        },
        "auth": {
          "login": "ÙˆØ±ÙˆØ¯",
          "login_with_google": "ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú¯ÙˆÚ¯Ù„",
          "logout": "Ø®Ø±ÙˆØ¬",
          "welcome": "Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯",
          "welcome_back": "Ø®ÙˆØ´ Ø¨Ø±Ú¯Ø´ØªÛŒØ¯",
          "login_title": "ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯",
          "login_subtitle": "Ø³ÛŒâ€ŒÙˆÛŒØŒ Ú©Ø§ÙˆØ±Ù„ØªØ± Ùˆ Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø³Ø§Ø²ÛŒØ¯",
          "logging_in": "Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...",
          "login_error": "ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",
          "dev_login_title": "ÙˆØ±ÙˆØ¯ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ù‡",
          "dev_login_subtitle": "Ø§ÛŒÙ† ÙˆØ±ÙˆØ¯ Ù…ÙˆÙ‚Øª ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª",
          "enter_email": "Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
          "enter_name": "Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
        },
        "dashboard": {
          "title": "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯",
          "welcome_message": "Ø¨Ù‡ Ø³ÛŒâ€ŒÙˆÛŒ ØªÛŒÙ„ÙˆØ± Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯",
          "quick_actions": "Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹",
          "recent_applications": "Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±",
          "cv_status": "ÙˆØ¶Ø¹ÛŒØª Ø³ÛŒâ€ŒÙˆÛŒ",
          "cv_complete": "Ø³ÛŒâ€ŒÙˆÛŒ Ø´Ù…Ø§ Ú©Ø§Ù…Ù„ Ø§Ø³Øª",
          "cv_incomplete": "Ø³ÛŒâ€ŒÙˆÛŒ Ø´Ù…Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø¯Ø§Ø±Ø¯",
          "cv_missing": "Ù‡Ù†ÙˆØ² Ø³ÛŒâ€ŒÙˆÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡",
          "create_first_application": "Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø³Ø§Ø²ÛŒØ¯",
          "view_all_applications": "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§",
          "total_applications": "Ú©Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§",
          "draft_applications": "Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³â€ŒÙ‡Ø§",
          "completed_applications": "ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡"
        },
        "cv": {
          "title": "Ø³ÛŒâ€ŒÙˆÛŒ Ø¬Ø§Ù…Ø¹",
          "page_title": "Ø³ÛŒâ€ŒÙˆÛŒ Ù…Ù†",
          "page_subtitle": "Ø³ÛŒâ€ŒÙˆÛŒ Ø¬Ø§Ù…Ø¹ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯",
          "upload_cv": "Ø¢Ù¾Ù„ÙˆØ¯ Ø³ÛŒâ€ŒÙˆÛŒ",
          "upload_description": "Ø³ÛŒâ€ŒÙˆÛŒ Ø¬Ø§Ù…Ø¹ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Word ÛŒØ§ Markdown Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯",
          "upload_drag_drop": "ÙØ§ÛŒÙ„ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú©Ø´ÛŒØ¯ Ùˆ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯ØŒ ÛŒØ§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯",
          "supported_formats": "ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡: .docx, .md",
          "or_enter_manually": "ÛŒØ§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
          "enter_manually": "ÙˆØ±ÙˆØ¯ Ø¯Ø³ØªÛŒ",
          "personal_info": "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ",
          "full_name": "Ù†Ø§Ù… Ú©Ø§Ù…Ù„",
          "email": "Ø§ÛŒÙ…ÛŒÙ„",
          "phone": "ØªÙ„ÙÙ†",
          "location": "Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ",
          "linkedin": "Ø¢Ø¯Ø±Ø³ Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†",
          "website": "Ø¢Ø¯Ø±Ø³ ÙˆØ¨â€ŒØ³Ø§ÛŒØª",
          "summary": "Ø®Ù„Ø§ØµÙ‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ",
          "work_experience": "Ø³ÙˆØ§Ø¨Ù‚ Ú©Ø§Ø±ÛŒ",
          "add_experience": "Ø§ÙØ²ÙˆØ¯Ù† ØªØ¬Ø±Ø¨Ù‡",
          "job_title": "Ø¹Ù†ÙˆØ§Ù† Ø´ØºÙ„",
          "company": "Ø´Ø±Ú©Øª",
          "start_date": "ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹",
          "end_date": "ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†",
          "current_job": "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø§ÛŒÙ†Ø¬Ø§ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù…",
          "description": "ØªÙˆØ¶ÛŒØ­Ø§Øª",
          "achievements": "Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ",
          "education": "ØªØ­ØµÛŒÙ„Ø§Øª",
          "add_education": "Ø§ÙØ²ÙˆØ¯Ù† ØªØ­ØµÛŒÙ„Ø§Øª",
          "degree": "Ù…Ø¯Ø±Ú©",
          "field_of_study": "Ø±Ø´ØªÙ‡ ØªØ­ØµÛŒÙ„ÛŒ",
          "institution": "Ù…Ø¤Ø³Ø³Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ",
          "gpa": "Ù…Ø¹Ø¯Ù„",
          "skills": "Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§",
          "add_skill": "Ø§ÙØ²ÙˆØ¯Ù† Ù…Ù‡Ø§Ø±Øª",
          "certifications": "Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§",
          "add_certification": "Ø§ÙØ²ÙˆØ¯Ù† Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡",
          "cert_name": "Ù†Ø§Ù… Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡",
          "issuer": "ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡",
          "date_obtained": "ØªØ§Ø±ÛŒØ® Ø§Ø®Ø°",
          "expiry_date": "ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§",
          "credential_id": "Ø´Ù†Ø§Ø³Ù‡ Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡",
          "credential_url": "Ù„ÛŒÙ†Ú© Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡",
          "languages": "Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§",
          "add_language": "Ø§ÙØ²ÙˆØ¯Ù† Ø²Ø¨Ø§Ù†",
          "language_name": "Ø²Ø¨Ø§Ù†",
          "proficiency": "Ø³Ø·Ø­ Ù…Ù‡Ø§Ø±Øª",
          "proficiency_native": "Ø²Ø¨Ø§Ù† Ù…Ø§Ø¯Ø±ÛŒ",
          "proficiency_fluent": "Ù…Ø³Ù„Ø·",
          "proficiency_advanced": "Ù¾ÛŒØ´Ø±ÙØªÙ‡",
          "proficiency_intermediate": "Ù…ØªÙˆØ³Ø·",
          "proficiency_beginner": "Ù…Ø¨ØªØ¯ÛŒ",
          "projects": "Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§",
          "add_project": "Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÚ˜Ù‡",
          "project_name": "Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡",
          "project_description": "ØªÙˆØ¶ÛŒØ­Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡",
          "technologies_used": "ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡",
          "project_url": "Ù„ÛŒÙ†Ú© Ù¾Ø±ÙˆÚ˜Ù‡",
          "additional_sections": "Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ",
          "add_section": "Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø®Ø´",
          "section_title": "Ø¹Ù†ÙˆØ§Ù† Ø¨Ø®Ø´",
          "section_content": "Ù…Ø­ØªÙˆØ§ÛŒ Ø¨Ø®Ø´",
          "incomplete_fields": "ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù‚Øµ",
          "please_complete": "Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†ØªÛŒØ¬Ù‡ Ø¨Ù‡ØªØ± ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯",
          "field_complete": "Ú©Ø§Ù…Ù„",
          "field_incomplete": "Ù†Ø§Ù‚Øµ",
          "field_optional": "Ø§Ø®ØªÛŒØ§Ø±ÛŒ",
          "save_cv": "Ø°Ø®ÛŒØ±Ù‡ Ø³ÛŒâ€ŒÙˆÛŒ",
          "saving": "Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...",
          "saved_successfully": "Ø³ÛŒâ€ŒÙˆÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
          "parsing_file": "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„...",
          "parse_error": "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„",
          "preview": "Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´",
          "raw_text": "Ù…ØªÙ† Ø®Ø§Ù…"
        },
        "prompts": {
          "title": "Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§",
          "page_subtitle": "Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù†Ø­ÙˆÙ‡ ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø§ Ú©Ù†ØªØ±Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯",
          "add_new": "Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±Ø§Ù…Ù¾Øª Ø¬Ø¯ÛŒØ¯",
          "edit_prompt": "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø§Ù…Ù¾Øª",
          "create_prompt": "Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±Ø§Ù…Ù¾Øª",
          "delete_prompt": "Ø­Ø°Ù Ù¾Ø±Ø§Ù…Ù¾Øª",
          "delete_confirm": "Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù¾Ø±Ø§Ù…Ù¾Øª Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ",
          "prompt_title": "Ø¹Ù†ÙˆØ§Ù†",
          "prompt_title_en": "Ø¹Ù†ÙˆØ§Ù† (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)",
          "prompt_title_fa": "Ø¹Ù†ÙˆØ§Ù† (ÙØ§Ø±Ø³ÛŒ)",
          "prompt_description": "ØªÙˆØ¶ÛŒØ­Ø§Øª",
          "prompt_description_en": "ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)",
          "prompt_description_fa": "ØªÙˆØ¶ÛŒØ­Ø§Øª (ÙØ§Ø±Ø³ÛŒ)",
          "prompt_text": "Ù…ØªÙ† Ù¾Ø±Ø§Ù…Ù¾Øª",
          "prompt_text_help": "Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯",
          "category": "Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",
          "active": "ÙØ¹Ø§Ù„",
          "inactive": "ØºÛŒØ±ÙØ¹Ø§Ù„",
          "sort_order": "ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´",
          "no_prompts": "Ù‡Ù†ÙˆØ² Ù¾Ø±Ø§Ù…Ù¾ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯",
          "create_first_prompt": "Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø±Ø§Ù…Ù¾Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯",
          "saved_successfully": "Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
          "deleted_successfully": "Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯"
        },
        "ai": {
          "title": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "api_keys": "Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ API Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "api_keys_subtitle": "Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ API Ø³Ø±ÙˆÛŒØ³â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…ØªØµÙ„ Ú©Ù†ÛŒØ¯",
          "add_key": "Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ API",
          "edit_key": "ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù„ÛŒØ¯ API",
          "provider": "Ø³Ø±ÙˆÛŒØ³ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "api_key": "Ú©Ù„ÛŒØ¯ API",
          "enter_api_key": "Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
          "model": "Ù…Ø¯Ù„",
          "select_model": "ÛŒÚ© Ù…Ø¯Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
          "status_connected": "Ù…ØªØµÙ„",
          "status_disconnected": "Ù‚Ø·Ø¹",
          "status_invalid": "Ú©Ù„ÛŒØ¯ Ù†Ø§Ù…Ø¹ØªØ¨Ø±",
          "status_checking": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...",
          "available_models": "Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³",
          "token_balance": "Ù…ÙˆØ¬ÙˆØ¯ÛŒ ØªÙˆÚ©Ù†",
          "test_connection": "ØªØ³Øª Ø§ØªØµØ§Ù„",
          "testing": "Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...",
          "connection_success": "Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚!",
          "connection_failed": "Ø§ØªØµØ§Ù„ Ù†Ø§Ù…ÙˆÙÙ‚",
          "select_for_draft": "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³",
          "select_for_final": "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù‡Ø§ÛŒÛŒ",
          "draft_mode": "Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³",
          "final_mode": "Ø­Ø§Ù„Øª Ù†Ù‡Ø§ÛŒÛŒ",
          "no_keys": "Ú©Ù„ÛŒØ¯ API ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡",
          "add_first_key": "Ø§ÙˆÙ„ÛŒÙ† Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",
          "key_saved": "Ú©Ù„ÛŒØ¯ API Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
          "key_deleted": "Ú©Ù„ÛŒØ¯ API Ø­Ø°Ù Ø´Ø¯",
          "key_hidden": "Ú©Ù„ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ù¾Ù†Ù‡Ø§Ù† Ø´Ø¯Ù‡",
          "show_key": "Ù†Ù…Ø§ÛŒØ´ Ú©Ù„ÛŒØ¯",
          "hide_key": "Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒØ¯"
        },
        "application": {
          "new_title": "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´ØºÙ„ÛŒ Ø¬Ø¯ÛŒØ¯",
          "page_subtitle": "ÛŒÚ© Ø³ÛŒâ€ŒÙˆÛŒØŒ Ú©Ø§ÙˆØ±Ù„ØªØ± Ùˆ Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø´ØºÙ„ Ø®Ø§Øµ Ø¨Ø³Ø§Ø²ÛŒØ¯",
          "step_job": "Ø¬Ø²Ø¦ÛŒØ§Øª Ø´ØºÙ„",
          "step_prompts": "Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø§Ù…Ù¾Øª",
          "step_ai": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª AI",
          "step_output": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø±ÙˆØ¬ÛŒ",
          "step_process": "ØªÙˆÙ„ÛŒØ¯",
          "step_review": "Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´",
          "step_download": "Ø¯Ø§Ù†Ù„ÙˆØ¯",
          "job_title": "Ø¹Ù†ÙˆØ§Ù† Ø´ØºÙ„",
          "company_name": "Ù†Ø§Ù… Ø´Ø±Ú©Øª",
          "job_description": "Ø´Ø±Ø­ Ø´ØºÙ„",
          "enter_job_description": "Ø´Ø±Ø­ Ø´ØºÙ„ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
          "job_description_help": "Ø¢Ú¯Ù‡ÛŒ ÛŒØ§ Ø´Ø±Ø­ Ú©Ø§Ù…Ù„ Ø´ØºÙ„",
          "select_prompts": "Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§",
          "select_prompts_help": "ÛŒÚ© ÛŒØ§ Ú†Ù†Ø¯ Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø¯Ø§ÛŒØª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
          "no_prompts_selected": "Ù¾Ø±Ø§Ù…Ù¾ØªÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡",
          "select_ai": "Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "select_ai_help": "Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
          "no_ai_configured": "Ø³Ø±ÙˆÛŒØ³ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡",
          "go_to_settings": "Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª",
          "select_language": "Ø²Ø¨Ø§Ù† Ø®Ø±ÙˆØ¬ÛŒ",
          "select_language_help": "Ø²Ø¨Ø§Ù† Ù…Ø³ØªÙ†Ø¯Ø§Øª ØªÙˆÙ„ÛŒØ¯Ø´Ø¯Ù‡",
          "select_tone": "Ù„Ø­Ù† Ù¾Ø§Ø³Ø®",
          "tone_preset": "Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶",
          "tone_custom": "ØªÙˆØµÛŒÙ Ù„Ø­Ù† Ø¯Ù„Ø®ÙˆØ§Ù‡",
          "custom_tone_placeholder": "Ù„Ø­Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ ØªÙˆØµÛŒÙ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ù„Ø§Ù‹: Ù¾Ø±Ø§Ù†Ø±Ú˜ÛŒ ÙˆÙ„ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ)",
          "select_template": "Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø§Ù„Ø¨",
          "template_optional": "Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ù‡Ø³ØªÙ†Ø¯",
          "no_templates": "Ù‚Ø§Ù„Ø¨ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª",
          "start_processing": "Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´",
          "processing": "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...",
          "ai_thinking": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù†...",
          "ai_asking": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±Ø¯",
          "your_answer": "Ù¾Ø§Ø³Ø® Ø´Ù…Ø§",
          "send_answer": "Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®",
          "skip_question": "Ø±Ø¯ Ø´Ø¯Ù†",
          "draft_ready": "Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª",
          "edit_output": "ÙˆÛŒØ±Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒ",
          "approve_output": "ØªØ£ÛŒÛŒØ¯ Ùˆ ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª",
          "regenerate": "ØªÙˆÙ„ÛŒØ¯ Ù…Ø¬Ø¯Ø¯",
          "generating_documents": "Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª...",
          "documents_ready": "Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!",
          "tailored_cv": "Ø³ÛŒâ€ŒÙˆÛŒ Ø§Ø®ØªØµØ§ØµÛŒ",
          "cover_letter": "Ú©Ø§ÙˆØ±Ù„ØªØ±",
          "application_email": "Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª",
          "download_word": "Ø¯Ø§Ù†Ù„ÙˆØ¯ Word",
          "download_markdown": "Ø¯Ø§Ù†Ù„ÙˆØ¯ Markdown",
          "download_all": "Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ù…Ù‡",
          "copy_to_clipboard": "Ú©Ù¾ÛŒ Ø¯Ø± Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯",
          "view_application": "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª",
          "application_saved": "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
          "continue_editing": "Ø§Ø¯Ø§Ù…Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´"
        },
        "applications": {
          "title": "Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†",
          "page_subtitle": "ØªÙ…Ø§Ù… Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø´ØºÙ„ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯",
          "no_applications": "Ù‡Ù†ÙˆØ² Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯",
          "create_first": "Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø³Ø§Ø²ÛŒØ¯",
          "filter_all": "Ù‡Ù…Ù‡",
          "filter_drafts": "Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³â€ŒÙ‡Ø§",
          "filter_completed": "ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡",
          "sort_newest": "Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†",
          "sort_oldest": "Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ±ÛŒÙ†",
          "delete_confirm": "Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ",
          "deleted_successfully": "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø°Ù Ø´Ø¯"
        },
        "templates": {
          "title": "Ù…Ø¯ÛŒØ±ÛŒØª Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§",
          "page_subtitle": "Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯",
          "upload_template": "Ø¢Ù¾Ù„ÙˆØ¯ Ù‚Ø§Ù„Ø¨",
          "template_name": "Ù†Ø§Ù… Ù‚Ø§Ù„Ø¨",
          "template_type": "Ù†ÙˆØ¹ Ù‚Ø§Ù„Ø¨",
          "type_cv": "Ù‚Ø§Ù„Ø¨ Ø³ÛŒâ€ŒÙˆÛŒ",
          "type_cover_letter": "Ù‚Ø§Ù„Ø¨ Ú©Ø§ÙˆØ±Ù„ØªØ±",
          "type_email": "Ù‚Ø§Ù„Ø¨ Ø§ÛŒÙ…ÛŒÙ„",
          "select_template": "Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø§Ù„Ø¨",
          "no_templates": "Ù‚Ø§Ù„Ø¨ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡",
          "upload_first": "Ø§ÙˆÙ„ÛŒÙ† Ù‚Ø§Ù„Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯",
          "preview": "Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù‚Ø§Ù„Ø¨",
          "delete_confirm": "Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù‚Ø§Ù„Ø¨ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ",
          "uploaded_successfully": "Ù‚Ø§Ù„Ø¨ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯",
          "deleted_successfully": "Ù‚Ø§Ù„Ø¨ Ø­Ø°Ù Ø´Ø¯"
        },
        "settings": {
          "title": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª",
          "page_subtitle": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯",
          "ui_language": "Ø²Ø¨Ø§Ù† Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ",
          "ui_language_help": "Ø²Ø¨Ø§Ù†ÛŒ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø±Ø§Ø¨Ø· Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯",
          "profile": "Ù¾Ø±ÙˆÙØ§ÛŒÙ„",
          "profile_info": "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„",
          "name": "Ù†Ø§Ù…",
          "email": "Ø§ÛŒÙ…ÛŒÙ„",
          "save_profile": "Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„",
          "saved_successfully": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
          "danger_zone": "Ù…Ù†Ø·Ù‚Ù‡ Ø®Ø·Ø±",
          "delete_account": "Ø­Ø°Ù Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ",
          "delete_account_warning": "Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª. ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ù…ÛŒØ´Ù‡ Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯."
        },
        "errors": {
          "generic": "Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",
          "network": "Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.",
          "not_found": "Ù…Ù†Ø¨Ø¹ Ø¯Ø±Ø®ÙˆØ§Ø³ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.",
          "unauthorized": "Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ø¨Ù‡ Ø§Ù†Ø¬Ø§Ù… Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù†ÛŒØ³ØªÛŒØ¯.",
          "validation": "Ù„Ø·ÙØ§Ù‹ ÙˆØ±ÙˆØ¯ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",
          "file_too_large": "ÙØ§ÛŒÙ„ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø¨Ø²Ø±Ú¯ Ø§Ø³Øª. Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ù†Ø¯Ø§Ø²Ù‡ {size} Ù…Ú¯Ø§Ø¨Ø§ÛŒØª Ø§Ø³Øª.",
          "invalid_file_type": "Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø´Ø¯Ù‡: {formats}",
          "required_field": "Ø§ÛŒÙ† ÙÛŒÙ„Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª",
          "invalid_email": "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
          "invalid_url": "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¢Ø¯Ø±Ø³ URL Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"
        }
      }

  - id: F089
    path: "src/i18n/request.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F089] src/i18n/request.ts
      // next-intl request configuration
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      import { getRequestConfig } from 'next-intl/server';
      import { locales, type Locale } from './config';
      
      export default getRequestConfig(async ({ locale }) => {
        // Validate that the incoming locale is valid
        if (!locales.includes(locale as Locale)) {
          return {
            messages: (await import(`./en.json`)).default
          };
        }
      
        return {
          messages: (await import(`./${locale}.json`)).default
        };
      });

files_to_modify:
  - id: F003
    path: "next.config.js"
  - id: F092
    path: "src/middleware.ts"

files_available:
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F080
    path: "src/lib/helpers.ts"
    from_block: B04

commands: []

instructions: |
  1. Create src/i18n/config.ts with locale configuration.
  
  2. Create src/i18n/en.json with ALL English translations.
  
  3. Create src/i18n/fa.json with ALL Farsi translations (this is comprehensive).
  
  4. Create src/i18n/request.ts for next-intl server configuration.
  
  5. Update next.config.js to use next-intl plugin:
     ```javascript
     const createNextIntlPlugin = require('next-intl/plugin');
     const withNextIntl = createNextIntlPlugin('./src/i18n/request.ts');
     
     /** @type {import('next').NextConfig} */
     const nextConfig = {};
     
     module.exports = withNextIntl(nextConfig);
     ```
  
  6. Create src/middleware.ts for locale routing:
     ```typescript
     import createMiddleware from 'next-intl/middleware';
     import { locales, defaultLocale } from './i18n/config';
     
     export default createMiddleware({
       locales,
       defaultLocale,
       localePrefix: 'always'
     });
     
     export const config = {
       matcher: ['/', '/(en|fa)/:path*']
     };
     ```
  
  7. Make sure all translation keys match between en.json and fa.json.

checkpoint_tests:
  - id: T01
    description: "i18n config file exists"
    type: "files_exist"
    files:
      - "src/i18n/config.ts"

  - id: T02
    description: "English translations file exists"
    type: "files_exist"
    files:
      - "src/i18n/en.json"

  - id: T03
    description: "Farsi translations file exists"
    type: "files_exist"
    files:
      - "src/i18n/fa.json"

  - id: T04
    description: "request.ts file exists"
    type: "files_exist"
    files:
      - "src/i18n/request.ts"

  - id: T05
    description: "Middleware configured"
    type: "files_exist"
    files:
      - "src/middleware.ts"

  - id: T06
    description: "next.config.js uses next-intl"
    type: "grep"
    file: "next.config.js"
    patterns:
      - "next-intl"
      - "withNextIntl"

  - id: T07
    description: "English has all main sections"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - '"common":'
      - '"nav":'
      - '"auth":'
      - '"cv":'
      - '"prompts":'
      - '"ai":'
      - '"application":'
      - '"settings":'
      - '"errors":'

  - id: T08
    description: "Farsi has all main sections"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - '"common":'
      - '"nav":'
      - '"auth":'
      - '"cv":'
      - '"prompts":'
      - '"ai":'
      - '"application":'
      - '"settings":'
      - '"errors":'

  - id: T09
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

max_retries: 3
B06.yaml
YAML

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# BLOCK B06: Supabase Connection and Database Setup
# Phase 0: Foundation
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

id: B06
name: "Supabase Connection and Database Setup"
phase: 0
phase_name: "Foundation"

goal: |
  Set up Supabase client connections (browser and server) and create
  all database tables with proper Row Level Security (RLS) policies.
  This establishes the entire data layer for the application.

dependencies:
  - B05

files_to_create:
  - id: F063
    path: "src/lib/supabase/client.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F063] src/lib/supabase/client.ts
      // Supabase Browser Client
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      import { createBrowserClient } from '@supabase/ssr';
      
      export function createClient() {
        return createBrowserClient(
          process.env.NEXT_PUBLIC_SUPABASE_URL!,
          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
        );
      }

  - id: F064
    path: "src/lib/supabase/server.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F064] src/lib/supabase/server.ts
      // Supabase Server Client
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      import { createServerClient, type CookieOptions } from '@supabase/ssr';
      import { cookies } from 'next/headers';
      
      export async function createServerSupabaseClient() {
        const cookieStore = await cookies();
      
        return createServerClient(
          process.env.NEXT_PUBLIC_SUPABASE_URL!,
          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
          {
            cookies: {
              get(name: string) {
                return cookieStore.get(name)?.value;
              },
              set(name: string, value: string, options: CookieOptions) {
                try {
                  cookieStore.set({ name, value, ...options });
                } catch (error) {
                  // Handle cookies in read-only context (e.g., Server Components)
                }
              },
              remove(name: string, options: CookieOptions) {
                try {
                  cookieStore.set({ name, value: '', ...options });
                } catch (error) {
                  // Handle cookies in read-only context
                }
              },
            },
          }
        );
      }

  - id: F065
    path: "src/lib/supabase/middleware.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F065] src/lib/supabase/middleware.ts
      // Supabase Middleware Client (for auth)
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      import { createServerClient, type CookieOptions } from '@supabase/ssr';
      import { NextResponse, type NextRequest } from 'next/server';
      
      export async function updateSession(request: NextRequest) {
        let response = NextResponse.next({
          request: {
            headers: request.headers,
          },
        });
      
        const supabase = createServerClient(
          process.env.NEXT_PUBLIC_SUPABASE_URL!,
          process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
          {
            cookies: {
              get(name: string) {
                return request.cookies.get(name)?.value;
              },
              set(name: string, value: string, options: CookieOptions) {
                request.cookies.set({
                  name,
                  value,
                  ...options,
                });
                response = NextResponse.next({
                  request: {
                    headers: request.headers,
                  },
                });
                response.cookies.set({
                  name,
                  value,
                  ...options,
                });
              },
              remove(name: string, options: CookieOptions) {
                request.cookies.set({
                  name,
                  value: '',
                  ...options,
                });
                response = NextResponse.next({
                  request: {
                    headers: request.headers,
                  },
                });
                response.cookies.set({
                  name,
                  value: '',
                  ...options,
                });
              },
            },
          }
        );
      
        // Refresh session if expired
        await supabase.auth.getUser();
      
        return response;
      }

  - id: F093
    path: "src/lib/supabase/database.types.ts"
    content: |
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // [F093] src/lib/supabase/database.types.ts
      // Supabase Database Types
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      export type Json =
        | string
        | number
        | boolean
        | null
        | { [key: string]: Json | undefined }
        | Json[]
      
      export interface Database {
        public: {
          Tables: {
            users: {
              Row: {
                id: string
                google_id: string | null
                email: string
                name: string
                avatar_url: string | null
                preferred_language: string
                created_at: string
                updated_at: string
              }
              Insert: {
                id?: string
                google_id?: string | null
                email: string
                name: string
                avatar_url?: string | null
                preferred_language?: string
                created_at?: string
                updated_at?: string
              }
              Update: {
                id?: string
                google_id?: string | null
                email?: string
                name?: string
                avatar_url?: string | null
                preferred_language?: string
                created_at?: string
                updated_at?: string
              }
            }
            comprehensive_cvs: {
              Row: {
                id: string
                user_id: string
                personal_info: Json
                work_experience: Json
                education: Json
                skills: Json
                certifications: Json
                languages: Json
                projects: Json
                additional_sections: Json
                raw_text: string
                created_at: string
                updated_at: string
              }
              Insert: {
                id?: string
                user_id: string
                personal_info?: Json
                work_experience?: Json
                education?: Json
                skills?: Json
                certifications?: Json
                languages?: Json
                projects?: Json
                additional_sections?: Json
                raw_text?: string
                created_at?: string
                updated_at?: string
              }
              Update: {
                id?: string
                user_id?: string
                personal_info?: Json
                work_experience?: Json
                education?: Json
                skills?: Json
                certifications?: Json
                languages?: Json
                projects?: Json
                additional_sections?: Json
                raw_text?: string
                created_at?: string
                updated_at?: string
              }
            }
            prompts: {
              Row: {
                id: string
                title_en: string
                title_fa: string
                description_en: string
                description_fa: string
                prompt_text: string
                category: string
                is_active: boolean
                sort_order: number
                created_at: string
                updated_at: string
              }
              Insert: {
                id?: string
                title_en: string
                title_fa: string
                description_en?: string
                description_fa?: string
                prompt_text: string
                category?: string
                is_active?: boolean
                sort_order?: number
                created_at?: string
                updated_at?: string
              }
              Update: {
                id?: string
                title_en?: string
                title_fa?: string
                description_en?: string
                description_fa?: string
                prompt_text?: string
                category?: string
                is_active?: boolean
                sort_order?: number
                created_at?: string
                updated_at?: string
              }
            }
            ai_api_keys: {
              Row: {
                id: string
                user_id: string
                provider_name: string
                api_key_encrypted: string
                is_valid: boolean
                available_models: Json
                token_balance: string | null
                last_validated_at: string | null
                created_at: string
                updated_at: string
              }
              Insert: {
                id?: string
                user_id: string
                provider_name: string
                api_key_encrypted: string
                is_valid?: boolean
                available_models?: Json
                token_balance?: string | null
                last_validated_at?: string | null
                created_at?: string
                updated_at?: string
              }
              Update: {
                id?: string
                user_id?: string
                provider_name?: string
                api_key_encrypted?: string
                is_valid?: boolean
                available_models?: Json
                token_balance?: string | null
                last_validated_at?: string | null
                created_at?: string
                updated_at?: string
              }
            }
            templates: {
              Row: {
                id: string
                user_id: string
                template_name: string
                template_type: string
                file_format: string
                file_content: string
                created_at: string
                updated_at: string
              }
              Insert: {
                id?: string
                user_id: string
                template_name: string
                template_type: string
                file_format: string
                file_content: string
                created_at?: string
                updated_at?: string
              }
              Update: {
                id?: string
                user_id?: string
                template_name?: string
                template_type?: string
                file_format?: string
                file_content?: string
                created_at?: string
                updated_at?: string
              }
            }
            job_applications: {
              Row: {
                id: string
                user_id: string
                job_title: string
                company_name: string
                job_description: string
                selected_prompt_ids: Json
                ai_selections: Json
                output_language: string
                tone_setting: Json
                selected_template_ids: Json
                conversation_history: Json
                draft_outputs: Json
                final_output: Json | null
                edited_output: Json | null
                status: string
                created_at: string
                updated_at: string
              }
              Insert: {
                id?: string
                user_id: string
                job_title?: string
                company_name?: string
                job_description: string
                selected_prompt_ids?: Json
                ai_selections?: Json
                output_language?: string
                tone_setting?: Json
                selected_template_ids?: Json
                conversation_history?: Json
                draft_outputs?: Json
                final_output?: Json | null
                edited_output?: Json | null
                status?: string
                created_at?: string
                updated_at?: string
              }
              Update: {
                id?: string
                user_id?: string
                job_title?: string
                company_name?: string
                job_description?: string
                selected_prompt_ids?: Json
                ai_selections?: Json
                output_language?: string
                tone_setting?: Json
                selected_template_ids?: Json
                conversation_history?: Json
                draft_outputs?: Json
                final_output?: Json | null
                edited_output?: Json | null
                status?: string
                created_at?: string
                updated_at?: string
              }
            }
          }
        }
      }

  - id: F094
    path: "supabase/schema.sql"
    content: |
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -- [F094] supabase/schema.sql
      -- Database Schema for CV Tailor
      -- Run this in Supabase SQL Editor
      -- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      -- Enable UUID extension
      CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- 1. USERS TABLE
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CREATE TABLE IF NOT EXISTS public.users (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        google_id TEXT UNIQUE,
        email TEXT NOT NULL UNIQUE,
        name TEXT NOT NULL,
        avatar_url TEXT,
        preferred_language TEXT DEFAULT 'en' CHECK (preferred_language IN ('en', 'fa')),
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW()
      );
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- 2. COMPREHENSIVE CVS TABLE
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CREATE TABLE IF NOT EXISTS public.comprehensive_cvs (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
        personal_info JSONB DEFAULT '{}'::jsonb,
        work_experience JSONB DEFAULT '[]'::jsonb,
        education JSONB DEFAULT '[]'::jsonb,
        skills JSONB DEFAULT '[]'::jsonb,
        certifications JSONB DEFAULT '[]'::jsonb,
        languages JSONB DEFAULT '[]'::jsonb,
        projects JSONB DEFAULT '[]'::jsonb,
        additional_sections JSONB DEFAULT '[]'::jsonb,
        raw_text TEXT DEFAULT '',
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW(),
        UNIQUE(user_id)
      );
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- 3. PROMPTS TABLE
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CREATE TABLE IF NOT EXISTS public.prompts (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        title_en TEXT NOT NULL,
        title_fa TEXT NOT NULL,
        description_en TEXT DEFAULT '',
        description_fa TEXT DEFAULT '',
        prompt_text TEXT NOT NULL,
        category TEXT DEFAULT 'general',
        is_active BOOLEAN DEFAULT true,
        sort_order INTEGER DEFAULT 0,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW()
      );
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- 4. AI API KEYS TABLE
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CREATE TABLE IF NOT EXISTS public.ai_api_keys (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
        provider_name TEXT NOT NULL CHECK (provider_name IN ('openai', 'anthropic', 'google')),
        api_key_encrypted TEXT NOT NULL,
        is_valid BOOLEAN DEFAULT false,
        available_models JSONB DEFAULT '[]'::jsonb,
        token_balance TEXT,
        last_validated_at TIMESTAMPTZ,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW(),
        UNIQUE(user_id, provider_name)
      );
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- 5. TEMPLATES TABLE
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CREATE TABLE IF NOT EXISTS public.templates (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
        template_name TEXT NOT NULL,
        template_type TEXT NOT NULL CHECK (template_type IN ('cv', 'cover_letter', 'email')),
        file_format TEXT NOT NULL CHECK (file_format IN ('docx', 'md')),
        file_content TEXT NOT NULL,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW()
      );
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- 6. JOB APPLICATIONS TABLE
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      CREATE TABLE IF NOT EXISTS public.job_applications (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
        job_title TEXT DEFAULT '',
        company_name TEXT DEFAULT '',
        job_description TEXT NOT NULL,
        selected_prompt_ids JSONB DEFAULT '[]'::jsonb,
        ai_selections JSONB DEFAULT '[]'::jsonb,
        output_language TEXT DEFAULT 'en',
        tone_setting JSONB DEFAULT '{"mode": "preset", "preset_value": "professional", "custom_text": null}'::jsonb,
        selected_template_ids JSONB DEFAULT '{"cv": null, "cover_letter": null, "email": null}'::jsonb,
        conversation_history JSONB DEFAULT '[]'::jsonb,
        draft_outputs JSONB DEFAULT '[]'::jsonb,
        final_output JSONB,
        edited_output JSONB,
        status TEXT DEFAULT 'input' CHECK (status IN ('input', 'processing', 'clarification', 'draft_ready', 'editing', 'finalized')),
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW()
      );
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- ROW LEVEL SECURITY
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      -- Enable RLS on all tables
      ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
      ALTER TABLE public.comprehensive_cvs ENABLE ROW LEVEL SECURITY;
      ALTER TABLE public.prompts ENABLE ROW LEVEL SECURITY;
      ALTER TABLE public.ai_api_keys ENABLE ROW LEVEL SECURITY;
      ALTER TABLE public.templates ENABLE ROW LEVEL SECURITY;
      ALTER TABLE public.job_applications ENABLE ROW LEVEL SECURITY;
      
      -- Development policies (permissive for now - will be tightened in production)
      -- Users table
      CREATE POLICY "users_select_all" ON public.users FOR SELECT USING (true);
      CREATE POLICY "users_insert_all" ON public.users FOR INSERT WITH CHECK (true);
      CREATE POLICY "users_update_all" ON public.users FOR UPDATE USING (true);
      
      -- CVs table
      CREATE POLICY "cvs_all" ON public.comprehensive_cvs FOR ALL USING (true);
      
      -- Prompts table (readable by all, manageable by all for now)
      CREATE POLICY "prompts_select_all" ON public.prompts FOR SELECT USING (true);
      CREATE POLICY "prompts_insert_all" ON public.prompts FOR INSERT WITH CHECK (true);
      CREATE POLICY "prompts_update_all" ON public.prompts FOR UPDATE USING (true);
      CREATE POLICY "prompts_delete_all" ON public.prompts FOR DELETE USING (true);
      
      -- API Keys table
      CREATE POLICY "api_keys_all" ON public.ai_api_keys FOR ALL USING (true);
      
      -- Templates table
      CREATE POLICY "templates_all" ON public.templates FOR ALL USING (true);
      
      -- Job Applications table
      CREATE POLICY "applications_all" ON public.job_applications FOR ALL USING (true);
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- UPDATED_AT TRIGGER
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      CREATE OR REPLACE FUNCTION update_updated_at_column()
      RETURNS TRIGGER AS $$
      BEGIN
          NEW.updated_at = NOW();
          RETURN NEW;
      END;
      $$ LANGUAGE plpgsql;
      
      -- Apply trigger to all tables
      DROP TRIGGER IF EXISTS update_users_updated_at ON public.users;
      CREATE TRIGGER update_users_updated_at 
        BEFORE UPDATE ON public.users
        FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
      
      DROP TRIGGER IF EXISTS update_cvs_updated_at ON public.comprehensive_cvs;
      CREATE TRIGGER update_cvs_updated_at 
        BEFORE UPDATE ON public.comprehensive_cvs
        FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
      
      DROP TRIGGER IF EXISTS update_prompts_updated_at ON public.prompts;
      CREATE TRIGGER update_prompts_updated_at 
        BEFORE UPDATE ON public.prompts
        FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
      
      DROP TRIGGER IF EXISTS update_api_keys_updated_at ON public.ai_api_keys;
      CREATE TRIGGER update_api_keys_updated_at 
        BEFORE UPDATE ON public.ai_api_keys
        FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
      
      DROP TRIGGER IF EXISTS update_templates_updated_at ON public.templates;
      CREATE TRIGGER update_templates_updated_at 
        BEFORE UPDATE ON public.templates
        FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
      
      DROP TRIGGER IF EXISTS update_applications_updated_at ON public.job_applications;
      CREATE TRIGGER update_applications_updated_at 
        BEFORE UPDATE ON public.job_applications
        FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
      
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      -- SAMPLE PROMPTS (seed data)
      -- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      INSERT INTO public.prompts (title_en, title_fa, description_en, description_fa, prompt_text, category, sort_order) VALUES
      (
        'Professional CV Tailoring',
        'ØªÙ†Ø¸ÛŒÙ… Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø³ÛŒâ€ŒÙˆÛŒ',
        'Create a professionally tailored CV that matches the job requirements',
        'Ø§ÛŒØ¬Ø§Ø¯ Ø³ÛŒâ€ŒÙˆÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø´ØºÙ„',
        'You are an expert CV writer. Given the comprehensive CV and job description, create a tailored CV that:
      1. Highlights relevant experience and skills
      2. Uses keywords from the job description
      3. Quantifies achievements where possible
      4. Maintains a professional tone
      5. Is concise and impactful
      
      Ask clarifying questions if needed before generating the output.',
        'general',
        1
      ),
      (
        'Tech Industry Focus',
        'ØªÙ…Ø±Ú©Ø² Ø¨Ø± ØµÙ†Ø¹Øª ÙÙ†Ø§ÙˆØ±ÛŒ',
        'Optimized for technology and software positions',
        'Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ Ùˆ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±',
        'You are a tech industry recruiting specialist. Create application materials that:
      1. Emphasize technical skills and technologies
      2. Highlight project experience and contributions
      3. Include relevant GitHub, portfolio, or technical achievements
      4. Use industry-standard terminology
      5. Focus on problem-solving abilities and impact
      
      Ask about specific technologies or projects if the information seems incomplete.',
        'tech',
        2
      ),
      (
        'Executive Level',
        'Ø³Ø·Ø­ Ù…Ø¯ÛŒØ±ÛŒØªÛŒ',
        'For senior management and executive positions',
        'Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø´Ø¯ Ùˆ Ø§Ø¬Ø±Ø§ÛŒÛŒ',
        'You are an executive career consultant. Create application materials that:
      1. Emphasize leadership experience and strategic impact
      2. Quantify business results and team achievements
      3. Highlight board experience, if any
      4. Focus on vision and organizational transformation
      5. Maintain an authoritative yet approachable tone
      
      Ask about leadership achievements or strategic initiatives if not clear.',
        'executive',
        3
      )
      ON CONFLICT DO NOTHING;

files_to_modify:
  - id: F005
    path: ".env.local"
  - id: F006
    path: ".env.example"

files_available:
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F005
    path: ".env.local"
    from_block: B01
  - id: F006
    path: ".env.example"
    from_block: B01

commands: []

instructions: |
  1. Create the Supabase client files:
     - src/lib/supabase/client.ts (browser client)
     - src/lib/supabase/server.ts (server client)
     - src/lib/supabase/middleware.ts (middleware client)
  
  2. Create src/lib/supabase/database.types.ts with TypeScript types matching the schema.
  
  3. Create supabase/schema.sql with the complete database schema.
  
  4. Update .env.local and .env.example to document Supabase variables.
  
  5. IMPORTANT: The actual SQL must be run manually in Supabase SQL Editor.
     This block just creates the files.
  
  6. Make sure all client files handle cookies correctly for Next.js 14+.

checkpoint_tests:
  - id: T01
    description: "Supabase client files exist"
    type: "files_exist"
    files:
      - "src/lib/supabase/client.ts"
      - "src/lib/supabase/server.ts"
      - "src/lib/supabase/middleware.ts"

  - id: T02
    description: "Database types file exists"
    type: "files_exist"
    files:
      - "src/lib/supabase/database.types.ts"

  - id: T03
    description: "Schema SQL file exists"
    type: "files_exist"
    files:
      - "supabase/schema.sql"

  - id: T04
    description: "Client uses createBrowserClient"
    type: "grep"
    file: "src/lib/supabase/client.ts"
    patterns:
      - "createBrowserClient"
      - "NEXT_PUBLIC_SUPABASE_URL"

  - id: T05
    description: "Server uses createServerClient"
    type: "grep"
    file: "src/lib/supabase/server.ts"
    patterns:
      - "createServerClient"
      - "cookies"

  - id: T06
    description: "Schema has all required tables"
    type: "grep"
    file: "supabase/schema.sql"
    patterns:
      - "CREATE TABLE IF NOT EXISTS public.users"
      - "CREATE TABLE IF NOT EXISTS public.comprehensive_cvs"
      - "CREATE TABLE IF NOT EXISTS public.prompts"
      - "CREATE TABLE IF NOT EXISTS public.ai_api_keys"
      - "CREATE TABLE IF NOT EXISTS public.templates"
      - "CREATE TABLE IF NOT EXISTS public.job_applications"

  - id: T07
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

max_retries: 3


B07.yaml â€” Ù„Ø§Ú¯ÛŒÙ† Ù…ÙˆÙ‚Øª (Development Auth)
YAML

# blocks/B07.yaml

id: B07
name: "Development Auth (Temporary Login)"
phase: 0
phase_name: "Foundation"

goal: |
  Create a simple temporary authentication system for development purposes.
  This will be replaced with Google OAuth in the final phase.
  Users can "login" by entering their email and name - no password required.
  This allows development to proceed without OAuth complexity.

dependencies: [B01, B02, B03, B04, B05, B06]

files_to_create:
  - id: F089
    path: "src/lib/auth/dev-auth.ts"
    description: "Development authentication helper functions"

  - id: F090
    path: "src/context/AuthContext.tsx"
    description: "React context for authentication state"

  - id: F091
    path: "src/components/auth/DevLoginForm.tsx"
    description: "Simple login form for development"

  - id: F092
    path: "src/components/auth/AuthGuard.tsx"
    description: "Component to protect routes that require authentication"

files_to_modify:
  - id: F011
    path: "src/app/[locale]/page.tsx"
    description: "Landing page with login form"

  - id: F010
    path: "src/app/[locale]/layout.tsx"
    description: "Add AuthContext provider"

  - id: F087
    path: "src/i18n/en.json"
    description: "Add auth-related translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add auth-related translations"

files_available:
  - id: F001
    path: "package.json"
    from_block: B01
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F080
    path: "src/lib/utils.ts"
    from_block: B04
  - id: F086
    path: "src/i18n/config.ts"
    from_block: B05
  - id: F087
    path: "src/i18n/en.json"
    from_block: B05
  - id: F088
    path: "src/i18n/fa.json"
    from_block: B05

commands: []

instructions: |
  1. Create dev-auth.ts with these functions:
     - devLogin(email: string, name: string): Creates or retrieves user from Supabase
     - devLogout(): Clears the session
     - getCurrentUser(): Returns current user or null
     - Use localStorage to persist the user ID during development
  
  2. Create AuthContext.tsx:
     - Provide user state, loading state, login/logout functions
     - Check for existing session on mount
     - Export useAuth hook
  
  3. Create DevLoginForm.tsx:
     - Simple form with email and name fields
     - Submit button
     - Loading state during login
     - Error message display
     - Use i18n for all text
     - Support RTL for Farsi
  
  4. Create AuthGuard.tsx:
     - Wrap protected pages
     - If not authenticated, redirect to login page
     - Show loading spinner while checking auth
  
  5. Update [locale]/page.tsx:
     - Show DevLoginForm if not authenticated
     - Redirect to /dashboard if authenticated
  
  6. Update [locale]/layout.tsx:
     - Wrap children with AuthProvider
  
  7. Add to en.json and fa.json under "auth" key:
     - login_title, email_label, name_label, login_button, logging_in, 
       login_error, welcome_back, logout, email_placeholder, name_placeholder

  IMPORTANT: This is temporary for development. Keep it simple.
  Do NOT implement password, OAuth, or complex session management.

checkpoint_tests:
  - id: T01
    description: "dev-auth.ts file exists"
    type: "files_exist"
    files:
      - "src/lib/auth/dev-auth.ts"

  - id: T02
    description: "AuthContext.tsx file exists"
    type: "files_exist"
    files:
      - "src/context/AuthContext.tsx"

  - id: T03
    description: "DevLoginForm.tsx file exists"
    type: "files_exist"
    files:
      - "src/components/auth/DevLoginForm.tsx"

  - id: T04
    description: "AuthGuard.tsx file exists"
    type: "files_exist"
    files:
      - "src/components/auth/AuthGuard.tsx"

  - id: T05
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T06
    description: "AuthContext exports useAuth hook"
    type: "grep"
    file: "src/context/AuthContext.tsx"
    patterns:
      - "export function useAuth"
      - "AuthProvider"
      - "createContext"

  - id: T07
    description: "DevLoginForm uses i18n"
    type: "grep"
    file: "src/components/auth/DevLoginForm.tsx"
    patterns:
      - "useTranslations"
      - "t("

  - id: T08
    description: "English translations have auth keys"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "login_title"
      - "email_label"
      - "login_button"

  - id: T09
    description: "Farsi translations have auth keys"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - "login_title"
      - "email_label"
      - "login_button"

  - id: T10
    description: "Layout includes AuthProvider"
    type: "grep"
    file: "src/app/[locale]/layout.tsx"
    patterns:
      - "AuthProvider"

max_retries: 3
B08.yaml â€” Layout Ø§ØµÙ„ÛŒ (Header + Sidebar + Footer)
YAML

# blocks/B08.yaml

id: B08
name: "Main Layout (Header + Sidebar + Footer)"
phase: 0
phase_name: "Foundation"

goal: |
  Create the main application layout with Header, Sidebar navigation, and Footer.
  The layout should be responsive, support RTL for Farsi, and include language switching.

dependencies: [B01, B02, B03, B04, B05, B06, B07]

files_to_create:
  - id: F037
    path: "src/components/layout/Header.tsx"
    description: "Top header with logo, app name, language switcher, user info"

  - id: F038
    path: "src/components/layout/Sidebar.tsx"
    description: "Side navigation menu with links to all main pages"

  - id: F039
    path: "src/components/layout/Footer.tsx"
    description: "Simple footer with copyright"

  - id: F040
    path: "src/components/layout/LanguageSwitcher.tsx"
    description: "Button/dropdown to switch between EN and FA"

  - id: F093
    path: "src/components/layout/MainLayout.tsx"
    description: "Combines Header, Sidebar, Footer into main app layout"

  - id: F094
    path: "src/components/layout/MobileMenu.tsx"
    description: "Hamburger menu for mobile devices"

  - id: F012
    path: "src/app/[locale]/dashboard/page.tsx"
    description: "Dashboard page (placeholder for now)"

files_to_modify:
  - id: F010
    path: "src/app/[locale]/layout.tsx"
    description: "Use MainLayout for authenticated pages"

  - id: F087
    path: "src/i18n/en.json"
    description: "Add navigation translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add navigation translations"

  - id: F009
    path: "src/app/globals.css"
    description: "Add layout-specific CSS if needed"

files_available:
  - id: F001
    path: "package.json"
    from_block: B01
  - id: F027
    path: "src/components/ui/button.tsx"
    from_block: B02
  - id: F036
    path: "src/components/ui/dropdown-menu.tsx"
    from_block: B02
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F080
    path: "src/lib/utils.ts"
    from_block: B04
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F086
    path: "src/i18n/config.ts"
    from_block: B05
  - id: F087
    path: "src/i18n/en.json"
    from_block: B05
  - id: F088
    path: "src/i18n/fa.json"
    from_block: B05
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07

commands: []

instructions: |
  1. Create Header.tsx:
     - Logo/App name on the left (links to dashboard)
     - LanguageSwitcher component
     - User avatar/name from AuthContext
     - Logout button
     - Use shadcn/ui Button and DropdownMenu
     - Responsive: hide some elements on mobile
  
  2. Create Sidebar.tsx:
     - Navigation links:
       * Dashboard (/[locale]/dashboard)
       * My CV (/[locale]/cv-manager)
       * New Application (/[locale]/new-application)
       * My Applications (/[locale]/applications)
       * Prompt Management (/[locale]/prompts)
       * Settings (/[locale]/settings)
     - Highlight active link
     - Use lucide-react icons
     - Collapsible on desktop (optional)
     - Hidden on mobile (replaced by MobileMenu)
  
  3. Create Footer.tsx:
     - Simple: "Â© 2025 CV Tailor. All rights reserved."
     - Centered, subtle styling
  
  4. Create LanguageSwitcher.tsx:
     - Show current language (EN/FA)
     - Click to switch
     - Use next-intl's useRouter and usePathname
     - When switching, redirect to same page in new locale
  
  5. Create MobileMenu.tsx:
     - Hamburger icon button
     - Opens a drawer/sheet with navigation links
     - Use shadcn Sheet or custom implementation
  
  6. Create MainLayout.tsx:
     - Combines: Header (top), Sidebar (left), main content (center), Footer (bottom)
     - Responsive grid/flex layout
     - On mobile: no sidebar, use MobileMenu
     - Handle RTL: sidebar on right for Farsi
  
  7. Create dashboard/page.tsx:
     - Simple placeholder: "Welcome to Dashboard"
     - Wrap with AuthGuard
     - Will be expanded later
  
  8. Update [locale]/layout.tsx:
     - Detect if route needs MainLayout (authenticated routes)
     - For now, apply MainLayout to all routes except login
  
  9. Add to translations (nav section):
     - dashboard, cv_manager, new_application, applications, prompts, settings
     - logout, language

checkpoint_tests:
  - id: T01
    description: "All layout component files exist"
    type: "files_exist"
    files:
      - "src/components/layout/Header.tsx"
      - "src/components/layout/Sidebar.tsx"
      - "src/components/layout/Footer.tsx"
      - "src/components/layout/LanguageSwitcher.tsx"
      - "src/components/layout/MainLayout.tsx"
      - "src/components/layout/MobileMenu.tsx"

  - id: T02
    description: "Dashboard page exists"
    type: "files_exist"
    files:
      - "src/app/[locale]/dashboard/page.tsx"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "Header uses AuthContext"
    type: "grep"
    file: "src/components/layout/Header.tsx"
    patterns:
      - "useAuth"

  - id: T05
    description: "Sidebar has all navigation links"
    type: "grep"
    file: "src/components/layout/Sidebar.tsx"
    patterns:
      - "dashboard"
      - "cv-manager"
      - "new-application"
      - "applications"
      - "prompts"
      - "settings"

  - id: T06
    description: "LanguageSwitcher handles locale change"
    type: "grep"
    file: "src/components/layout/LanguageSwitcher.tsx"
    patterns:
      - "useRouter"
      - "usePathname"
      - "locale"

  - id: T07
    description: "MainLayout combines all components"
    type: "grep"
    file: "src/components/layout/MainLayout.tsx"
    patterns:
      - "Header"
      - "Sidebar"
      - "Footer"

  - id: T08
    description: "English translations have nav keys"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "dashboard"
      - "cv_manager"
      - "new_application"
      - "settings"

  - id: T09
    description: "Farsi translations have nav keys"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - "dashboard"
      - "settings"

  - id: T10
    description: "Dashboard page uses AuthGuard"
    type: "grep"
    file: "src/app/[locale]/dashboard/page.tsx"
    patterns:
      - "AuthGuard"

max_retries: 3
B09.yaml â€” Ù¾Ø§Ø±Ø³Ø±Ù‡Ø§ÛŒ ÙØ§ÛŒÙ„ (Word + Markdown)
YAML

# blocks/B09.yaml

id: B09
name: "File Parsers (Word + Markdown)"
phase: 1
phase_name: "CV Management"

goal: |
  Create utility functions to parse Word (.docx) and Markdown (.md) files
  and extract their text content. These will be used to parse uploaded CVs.

dependencies: [B01, B02, B03, B04]

files_to_create:
  - id: F072
    path: "src/lib/parsers/docx-parser.ts"
    description: "Parse .docx files and extract text content"

  - id: F073
    path: "src/lib/parsers/markdown-parser.ts"
    description: "Parse .md files and extract text content"

  - id: F095
    path: "src/lib/parsers/index.ts"
    description: "Export all parsers from single entry point"

files_to_modify: []

files_available:
  - id: F001
    path: "package.json"
    from_block: B01
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F080
    path: "src/lib/utils.ts"
    from_block: B04

commands: []

instructions: |
  1. Create docx-parser.ts:
     ```typescript
     import mammoth from 'mammoth';
     
     export interface ParsedDocument {
       text: string;
       html?: string;
       metadata?: {
         wordCount: number;
         hasImages: boolean;
       };
     }
     
     export async function parseDocx(file: File | Buffer): Promise<ParsedDocument> {
       // If File, convert to ArrayBuffer first
       // Use mammoth.extractRawText() for text
       // Use mammoth.convertToHtml() for HTML (optional)
       // Return ParsedDocument
       // Handle errors gracefully
     }
     
     export async function parseDocxFromArrayBuffer(arrayBuffer: ArrayBuffer): Promise<ParsedDocument> {
       // Direct parsing from ArrayBuffer
     }
     ```
  
  2. Create markdown-parser.ts:
     ```typescript
     import { unified } from 'unified';
     import remarkParse from 'remark-parse';
     import remarkHtml from 'remark-html';
     
     export interface ParsedMarkdown {
       text: string;
       html: string;
       metadata?: {
         wordCount: number;
         headings: string[];
       };
     }
     
     export async function parseMarkdown(content: string): Promise<ParsedMarkdown> {
       // Parse markdown to AST
       // Extract plain text (strip formatting)
       // Convert to HTML
       // Extract headings
       // Return ParsedMarkdown
     }
     
     export async function parseMarkdownFile(file: File): Promise<ParsedMarkdown> {
       // Read file as text
       // Call parseMarkdown
     }
     ```
  
  3. Create index.ts:
     ```typescript
     export * from './docx-parser';
     export * from './markdown-parser';
     
     export type SupportedFileType = 'docx' | 'md' | 'txt';
     
     export function detectFileType(filename: string): SupportedFileType | null {
       // Check file extension
       // Return type or null if unsupported
     }
     
     export async function parseFile(file: File): Promise<{ text: string; html?: string }> {
       // Detect type
       // Call appropriate parser
       // Throw error if unsupported
     }
     ```
  
  IMPORTANT:
  - Handle errors gracefully (corrupted files, empty files, etc.)
  - Return meaningful error messages
  - Keep functions pure and testable
  - Word count should count actual words, not characters

checkpoint_tests:
  - id: T01
    description: "All parser files exist"
    type: "files_exist"
    files:
      - "src/lib/parsers/docx-parser.ts"
      - "src/lib/parsers/markdown-parser.ts"
      - "src/lib/parsers/index.ts"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "docx-parser exports parseDocx function"
    type: "grep"
    file: "src/lib/parsers/docx-parser.ts"
    patterns:
      - "export async function parseDocx"
      - "mammoth"
      - "ParsedDocument"

  - id: T04
    description: "markdown-parser exports parseMarkdown function"
    type: "grep"
    file: "src/lib/parsers/markdown-parser.ts"
    patterns:
      - "export async function parseMarkdown"
      - "unified"
      - "ParsedMarkdown"

  - id: T05
    description: "index.ts exports all parsers and utilities"
    type: "grep"
    file: "src/lib/parsers/index.ts"
    patterns:
      - "export * from './docx-parser'"
      - "export * from './markdown-parser'"
      - "parseFile"
      - "detectFileType"

  - id: T06
    description: "Error handling is implemented"
    type: "grep"
    file: "src/lib/parsers/docx-parser.ts"
    patterns:
      - "try"
      - "catch"
      - "throw"

max_retries: 3

B10.yaml â€” AI Provider Interface (Ø¬Ø¯ÛŒØ¯ â€” Ø§Ø² B19 Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯)
YAML

# blocks/B10.yaml

id: B10
name: "AI Provider Interface (Abstract Layer)"
phase: 1
phase_name: "CV Management"

goal: |
  Create an abstract interface for AI providers (OpenAI, Anthropic, Google).
  This allows the app to work with multiple AI services through a unified API.
  This block is moved earlier because AI is needed for CV field extraction.

dependencies: [B01, B02, B03, B04]

files_to_create:
  - id: F066
    path: "src/lib/ai/ai-provider.ts"
    description: "Abstract AI Provider interface"

  - id: F067
    path: "src/lib/ai/openai-provider.ts"
    description: "OpenAI implementation"

  - id: F068
    path: "src/lib/ai/anthropic-provider.ts"
    description: "Anthropic (Claude) implementation"

  - id: F069
    path: "src/lib/ai/google-ai-provider.ts"
    description: "Google AI (Gemini) implementation"

  - id: F070
    path: "src/lib/ai/ai-factory.ts"
    description: "Factory to create AI provider instances"

  - id: F104
    path: "src/lib/ai/index.ts"
    description: "Export all AI modules"

files_to_modify: []

files_available:
  - id: F001
    path: "package.json"
    from_block: B01
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04

commands: []

instructions: |
  1. Create ai-provider.ts - The abstract interface:
     ```typescript
     // ============================================
     // [F066] src/lib/ai/ai-provider.ts
     // Abstract AI Provider Interface
     // ============================================
     
     import { AIProviderName, AIModel, AIChatMessage } from '@/lib/types';
     
     export interface AIProviderConfig {
       apiKey: string;
       model?: string;
       temperature?: number;
       maxTokens?: number;
     }
     
     export interface AIValidationResult {
       valid: boolean;
       error?: string;
       models?: AIModel[];
       balance?: string | null;
     }
     
     export interface AICompletionOptions {
       model: string;
       messages: AIChatMessage[];
       temperature?: number;
       maxTokens?: number;
       jsonMode?: boolean;  // Request JSON output
     }
     
     export interface AIProvider {
       readonly providerName: AIProviderName;
       
       // Validate API key and get available models
       validateKey(apiKey: string): Promise<AIValidationResult>;
       
       // Get list of available models
       getModels(apiKey: string): Promise<AIModel[]>;
       
       // Simple completion (non-streaming)
       complete(config: AIProviderConfig, options: AICompletionOptions): Promise<string>;
       
       // Streaming completion
       streamComplete(
         config: AIProviderConfig,
         options: AICompletionOptions,
         onChunk: (chunk: string) => void
       ): Promise<string>;
       
       // Parse JSON response (with error handling)
       parseJsonResponse<T>(response: string): T | null;
     }
     
     // Base class with common functionality
     export abstract class BaseAIProvider implements AIProvider {
       abstract readonly providerName: AIProviderName;
       
       abstract validateKey(apiKey: string): Promise<AIValidationResult>;
       abstract getModels(apiKey: string): Promise<AIModel[]>;
       abstract complete(config: AIProviderConfig, options: AICompletionOptions): Promise<string>;
       abstract streamComplete(
         config: AIProviderConfig,
         options: AICompletionOptions,
         onChunk: (chunk: string) => void
       ): Promise<string>;
       
       parseJsonResponse<T>(response: string): T | null {
         try {
           // Try to extract JSON from response
           // Handle cases where AI wraps JSON in markdown code blocks
           let jsonStr = response;
           
           // Remove markdown code blocks if present
           const jsonMatch = response.match(/```(?:json)?\s*([\s\S]*?)\s*```/);
           if (jsonMatch) {
             jsonStr = jsonMatch[1];
           }
           
           return JSON.parse(jsonStr) as T;
         } catch (e) {
           console.error('Failed to parse JSON response:', e);
           return null;
         }
       }
     }
     ```
  
  2. Create openai-provider.ts:
     ```typescript
     // ============================================
     // [F067] src/lib/ai/openai-provider.ts
     // ============================================
     
     import OpenAI from 'openai';
     import { BaseAIProvider, AIProviderConfig, AICompletionOptions, AIValidationResult } from './ai-provider';
     import { AIProviderName, AIModel } from '@/lib/types';
     
     export class OpenAIProvider extends BaseAIProvider {
       readonly providerName: AIProviderName = 'openai';
       
       private createClient(apiKey: string): OpenAI {
         return new OpenAI({ apiKey });
       }
       
       async validateKey(apiKey: string): Promise<AIValidationResult> {
         try {
           const client = this.createClient(apiKey);
           const models = await client.models.list();
           
           const availableModels: AIModel[] = models.data
             .filter(m => m.id.includes('gpt'))
             .map(m => ({
               model_id: m.id,
               model_name: m.id,
               provider: 'openai' as AIProviderName
             }));
           
           return {
             valid: true,
             models: availableModels
           };
         } catch (error: any) {
           return {
             valid: false,
             error: error.message || 'Invalid API key'
           };
         }
       }
       
       async getModels(apiKey: string): Promise<AIModel[]> {
         const result = await this.validateKey(apiKey);
         return result.models || [];
       }
       
       async complete(config: AIProviderConfig, options: AICompletionOptions): Promise<string> {
         const client = this.createClient(config.apiKey);
         
         const response = await client.chat.completions.create({
           model: options.model,
           messages: options.messages.map(m => ({
             role: m.role as 'system' | 'user' | 'assistant',
             content: m.content
           })),
           temperature: options.temperature ?? config.temperature ?? 0.7,
           max_tokens: options.maxTokens ?? config.maxTokens ?? 4096,
           response_format: options.jsonMode ? { type: 'json_object' } : undefined
         });
         
         return response.choices[0]?.message?.content || '';
       }
       
       async streamComplete(
         config: AIProviderConfig,
         options: AICompletionOptions,
         onChunk: (chunk: string) => void
       ): Promise<string> {
         const client = this.createClient(config.apiKey);
         
         const stream = await client.chat.completions.create({
           model: options.model,
           messages: options.messages.map(m => ({
             role: m.role as 'system' | 'user' | 'assistant',
             content: m.content
           })),
           temperature: options.temperature ?? config.temperature ?? 0.7,
           max_tokens: options.maxTokens ?? config.maxTokens ?? 4096,
           stream: true
         });
         
         let fullResponse = '';
         for await (const chunk of stream) {
           const content = chunk.choices[0]?.delta?.content || '';
           fullResponse += content;
           onChunk(content);
         }
         
         return fullResponse;
       }
     }
     ```
  
  3. Create anthropic-provider.ts:
     ```typescript
     // ============================================
     // [F068] src/lib/ai/anthropic-provider.ts
     // ============================================
     
     import Anthropic from '@anthropic-ai/sdk';
     import { BaseAIProvider, AIProviderConfig, AICompletionOptions, AIValidationResult } from './ai-provider';
     import { AIProviderName, AIModel } from '@/lib/types';
     
     export class AnthropicProvider extends BaseAIProvider {
       readonly providerName: AIProviderName = 'anthropic';
       
       // Known Claude models (Anthropic doesn't have a models list API)
       private readonly KNOWN_MODELS: AIModel[] = [
         { model_id: 'claude-3-5-sonnet-20241022', model_name: 'Claude 3.5 Sonnet', provider: 'anthropic' },
         { model_id: 'claude-3-5-haiku-20241022', model_name: 'Claude 3.5 Haiku', provider: 'anthropic' },
         { model_id: 'claude-3-opus-20240229', model_name: 'Claude 3 Opus', provider: 'anthropic' },
         { model_id: 'claude-3-sonnet-20240229', model_name: 'Claude 3 Sonnet', provider: 'anthropic' },
         { model_id: 'claude-3-haiku-20240307', model_name: 'Claude 3 Haiku', provider: 'anthropic' },
       ];
       
       private createClient(apiKey: string): Anthropic {
         return new Anthropic({ apiKey });
       }
       
       async validateKey(apiKey: string): Promise<AIValidationResult> {
         try {
           const client = this.createClient(apiKey);
           
           // Make a minimal API call to verify the key
           await client.messages.create({
             model: 'claude-3-haiku-20240307',
             max_tokens: 10,
             messages: [{ role: 'user', content: 'Hi' }]
           });
           
           return {
             valid: true,
             models: this.KNOWN_MODELS
           };
         } catch (error: any) {
           return {
             valid: false,
             error: error.message || 'Invalid API key'
           };
         }
       }
       
       async getModels(apiKey: string): Promise<AIModel[]> {
         const result = await this.validateKey(apiKey);
         return result.valid ? this.KNOWN_MODELS : [];
       }
       
       async complete(config: AIProviderConfig, options: AICompletionOptions): Promise<string> {
         const client = this.createClient(config.apiKey);
         
         // Extract system message if present
         const systemMsg = options.messages.find(m => m.role === 'system');
         const otherMsgs = options.messages.filter(m => m.role !== 'system');
         
         const response = await client.messages.create({
           model: options.model,
           max_tokens: options.maxTokens ?? config.maxTokens ?? 4096,
           system: systemMsg?.content,
           messages: otherMsgs.map(m => ({
             role: m.role as 'user' | 'assistant',
             content: m.content
           }))
         });
         
         // Extract text from response
         const textBlock = response.content.find(c => c.type === 'text');
         return textBlock?.text || '';
       }
       
       async streamComplete(
         config: AIProviderConfig,
         options: AICompletionOptions,
         onChunk: (chunk: string) => void
       ): Promise<string> {
         const client = this.createClient(config.apiKey);
         
         const systemMsg = options.messages.find(m => m.role === 'system');
         const otherMsgs = options.messages.filter(m => m.role !== 'system');
         
         const stream = await client.messages.stream({
           model: options.model,
           max_tokens: options.maxTokens ?? config.maxTokens ?? 4096,
           system: systemMsg?.content,
           messages: otherMsgs.map(m => ({
             role: m.role as 'user' | 'assistant',
             content: m.content
           }))
         });
         
         let fullResponse = '';
         for await (const event of stream) {
           if (event.type === 'content_block_delta' && event.delta.type === 'text_delta') {
             const text = event.delta.text;
             fullResponse += text;
             onChunk(text);
           }
         }
         
         return fullResponse;
       }
     }
     ```
  
  4. Create google-ai-provider.ts:
     ```typescript
     // ============================================
     // [F069] src/lib/ai/google-ai-provider.ts
     // ============================================
     
     import { GoogleGenerativeAI } from '@google/generative-ai';
     import { BaseAIProvider, AIProviderConfig, AICompletionOptions, AIValidationResult } from './ai-provider';
     import { AIProviderName, AIModel } from '@/lib/types';
     
     export class GoogleAIProvider extends BaseAIProvider {
       readonly providerName: AIProviderName = 'google';
       
       private readonly KNOWN_MODELS: AIModel[] = [
         { model_id: 'gemini-1.5-pro', model_name: 'Gemini 1.5 Pro', provider: 'google' },
         { model_id: 'gemini-1.5-flash', model_name: 'Gemini 1.5 Flash', provider: 'google' },
         { model_id: 'gemini-1.0-pro', model_name: 'Gemini 1.0 Pro', provider: 'google' },
       ];
       
       private createClient(apiKey: string): GoogleGenerativeAI {
         return new GoogleGenerativeAI(apiKey);
       }
       
       async validateKey(apiKey: string): Promise<AIValidationResult> {
         try {
           const client = this.createClient(apiKey);
           const model = client.getGenerativeModel({ model: 'gemini-1.5-flash' });
           
           // Make a minimal API call to verify
           await model.generateContent('Hi');
           
           return {
             valid: true,
             models: this.KNOWN_MODELS
           };
         } catch (error: any) {
           return {
             valid: false,
             error: error.message || 'Invalid API key'
           };
         }
       }
       
       async getModels(apiKey: string): Promise<AIModel[]> {
         const result = await this.validateKey(apiKey);
         return result.valid ? this.KNOWN_MODELS : [];
       }
       
       async complete(config: AIProviderConfig, options: AICompletionOptions): Promise<string> {
         const client = this.createClient(config.apiKey);
         const model = client.getGenerativeModel({ 
           model: options.model,
           generationConfig: {
             temperature: options.temperature ?? config.temperature ?? 0.7,
             maxOutputTokens: options.maxTokens ?? config.maxTokens ?? 4096,
           }
         });
         
         // Convert messages to Gemini format
         const history = options.messages
           .filter(m => m.role !== 'system')
           .slice(0, -1)
           .map(m => ({
             role: m.role === 'assistant' ? 'model' : 'user',
             parts: [{ text: m.content }]
           }));
         
         const systemInstruction = options.messages.find(m => m.role === 'system')?.content;
         const lastMessage = options.messages[options.messages.length - 1];
         
         const chat = model.startChat({
           history,
           systemInstruction
         });
         
         const result = await chat.sendMessage(lastMessage.content);
         return result.response.text();
       }
       
       async streamComplete(
         config: AIProviderConfig,
         options: AICompletionOptions,
         onChunk: (chunk: string) => void
       ): Promise<string> {
         const client = this.createClient(config.apiKey);
         const model = client.getGenerativeModel({ 
           model: options.model,
           generationConfig: {
             temperature: options.temperature ?? config.temperature ?? 0.7,
             maxOutputTokens: options.maxTokens ?? config.maxTokens ?? 4096,
           }
         });
         
         const history = options.messages
           .filter(m => m.role !== 'system')
           .slice(0, -1)
           .map(m => ({
             role: m.role === 'assistant' ? 'model' : 'user',
             parts: [{ text: m.content }]
           }));
         
         const systemInstruction = options.messages.find(m => m.role === 'system')?.content;
         const lastMessage = options.messages[options.messages.length - 1];
         
         const chat = model.startChat({
           history,
           systemInstruction
         });
         
         const result = await chat.sendMessageStream(lastMessage.content);
         
         let fullResponse = '';
         for await (const chunk of result.stream) {
           const text = chunk.text();
           fullResponse += text;
           onChunk(text);
         }
         
         return fullResponse;
       }
     }
     ```
  
  5. Create ai-factory.ts:
     ```typescript
     // ============================================
     // [F070] src/lib/ai/ai-factory.ts
     // ============================================
     
     import { AIProviderName } from '@/lib/types';
     import { AIProvider } from './ai-provider';
     import { OpenAIProvider } from './openai-provider';
     import { AnthropicProvider } from './anthropic-provider';
     import { GoogleAIProvider } from './google-ai-provider';
     
     const providers: Record<AIProviderName, AIProvider> = {
       openai: new OpenAIProvider(),
       anthropic: new AnthropicProvider(),
       google: new GoogleAIProvider(),
     };
     
     export function getAIProvider(name: AIProviderName): AIProvider {
       const provider = providers[name];
       if (!provider) {
         throw new Error(`Unknown AI provider: ${name}`);
       }
       return provider;
     }
     
     export function getAllProviders(): AIProvider[] {
       return Object.values(providers);
     }
     
     export function getProviderNames(): AIProviderName[] {
       return Object.keys(providers) as AIProviderName[];
     }
     ```
  
  6. Create index.ts:
     ```typescript
     // ============================================
     // [F104] src/lib/ai/index.ts
     // ============================================
     
     export * from './ai-provider';
     export * from './openai-provider';
     export * from './anthropic-provider';
     export * from './google-ai-provider';
     export * from './ai-factory';
     ```

checkpoint_tests:
  - id: T01
    description: "All AI provider files exist"
    type: "files_exist"
    files:
      - "src/lib/ai/ai-provider.ts"
      - "src/lib/ai/openai-provider.ts"
      - "src/lib/ai/anthropic-provider.ts"
      - "src/lib/ai/google-ai-provider.ts"
      - "src/lib/ai/ai-factory.ts"
      - "src/lib/ai/index.ts"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "ai-provider.ts exports interface and base class"
    type: "grep"
    file: "src/lib/ai/ai-provider.ts"
    patterns:
      - "export interface AIProvider"
      - "export abstract class BaseAIProvider"
      - "validateKey"
      - "complete"
      - "streamComplete"
      - "parseJsonResponse"

  - id: T04
    description: "All providers extend BaseAIProvider"
    type: "grep"
    file: "src/lib/ai/openai-provider.ts"
    patterns:
      - "extends BaseAIProvider"
      - "OpenAI"

  - id: T05
    description: "Factory exports getAIProvider"
    type: "grep"
    file: "src/lib/ai/ai-factory.ts"
    patterns:
      - "export function getAIProvider"
      - "openai"
      - "anthropic"
      - "google"

  - id: T06
    description: "index.ts exports all modules"
    type: "grep"
    file: "src/lib/ai/index.ts"
    patterns:
      - "ai-provider"
      - "ai-factory"
      - "openai-provider"
      - "anthropic-provider"
      - "google-ai-provider"

max_retries: 3
B11.yaml â€” Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª API Key (Ø¬Ø¯ÛŒØ¯)
YAML

# blocks/B11.yaml

id: B11
name: "API Key Encryption and Storage"
phase: 1
phase_name: "CV Management"

goal: |
  Create secure storage for AI API keys with encryption.
  Users can add, validate, and manage their API keys for different AI providers.
  Keys are encrypted before storing in Supabase.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B10]

files_to_create:
  - id: F077
    path: "src/lib/encryption.ts"
    description: "Encryption/decryption utilities for API keys"

  - id: F105
    path: "src/app/api/ai/keys/route.ts"
    description: "API route for managing AI API keys"

  - id: F106
    path: "src/app/api/ai/validate/route.ts"
    description: "API route to validate an AI API key"

  - id: F081
    path: "src/hooks/useAIKeys.ts"
    description: "React hook for AI key management"

files_to_modify:
  - id: F087
    path: "src/i18n/en.json"
    description: "Add AI key management translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add AI key management translations"

files_available:
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07
  - id: F066
    path: "src/lib/ai/ai-provider.ts"
    from_block: B10
  - id: F070
    path: "src/lib/ai/ai-factory.ts"
    from_block: B10

commands: []

instructions: |
  1. Create encryption.ts:
     ```typescript
     // ============================================
     // [F077] src/lib/encryption.ts
     // ============================================
     
     import CryptoJS from 'crypto-js';
     
     const SECRET_KEY = process.env.ENCRYPTION_SECRET_KEY || 'default-dev-key-change-in-prod';
     
     export function encrypt(text: string): string {
       return CryptoJS.AES.encrypt(text, SECRET_KEY).toString();
     }
     
     export function decrypt(encryptedText: string): string {
       const bytes = CryptoJS.AES.decrypt(encryptedText, SECRET_KEY);
       return bytes.toString(CryptoJS.enc.Utf8);
     }
     
     // For API keys, add extra validation
     export function encryptApiKey(apiKey: string): string {
       if (!apiKey || apiKey.trim().length === 0) {
         throw new Error('API key cannot be empty');
       }
       return encrypt(apiKey.trim());
     }
     
     export function decryptApiKey(encryptedKey: string): string {
       try {
         const decrypted = decrypt(encryptedKey);
         if (!decrypted) {
           throw new Error('Decryption failed');
         }
         return decrypted;
       } catch (error) {
         throw new Error('Failed to decrypt API key');
       }
     }
     ```
  
  2. Create api/ai/keys/route.ts:
     ```typescript
     // ============================================
     // [F105] src/app/api/ai/keys/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { encryptApiKey, decryptApiKey } from '@/lib/encryption';
     import { getAIProvider } from '@/lib/ai';
     import { AIProviderName, AIApiKey } from '@/lib/types';
     
     // GET - List all API keys for current user (without decrypted keys)
     export async function GET(request: NextRequest) {
       const supabase = createServerSupabaseClient();
       
       // Get current user (from dev auth or session)
       const userId = request.headers.get('x-user-id'); // Simplified for dev
       if (!userId) {
         return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
       }
       
       const { data, error } = await supabase
         .from('ai_api_keys')
         .select('id, provider_name, is_valid, available_models, token_balance, last_validated_at')
         .eq('user_id', userId);
       
       if (error) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
       
       return NextResponse.json({ keys: data });
     }
     
     // POST - Add or update an API key
     export async function POST(request: NextRequest) {
       const supabase = createServerSupabaseClient();
       const userId = request.headers.get('x-user-id');
       
       if (!userId) {
         return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
       }
       
       const { provider_name, api_key } = await request.json();
       
       if (!provider_name || !api_key) {
         return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });
       }
       
       // Validate the key
       const provider = getAIProvider(provider_name as AIProviderName);
       const validation = await provider.validateKey(api_key);
       
       // Encrypt the key
       const encryptedKey = encryptApiKey(api_key);
       
       // Upsert the key
       const { data, error } = await supabase
         .from('ai_api_keys')
         .upsert({
           user_id: userId,
           provider_name,
           api_key_encrypted: encryptedKey,
           is_valid: validation.valid,
           available_models: validation.models || [],
           token_balance: validation.balance,
           last_validated_at: new Date().toISOString()
         }, {
           onConflict: 'user_id,provider_name'
         })
         .select()
         .single();
       
       if (error) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
       
       // Don't return the encrypted key
       const { api_key_encrypted, ...safeData } = data;
       
       return NextResponse.json({
         key: safeData,
         validation: {
           valid: validation.valid,
           error: validation.error,
           models: validation.models
         }
       });
     }
     
     // DELETE - Remove an API key
     export async function DELETE(request: NextRequest) {
       const supabase = createServerSupabaseClient();
       const userId = request.headers.get('x-user-id');
       const { searchParams } = new URL(request.url);
       const provider = searchParams.get('provider');
       
       if (!userId) {
         return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
       }
       
       if (!provider) {
         return NextResponse.json({ error: 'Provider required' }, { status: 400 });
       }
       
       const { error } = await supabase
         .from('ai_api_keys')
         .delete()
         .eq('user_id', userId)
         .eq('provider_name', provider);
       
       if (error) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
       
       return NextResponse.json({ success: true });
     }
     ```
  
  3. Create api/ai/validate/route.ts:
     ```typescript
     // ============================================
     // [F106] src/app/api/ai/validate/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { getAIProvider } from '@/lib/ai';
     import { AIProviderName } from '@/lib/types';
     
     // POST - Validate an API key without storing it
     export async function POST(request: NextRequest) {
       const { provider_name, api_key } = await request.json();
       
       if (!provider_name || !api_key) {
         return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });
       }
       
       try {
         const provider = getAIProvider(provider_name as AIProviderName);
         const validation = await provider.validateKey(api_key);
         
         return NextResponse.json(validation);
       } catch (error: any) {
         return NextResponse.json({
           valid: false,
           error: error.message
         });
       }
     }
     ```
  
  4. Create hooks/useAIKeys.ts:
     ```typescript
     // ============================================
     // [F081] src/hooks/useAIKeys.ts
     // ============================================
     
     import { useState, useEffect, useCallback } from 'react';
     import { useAuth } from '@/context/AuthContext';
     import { AIProviderName, AIApiKey, AIModel } from '@/lib/types';
     
     interface StoredKey {
       id: string;
       provider_name: AIProviderName;
       is_valid: boolean;
       available_models: AIModel[];
       token_balance: string | null;
       last_validated_at: string | null;
     }
     
     export function useAIKeys() {
       const { user } = useAuth();
       const [keys, setKeys] = useState<StoredKey[]>([]);
       const [loading, setLoading] = useState(true);
       const [error, setError] = useState<string | null>(null);
       
       // Fetch keys on mount
       useEffect(() => {
         if (user) {
           fetchKeys();
         }
       }, [user]);
       
       const fetchKeys = useCallback(async () => {
         setLoading(true);
         setError(null);
         
         try {
           const res = await fetch('/api/ai/keys', {
             headers: { 'x-user-id': user?.id || '' }
           });
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           setKeys(data.keys || []);
         } catch (err: any) {
           setError(err.message);
         } finally {
           setLoading(false);
         }
       }, [user]);
       
       const addKey = useCallback(async (provider: AIProviderName, apiKey: string) => {
         setError(null);
         
         try {
           const res = await fetch('/api/ai/keys', {
             method: 'POST',
             headers: {
               'Content-Type': 'application/json',
               'x-user-id': user?.id || ''
             },
             body: JSON.stringify({
               provider_name: provider,
               api_key: apiKey
             })
           });
           
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           await fetchKeys();
           return data.validation;
         } catch (err: any) {
           setError(err.message);
           throw err;
         }
       }, [user, fetchKeys]);
       
       const removeKey = useCallback(async (provider: AIProviderName) => {
         try {
           await fetch(`/api/ai/keys?provider=${provider}`, {
             method: 'DELETE',
             headers: { 'x-user-id': user?.id || '' }
           });
           await fetchKeys();
         } catch (err: any) {
           setError(err.message);
         }
       }, [user, fetchKeys]);
       
       const validateKey = useCallback(async (provider: AIProviderName, apiKey: string) => {
         const res = await fetch('/api/ai/validate', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({
             provider_name: provider,
             api_key: apiKey
           })
         });
         return res.json();
       }, []);
       
       const getModelsForProvider = useCallback((provider: AIProviderName): AIModel[] => {
         const key = keys.find(k => k.provider_name === provider);
         return key?.available_models || [];
       }, [keys]);
       
       const hasValidKey = useCallback((provider: AIProviderName): boolean => {
         const key = keys.find(k => k.provider_name === provider);
         return key?.is_valid || false;
       }, [keys]);
       
       const getValidProviders = useCallback((): AIProviderName[] => {
         return keys.filter(k => k.is_valid).map(k => k.provider_name);
       }, [keys]);
       
       return {
         keys,
         loading,
         error,
         fetchKeys,
         addKey,
         removeKey,
         validateKey,
         getModelsForProvider,
         hasValidKey,
         getValidProviders
       };
     }
     ```
  
  5. Add translations to en.json under "ai_keys":
     - title, add_key, provider, api_key, validate, save, delete
     - status_valid, status_invalid, status_checking
     - key_saved, key_deleted, validation_failed
     - enter_api_key_placeholder
  
  6. Add same translations to fa.json

checkpoint_tests:
  - id: T01
    description: "All API key management files exist"
    type: "files_exist"
    files:
      - "src/lib/encryption.ts"
      - "src/app/api/ai/keys/route.ts"
      - "src/app/api/ai/validate/route.ts"
      - "src/hooks/useAIKeys.ts"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "encryption.ts exports encrypt/decrypt functions"
    type: "grep"
    file: "src/lib/encryption.ts"
    patterns:
      - "export function encrypt"
      - "export function decrypt"
      - "encryptApiKey"
      - "decryptApiKey"
      - "CryptoJS"

  - id: T04
    description: "Keys API route has all CRUD methods"
    type: "grep"
    file: "src/app/api/ai/keys/route.ts"
    patterns:
      - "export async function GET"
      - "export async function POST"
      - "export async function DELETE"
      - "encryptApiKey"

  - id: T05
    description: "useAIKeys hook exports all functions"
    type: "grep"
    file: "src/hooks/useAIKeys.ts"
    patterns:
      - "export function useAIKeys"
      - "addKey"
      - "removeKey"
      - "validateKey"
      - "getModelsForProvider"
      - "hasValidKey"

  - id: T06
    description: "English translations have ai_keys section"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "ai_keys"

max_retries: 3
B12.yaml â€” Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ CV Ø¨Ø§ AI (Ø¬Ø¯ÛŒØ¯)
YAML

# blocks/B12.yaml

id: B12
name: "AI-Powered CV Field Extraction"
phase: 1
phase_name: "CV Management"

goal: |
  Create a system that uses AI to extract structured fields from raw CV text.
  This replaces the regex-based approach with intelligent extraction.
  Includes prompts for CV parsing and handles the AI response.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B09, B10, B11]

files_to_create:
  - id: F074
    path: "src/lib/cv/cv-extractor.ts"
    description: "AI-powered CV field extraction logic"

  - id: F107
    path: "src/lib/cv/cv-extraction-prompt.ts"
    description: "Prompts for CV extraction"

  - id: F108
    path: "src/lib/cv/cv-validator.ts"
    description: "Validate and check completeness of extracted CV"

  - id: F109
    path: "src/lib/cv/index.ts"
    description: "Export all CV modules"

  - id: F110
    path: "src/app/api/cv/extract/route.ts"
    description: "API route for AI CV extraction"

files_to_modify:
  - id: F079
    path: "src/lib/types.ts"
    description: "Add CVExtractionResult type"

files_available:
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F066
    path: "src/lib/ai/ai-provider.ts"
    from_block: B10
  - id: F070
    path: "src/lib/ai/ai-factory.ts"
    from_block: B10
  - id: F077
    path: "src/lib/encryption.ts"
    from_block: B11
  - id: F072
    path: "src/lib/parsers/docx-parser.ts"
    from_block: B09
  - id: F073
    path: "src/lib/parsers/markdown-parser.ts"
    from_block: B09

commands: []

instructions: |
  1. Add to types.ts:
     ```typescript
     // Add these types to the existing types.ts file
     
     export interface CVExtractionResult {
       success: boolean;
       cv: Partial<ComprehensiveCV>;
       fieldStatuses: CVFieldStatus[];
       confidence: number;  // 0-100
       rawText: string;
       aiProvider: AIProviderName;
       aiModel: string;
       extractionNotes?: string;  // Any notes from AI about the extraction
     }
     
     export interface CVExtractionRequest {
       rawText: string;
       aiProvider: AIProviderName;
       aiModel: string;
       language?: 'en' | 'fa' | 'auto';
     }
     ```
  
  2. Create cv-extraction-prompt.ts:
     ```typescript
     // ============================================
     // [F107] src/lib/cv/cv-extraction-prompt.ts
     // ============================================
     
     export const CV_EXTRACTION_SYSTEM_PROMPT = `You are an expert CV/Resume parser. Your job is to extract structured information from CV text.

     You MUST respond with valid JSON only, no other text or markdown.

     The JSON structure must be:
     {
       "personal_info": {
         "full_name": "string or null",
         "email": "string or null",
         "phone": "string or null",
         "location": "string or null",
         "linkedin_url": "string or null",
         "website_url": "string or null",
         "summary": "string or null"
       },
       "work_experience": [
         {
           "id": "unique string",
           "job_title": "string",
           "company": "string",
           "location": "string or null",
           "start_date": "YYYY-MM or null",
           "end_date": "YYYY-MM or null (null if current)",
           "is_current": boolean,
           "description": "string",
           "achievements": ["string"]
         }
       ],
       "education": [
         {
           "id": "unique string",
           "degree": "string",
           "institution": "string",
           "location": "string or null",
           "start_date": "YYYY-MM or null",
           "end_date": "YYYY-MM or null",
           "gpa": "string or null",
           "description": "string or null"
         }
       ],
       "skills": ["string"],
       "certifications": [
         {
           "id": "unique string",
           "name": "string",
           "issuer": "string",
           "date_obtained": "YYYY-MM or null",
           "expiry_date": "YYYY-MM or null",
           "credential_url": "string or null"
         }
       ],
       "languages": [
         {
           "language": "string",
           "proficiency": "Native | Fluent | Advanced | Intermediate | Basic"
         }
       ],
       "projects": [
         {
           "id": "unique string",
           "name": "string",
           "description": "string",
           "url": "string or null"
         }
       ],
       "confidence": 0-100,
       "notes": "Any observations about the CV quality or missing information"
     }

     Rules:
     1. Extract ALL information you can find
     2. Use null for fields that are not present
     3. Generate unique IDs for list items (use simple strings like "work-1", "edu-1", etc.)
     4. Normalize dates to YYYY-MM format when possible
     5. If a date says "Present" or "Current", set is_current to true and end_date to null
     6. Extract achievements as separate items in the achievements array
     7. Be thorough - don't miss any information
     8. The confidence score should reflect how complete and clear the CV is
     9. Add any observations to the notes field`;
     
     export const CV_EXTRACTION_USER_PROMPT = (cvText: string) => 
       `Please parse the following CV/Resume and extract all structured information:

     ---CV TEXT START---
     ${cvText}
     ---CV TEXT END---

     Respond with JSON only.`;
     
     // Alternative prompt for unclear/short CVs
     export const CV_EXTRACTION_CLARIFICATION_PROMPT = (cvText: string, missingFields: string[]) =>
       `The CV appears to be missing some important information. Please try to extract what's available and note the missing fields.
     
     Missing fields: ${missingFields.join(', ')}
     
     CV Text:
     ${cvText}
     
     Respond with JSON only, using null for missing fields.`;
     ```
  
  3. Create cv-validator.ts:
     ```typescript
     // ============================================
     // [F108] src/lib/cv/cv-validator.ts
     // ============================================
     
     import { ComprehensiveCV, CVFieldStatus } from '@/lib/types';
     import { CV_REQUIRED_FIELDS } from '@/lib/constants';
     
     export function validateExtractedCV(cv: Partial<ComprehensiveCV>): CVFieldStatus[] {
       const statuses: CVFieldStatus[] = [];
       
       // Check personal info fields
       const personalFields = ['full_name', 'email', 'phone', 'summary'];
       for (const field of personalFields) {
         const value = cv.personal_info?.[field as keyof typeof cv.personal_info];
         statuses.push({
           field_name: `personal_info.${field}`,
           is_complete: Boolean(value && String(value).trim().length > 0),
           current_value: value || null
         });
       }
       
       // Check work experience
       statuses.push({
         field_name: 'work_experience',
         is_complete: (cv.work_experience?.length || 0) > 0,
         current_value: cv.work_experience || []
       });
       
       // Check education
       statuses.push({
         field_name: 'education',
         is_complete: (cv.education?.length || 0) > 0,
         current_value: cv.education || []
       });
       
       // Check skills
       statuses.push({
         field_name: 'skills',
         is_complete: (cv.skills?.length || 0) > 0,
         current_value: cv.skills || []
       });
       
       return statuses;
     }
     
     export function getMissingFields(statuses: CVFieldStatus[]): string[] {
       return statuses
         .filter(s => !s.is_complete)
         .map(s => s.field_name);
     }
     
     export function getCompletionPercentage(statuses: CVFieldStatus[]): number {
       if (statuses.length === 0) return 0;
       const complete = statuses.filter(s => s.is_complete).length;
       return Math.round((complete / statuses.length) * 100);
     }
     
     export function isMinimumViable(cv: Partial<ComprehensiveCV>): boolean {
       // A CV is minimally viable if it has at least:
       // - Name
       // - Email OR Phone
       // - At least one work experience OR education
       const hasName = Boolean(cv.personal_info?.full_name);
       const hasContact = Boolean(cv.personal_info?.email || cv.personal_info?.phone);
       const hasExperience = (cv.work_experience?.length || 0) > 0;
       const hasEducation = (cv.education?.length || 0) > 0;
       
       return hasName && hasContact && (hasExperience || hasEducation);
     }
     ```
  
  4. Create cv-extractor.ts:
     ```typescript
     // ============================================
     // [F074] src/lib/cv/cv-extractor.ts
     // ============================================
     
     import { getAIProvider } from '@/lib/ai';
     import { AIProviderConfig, AICompletionOptions } from '@/lib/ai/ai-provider';
     import { 
       CVExtractionResult, 
       CVExtractionRequest,
       ComprehensiveCV,
       AIProviderName 
     } from '@/lib/types';
     import { 
       CV_EXTRACTION_SYSTEM_PROMPT, 
       CV_EXTRACTION_USER_PROMPT 
     } from './cv-extraction-prompt';
     import { validateExtractedCV, getCompletionPercentage } from './cv-validator';
     import { generateId } from '@/lib/utils';
     
     export async function extractCVWithAI(
       request: CVExtractionRequest,
       apiKey: string
     ): Promise<CVExtractionResult> {
       const { rawText, aiProvider, aiModel } = request;
       
       const provider = getAIProvider(aiProvider);
       
       const config: AIProviderConfig = {
         apiKey,
         temperature: 0.1,  // Low temperature for consistent extraction
         maxTokens: 4096
       };
       
       const options: AICompletionOptions = {
         model: aiModel,
         messages: [
           { role: 'system', content: CV_EXTRACTION_SYSTEM_PROMPT },
           { role: 'user', content: CV_EXTRACTION_USER_PROMPT(rawText) }
         ],
         jsonMode: true  // Request JSON output where supported
       };
       
       try {
         const response = await provider.complete(config, options);
         const parsed = provider.parseJsonResponse<any>(response);
         
         if (!parsed) {
           return {
             success: false,
             cv: {},
             fieldStatuses: [],
             confidence: 0,
             rawText,
             aiProvider,
             aiModel,
             extractionNotes: 'Failed to parse AI response as JSON'
           };
         }
         
         // Transform parsed data to our CV structure
         const cv: Partial<ComprehensiveCV> = {
           personal_info: parsed.personal_info || {},
           work_experience: (parsed.work_experience || []).map((w: any) => ({
             ...w,
             id: w.id || generateId()
           })),
           education: (parsed.education || []).map((e: any) => ({
             ...e,
             id: e.id || generateId()
           })),
           skills: parsed.skills || [],
           certifications: (parsed.certifications || []).map((c: any) => ({
             ...c,
             id: c.id || generateId()
           })),
           languages: parsed.languages || [],
           projects: (parsed.projects || []).map((p: any) => ({
             ...p,
             id: p.id || generateId()
           })),
           additional_sections: [],
           raw_text: rawText
         };
         
         const fieldStatuses = validateExtractedCV(cv);
         const completionPercentage = getCompletionPercentage(fieldStatuses);
         
         return {
           success: true,
           cv,
           fieldStatuses,
           confidence: parsed.confidence || completionPercentage,
           rawText,
           aiProvider,
           aiModel,
           extractionNotes: parsed.notes
         };
         
       } catch (error: any) {
         return {
           success: false,
           cv: {},
           fieldStatuses: [],
           confidence: 0,
           rawText,
           aiProvider,
           aiModel,
           extractionNotes: `Extraction failed: ${error.message}`
         };
       }
     }
     ```
  
  5. Create index.ts:
     ```typescript
     // ============================================
     // [F109] src/lib/cv/index.ts
     // ============================================
     
     export * from './cv-extractor';
     export * from './cv-extraction-prompt';
     export * from './cv-validator';
     ```
  
  6. Create api/cv/extract/route.ts:
     ```typescript
     // ============================================
     // [F110] src/app/api/cv/extract/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { extractCVWithAI } from '@/lib/cv';
     import { decryptApiKey } from '@/lib/encryption';
     import { parseFile } from '@/lib/parsers';
     import { AIProviderName } from '@/lib/types';
     
     export async function POST(request: NextRequest) {
       const supabase = createServerSupabaseClient();
       const userId = request.headers.get('x-user-id');
       
       if (!userId) {
         return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
       }
       
       const formData = await request.formData();
       const file = formData.get('file') as File | null;
       const rawText = formData.get('rawText') as string | null;
       const provider = formData.get('provider') as AIProviderName;
       const model = formData.get('model') as string;
       
       if (!provider || !model) {
         return NextResponse.json({ 
           error: 'AI provider and model are required' 
         }, { status: 400 });
       }
       
       // Get the user's API key for this provider
       const { data: keyData, error: keyError } = await supabase
         .from('ai_api_keys')
         .select('api_key_encrypted')
         .eq('user_id', userId)
         .eq('provider_name', provider)
         .single();
       
       if (keyError || !keyData) {
         return NextResponse.json({ 
           error: `No API key found for ${provider}. Please add one in Settings.` 
         }, { status: 400 });
       }
       
       // Decrypt the API key
       let apiKey: string;
       try {
         apiKey = decryptApiKey(keyData.api_key_encrypted);
       } catch {
         return NextResponse.json({ 
           error: 'Failed to decrypt API key' 
         }, { status: 500 });
       }
       
       // Get the raw text (either from file or direct input)
       let textToProcess: string;
       
       if (file) {
         try {
           const parsed = await parseFile(file);
           textToProcess = parsed.text;
         } catch (error: any) {
           return NextResponse.json({ 
             error: `Failed to parse file: ${error.message}` 
           }, { status: 400 });
         }
       } else if (rawText) {
         textToProcess = rawText;
       } else {
         return NextResponse.json({ 
           error: 'Either file or rawText is required' 
         }, { status: 400 });
       }
       
       // Extract CV fields using AI
       const result = await extractCVWithAI(
         {
           rawText: textToProcess,
           aiProvider: provider,
           aiModel: model
         },
         apiKey
       );
       
       return NextResponse.json(result);
     }
     ```

checkpoint_tests:
  - id: T01
    description: "All CV extraction files exist"
    type: "files_exist"
    files:
      - "src/lib/cv/cv-extractor.ts"
      - "src/lib/cv/cv-extraction-prompt.ts"
      - "src/lib/cv/cv-validator.ts"
      - "src/lib/cv/index.ts"
      - "src/app/api/cv/extract/route.ts"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "cv-extractor.ts uses AI provider"
    type: "grep"
    file: "src/lib/cv/cv-extractor.ts"
    patterns:
      - "getAIProvider"
      - "extractCVWithAI"
      - "CVExtractionResult"
      - "provider.complete"

  - id: T04
    description: "cv-extraction-prompt.ts has extraction prompts"
    type: "grep"
    file: "src/lib/cv/cv-extraction-prompt.ts"
    patterns:
      - "CV_EXTRACTION_SYSTEM_PROMPT"
      - "CV_EXTRACTION_USER_PROMPT"
      - "personal_info"
      - "work_experience"
      - "JSON"

  - id: T05
    description: "cv-validator.ts has validation functions"
    type: "grep"
    file: "src/lib/cv/cv-validator.ts"
    patterns:
      - "validateExtractedCV"
      - "getMissingFields"
      - "getCompletionPercentage"
      - "isMinimumViable"

  - id: T06
    description: "API route uses AI extraction"
    type: "grep"
    file: "src/app/api/cv/extract/route.ts"
    patterns:
      - "extractCVWithAI"
      - "decryptApiKey"
      - "parseFile"

  - id: T07
    description: "types.ts has CVExtractionResult"
    type: "grep"
    file: "src/lib/types.ts"
    patterns:
      - "CVExtractionResult"
      - "CVExtractionRequest"

max_retries: 3
ØªØ±ØªÛŒØ¨ Ø¬Ø¯ÛŒØ¯ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§
text

B07: Development Auth            (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
B08: Main Layout                 (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
B09: File Parsers                (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±)
B10: AI Provider Interface       â† Ø¬Ø¯ÛŒØ¯ (Ø§Ø² B19 Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯)
B11: API Key Management          â† Ø¬Ø¯ÛŒØ¯ (Ø§Ø² B18/B21/B22 ØªØ±Ú©ÛŒØ¨ Ø´Ø¯)
B12: AI CV Field Extractor       â† Ø¬Ø¯ÛŒØ¯ (Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† B10 Ù‚Ø¯ÛŒÙ…)
B13: CV Uploader Component       â† Ø´Ù…Ø§Ø±Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ (Ù‚Ø¨Ù„Ø§Ù‹ B11)
B14: CV Field Display & Forms    â† Ø´Ù…Ø§Ø±Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ (Ù‚Ø¨Ù„Ø§Ù‹ B12)
B15: CV API & Database           â† Ø´Ù…Ø§Ø±Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ (Ù‚Ø¨Ù„Ø§Ù‹ B13)
B16: CV Manager Page             â† Ø´Ù…Ø§Ø±Ù‡ ØªØºÛŒÛŒØ± Ú©Ø±Ø¯ (Ù‚Ø¨Ù„Ø§Ù‹ B14)

id: B14
name: "CV Field Display and Completion Forms"
phase: 1
phase_name: "CV Management"

goal: |
  Create components to display AI-extracted CV fields, highlight incomplete fields,
  show confidence scores, and provide forms to complete or edit information.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B09, B10, B11, B12, B13]

files_to_create:
  - id: F042
    path: "src/components/cv/CVFieldDisplay.tsx"
    description: "Display extracted fields with completeness indicators"

  - id: F043
    path: "src/components/cv/CVCompletionForm.tsx"
    description: "Form to fill in missing CV fields"

  - id: F044
    path: "src/components/cv/CVPreview.tsx"
    description: "Preview the complete CV in a readable format"

  - id: F099
    path: "src/components/cv/FieldStatusBadge.tsx"
    description: "Badge showing complete/incomplete status"

  - id: F100
    path: "src/components/cv/WorkExperienceForm.tsx"
    description: "Form for adding/editing work experience entries"

  - id: F101
    path: "src/components/cv/EducationForm.tsx"
    description: "Form for adding/editing education entries"

  - id: F113
    path: "src/components/cv/SkillsEditor.tsx"
    description: "Tag-based editor for skills"

  - id: F114
    path: "src/components/cv/PersonalInfoForm.tsx"
    description: "Form for editing personal information"

  - id: F115
    path: "src/components/cv/ConfidenceIndicator.tsx"
    description: "Shows AI extraction confidence score"

files_to_modify:
  - id: F087
    path: "src/i18n/en.json"
    description: "Add field display and form translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add field display and form translations"

files_available:
  - id: F027
    path: "src/components/ui/button.tsx"
    from_block: B02
  - id: F028
    path: "src/components/ui/input.tsx"
    from_block: B02
  - id: F029
    path: "src/components/ui/card.tsx"
    from_block: B02
  - id: F030
    path: "src/components/ui/dialog.tsx"
    from_block: B02
  - id: F032
    path: "src/components/ui/textarea.tsx"
    from_block: B02
  - id: F034
    path: "src/components/ui/badge.tsx"
    from_block: B02
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F108
    path: "src/lib/cv/cv-validator.ts"
    from_block: B12

commands: []

instructions: |
  1. Create FieldStatusBadge.tsx:
     ```typescript
     // ============================================
     // [F099] src/components/cv/FieldStatusBadge.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Badge } from '@/components/ui/badge';
     import { CheckCircle, AlertCircle } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     interface FieldStatusBadgeProps {
       isComplete: boolean;
       size?: 'sm' | 'md';
       showText?: boolean;
       className?: string;
     }
     
     export function FieldStatusBadge({
       isComplete,
       size = 'sm',
       showText = true,
       className
     }: FieldStatusBadgeProps) {
       const t = useTranslations('cv');
       
       const iconSize = size === 'sm' ? 'h-3 w-3' : 'h-4 w-4';
       
       if (isComplete) {
         return (
           <Badge 
             variant="outline" 
             className={cn(
               'bg-green-50 text-green-700 border-green-200 dark:bg-green-950 dark:text-green-300',
               className
             )}
           >
             <CheckCircle className={cn(iconSize, showText && 'mr-1')} />
             {showText && t('field_complete')}
           </Badge>
         );
       }
       
       return (
         <Badge 
           variant="outline" 
           className={cn(
             'bg-yellow-50 text-yellow-700 border-yellow-200 dark:bg-yellow-950 dark:text-yellow-300',
             className
           )}
         >
           <AlertCircle className={cn(iconSize, showText && 'mr-1')} />
           {showText && t('field_incomplete')}
         </Badge>
       );
     }
     ```
  
  2. Create ConfidenceIndicator.tsx:
     ```typescript
     // ============================================
     // [F115] src/components/cv/ConfidenceIndicator.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { cn } from '@/lib/utils';
     import { Sparkles } from 'lucide-react';
     
     interface ConfidenceIndicatorProps {
       confidence: number;  // 0-100
       className?: string;
     }
     
     export function ConfidenceIndicator({ confidence, className }: ConfidenceIndicatorProps) {
       const t = useTranslations('cv');
       
       const getColor = () => {
         if (confidence >= 80) return 'text-green-600 bg-green-100';
         if (confidence >= 60) return 'text-yellow-600 bg-yellow-100';
         return 'text-red-600 bg-red-100';
       };
       
       const getLabel = () => {
         if (confidence >= 80) return t('confidence_high');
         if (confidence >= 60) return t('confidence_medium');
         return t('confidence_low');
       };
       
       return (
         <div className={cn('flex items-center gap-2', className)}>
           <div className={cn(
             'flex items-center gap-1.5 px-2 py-1 rounded-full text-sm font-medium',
             getColor()
           )}>
             <Sparkles className="h-3.5 w-3.5" />
             <span>{confidence}%</span>
           </div>
           <span className="text-xs text-muted-foreground">
             {t('ai_confidence')}: {getLabel()}
           </span>
         </div>
       );
     }
     ```
  
  3. Create PersonalInfoForm.tsx:
     ```typescript
     // ============================================
     // [F114] src/components/cv/PersonalInfoForm.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { PersonalInfo } from '@/lib/types';
     import { Button } from '@/components/ui/button';
     import { Input } from '@/components/ui/input';
     import { Textarea } from '@/components/ui/textarea';
     import { Label } from '@/components/ui/label';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogFooter,
     } from '@/components/ui/dialog';
     
     interface PersonalInfoFormProps {
       info: Partial<PersonalInfo>;
       open: boolean;
       onClose: () => void;
       onSave: (info: PersonalInfo) => void;
     }
     
     export function PersonalInfoForm({
       info,
       open,
       onClose,
       onSave
     }: PersonalInfoFormProps) {
       const t = useTranslations('cv');
       const [formData, setFormData] = useState<Partial<PersonalInfo>>(info);
       
       const handleChange = (field: keyof PersonalInfo, value: string) => {
         setFormData(prev => ({ ...prev, [field]: value }));
       };
       
       const handleSubmit = () => {
         onSave(formData as PersonalInfo);
         onClose();
       };
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-lg">
             <DialogHeader>
               <DialogTitle>{t('edit_personal_info')}</DialogTitle>
             </DialogHeader>
             
             <div className="grid gap-4 py-4">
               <div className="grid gap-2">
                 <Label htmlFor="full_name">{t('full_name')} *</Label>
                 <Input
                   id="full_name"
                   value={formData.full_name || ''}
                   onChange={(e) => handleChange('full_name', e.target.value)}
                   placeholder={t('full_name_placeholder')}
                 />
               </div>
               
               <div className="grid grid-cols-2 gap-4">
                 <div className="grid gap-2">
                   <Label htmlFor="email">{t('email')} *</Label>
                   <Input
                     id="email"
                     type="email"
                     value={formData.email || ''}
                     onChange={(e) => handleChange('email', e.target.value)}
                     placeholder="email@example.com"
                   />
                 </div>
                 <div className="grid gap-2">
                   <Label htmlFor="phone">{t('phone')}</Label>
                   <Input
                     id="phone"
                     value={formData.phone || ''}
                     onChange={(e) => handleChange('phone', e.target.value)}
                     placeholder="+1 234 567 8900"
                   />
                 </div>
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="location">{t('location')}</Label>
                 <Input
                   id="location"
                   value={formData.location || ''}
                   onChange={(e) => handleChange('location', e.target.value)}
                   placeholder={t('location_placeholder')}
                 />
               </div>
               
               <div className="grid grid-cols-2 gap-4">
                 <div className="grid gap-2">
                   <Label htmlFor="linkedin">{t('linkedin')}</Label>
                   <Input
                     id="linkedin"
                     value={formData.linkedin_url || ''}
                     onChange={(e) => handleChange('linkedin_url', e.target.value)}
                     placeholder="linkedin.com/in/..."
                   />
                 </div>
                 <div className="grid gap-2">
                   <Label htmlFor="website">{t('website')}</Label>
                   <Input
                     id="website"
                     value={formData.website_url || ''}
                     onChange={(e) => handleChange('website_url', e.target.value)}
                     placeholder="https://..."
                   />
                 </div>
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="summary">{t('summary')}</Label>
                 <Textarea
                   id="summary"
                   value={formData.summary || ''}
                   onChange={(e) => handleChange('summary', e.target.value)}
                   placeholder={t('summary_placeholder')}
                   rows={4}
                 />
               </div>
             </div>
             
             <DialogFooter>
               <Button variant="outline" onClick={onClose}>
                 {t('cancel')}
               </Button>
               <Button onClick={handleSubmit}>
                 {t('save')}
               </Button>
             </DialogFooter>
           </DialogContent>
         </Dialog>
       );
     }
     ```
  
  4. Create WorkExperienceForm.tsx:
     ```typescript
     // ============================================
     // [F100] src/components/cv/WorkExperienceForm.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { WorkExperience } from '@/lib/types';
     import { generateId } from '@/lib/utils';
     import { Button } from '@/components/ui/button';
     import { Input } from '@/components/ui/input';
     import { Textarea } from '@/components/ui/textarea';
     import { Label } from '@/components/ui/label';
     import { Checkbox } from '@/components/ui/checkbox';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogFooter,
     } from '@/components/ui/dialog';
     import { Plus, X } from 'lucide-react';
     
     interface WorkExperienceFormProps {
       experience?: WorkExperience;
       open: boolean;
       onClose: () => void;
       onSave: (experience: WorkExperience) => void;
     }
     
     export function WorkExperienceForm({
       experience,
       open,
       onClose,
       onSave
     }: WorkExperienceFormProps) {
       const t = useTranslations('cv');
       
       const [formData, setFormData] = useState<Partial<WorkExperience>>(
         experience || {
           id: generateId(),
           job_title: '',
           company: '',
           location: '',
           start_date: '',
           end_date: '',
           is_current: false,
           description: '',
           achievements: []
         }
       );
       
       const [newAchievement, setNewAchievement] = useState('');
       
       const handleChange = (field: keyof WorkExperience, value: any) => {
         setFormData(prev => ({ ...prev, [field]: value }));
       };
       
       const addAchievement = () => {
         if (newAchievement.trim()) {
           handleChange('achievements', [
             ...(formData.achievements || []),
             newAchievement.trim()
           ]);
           setNewAchievement('');
         }
       };
       
       const removeAchievement = (index: number) => {
         handleChange('achievements', 
           (formData.achievements || []).filter((_, i) => i !== index)
         );
       };
       
       const handleSubmit = () => {
         onSave(formData as WorkExperience);
         onClose();
       };
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-lg max-h-[90vh] overflow-y-auto">
             <DialogHeader>
               <DialogTitle>
                 {experience ? t('edit_experience') : t('add_experience')}
               </DialogTitle>
             </DialogHeader>
             
             <div className="grid gap-4 py-4">
               <div className="grid gap-2">
                 <Label htmlFor="job_title">{t('job_title')} *</Label>
                 <Input
                   id="job_title"
                   value={formData.job_title || ''}
                   onChange={(e) => handleChange('job_title', e.target.value)}
                   placeholder={t('job_title_placeholder')}
                 />
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="company">{t('company')} *</Label>
                 <Input
                   id="company"
                   value={formData.company || ''}
                   onChange={(e) => handleChange('company', e.target.value)}
                   placeholder={t('company_placeholder')}
                 />
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="location">{t('location')}</Label>
                 <Input
                   id="location"
                   value={formData.location || ''}
                   onChange={(e) => handleChange('location', e.target.value)}
                   placeholder={t('location_placeholder')}
                 />
               </div>
               
               <div className="grid grid-cols-2 gap-4">
                 <div className="grid gap-2">
                   <Label htmlFor="start_date">{t('start_date')}</Label>
                   <Input
                     id="start_date"
                     type="month"
                     value={formData.start_date || ''}
                     onChange={(e) => handleChange('start_date', e.target.value)}
                   />
                 </div>
                 <div className="grid gap-2">
                   <Label htmlFor="end_date">{t('end_date')}</Label>
                   <Input
                     id="end_date"
                     type="month"
                     value={formData.end_date || ''}
                     onChange={(e) => handleChange('end_date', e.target.value)}
                     disabled={formData.is_current}
                   />
                 </div>
               </div>
               
               <div className="flex items-center gap-2">
                 <Checkbox
                   id="is_current"
                   checked={formData.is_current}
                   onCheckedChange={(checked) => {
                     handleChange('is_current', checked);
                     if (checked) handleChange('end_date', '');
                   }}
                 />
                 <Label htmlFor="is_current" className="cursor-pointer">
                   {t('current_position')}
                 </Label>
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="description">{t('description')}</Label>
                 <Textarea
                   id="description"
                   value={formData.description || ''}
                   onChange={(e) => handleChange('description', e.target.value)}
                   placeholder={t('description_placeholder')}
                   rows={3}
                 />
               </div>
               
               {/* Achievements */}
               <div className="grid gap-2">
                 <Label>{t('achievements')}</Label>
                 <div className="space-y-2">
                   {(formData.achievements || []).map((achievement, index) => (
                     <div key={index} className="flex items-center gap-2">
                       <span className="flex-1 text-sm bg-muted p-2 rounded">
                         {achievement}
                       </span>
                       <Button
                         type="button"
                         variant="ghost"
                         size="sm"
                         onClick={() => removeAchievement(index)}
                       >
                         <X className="h-4 w-4" />
                       </Button>
                     </div>
                   ))}
                   <div className="flex gap-2">
                     <Input
                       value={newAchievement}
                       onChange={(e) => setNewAchievement(e.target.value)}
                       placeholder={t('add_achievement_placeholder')}
                       onKeyPress={(e) => e.key === 'Enter' && addAchievement()}
                     />
                     <Button type="button" variant="outline" onClick={addAchievement}>
                       <Plus className="h-4 w-4" />
                     </Button>
                   </div>
                 </div>
               </div>
             </div>
             
             <DialogFooter>
               <Button variant="outline" onClick={onClose}>
                 {t('cancel')}
               </Button>
               <Button onClick={handleSubmit}>
                 {t('save')}
               </Button>
             </DialogFooter>
           </DialogContent>
         </Dialog>
       );
     }
     ```
  
  5. Create EducationForm.tsx (similar structure to WorkExperienceForm):
     ```typescript
     // ============================================
     // [F101] src/components/cv/EducationForm.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { Education } from '@/lib/types';
     import { generateId } from '@/lib/utils';
     import { Button } from '@/components/ui/button';
     import { Input } from '@/components/ui/input';
     import { Textarea } from '@/components/ui/textarea';
     import { Label } from '@/components/ui/label';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogFooter,
     } from '@/components/ui/dialog';
     
     interface EducationFormProps {
       education?: Education;
       open: boolean;
       onClose: () => void;
       onSave: (education: Education) => void;
     }
     
     export function EducationForm({
       education,
       open,
       onClose,
       onSave
     }: EducationFormProps) {
       const t = useTranslations('cv');
       
       const [formData, setFormData] = useState<Partial<Education>>(
         education || {
           id: generateId(),
           degree: '',
           institution: '',
           location: '',
           start_date: '',
           end_date: '',
           gpa: '',
           description: ''
         }
       );
       
       const handleChange = (field: keyof Education, value: string) => {
         setFormData(prev => ({ ...prev, [field]: value }));
       };
       
       const handleSubmit = () => {
         onSave(formData as Education);
         onClose();
       };
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-lg">
             <DialogHeader>
               <DialogTitle>
                 {education ? t('edit_education') : t('add_education')}
               </DialogTitle>
             </DialogHeader>
             
             <div className="grid gap-4 py-4">
               <div className="grid gap-2">
                 <Label htmlFor="degree">{t('degree')} *</Label>
                 <Input
                   id="degree"
                   value={formData.degree || ''}
                   onChange={(e) => handleChange('degree', e.target.value)}
                   placeholder={t('degree_placeholder')}
                 />
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="institution">{t('institution')} *</Label>
                 <Input
                   id="institution"
                   value={formData.institution || ''}
                   onChange={(e) => handleChange('institution', e.target.value)}
                   placeholder={t('institution_placeholder')}
                 />
               </div>
               
               <div className="grid grid-cols-2 gap-4">
                 <div className="grid gap-2">
                   <Label htmlFor="location">{t('location')}</Label>
                   <Input
                     id="location"
                     value={formData.location || ''}
                     onChange={(e) => handleChange('location', e.target.value)}
                   />
                 </div>
                 <div className="grid gap-2">
                   <Label htmlFor="gpa">{t('gpa')}</Label>
                   <Input
                     id="gpa"
                     value={formData.gpa || ''}
                     onChange={(e) => handleChange('gpa', e.target.value)}
                     placeholder="3.8/4.0"
                   />
                 </div>
               </div>
               
               <div className="grid grid-cols-2 gap-4">
                 <div className="grid gap-2">
                   <Label htmlFor="start_date">{t('start_date')}</Label>
                   <Input
                     id="start_date"
                     type="month"
                     value={formData.start_date || ''}
                     onChange={(e) => handleChange('start_date', e.target.value)}
                   />
                 </div>
                 <div className="grid gap-2">
                   <Label htmlFor="end_date">{t('end_date')}</Label>
                   <Input
                     id="end_date"
                     type="month"
                     value={formData.end_date || ''}
                     onChange={(e) => handleChange('end_date', e.target.value)}
                   />
                 </div>
               </div>
               
               <div className="grid gap-2">
                 <Label htmlFor="description">{t('description')}</Label>
                 <Textarea
                   id="description"
                   value={formData.description || ''}
                   onChange={(e) => handleChange('description', e.target.value)}
                   rows={3}
                 />
               </div>
             </div>
             
             <DialogFooter>
               <Button variant="outline" onClick={onClose}>
                 {t('cancel')}
               </Button>
               <Button onClick={handleSubmit}>
                 {t('save')}
               </Button>
             </DialogFooter>
           </DialogContent>
         </Dialog>
       );
     }
     ```
  
  6. Create SkillsEditor.tsx:
     ```typescript
     // ============================================
     // [F113] src/components/cv/SkillsEditor.tsx
     // ============================================
     
     'use client';
     
     import { useState, useCallback } from 'react';
     import { useTranslations } from 'next-intl';
     import { Input } from '@/components/ui/input';
     import { Badge } from '@/components/ui/badge';
     import { X, Plus } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     interface SkillsEditorProps {
       skills: string[];
       onChange: (skills: string[]) => void;
       disabled?: boolean;
       className?: string;
     }
     
     export function SkillsEditor({
       skills,
       onChange,
       disabled = false,
       className
     }: SkillsEditorProps) {
       const t = useTranslations('cv');
       const [inputValue, setInputValue] = useState('');
       
       const addSkill = useCallback(() => {
         const skill = inputValue.trim();
         if (skill && !skills.includes(skill)) {
           onChange([...skills, skill]);
           setInputValue('');
         }
       }, [inputValue, skills, onChange]);
       
       const removeSkill = useCallback((skillToRemove: string) => {
         onChange(skills.filter(s => s !== skillToRemove));
       }, [skills, onChange]);
       
       const handleKeyDown = (e: React.KeyboardEvent) => {
         if (e.key === 'Enter') {
           e.preventDefault();
           addSkill();
         }
       };
       
       return (
         <div className={cn('space-y-3', className)}>
           <div className="flex gap-2">
             <Input
               value={inputValue}
               onChange={(e) => setInputValue(e.target.value)}
               onKeyDown={handleKeyDown}
               placeholder={t('add_skill_placeholder')}
               disabled={disabled}
               className="flex-1"
             />
             <button
               onClick={addSkill}
               disabled={disabled || !inputValue.trim()}
               className="px-3 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 disabled:opacity-50"
             >
               <Plus className="h-4 w-4" />
             </button>
           </div>
           
           <div className="flex flex-wrap gap-2">
             {skills.map((skill) => (
               <Badge
                 key={skill}
                 variant="secondary"
                 className="px-3 py-1 text-sm"
               >
                 {skill}
                 {!disabled && (
                   <button
                     onClick={() => removeSkill(skill)}
                     className="ml-2 hover:text-destructive"
                   >
                     <X className="h-3 w-3" />
                   </button>
                 )}
               </Badge>
             ))}
             {skills.length === 0 && (
               <span className="text-sm text-muted-foreground">
                 {t('no_skills_added')}
               </span>
             )}
           </div>
         </div>
       );
     }
     ```
  
  7. Create CVFieldDisplay.tsx:
     ```typescript
     // ============================================
     // [F042] src/components/cv/CVFieldDisplay.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { ComprehensiveCV, CVFieldStatus, WorkExperience, Education } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { FieldStatusBadge } from './FieldStatusBadge';
     import { ConfidenceIndicator } from './ConfidenceIndicator';
     import { PersonalInfoForm } from './PersonalInfoForm';
     import { WorkExperienceForm } from './WorkExperienceForm';
     import { EducationForm } from './EducationForm';
     import { SkillsEditor } from './SkillsEditor';
     import {
       User, Briefcase, GraduationCap, Code, Award, Languages, FolderOpen,
       Pencil, Plus, Trash2
     } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     interface CVFieldDisplayProps {
       cv: Partial<ComprehensiveCV>;
       fieldStatuses: CVFieldStatus[];
       confidence: number;
       onUpdate: (updates: Partial<ComprehensiveCV>) => void;
       className?: string;
     }
     
     export function CVFieldDisplay({
       cv,
       fieldStatuses,
       confidence,
       onUpdate,
       className
     }: CVFieldDisplayProps) {
       const t = useTranslations('cv');
       
       // Edit dialogs state
       const [editingPersonalInfo, setEditingPersonalInfo] = useState(false);
       const [editingExperience, setEditingExperience] = useState<WorkExperience | null>(null);
       const [addingExperience, setAddingExperience] = useState(false);
       const [editingEducation, setEditingEducation] = useState<Education | null>(null);
       const [addingEducation, setAddingEducation] = useState(false);
       
       // Helper to check if a field is complete
       const isFieldComplete = (fieldName: string) => {
         return fieldStatuses.find(s => s.field_name === fieldName)?.is_complete ?? false;
       };
       
       // Calculate completion stats
       const completeCount = fieldStatuses.filter(s => s.is_complete).length;
       const totalCount = fieldStatuses.length;
       const completionPercent = totalCount > 0 ? Math.round((completeCount / totalCount) * 100) : 0;
       
       // Update handlers
       const handlePersonalInfoSave = (info: any) => {
         onUpdate({ personal_info: info });
       };
       
       const handleExperienceSave = (exp: WorkExperience) => {
         const current = cv.work_experience || [];
         const index = current.findIndex(e => e.id === exp.id);
         if (index >= 0) {
           const updated = [...current];
           updated[index] = exp;
           onUpdate({ work_experience: updated });
         } else {
           onUpdate({ work_experience: [...current, exp] });
         }
         setEditingExperience(null);
         setAddingExperience(false);
       };
       
       const handleExperienceDelete = (id: string) => {
         onUpdate({
           work_experience: (cv.work_experience || []).filter(e => e.id !== id)
         });
       };
       
       const handleEducationSave = (edu: Education) => {
         const current = cv.education || [];
         const index = current.findIndex(e => e.id === edu.id);
         if (index >= 0) {
           const updated = [...current];
           updated[index] = edu;
           onUpdate({ education: updated });
         } else {
           onUpdate({ education: [...current, edu] });
         }
         setEditingEducation(null);
         setAddingEducation(false);
       };
       
       const handleEducationDelete = (id: string) => {
         onUpdate({
           education: (cv.education || []).filter(e => e.id !== id)
         });
       };
       
       const handleSkillsChange = (skills: string[]) => {
         onUpdate({ skills });
       };
       
       return (
         <div className={cn('space-y-6', className)}>
           {/* Summary Header */}
           <Card>
             <CardContent className="py-4">
               <div className="flex items-center justify-between flex-wrap gap-4">
                 <div>
                   <h3 className="font-semibold text-lg">{t('extraction_summary')}</h3>
                   <p className="text-sm text-muted-foreground">
                     {t('fields_complete', { count: completeCount, total: totalCount })}
                   </p>
                 </div>
                 <div className="flex items-center gap-4">
                   <div className="w-32 h-2 bg-muted rounded-full overflow-hidden">
                     <div 
                       className="h-full bg-primary transition-all" 
                       style={{ width: `${completionPercent}%` }}
                     />
                   </div>
                   <ConfidenceIndicator confidence={confidence} />
                 </div>
               </div>
             </CardContent>
           </Card>
           
           {/* Personal Info */}
           <Card>
             <CardHeader className="flex flex-row items-center justify-between">
               <CardTitle className="flex items-center gap-2 text-lg">
                 <User className="h-5 w-5" />
                 {t('personal_info')}
               </CardTitle>
               <div className="flex items-center gap-2">
                 <FieldStatusBadge isComplete={isFieldComplete('personal_info.full_name')} />
                 <Button variant="ghost" size="sm" onClick={() => setEditingPersonalInfo(true)}>
                   <Pencil className="h-4 w-4" />
                 </Button>
               </div>
             </CardHeader>
             <CardContent>
               <dl className="grid grid-cols-2 gap-4 text-sm">
                 <div>
                   <dt className="text-muted-foreground">{t('full_name')}</dt>
                   <dd className="font-medium">{cv.personal_info?.full_name || 'â€”'}</dd>
                 </div>
                 <div>
                   <dt className="text-muted-foreground">{t('email')}</dt>
                   <dd>{cv.personal_info?.email || 'â€”'}</dd>
                 </div>
                 <div>
                   <dt className="text-muted-foreground">{t('phone')}</dt>
                   <dd>{cv.personal_info?.phone || 'â€”'}</dd>
                 </div>
                 <div>
                   <dt className="text-muted-foreground">{t('location')}</dt>
                   <dd>{cv.personal_info?.location || 'â€”'}</dd>
                 </div>
               </dl>
               {cv.personal_info?.summary && (
                 <div className="mt-4">
                   <dt className="text-muted-foreground text-sm">{t('summary')}</dt>
                   <dd className="mt-1 text-sm">{cv.personal_info.summary}</dd>
                 </div>
               )}
             </CardContent>
           </Card>
           
           {/* Work Experience */}
           <Card>
             <CardHeader className="flex flex-row items-center justify-between">
               <CardTitle className="flex items-center gap-2 text-lg">
                 <Briefcase className="h-5 w-5" />
                 {t('work_experience')}
               </CardTitle>
               <div className="flex items-center gap-2">
                 <FieldStatusBadge isComplete={isFieldComplete('work_experience')} />
                 <Button variant="ghost" size="sm" onClick={() => setAddingExperience(true)}>
                   <Plus className="h-4 w-4" />
                 </Button>
               </div>
             </CardHeader>
             <CardContent>
               {(cv.work_experience || []).length > 0 ? (
                 <div className="space-y-4">
                   {cv.work_experience!.map((exp) => (
                     <div 
                       key={exp.id} 
                       className="p-4 bg-muted/50 rounded-lg group relative"
                     >
                       <div className="absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                         <Button 
                           variant="ghost" 
                           size="sm"
                           onClick={() => setEditingExperience(exp)}
                         >
                           <Pencil className="h-3 w-3" />
                         </Button>
                         <Button 
                           variant="ghost" 
                           size="sm"
                           onClick={() => handleExperienceDelete(exp.id)}
                         >
                           <Trash2 className="h-3 w-3 text-destructive" />
                         </Button>
                       </div>
                       <h4 className="font-semibold">{exp.job_title}</h4>
                       <p className="text-sm text-muted-foreground">
                         {exp.company} {exp.location && `â€¢ ${exp.location}`}
                       </p>
                       <p className="text-xs text-muted-foreground mt-1">
                         {exp.start_date} â€” {exp.is_current ? t('present') : exp.end_date}
                       </p>
                       {exp.description && (
                         <p className="text-sm mt-2">{exp.description}</p>
                       )}
                     </div>
                   ))}
                 </div>
               ) : (
                 <p className="text-sm text-muted-foreground">{t('no_experience_added')}</p>
               )}
             </CardContent>
           </Card>
           
           {/* Education */}
           <Card>
             <CardHeader className="flex flex-row items-center justify-between">
               <CardTitle className="flex items-center gap-2 text-lg">
                 <GraduationCap className="h-5 w-5" />
                 {t('education')}
               </CardTitle>
               <div className="flex items-center gap-2">
                 <FieldStatusBadge isComplete={isFieldComplete('education')} />
                 <Button variant="ghost" size="sm" onClick={() => setAddingEducation(true)}>
                   <Plus className="h-4 w-4" />
                 </Button>
               </div>
             </CardHeader>
             <CardContent>
               {(cv.education || []).length > 0 ? (
                 <div className="space-y-4">
                   {cv.education!.map((edu) => (
                     <div 
                       key={edu.id} 
                       className="p-4 bg-muted/50 rounded-lg group relative"
                     >
                       <div className="absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                         <Button 
                           variant="ghost" 
                           size="sm"
                           onClick={() => setEditingEducation(edu)}
                         >
                           <Pencil className="h-3 w-3" />
                         </Button>
                         <Button 
                           variant="ghost" 
                           size="sm"
                           onClick={() => handleEducationDelete(edu.id)}
                         >
                           <Trash2 className="h-3 w-3 text-destructive" />
                         </Button>
                       </div>
                       <h4 className="font-semibold">{edu.degree}</h4>
                       <p className="text-sm text-muted-foreground">{edu.institution}</p>
                       <p className="text-xs text-muted-foreground mt-1">
                         {edu.start_date} â€” {edu.end_date}
                         {edu.gpa && ` â€¢ GPA: ${edu.gpa}`}
                       </p>
                     </div>
                   ))}
                 </div>
               ) : (
                 <p className="text-sm text-muted-foreground">{t('no_education_added')}</p>
               )}
             </CardContent>
           </Card>
           {/* Skills */}
           <Card>
             <CardHeader className="flex flex-row items-center justify-between">
               <CardTitle className="flex items-center gap-2 text-lg">
                 <Code className="h-5 w-5" />
                 {t('skills')}
               </CardTitle>
               <FieldStatusBadge isComplete={isFieldComplete('skills')} />
             </CardHeader>
             <CardContent>
               <SkillsEditor
                 skills={cv.skills || []}
                 onChange={handleSkillsChange}
               />
             </CardContent>
           </Card>
           
           {/* Languages */}
           {(cv.languages || []).length > 0 && (
             <Card>
               <CardHeader>
                 <CardTitle className="flex items-center gap-2 text-lg">
                   <Languages className="h-5 w-5" />
                   {t('languages')}
                 </CardTitle>
               </CardHeader>
               <CardContent>
                 <div className="flex flex-wrap gap-2">
                   {cv.languages!.map((lang, index) => (
                     <Badge key={index} variant="outline">
                       {lang.language} â€” {lang.proficiency}
                     </Badge>
                   ))}
                 </div>
               </CardContent>
             </Card>
           )}
           
           {/* Certifications */}
           {(cv.certifications || []).length > 0 && (
             <Card>
               <CardHeader>
                 <CardTitle className="flex items-center gap-2 text-lg">
                   <Award className="h-5 w-5" />
                   {t('certifications')}
                 </CardTitle>
               </CardHeader>
               <CardContent>
                 <div className="space-y-3">
                   {cv.certifications!.map((cert) => (
                     <div key={cert.id} className="p-3 bg-muted/50 rounded-lg">
                       <h4 className="font-medium">{cert.name}</h4>
                       <p className="text-sm text-muted-foreground">
                         {cert.issuer} â€¢ {cert.date_obtained}
                       </p>
                     </div>
                   ))}
                 </div>
               </CardContent>
             </Card>
           )}
           
           {/* Projects */}
           {(cv.projects || []).length > 0 && (
             <Card>
               <CardHeader>
                 <CardTitle className="flex items-center gap-2 text-lg">
                   <FolderOpen className="h-5 w-5" />
                   {t('projects')}
                 </CardTitle>
               </CardHeader>
               <CardContent>
                 <div className="space-y-3">
                   {cv.projects!.map((project) => (
                     <div key={project.id} className="p-3 bg-muted/50 rounded-lg">
                       <h4 className="font-medium">{project.name}</h4>
                       <p className="text-sm mt-1">{project.description}</p>
                       {project.url && (
                         <a 
                           href={project.url} 
                           target="_blank" 
                           rel="noopener noreferrer"
                           className="text-xs text-primary hover:underline mt-1 inline-block"
                         >
                           {project.url}
                         </a>
                       )}
                     </div>
                   ))}
                 </div>
               </CardContent>
             </Card>
           )}
           
           {/* Edit Dialogs */}
           <PersonalInfoForm
             info={cv.personal_info || {}}
             open={editingPersonalInfo}
             onClose={() => setEditingPersonalInfo(false)}
             onSave={handlePersonalInfoSave}
           />
           
           <WorkExperienceForm
             experience={editingExperience || undefined}
             open={editingExperience !== null || addingExperience}
             onClose={() => {
               setEditingExperience(null);
               setAddingExperience(false);
             }}
             onSave={handleExperienceSave}
           />
           
           <EducationForm
             education={editingEducation || undefined}
             open={editingEducation !== null || addingEducation}
             onClose={() => {
               setEditingEducation(null);
               setAddingEducation(false);
             }}
             onSave={handleEducationSave}
           />
         </div>
       );
     }
     ```
  
  8. Create CVCompletionForm.tsx:
     ```typescript
     // ============================================
     // [F043] src/components/cv/CVCompletionForm.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { CVFieldStatus } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { AlertTriangle, ArrowRight } from 'lucide-react';
     
     interface CVCompletionFormProps {
       incompleteFields: CVFieldStatus[];
       onFieldClick: (fieldName: string) => void;
       className?: string;
     }
     
     export function CVCompletionForm({
       incompleteFields,
       onFieldClick,
       className
     }: CVCompletionFormProps) {
       const t = useTranslations('cv');
       
       if (incompleteFields.length === 0) {
         return null;
       }
       
       const getFieldLabel = (fieldName: string): string => {
         const labels: Record<string, string> = {
           'personal_info.full_name': t('full_name'),
           'personal_info.email': t('email'),
           'personal_info.phone': t('phone'),
           'personal_info.summary': t('summary'),
           'work_experience': t('work_experience'),
           'education': t('education'),
           'skills': t('skills'),
         };
         return labels[fieldName] || fieldName;
       };
       
       const getFieldSection = (fieldName: string): string => {
         if (fieldName.startsWith('personal_info')) return 'personal';
         return fieldName;
       };
       
       return (
         <Card className={className}>
           <CardHeader>
             <CardTitle className="flex items-center gap-2 text-yellow-600">
               <AlertTriangle className="h-5 w-5" />
               {t('incomplete_fields')}
             </CardTitle>
             <CardDescription>
               {t('complete_fields_hint')}
             </CardDescription>
           </CardHeader>
           <CardContent>
             <ul className="space-y-2">
               {incompleteFields.map((field) => (
                 <li key={field.field_name}>
                   <Button
                     variant="ghost"
                     className="w-full justify-between text-left h-auto py-3"
                     onClick={() => onFieldClick(getFieldSection(field.field_name))}
                   >
                     <span className="flex items-center gap-2">
                       <span className="w-2 h-2 rounded-full bg-yellow-500" />
                       {getFieldLabel(field.field_name)}
                     </span>
                     <ArrowRight className="h-4 w-4" />
                   </Button>
                 </li>
               ))}
             </ul>
           </CardContent>
         </Card>
       );
     }
     ```
  
  9. Create CVPreview.tsx:
     ```typescript
     // ============================================
     // [F044] src/components/cv/CVPreview.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { ComprehensiveCV } from '@/lib/types';
     import { Card, CardContent } from '@/components/ui/card';
     import { Separator } from '@/components/ui/separator';
     import { cn, isRTL } from '@/lib/utils';
     import { 
       Mail, Phone, MapPin, Linkedin, Globe, 
       Briefcase, GraduationCap, Award, Code, Languages as LanguagesIcon
     } from 'lucide-react';
     
     interface CVPreviewProps {
       cv: Partial<ComprehensiveCV>;
       locale: 'en' | 'fa';
       className?: string;
     }
     
     export function CVPreview({ cv, locale, className }: CVPreviewProps) {
       const t = useTranslations('cv');
       const rtl = isRTL(locale);
       
       const formatDate = (date: string | null | undefined): string => {
         if (!date) return '';
         const [year, month] = date.split('-');
         return locale === 'fa' 
           ? `${year}/${month}`
           : new Date(date).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
       };
       
       return (
         <Card className={cn('overflow-hidden', className)}>
           <CardContent className={cn(
             'p-8 max-w-3xl mx-auto',
             rtl && 'text-right'
           )} dir={rtl ? 'rtl' : 'ltr'}>
             
             {/* Header / Personal Info */}
             <header className="mb-8">
               <h1 className="text-3xl font-bold mb-2">
                 {cv.personal_info?.full_name || t('your_name')}
               </h1>
               
               {cv.personal_info?.summary && (
                 <p className="text-muted-foreground mt-3 leading-relaxed">
                   {cv.personal_info.summary}
                 </p>
               )}
               
               <div className={cn(
                 'flex flex-wrap gap-4 mt-4 text-sm text-muted-foreground',
                 rtl && 'flex-row-reverse'
               )}>
                 {cv.personal_info?.email && (
                   <span className="flex items-center gap-1">
                     <Mail className="h-4 w-4" />
                     {cv.personal_info.email}
                   </span>
                 )}
                 {cv.personal_info?.phone && (
                   <span className="flex items-center gap-1">
                     <Phone className="h-4 w-4" />
                     {cv.personal_info.phone}
                   </span>
                 )}
                 {cv.personal_info?.location && (
                   <span className="flex items-center gap-1">
                     <MapPin className="h-4 w-4" />
                     {cv.personal_info.location}
                   </span>
                 )}
                 {cv.personal_info?.linkedin_url && (
                   <span className="flex items-center gap-1">
                     <Linkedin className="h-4 w-4" />
                     LinkedIn
                   </span>
                 )}
                 {cv.personal_info?.website_url && (
                   <span className="flex items-center gap-1">
                     <Globe className="h-4 w-4" />
                     Website
                   </span>
                 )}
               </div>
             </header>
             
             <Separator className="my-6" />
             
             {/* Work Experience */}
             {(cv.work_experience || []).length > 0 && (
               <section className="mb-8">
                 <h2 className="text-xl font-semibold flex items-center gap-2 mb-4">
                   <Briefcase className="h-5 w-5" />
                   {t('work_experience')}
                 </h2>
                 <div className="space-y-6">
                   {cv.work_experience!.map((exp) => (
                     <div key={exp.id}>
                       <div className="flex justify-between items-start flex-wrap gap-2">
                         <div>
                           <h3 className="font-semibold">{exp.job_title}</h3>
                           <p className="text-muted-foreground">{exp.company}</p>
                         </div>
                         <div className="text-sm text-muted-foreground">
                           {formatDate(exp.start_date)} â€” {exp.is_current ? t('present') : formatDate(exp.end_date)}
                         </div>
                       </div>
                       {exp.description && (
                         <p className="mt-2 text-sm">{exp.description}</p>
                       )}
                       {exp.achievements && exp.achievements.length > 0 && (
                         <ul className="mt-2 space-y-1">
                           {exp.achievements.map((achievement, i) => (
                             <li key={i} className="text-sm flex items-start gap-2">
                               <span className="text-primary mt-1.5">â€¢</span>
                               {achievement}
                             </li>
                           ))}
                         </ul>
                       )}
                     </div>
                   ))}
                 </div>
               </section>
             )}
             
             {/* Education */}
             {(cv.education || []).length > 0 && (
               <section className="mb-8">
                 <h2 className="text-xl font-semibold flex items-center gap-2 mb-4">
                   <GraduationCap className="h-5 w-5" />
                   {t('education')}
                 </h2>
                 <div className="space-y-4">
                   {cv.education!.map((edu) => (
                     <div key={edu.id}>
                       <div className="flex justify-between items-start flex-wrap gap-2">
                         <div>
                           <h3 className="font-semibold">{edu.degree}</h3>
                           <p className="text-muted-foreground">{edu.institution}</p>
                         </div>
                         <div className="text-sm text-muted-foreground">
                           {formatDate(edu.start_date)} â€” {formatDate(edu.end_date)}
                           {edu.gpa && ` â€¢ GPA: ${edu.gpa}`}
                         </div>
                       </div>
                       {edu.description && (
                         <p className="mt-1 text-sm">{edu.description}</p>
                       )}
                     </div>
                   ))}
                 </div>
               </section>
             )}
             
             {/* Skills */}
             {(cv.skills || []).length > 0 && (
               <section className="mb-8">
                 <h2 className="text-xl font-semibold flex items-center gap-2 mb-4">
                   <Code className="h-5 w-5" />
                   {t('skills')}
                 </h2>
                 <div className="flex flex-wrap gap-2">
                   {cv.skills!.map((skill, i) => (
                     <span 
                       key={i}
                       className="px-3 py-1 bg-muted rounded-full text-sm"
                     >
                       {skill}
                     </span>
                   ))}
                 </div>
               </section>
             )}
             
             {/* Languages */}
             {(cv.languages || []).length > 0 && (
               <section className="mb-8">
                 <h2 className="text-xl font-semibold flex items-center gap-2 mb-4">
                   <LanguagesIcon className="h-5 w-5" />
                   {t('languages')}
                 </h2>
                 <div className="flex flex-wrap gap-4">
                   {cv.languages!.map((lang, i) => (
                     <span key={i} className="text-sm">
                       <span className="font-medium">{lang.language}</span>
                       <span className="text-muted-foreground"> â€” {lang.proficiency}</span>
                     </span>
                   ))}
                 </div>
               </section>
             )}
             
             {/* Certifications */}
             {(cv.certifications || []).length > 0 && (
               <section className="mb-8">
                 <h2 className="text-xl font-semibold flex items-center gap-2 mb-4">
                   <Award className="h-5 w-5" />
                   {t('certifications')}
                 </h2>
                 <div className="space-y-2">
                   {cv.certifications!.map((cert) => (
                     <div key={cert.id} className="flex justify-between items-center">
                       <div>
                         <span className="font-medium">{cert.name}</span>
                         <span className="text-muted-foreground"> â€” {cert.issuer}</span>
                       </div>
                       <span className="text-sm text-muted-foreground">
                         {formatDate(cert.date_obtained)}
                       </span>
                     </div>
                   ))}
                 </div>
               </section>
             )}
             
           </CardContent>
         </Card>
       );
     }
     ```
  
  10. Add translations to en.json under "cv" key (append to existing):
      ```json
      {
        "cv": {
          "field_complete": "Complete",
          "field_incomplete": "Incomplete",
          "extraction_summary": "Extraction Summary",
          "fields_complete": "{count} of {total} fields complete",
          "ai_confidence": "AI Confidence",
          "confidence_high": "High",
          "confidence_medium": "Medium",
          "confidence_low": "Low",
          "personal_info": "Personal Information",
          "work_experience": "Work Experience",
          "education": "Education",
          "skills": "Skills",
          "certifications": "Certifications",
          "languages": "Languages",
          "projects": "Projects",
          "full_name": "Full Name",
          "email": "Email",
          "phone": "Phone",
          "location": "Location",
          "linkedin": "LinkedIn",
          "website": "Website",
          "summary": "Professional Summary",
          "edit_personal_info": "Edit Personal Information",
          "full_name_placeholder": "John Doe",
          "location_placeholder": "City, Country",
          "summary_placeholder": "Brief professional summary...",
          "job_title": "Job Title",
          "company": "Company",
          "start_date": "Start Date",
          "end_date": "End Date",
          "current_position": "I currently work here",
          "present": "Present",
          "description": "Description",
          "description_placeholder": "Describe your role and responsibilities...",
          "achievements": "Key Achievements",
          "add_achievement_placeholder": "Add an achievement...",
          "add_experience": "Add Experience",
          "edit_experience": "Edit Experience",
          "no_experience_added": "No work experience added yet",
          "degree": "Degree",
          "institution": "Institution",
          "gpa": "GPA",
          "degree_placeholder": "Bachelor of Science in...",
          "institution_placeholder": "University name",
          "add_education": "Add Education",
          "edit_education": "Edit Education",
          "no_education_added": "No education added yet",
          "add_skill_placeholder": "Type a skill and press Enter",
          "no_skills_added": "No skills added yet",
          "incomplete_fields": "Incomplete Fields",
          "complete_fields_hint": "Complete these fields to improve your CV",
          "your_name": "Your Name",
          "save": "Save",
          "cancel": "Cancel"
        }
      }
      ```
  
  11. Add same translations to fa.json:
      ```json
      {
        "cv": {
          "field_complete": "Ú©Ø§Ù…Ù„",
          "field_incomplete": "Ù†Ø§Ù‚Øµ",
          "extraction_summary": "Ø®Ù„Ø§ØµÙ‡ Ø§Ø³ØªØ®Ø±Ø§Ø¬",
          "fields_complete": "{count} Ø§Ø² {total} ÙÛŒÙ„Ø¯ Ú©Ø§Ù…Ù„",
          "ai_confidence": "Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "confidence_high": "Ø¨Ø§Ù„Ø§",
          "confidence_medium": "Ù…ØªÙˆØ³Ø·",
          "confidence_low": "Ù¾Ø§ÛŒÛŒÙ†",
          "personal_info": "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ",
          "work_experience": "Ø³ÙˆØ§Ø¨Ù‚ Ú©Ø§Ø±ÛŒ",
          "education": "ØªØ­ØµÛŒÙ„Ø§Øª",
          "skills": "Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§",
          "certifications": "Ú¯ÙˆØ§Ù‡ÛŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§",
          "languages": "Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§",
          "projects": "Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§",
          "full_name": "Ù†Ø§Ù… Ú©Ø§Ù…Ù„",
          "email": "Ø§ÛŒÙ…ÛŒÙ„",
          "phone": "ØªÙ„ÙÙ†",
          "location": "Ù…ÙˆÙ‚Ø¹ÛŒØª",
          "linkedin": "Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†",
          "website": "ÙˆØ¨â€ŒØ³Ø§ÛŒØª",
          "summary": "Ø®Ù„Ø§ØµÙ‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ",
          "edit_personal_info": "ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ",
          "full_name_placeholder": "Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",
          "location_placeholder": "Ø´Ù‡Ø±ØŒ Ú©Ø´ÙˆØ±",
          "summary_placeholder": "Ø®Ù„Ø§ØµÙ‡â€ŒØ§ÛŒ Ø§Ø² ØªØ¬Ø±Ø¨ÛŒØ§Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ...",
          "job_title": "Ø¹Ù†ÙˆØ§Ù† Ø´ØºÙ„ÛŒ",
          "company": "Ø´Ø±Ú©Øª",
          "start_date": "ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹",
          "end_date": "ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù†",
          "current_position": "Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø§ÛŒÙ†Ø¬Ø§ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù…",
          "present": "ØªØ§Ú©Ù†ÙˆÙ†",
          "description": "ØªÙˆØ¶ÛŒØ­Ø§Øª",
          "description_placeholder": "Ù†Ù‚Ø´ Ùˆ Ù…Ø³Ø¦ÙˆÙ„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯...",
          "achievements": "Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ",
          "add_achievement_placeholder": "ÛŒÚ© Ø¯Ø³ØªØ§ÙˆØ±Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯...",
          "add_experience": "Ø§ÙØ²ÙˆØ¯Ù† ØªØ¬Ø±Ø¨Ù‡",
          "edit_experience": "ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ¬Ø±Ø¨Ù‡",
          "no_experience_added": "Ù‡Ù†ÙˆØ² Ø³Ø§Ø¨Ù‚Ù‡ Ú©Ø§Ø±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡",
          "degree": "Ù…Ø¯Ø±Ú©",
          "institution": "Ù…ÙˆØ³Ø³Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ",
          "gpa": "Ù…Ø¹Ø¯Ù„",
          "degree_placeholder": "Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ Ø¯Ø± Ø±Ø´ØªÙ‡...",
          "institution_placeholder": "Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡",
          "add_education": "Ø§ÙØ²ÙˆØ¯Ù† ØªØ­ØµÛŒÙ„Ø§Øª",
          "edit_education": "ÙˆÛŒØ±Ø§ÛŒØ´ ØªØ­ØµÛŒÙ„Ø§Øª",
          "no_education_added": "Ù‡Ù†ÙˆØ² ØªØ­ØµÛŒÙ„Ø§ØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡",
          "add_skill_placeholder": "Ù…Ù‡Ø§Ø±Øª Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯ Ùˆ Enter Ø¨Ø²Ù†ÛŒØ¯",
          "no_skills_added": "Ù‡Ù†ÙˆØ² Ù…Ù‡Ø§Ø±ØªÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡",
          "incomplete_fields": "ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù‚Øµ",
          "complete_fields_hint": "Ø§ÛŒÙ† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯ ØªØ§ Ø³ÛŒâ€ŒÙˆÛŒ Ø¨Ù‡ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯",
          "your_name": "Ù†Ø§Ù… Ø´Ù…Ø§",
          "save": "Ø°Ø®ÛŒØ±Ù‡",
          "cancel": "Ø§Ù†ØµØ±Ø§Ù"
        }
      }
      ```

checkpoint_tests:
  - id: T01
    description: "All CV field component files exist"
    type: "files_exist"
    files:
      - "src/components/cv/CVFieldDisplay.tsx"
      - "src/components/cv/CVCompletionForm.tsx"
      - "src/components/cv/CVPreview.tsx"
      - "src/components/cv/FieldStatusBadge.tsx"
      - "src/components/cv/WorkExperienceForm.tsx"
      - "src/components/cv/EducationForm.tsx"
      - "src/components/cv/SkillsEditor.tsx"
      - "src/components/cv/PersonalInfoForm.tsx"
      - "src/components/cv/ConfidenceIndicator.tsx"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "CVFieldDisplay shows all CV sections"
    type: "grep"
    file: "src/components/cv/CVFieldDisplay.tsx"
    patterns:
      - "personal_info"
      - "work_experience"
      - "education"
      - "skills"
      - "FieldStatusBadge"
      - "ConfidenceIndicator"

  - id: T04
    description: "CVPreview supports RTL"
    type: "grep"
    file: "src/components/cv/CVPreview.tsx"
    patterns:
      - "isRTL"
      - "dir="
      - "rtl"

  - id: T05
    description: "SkillsEditor uses tag-based input"
    type: "grep"
    file: "src/components/cv/SkillsEditor.tsx"
    patterns:
      - "Badge"
      - "addSkill"
      - "removeSkill"

  - id: T06
    description: "Forms use Dialog component"
    type: "grep"
    file: "src/components/cv/PersonalInfoForm.tsx"
    patterns:
      - "Dialog"
      - "DialogContent"
      - "onSave"

  - id: T07
    description: "Uses i18n for translations"
    type: "grep"
    file: "src/components/cv/CVFieldDisplay.tsx"
    patterns:
      - "useTranslations"

  - id: T08
    description: "English translations have all CV field keys"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "field_complete"
      - "extraction_summary"
      - "add_experience"
      - "confidence_high"

  - id: T09
    description: "Farsi translations have all CV field keys"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - "field_complete"
      - "extraction_summary"
      - "confidence_high"

max_retries: 3
B15.yaml â€” API Route Ø³ÛŒâ€ŒÙˆÛŒ + Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Supabase
YAML

# blocks/B15.yaml

id: B15
name: "CV API Routes and Database Integration"
phase: 1
phase_name: "CV Management"

goal: |
  Create API routes for CV CRUD operations and a React hook for CV state management.
  CVs are stored in Supabase. Each user has one comprehensive CV.
  This integrates with the AI extraction from B12.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B09, B10, B11, B12, B13, B14]

files_to_create:
  - id: F022
    path: "src/app/api/cv/route.ts"
    description: "API route for CV CRUD (GET, POST, PUT)"

  - id: F082
    path: "src/hooks/useCV.ts"
    description: "React hook for CV operations"

  - id: F116
    path: "src/lib/cv/cv-service.ts"
    description: "CV service layer for database operations"

files_to_modify:
  - id: F109
    path: "src/lib/cv/index.ts"
    description: "Export CV service"

files_available:
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07
  - id: F074
    path: "src/lib/cv/cv-extractor.ts"
    from_block: B12
  - id: F108
    path: "src/lib/cv/cv-validator.ts"
    from_block: B12

commands: []

instructions: |
  1. Create cv-service.ts:
     ```typescript
     // ============================================
     // [F116] src/lib/cv/cv-service.ts
     // ============================================
     
     import { SupabaseClient } from '@supabase/supabase-js';
     import { ComprehensiveCV } from '@/lib/types';
     
     export class CVService {
       constructor(private supabase: SupabaseClient) {}
       
       async getCV(userId: string): Promise<ComprehensiveCV | null> {
         const { data, error } = await this.supabase
           .from('comprehensive_cvs')
           .select('*')
           .eq('user_id', userId)
           .single();
         
         if (error) {
           if (error.code === 'PGRST116') {
             // No rows returned - CV doesn't exist
             return null;
           }
           throw error;
         }
         
         return this.mapDatabaseToCV(data);
       }
       
       async createCV(userId: string, cv: Partial<ComprehensiveCV>): Promise<ComprehensiveCV> {
         const dbData = this.mapCVToDatabase(userId, cv);
         
         const { data, error } = await this.supabase
           .from('comprehensive_cvs')
           .insert(dbData)
           .select()
           .single();
         
         if (error) throw error;
         return this.mapDatabaseToCV(data);
       }
       
       async updateCV(userId: string, cv: Partial<ComprehensiveCV>): Promise<ComprehensiveCV> {
         const dbData = this.mapCVToDatabase(userId, cv);
         
         const { data, error } = await this.supabase
           .from('comprehensive_cvs')
           .update(dbData)
           .eq('user_id', userId)
           .select()
           .single();
         
         if (error) throw error;
         return this.mapDatabaseToCV(data);
       }
       
       async upsertCV(userId: string, cv: Partial<ComprehensiveCV>): Promise<ComprehensiveCV> {
         const dbData = this.mapCVToDatabase(userId, cv);
         
         const { data, error } = await this.supabase
           .from('comprehensive_cvs')
           .upsert(dbData, { onConflict: 'user_id' })
           .select()
           .single();
         
         if (error) throw error;
         return this.mapDatabaseToCV(data);
       }
       
       async deleteCV(userId: string): Promise<void> {
         const { error } = await this.supabase
           .from('comprehensive_cvs')
           .delete()
           .eq('user_id', userId);
         
         if (error) throw error;
       }
       
       async updateCVField(
         userId: string, 
         fieldPath: string, 
         value: any
       ): Promise<ComprehensiveCV> {
         // Get current CV
         const currentCV = await this.getCV(userId);
         if (!currentCV) {
           throw new Error('CV not found');
         }
         
         // Update the specific field
         const updatedCV = this.setNestedValue(currentCV, fieldPath, value);
         
         // Save back to database
         return this.updateCV(userId, updatedCV);
       }
       
       // Helper: Map database row to ComprehensiveCV type
       private mapDatabaseToCV(row: any): ComprehensiveCV {
         return {
           id: row.id,
           user_id: row.user_id,
           personal_info: row.personal_info || {},
           work_experience: row.work_experience || [],
           education: row.education || [],
           skills: row.skills || [],
           certifications: row.certifications || [],
           languages: row.languages || [],
           projects: row.projects || [],
           additional_sections: row.additional_sections || [],
           raw_text: row.raw_text || '',
           created_at: row.created_at,
           updated_at: row.updated_at,
         };
       }
       
       // Helper: Map ComprehensiveCV to database format
       private mapCVToDatabase(userId: string, cv: Partial<ComprehensiveCV>): any {
         return {
           user_id: userId,
           personal_info: cv.personal_info || {},
           work_experience: cv.work_experience || [],
           education: cv.education || [],
           skills: cv.skills || [],
           certifications: cv.certifications || [],
           languages: cv.languages || [],
           projects: cv.projects || [],
           additional_sections: cv.additional_sections || [],
           raw_text: cv.raw_text || '',
         };
       }
       
       // Helper: Set nested object value by path string
       private setNestedValue(obj: any, path: string, value: any): any {
         const clone = JSON.parse(JSON.stringify(obj));
         const keys = path.split('.');
         let current = clone;
         
         for (let i = 0; i < keys.length - 1; i++) {
           if (!(keys[i] in current)) {
             current[keys[i]] = {};
           }
           current = current[keys[i]];
         }
         
         current[keys[keys.length - 1]] = value;
         return clone;
       }
     }
     
     // Factory function
     export function createCVService(supabase: SupabaseClient): CVService {
       return new CVService(supabase);
     }
     ```
  
  2. Create src/app/api/cv/route.ts:
     ```typescript
     // ============================================
     // [F022] src/app/api/cv/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createCVService } from '@/lib/cv/cv-service';
     import { ComprehensiveCV } from '@/lib/types';
     
     // GET - Retrieve user's CV
     export async function GET(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         
         if (!userId) {
           return NextResponse.json(
             { error: 'Unauthorized' },
             { status: 401 }
           );
         }
         
         const supabase = createServerSupabaseClient();
         const cvService = createCVService(supabase);
         
         const cv = await cvService.getCV(userId);
         
         return NextResponse.json({ cv });
         
       } catch (error: any) {
         console.error('GET /api/cv error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to fetch CV' },
           { status: 500 }
         );
       }
     }
     
     // POST - Create or replace CV
     export async function POST(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         
         if (!userId) {
           return NextResponse.json(
             { error: 'Unauthorized' },
             { status: 401 }
           );
         }
         
         const body = await request.json();
         const cvData: Partial<ComprehensiveCV> = body.cv;
         
         if (!cvData) {
           return NextResponse.json(
             { error: 'CV data is required' },
             { status: 400 }
           );
         }
         
         const supabase = createServerSupabaseClient();
         const cvService = createCVService(supabase);
         
         const cv = await cvService.upsertCV(userId, cvData);
         
         return NextResponse.json({ cv, success: true });
         
       } catch (error: any) {
         console.error('POST /api/cv error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to save CV' },
           { status: 500 }
         );
       }
     }
     
     // PUT - Update specific fields of CV
     export async function PUT(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         
         if (!userId) {
           return NextResponse.json(
             { error: 'Unauthorized' },
             { status: 401 }
           );
         }
         
         const body = await request.json();
         const { fieldPath, value, updates } = body;
         
         const supabase = createServerSupabaseClient();
         const cvService = createCVService(supabase);
         
         let cv;
         
         if (fieldPath && value !== undefined) {
           // Update single field
           cv = await cvService.updateCVField(userId, fieldPath, value);
         } else if (updates) {
           // Update multiple fields
           cv = await cvService.updateCV(userId, updates);
         } else {
           return NextResponse.json(
             { error: 'Either fieldPath/value or updates is required' },
             { status: 400 }
           );
         }
         
         return NextResponse.json({ cv, success: true });
         
       } catch (error: any) {
         console.error('PUT /api/cv error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to update CV' },
           { status: 500 }
         );
       }
     }
     
     // DELETE - Delete user's CV
     export async function DELETE(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         
         if (!userId) {
           return NextResponse.json(
             { error: 'Unauthorized' },
             { status: 401 }
           );
         }
         
         const supabase = createServerSupabaseClient();
         const cvService = createCVService(supabase);
         
         await cvService.deleteCV(userId);
         
         return NextResponse.json({ success: true });
         
       } catch (error: any) {
         console.error('DELETE /api/cv error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to delete CV' },
           { status: 500 }
         );
       }
     }
     ```
  
  3. Create hooks/useCV.ts:
     ```typescript
     // ============================================
     // [F082] src/hooks/useCV.ts
     // ============================================
     
     'use client';
     
     import { useState, useEffect, useCallback } from 'react';
     import { useAuth } from '@/context/AuthContext';
     import { 
       ComprehensiveCV, 
       CVFieldStatus, 
       CVExtractionResult,
       AIProviderName 
     } from '@/lib/types';
     import { validateExtractedCV, getCompletionPercentage } from '@/lib/cv/cv-validator';
     
     interface UseCVReturn {
       cv: ComprehensiveCV | null;
       loading: boolean;
       saving: boolean;
       error: string | null;
       fieldStatuses: CVFieldStatus[];
       completionPercentage: number;
       
       // Actions
       fetchCV: () => Promise<void>;
       saveCV: (cvData: Partial<ComprehensiveCV>) => Promise<void>;
       updateCV: (updates: Partial<ComprehensiveCV>) => Promise<void>;
       updateField: (fieldPath: string, value: any) => Promise<void>;
       deleteCV: () => Promise<void>;
       
       // AI Extraction
       extractFromFile: (
         file: File,
         provider: AIProviderName,
         model: string
       ) => Promise<CVExtractionResult>;
       
       extractFromText: (
         text: string,
         provider: AIProviderName,
         model: string
       ) => Promise<CVExtractionResult>;
       
       applyExtraction: (result: CVExtractionResult) => Promise<void>;
     }
     
     export function useCV(): UseCVReturn {
       const { user } = useAuth();
       
       const [cv, setCV] = useState<ComprehensiveCV | null>(null);
       const [loading, setLoading] = useState(true);
       const [saving, setSaving] = useState(false);
       const [error, setError] = useState<string | null>(null);
       
       // Derived state
       const fieldStatuses = cv ? validateExtractedCV(cv) : [];
       const completionPercentage = getCompletionPercentage(fieldStatuses);
       
       // Fetch CV on mount
       useEffect(() => {
         if (user) {
           fetchCV();
         } else {
           setCV(null);
           setLoading(false);
         }
       }, [user?.id]);
       
       const fetchCV = useCallback(async () => {
         if (!user) return;
         
         setLoading(true);
         setError(null);
         
         try {
           const res = await fetch('/api/cv', {
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           setCV(data.cv);
           
         } catch (err: any) {
           setError(err.message);
           setCV(null);
         } finally {
           setLoading(false);
         }
       }, [user]);
       
       const saveCV = useCallback(async (cvData: Partial<ComprehensiveCV>) => {
         if (!user) return;
         
         setSaving(true);
         setError(null);
         
         try {
           const res = await fetch('/api/cv', {
             method: 'POST',
             headers: {
               'Content-Type': 'application/json',
               'x-user-id': user.id
             },
             body: JSON.stringify({ cv: cvData })
           });
           
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           setCV(data.cv);
           
         } catch (err: any) {
           setError(err.message);
           throw err;
         } finally {
           setSaving(false);
         }
       }, [user]);
       
       const updateCV = useCallback(async (updates: Partial<ComprehensiveCV>) => {
         if (!user) return;
         
         setSaving(true);
         setError(null);
         
         try {
           const res = await fetch('/api/cv', {
             method: 'PUT',
             headers: {
               'Content-Type': 'application/json',
               'x-user-id': user.id
             },
             body: JSON.stringify({ updates })
           });
           
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           setCV(data.cv);
           
         } catch (err: any) {
           setError(err.message);
           throw err;
         } finally {
           setSaving(false);
         }
       }, [user]);
       
       const updateField = useCallback(async (fieldPath: string, value: any) => {
         if (!user) return;
         
         setSaving(true);
         setError(null);
         
         try {
           const res = await fetch('/api/cv', {
             method: 'PUT',
             headers: {
               'Content-Type': 'application/json',
               'x-user-id': user.id
             },
             body: JSON.stringify({ fieldPath, value })
           });
           
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           setCV(data.cv);
           
         } catch (err: any) {
           setError(err.message);
           throw err;
         } finally {
           setSaving(false);
         }
       }, [user]);
       
       const deleteCV = useCallback(async () => {
         if (!user) return;
         
         setSaving(true);
         setError(null);
         
         try {
           const res = await fetch('/api/cv', {
             method: 'DELETE',
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           
           if (data.error) {
             throw new Error(data.error);
           }
           
           setCV(null);
           
         } catch (err: any) {
           setError(err.message);
           throw err;
         } finally {
           setSaving(false);
         }
       }, [user]);
       
       const extractFromFile = useCallback(async (
         file: File,
         provider: AIProviderName,
         model: string
       ): Promise<CVExtractionResult> => {
         if (!user) throw new Error('Not authenticated');
         
         const formData = new FormData();
         formData.append('file', file);
         formData.append('provider', provider);
         formData.append('model', model);
         
         const res = await fetch('/api/cv/extract', {
           method: 'POST',
           headers: { 'x-user-id': user.id },
           body: formData
         });
         
         const result = await res.json();
         
         if (!res.ok || !result.success) {
           throw new Error(result.extractionNotes || 'Extraction failed');
         }
         
         return result;
       }, [user]);
       
       const extractFromText = useCallback(async (
         text: string,
         provider: AIProviderName,
         model: string
       ): Promise<CVExtractionResult> => {
         if (!user) throw new Error('Not authenticated');
         
         const formData = new FormData();
         formData.append('rawText', text);
         formData.append('provider', provider);
         formData.append('model', model);
         
         const res = await fetch('/api/cv/extract', {
           method: 'POST',
           headers: { 'x-user-id': user.id },
           body: formData
         });
         
         const result = await res.json();
         
         if (!res.ok || !result.success) {
           throw new Error(result.extractionNotes || 'Extraction failed');
         }
         
         return result;
       }, [user]);
       
       const applyExtraction = useCallback(async (result: CVExtractionResult) => {
         await saveCV(result.cv);
       }, [saveCV]);
       
       return {
         cv,
         loading,
         saving,
         error,
         fieldStatuses,
         completionPercentage,
         fetchCV,
         saveCV,
         updateCV,
         updateField,
         deleteCV,
         extractFromFile,
         extractFromText,
         applyExtraction,
       };
     }
     ```
  
  4. Update src/lib/cv/index.ts:
     ```typescript
     // ============================================
     // [F109] src/lib/cv/index.ts (updated)
     // ============================================
     
     export * from './cv-extractor';
     export * from './cv-extraction-prompt';
     export * from './cv-validator';
     export * from './cv-service';
     ```

checkpoint_tests:
  - id: T01
    description: "API route and hook files exist"
    type: "files_exist"
    files:
      - "src/app/api/cv/route.ts"
      - "src/hooks/useCV.ts"
      - "src/lib/cv/cv-service.ts"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "CV API route has all CRUD methods"
    type: "grep"
    file: "src/app/api/cv/route.ts"
    patterns:
      - "export async function GET"
      - "export async function POST"
      - "export async function PUT"
      - "export async function DELETE"
      - "createCVService"

  - id: T04
    description: "CV service has all methods"
    type: "grep"
    file: "src/lib/cv/cv-service.ts"
    patterns:
      - "getCV"
      - "createCV"
      - "updateCV"
      - "upsertCV"
      - "deleteCV"
      - "updateCVField"

  - id: T05
    description: "useCV hook exports all functions"
    type: "grep"
    file: "src/hooks/useCV.ts"
    patterns:
      - "export function useCV"
      - "fetchCV"
      - "saveCV"
      - "updateCV"
      - "updateField"
      - "extractFromFile"
      - "extractFromText"
      - "applyExtraction"

  - id: T06
    description: "useCV uses auth context"
    type: "grep"
    file: "src/hooks/useCV.ts"
    patterns:
      - "useAuth"
      - "user.id"

  - id: T07
    description: "CV index exports cv-service"
    type: "grep"
    file: "src/lib/cv/index.ts"
    patterns:
      - "cv-service"

max_retries: 3
B16.yaml â€” ØµÙØ­Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒâ€ŒÙˆÛŒ (ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ)
YAML

# blocks/B16.yaml

id: B16
name: "CV Manager Page (Full Integration)"
phase: 1
phase_name: "CV Management"

goal: |
  Create the complete CV Manager page that integrates all CV components.
  Users can upload/enter their CV, see AI-extracted fields, complete missing info,
  preview their CV, and save to database.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B09, B10, B11, B12, B13, B14, B15]

files_to_create:
  - id: F013
    path: "src/app/[locale]/cv-manager/page.tsx"
    description: "Main CV Manager page"

  - id: F103
    path: "src/app/[locale]/cv-manager/loading.tsx"
    description: "Loading state for CV Manager"

  - id: F117
    path: "src/components/cv/CVManagerTabs.tsx"
    description: "Tab navigation for CV Manager workflow"

files_to_modify:
  - id: F087
    path: "src/i18n/en.json"
    description: "Add CV Manager page translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add CV Manager page translations"

files_available:
  - id: F027
    path: "src/components/ui/button.tsx"
    from_block: B02
  - id: F029
    path: "src/components/ui/card.tsx"
    from_block: B02
  - id: F033
    path: "src/components/ui/tabs.tsx"
    from_block: B02
  - id: F035
    path: "src/components/ui/toast.tsx"
    from_block: B02
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F092
    path: "src/components/auth/AuthGuard.tsx"
    from_block: B07
  - id: F041
    path: "src/components/cv/CVUploader.tsx"
    from_block: B13
  - id: F042
    path: "src/components/cv/CVFieldDisplay.tsx"
    from_block: B14
  - id: F043
    path: "src/components/cv/CVCompletionForm.tsx"
    from_block: B14
  - id: F044
    path: "src/components/cv/CVPreview.tsx"
    from_block: B14
  - id: F082
    path: "src/hooks/useCV.ts"
    from_block: B15

commands: []

instructions: |
  1. Create CVManagerTabs.tsx:
     ```typescript
     // ============================================
     // [F117] src/components/cv/CVManagerTabs.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
     import { Upload, ListChecks, Eye } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     type CVTab = 'upload' | 'fields' | 'preview';
     
     interface CVManagerTabsProps {
       activeTab: CVTab;
       onTabChange: (tab: CVTab) => void;
       hasCV: boolean;
       completionPercentage: number;
       disabled?: boolean;
       className?: string;
     }
     
     export function CVManagerTabs({
       activeTab,
       onTabChange,
       hasCV,
       completionPercentage,
       disabled = false,
       className
     }: CVManagerTabsProps) {
       const t = useTranslations('cv_manager');
       
       return (
         <Tabs 
           value={activeTab} 
           onValueChange={(v) => onTabChange(v as CVTab)}
           className={className}
         >
           <TabsList className="grid w-full grid-cols-3">
             <TabsTrigger 
               value="upload" 
               disabled={disabled}
               className="flex items-center gap-2"
             >
               <Upload className="h-4 w-4" />
               <span className="hidden sm:inline">{t('upload_tab')}</span>
             </TabsTrigger>
             
             <TabsTrigger 
               value="fields" 
               disabled={disabled || !hasCV}
               className="flex items-center gap-2"
             >
               <ListChecks className="h-4 w-4" />
               <span className="hidden sm:inline">{t('fields_tab')}</span>
               {hasCV && completionPercentage < 100 && (
                 <span className={cn(
                   'text-xs px-1.5 py-0.5 rounded-full',
                   completionPercentage >= 70 
                     ? 'bg-green-100 text-green-700' 
                     : 'bg-yellow-100 text-yellow-700'
                 )}>
                   {completionPercentage}%
                 </span>
               )}
             </TabsTrigger>
             
             <TabsTrigger 
               value="preview" 
               disabled={disabled || !hasCV}
               className="flex items-center gap-2"
             >
               <Eye className="h-4 w-4" />
               <span className="hidden sm:inline">{t('preview_tab')}</span>
             </TabsTrigger>
           </TabsList>
         </Tabs>
       );
     }
     ```
  
  2. Create cv-manager/loading.tsx:
     ```typescript
     // ============================================
     // [F103] src/app/[locale]/cv-manager/loading.tsx
     // ============================================
     
     import { Skeleton } from '@/components/ui/skeleton';
     import { Card, CardContent, CardHeader } from '@/components/ui/card';
     
     export default function Loading() {
       return (
         <div className="container mx-auto p-6 space-y-6">
           {/* Header skeleton */}
           <div className="space-y-2">
             <Skeleton className="h-8 w-64" />
             <Skeleton className="h-4 w-96" />
           </div>
           
           {/* Tabs skeleton */}
           <Skeleton className="h-10 w-full" />
           
           {/* Content skeleton */}
           <Card>
             <CardHeader>
               <Skeleton className="h-6 w-48" />
             </CardHeader>
             <CardContent className="space-y-4">
               <Skeleton className="h-32 w-full" />
               <Skeleton className="h-10 w-32" />
             </CardContent>
           </Card>
         </div>
       );
     }
     ```
  
  3. Create cv-manager/page.tsx:
     ```typescript
     // ============================================
     // [F013] src/app/[locale]/cv-manager/page.tsx
     // ============================================
     
     'use client';
     
     import { useState, useEffect } from 'react';
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import { AuthGuard } from '@/components/auth/AuthGuard';
     import { CVUploader } from '@/components/cv/CVUploader';
     import { CVFieldDisplay } from '@/components/cv/CVFieldDisplay';
     import { CVCompletionForm } from '@/components/cv/CVCompletionForm';
     import { CVPreview } from '@/components/cv/CVPreview';
     import { CVManagerTabs } from '@/components/cv/CVManagerTabs';
     import { useCV } from '@/hooks/useCV';
     import { Button } from '@/components/ui/button';
     import { Card, CardContent } from '@/components/ui/card';
     import { useToast } from '@/components/ui/use-toast';
     import { CVExtractionResult, ComprehensiveCV } from '@/lib/types';
     import { 
       FileText, Save, Trash2, CheckCircle, AlertCircle, Loader2 
     } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     type CVTab = 'upload' | 'fields' | 'preview';
     
     export default function CVManagerPage() {
       const t = useTranslations('cv_manager');
       const params = useParams();
       const locale = params.locale as 'en' | 'fa';
       const { toast } = useToast();
       
       const {
         cv,
         loading,
         saving,
         error,
         fieldStatuses,
         completionPercentage,
         saveCV,
         updateCV,
         deleteCV,
         applyExtraction
       } = useCV();
       
       const [activeTab, setActiveTab] = useState<CVTab>('upload');
       const [pendingExtraction, setPendingExtraction] = useState<CVExtractionResult | null>(null);
       
       // Switch to fields tab when CV is loaded or extracted
       useEffect(() => {
         if (cv && activeTab === 'upload') {
           setActiveTab('fields');
         }
       }, [cv]);
       
       // Handle extraction complete
       const handleExtractionComplete = async (result: CVExtractionResult) => {
         setPendingExtraction(result);
         
         try {
           await applyExtraction(result);
           
           toast({
             title: t('extraction_success'),
             description: t('extraction_success_desc'),
           });
           
           setActiveTab('fields');
           
         } catch (err: any) {
           toast({
             variant: 'destructive',
             title: t('extraction_error'),
             description: err.message,
           });
         } finally {
           setPendingExtraction(null);
         }
       };
       
       // Handle CV update from field display
       const handleCVUpdate = async (updates: Partial<ComprehensiveCV>) => {
         try {
           await updateCV(updates);
           
           toast({
             title: t('saved'),
             description: t('changes_saved'),
           });
           
         } catch (err: any) {
           toast({
             variant: 'destructive',
             title: t('save_error'),
             description: err.message,
           });
         }
       };
       
       // Handle delete CV
       const handleDeleteCV = async () => {
         if (!confirm(t('delete_confirm'))) return;
         
         try {
           await deleteCV();
           setActiveTab('upload');
           
           toast({
             title: t('deleted'),
             description: t('cv_deleted'),
           });
           
         } catch (err: any) {
           toast({
             variant: 'destructive',
             title: t('delete_error'),
             description: err.message,
           });
         }
       };
       
       // Get incomplete fields
       const incompleteFields = fieldStatuses.filter(s => !s.is_complete);
       
       return (
         <AuthGuard>
           <div className="container mx-auto p-6 max-w-5xl">
             {/* Header */}
             <div className="mb-6">
               <h1 className="text-2xl font-bold flex items-center gap-2">
                 <FileText className="h-6 w-6" />
                 {t('title')}
               </h1>
               <p className="text-muted-foreground mt-1">
                 {t('description')}
               </p>
             </div>
             
             {/* Error Display */}
             {error && (
               <Card className="mb-6 border-destructive">
                 <CardContent className="py-4">
                   <div className="flex items-center gap-2 text-destructive">
                     <AlertCircle className="h-5 w-5" />
                     <span>{error}</span>
                   </div>
                 </CardContent>
               </Card>
             )}
             
             {/* Loading State */}
             {loading ? (
               <Card>
                 <CardContent className="py-12">
                   <div className="flex flex-col items-center justify-center gap-3">
                     <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
                     <p className="text-muted-foreground">{t('loading')}</p>
                   </div>
                 </CardContent>
               </Card>
             ) : (
               <>
                 {/* Tab Navigation */}
                 <CVManagerTabs
                   activeTab={activeTab}
                   onTabChange={setActiveTab}
                   hasCV={cv !== null}
                   completionPercentage={completionPercentage}
                   disabled={saving}
                   className="mb-6"
                 />
                 
                 {/* Tab Content */}
                 <div className="space-y-6">
                   
                   {/* Upload Tab */}
                   {activeTab === 'upload' && (
                     <CVUploader
                       onExtractionComplete={handleExtractionComplete}
                       existingCV={cv}
                       disabled={saving}
                     />
                   )}
                   
                   {/* Fields Tab */}
                   {activeTab === 'fields' && cv && (
                     <>
                       {/* Incomplete Fields Warning */}
                       {incompleteFields.length > 0 && (
                         <CVCompletionForm
                           incompleteFields={incompleteFields}
                           onFieldClick={(section) => {
                             // Scroll to section or open edit modal
                             console.log('Navigate to section:', section);
                           }}
                         />
                       )}
                       
                       {/* Field Display */}
                       <CVFieldDisplay
                         cv={cv}
                         fieldStatuses={fieldStatuses}
                         confidence={pendingExtraction?.confidence || 85}
                         onUpdate={handleCVUpdate}
                       />
                     </>
                   )}
                   
                   {/* Preview Tab */}
                   {activeTab === 'preview' && cv && (
                     <CVPreview
                       cv={cv}
                       locale={locale}
                     />
                   )}
                   
                 </div>
                 
                 {/* Action Bar */}
                 {cv && (
                   <div className="mt-8 flex items-center justify-between border-t pt-6">
                     <div className="flex items-center gap-2 text-sm text-muted-foreground">
                       <CheckCircle className={cn(
                         'h-4 w-4',
                         completionPercentage === 100 ? 'text-green-500' : 'text-yellow-500'
                       )} />
                       <span>
                         {t('completion', { percent: completionPercentage })}
                       </span>
                     </div>
                     
                     <div className="flex items-center gap-3">
                       <Button
                         variant="outline"
                         onClick={handleDeleteCV}
                         disabled={saving}
                       >
                         <Trash2 className="h-4 w-4 mr-2" />
                         {t('delete_cv')}
                       </Button>
                       
                       <Button
                         onClick={() => saveCV(cv)}
                         disabled={saving}
                       >
                         {saving ? (
                           <>
                             <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                             {t('saving')}
                           </>
                         ) : (
                           <>
                             <Save className="h-4 w-4 mr-2" />
                             {t('save_cv')}
                           </>
                         )}
                       </Button>
                     </div>
                   </div>
                 )}
               </>
             )}
           </div>
         </AuthGuard>
       );
     }
     ```
  
  4. Add translations to en.json under "cv_manager" key:
     ```json
     {
       "cv_manager": {
         "title": "My Comprehensive CV",
         "description": "Upload, edit, and manage your comprehensive CV",
         "upload_tab": "Upload",
         "fields_tab": "Edit Fields",
         "preview_tab": "Preview",
         "loading": "Loading your CV...",
         "extraction_success": "CV Extracted Successfully",
         "extraction_success_desc": "Your CV has been processed. Please review the extracted information.",
         "extraction_error": "Extraction Failed",
         "saved": "Saved",
         "changes_saved": "Your changes have been saved.",
         "save_error": "Save Failed",
         "delete_confirm": "Are you sure you want to delete your CV? This action cannot be undone.",
         "deleted": "Deleted",
         "cv_deleted": "Your CV has been deleted.",
         "delete_error": "Delete Failed",
         "completion": "{percent}% complete",
         "save_cv": "Save CV",
         "saving": "Saving...",
         "delete_cv": "Delete CV"
       }
     }
     ```
  
  5. Add same translations to fa.json:
     ```json
     {
       "cv_manager": {
         "title": "Ø³ÛŒâ€ŒÙˆÛŒ Ø¬Ø§Ù…Ø¹ Ù…Ù†",
         "description": "Ø¢Ù¾Ù„ÙˆØ¯ØŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒâ€ŒÙˆÛŒ Ø¬Ø§Ù…Ø¹ Ø´Ù…Ø§",
         "upload_tab": "Ø¢Ù¾Ù„ÙˆØ¯",
         "fields_tab": "ÙˆÛŒØ±Ø§ÛŒØ´ ÙÛŒÙ„Ø¯Ù‡Ø§",
         "preview_tab": "Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´",
         "loading": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³ÛŒâ€ŒÙˆÛŒ...",
         "extraction_success": "Ø³ÛŒâ€ŒÙˆÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯",
         "extraction_success_desc": "Ø³ÛŒâ€ŒÙˆÛŒ Ø´Ù…Ø§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬â€ŒØ´Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.",
         "extraction_error": "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯",
         "saved": "Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯",
         "changes_saved": "ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.",
         "save_error": "Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯",
         "delete_confirm": "Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø³ÛŒâ€ŒÙˆÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.",
         "deleted": "Ø­Ø°Ù Ø´Ø¯",
         "cv_deleted": "Ø³ÛŒâ€ŒÙˆÛŒ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯.",
         "delete_error": "Ø­Ø°Ù Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯",
         "completion": "{percent}% ØªÚ©Ù…ÛŒÙ„",
         "save_cv": "Ø°Ø®ÛŒØ±Ù‡ Ø³ÛŒâ€ŒÙˆÛŒ",
         "saving": "Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...",
         "delete_cv": "Ø­Ø°Ù Ø³ÛŒâ€ŒÙˆÛŒ"
       }
     }
     ```

checkpoint_tests:
  - id: T01
    description: "CV Manager page files exist"
    type: "files_exist"
    files:
      - "src/app/[locale]/cv-manager/page.tsx"
      - "src/app/[locale]/cv-manager/loading.tsx"
      - "src/components/cv/CVManagerTabs.tsx"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "CV Manager page uses AuthGuard"
    type: "grep"
    file: "src/app/[locale]/cv-manager/page.tsx"
    patterns:
      - "AuthGuard"
      - "<AuthGuard>"

  - id: T04
    description: "CV Manager page uses all CV components"
    type: "grep"
    file: "src/app/[locale]/cv-manager/page.tsx"
    patterns:
      - "CVUploader"
      - "CVFieldDisplay"
      - "CVCompletionForm"
      - "CVPreview"
      - "CVManagerTabs"

  - id: T05
    description: "CV Manager page uses useCV hook"
    type: "grep"
    file: "src/app/[locale]/cv-manager/page.tsx"
    patterns:
      - "useCV"
      - "saveCV"
      - "updateCV"
      - "applyExtraction"

  - id: T06
    description: "CV Manager has tab navigation"
    type: "grep"
    file: "src/app/[locale]/cv-manager/page.tsx"
    patterns:
      - "activeTab"
      - "setActiveTab"
      - "upload"
      - "fields"
      - "preview"

  - id: T07
    description: "Uses toast notifications"
    type: "grep"
    file: "src/app/[locale]/cv-manager/page.tsx"
    patterns:
      - "useToast"
      - "toast({"

  - id: T08
    description: "CV Manager uses i18n"
    type: "grep"
    file: "src/app/[locale]/cv-manager/page.tsx"
    patterns:
      - "useTranslations"
      - "cv_manager"

  - id: T09
    description: "English translations have CV Manager keys"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "cv_manager"
      - "upload_tab"
      - "fields_tab"
      - "preview_tab"
      - "extraction_success"

  - id: T10
    description: "Farsi translations have CV Manager keys"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - "cv_manager"
      - "extraction_success"

  - id: T11
    description: "Loading component exists with skeleton"
    type: "grep"
    file: "src/app/[locale]/cv-manager/loading.tsx"
    patterns:
      - "export default function Loading"
      - "Skeleton"

max_retries: 3
Ø®Ù„Ø§ØµÙ‡ Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ B10-B16
Ø¨Ù„ÙˆÚ©	Ù†Ø§Ù…	ØªÙˆØ¶ÛŒØ­ ØªØºÛŒÛŒØ±Ø§Øª
B10	AI Provider Interface	Ø¬Ø¯ÛŒØ¯ - Ø§Ø² B19 Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯ØŒ Ø´Ø§Ù…Ù„ OpenAI/Anthropic/Google providers
B11	API Key Management	Ø¬Ø¯ÛŒØ¯ - Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ AI
B12	AI CV Extractor	Ø¬Ø¯ÛŒØ¯ - Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ CV Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ù‡ Ø¬Ø§ÛŒ regex
B13	CV Uploader	Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ - ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø¨Ø§ AI extractionØŒ Ø´Ø§Ù…Ù„ AIModelPicker
B14	CV Field Display	Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ - Ø´Ø§Ù…Ù„ ConfidenceIndicator Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† AI
B15	CV API & Database	Ø¬Ø¯ÛŒØ¯ - Ø³Ø±ÙˆÛŒØ³ Ùˆ API routes Ø¨Ø±Ø§ÛŒ CRUD Ø³ÛŒâ€ŒÙˆÛŒ
B16	CV Manager Page	Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡ - ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ø§ AI extraction
Ù†Ù…ÙˆØ¯Ø§Ø± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø¬Ø¯ÛŒØ¯
text

B01 â†’ B02 â†’ B03 â†’ B04 â†’ B05 â†’ B06 â†’ B07 â†’ B08
                    â”‚                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                    â–¼
                  B09                  B10 (AI Providers)
                    â”‚                    â”‚
                    â”‚                    â–¼
                    â”‚                  B11 (AI Key Mgmt)
                    â”‚                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
                           B12 (AI CV Extractor)
                             â”‚
                             â–¼
                           B13 (CV Uploader + AI)
                             â”‚
                             â–¼
                           B14 (CV Field Display)
                             â”‚
                             â–¼
                           B15 (CV API & DB)
                             â”‚
                             â–¼
                           B16 (CV Manager Page)




Ø¨Ù„ÙˆÚ© B17 â€” Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ (CRUD Backend + Frontend)
B17.yaml â€” Ø³ÛŒØ³ØªÙ… Ú©Ø§Ù…Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§
YAML

# blocks/B17.yaml

id: B17
name: "Prompt Management System"
phase: 2
phase_name: "Prompt Management"

goal: |
  Create the complete prompt management system - the heart of the application.
  This includes:
  - API routes for CRUD operations on prompts
  - React hook for prompt state management
  - UI components for listing, creating, editing, and selecting prompts
  - Admin page for managing prompts (no-code management)
  
  Prompts are pre-built templates that define how AI should process CVs and job descriptions.
  Each prompt has titles/descriptions in both English and Farsi.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08]

files_to_create:
  # API Routes
  - id: F024
    path: "src/app/api/prompts/route.ts"
    description: "API route for prompts CRUD (GET all, POST new)"

  - id: F118
    path: "src/app/api/prompts/[id]/route.ts"
    description: "API route for single prompt (GET, PUT, DELETE)"

  # Service Layer
  - id: F119
    path: "src/lib/prompts/prompt-service.ts"
    description: "Prompt service layer for database operations"

  - id: F120
    path: "src/lib/prompts/index.ts"
    description: "Export all prompt modules"

  - id: F121
    path: "src/lib/prompts/default-prompts.ts"
    description: "Default/seed prompts for initial setup"

  # React Hook
  - id: F083
    path: "src/hooks/usePrompts.ts"
    description: "React hook for prompt operations"

  # UI Components
  - id: F045
    path: "src/components/prompts/PromptList.tsx"
    description: "Display list of prompts with filters"

  - id: F046
    path: "src/components/prompts/PromptEditor.tsx"
    description: "Form for creating/editing prompts"

  - id: F047
    path: "src/components/prompts/PromptSelector.tsx"
    description: "Component for selecting prompts in application flow"

  - id: F048
    path: "src/components/prompts/PromptCategoryFilter.tsx"
    description: "Filter prompts by category"

  - id: F122
    path: "src/components/prompts/PromptCard.tsx"
    description: "Card display for a single prompt"

  - id: F123
    path: "src/components/prompts/PromptPreview.tsx"
    description: "Preview full prompt text"

  # Page
  - id: F015
    path: "src/app/[locale]/prompts/page.tsx"
    description: "Prompt management page"

  - id: F124
    path: "src/app/[locale]/prompts/loading.tsx"
    description: "Loading state for prompts page"

files_to_modify:
  - id: F087
    path: "src/i18n/en.json"
    description: "Add prompt management translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add prompt management translations"

files_available:
  - id: F027
    path: "src/components/ui/button.tsx"
    from_block: B02
  - id: F028
    path: "src/components/ui/input.tsx"
    from_block: B02
  - id: F029
    path: "src/components/ui/card.tsx"
    from_block: B02
  - id: F030
    path: "src/components/ui/dialog.tsx"
    from_block: B02
  - id: F031
    path: "src/components/ui/select.tsx"
    from_block: B02
  - id: F032
    path: "src/components/ui/textarea.tsx"
    from_block: B02
  - id: F033
    path: "src/components/ui/tabs.tsx"
    from_block: B02
  - id: F034
    path: "src/components/ui/badge.tsx"
    from_block: B02
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F080
    path: "src/lib/utils.ts"
    from_block: B04
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07
  - id: F092
    path: "src/components/auth/AuthGuard.tsx"
    from_block: B07

commands: []

instructions: |
  1. Create default-prompts.ts (seed data):
     ```typescript
     // ============================================
     // [F121] src/lib/prompts/default-prompts.ts
     // ============================================
     
     import { Prompt } from '@/lib/types';
     
     export const DEFAULT_PROMPTS: Omit<Prompt, 'id' | 'created_at' | 'updated_at'>[] = [
       {
         title_en: "Professional CV Tailoring",
         title_fa: "ØªÙ†Ø¸ÛŒÙ… Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø³ÛŒâ€ŒÙˆÛŒ",
         description_en: "Tailors your CV to match the job description with professional language and formatting.",
         description_fa: "Ø³ÛŒâ€ŒÙˆÛŒ Ø´Ù…Ø§ Ø±Ø§ Ø¨Ø§ Ø²Ø¨Ø§Ù† Ùˆ Ù‚Ø§Ù„Ø¨â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø´Ø±Ø­ Ø´ØºÙ„ ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",
         prompt_text: `You are an expert CV writer and career consultant. Your task is to tailor the candidate's CV to match the job description.

     INPUTS:
     - Candidate's comprehensive CV
     - Target job description
     - Desired output language
     - Tone preference

     INSTRUCTIONS:
     1. Analyze the job description to identify:
        - Required skills and qualifications
        - Key responsibilities
        - Company culture indicators
        - Industry-specific terminology

     2. Review the candidate's CV and identify:
        - Relevant experience that matches the job
        - Transferable skills
        - Achievements that demonstrate required competencies
        - Gaps that need to be addressed

     3. Create a tailored CV that:
        - Highlights the most relevant experience first
        - Uses keywords from the job description
        - Quantifies achievements where possible
        - Matches the tone and style appropriate for the industry
        - Is concise yet comprehensive (ideally 1-2 pages)

     4. If you need clarification on any aspect, ask specific questions.

     5. Output the tailored CV in a clean, professional format.

     Remember: The goal is to present the candidate as the ideal fit for this specific role while remaining truthful about their experience.`,
         category: "cv_tailoring",
         is_active: true,
         sort_order: 1
       },
       {
         title_en: "Technical Role Focus",
         title_fa: "ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ù†Ù‚Ø´ ÙÙ†ÛŒ",
         description_en: "Emphasizes technical skills, projects, and achievements for engineering/IT roles.",
         description_fa: "Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ÙÙ†ÛŒØŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù†Ø¯Ø³ÛŒ/ÙÙ†Ø§ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø¬Ø³ØªÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",
         prompt_text: `You are a technical recruiter and CV specialist for engineering and IT roles.

     FOCUS AREAS:
     - Technical skills and proficiencies (languages, frameworks, tools)
     - Project experience with technical details
     - Problem-solving achievements with measurable outcomes
     - Certifications and technical education
     - Open source contributions or technical publications

     INSTRUCTIONS:
     1. Parse the job description for:
        - Required tech stack
        - Experience level needed
        - Specific technical challenges mentioned
        - Team structure and methodology (Agile, etc.)

     2. From the CV, extract and prioritize:
        - Matching technical skills (order by relevance)
        - Projects using similar technologies
        - Scale of systems worked on
        - Technical leadership experience

     3. Format the output with:
        - Skills section prominently placed
        - Project descriptions with tech stack tags
        - Metrics (users served, performance improvements, etc.)
        - Clean, ATS-friendly formatting

     Ask clarifying questions if the technical requirements are unclear or if you need more details about specific projects.`,
         category: "cv_tailoring",
         is_active: true,
         sort_order: 2
       },
       {
         title_en: "Executive/Leadership Focus",
         title_fa: "ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¬Ø±Ø§ÛŒÛŒ",
         description_en: "Crafts CVs for senior leadership positions, emphasizing strategic impact and team leadership.",
         description_fa: "Ø³ÛŒâ€ŒÙˆÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø´Ø¯ Ø¨Ø§ ØªØ£Ú©ÛŒØ¯ Ø¨Ø± ØªØ£Ø«ÛŒØ± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ© Ùˆ Ø±Ù‡Ø¨Ø±ÛŒ ØªÛŒÙ… ØªÙ†Ø¸ÛŒÙ… Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",
         prompt_text: `You are an executive career consultant specializing in C-suite and senior leadership positions.

     FOCUS AREAS:
     - Strategic vision and business impact
     - P&L responsibility and budget management
     - Team building and organizational development
     - Board presentations and stakeholder management
     - Industry thought leadership

     INSTRUCTIONS:
     1. Analyze the role for:
        - Scope of responsibility
        - Reporting structure
        - Strategic priorities
        - Cultural fit indicators

     2. Highlight from the CV:
        - Revenue/growth achievements with numbers
        - Transformation initiatives led
        - Team sizes managed
        - Board-level experience
        - Industry recognition

     3. Craft an executive summary that:
        - Leads with the most impressive achievement
        - Positions the candidate as a strategic leader
        - Uses powerful, confident language
        - Demonstrates industry expertise

     The output should be polished, concise, and appropriate for executive-level review.`,
         category: "cv_tailoring",
         is_active: true,
         sort_order: 3
       },
       {
         title_en: "Cover Letter Generator",
         title_fa: "ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ù‡ Ú©Ø§ÙˆØ±Ù„ØªØ±",
         description_en: "Creates compelling cover letters that complement the tailored CV.",
         description_fa: "Ú©Ø§ÙˆØ±Ù„ØªØ±Ù‡Ø§ÛŒ Ø¬Ø°Ø§Ø¨ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù…Ú©Ù…Ù„ Ø³ÛŒâ€ŒÙˆÛŒ ØªÙ†Ø¸ÛŒÙ…â€ŒØ´Ø¯Ù‡ Ù‡Ø³ØªÙ†Ø¯.",
         prompt_text: `You are an expert cover letter writer. Create a compelling cover letter based on the candidate's CV and target job.

     STRUCTURE:
     1. Opening paragraph:
        - Hook that captures attention
        - Clear statement of the position applied for
        - Brief indication of why you're a great fit

     2. Body paragraphs (2-3):
        - Match your top qualifications to job requirements
        - Provide specific examples with results
        - Show knowledge of the company
        - Demonstrate cultural fit

     3. Closing paragraph:
        - Reiterate enthusiasm
        - Clear call to action
        - Professional sign-off

     GUIDELINES:
     - Keep it to one page (300-400 words)
     - Use the same tone as the job posting
     - Avoid repeating the CV verbatim
     - Show personality while remaining professional
     - Address it properly (research the hiring manager if possible)

     If the job posting mentions specific values or initiatives, incorporate them naturally.`,
         category: "cover_letter",
         is_active: true,
         sort_order: 10
       },
       {
         title_en: "Application Email",
         title_fa: "Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª",
         description_en: "Writes professional application emails for job submissions.",
         description_fa: "Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´ØºÙ„ÛŒ Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ø¯.",
         prompt_text: `You are writing a professional job application email. This email will accompany the CV and cover letter.

     EMAIL STRUCTURE:
     1. Subject line: Clear and professional
        Example: "Application for [Position] - [Your Name]"

     2. Greeting: Formal, addressed properly

     3. Body (brief, 3-4 sentences):
        - State the position you're applying for
        - One compelling reason you're a fit
        - Mention attached documents
        - Express enthusiasm

     4. Closing:
        - Thank them for their time
        - Professional signature with contact info

     GUIDELINES:
     - Keep it SHORT - this is not the cover letter
     - Professional but warm tone
     - Easy to read on mobile
     - Include all contact information
     - Mention if referred by someone

     The email should make them want to open the attachments.`,
         category: "email",
         is_active: true,
         sort_order: 20
       },
       {
         title_en: "Career Changer",
         title_fa: "ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ± Ø´ØºÙ„ÛŒ",
         description_en: "Helps candidates transitioning to a new industry or role highlight transferable skills.",
         description_fa: "Ø¨Ù‡ Ù…ØªÙ‚Ø§Ø¶ÛŒØ§Ù†ÛŒ Ú©Ù‡ Ø¨Ù‡ ØµÙ†Ø¹Øª ÛŒØ§ Ù†Ù‚Ø´ Ø¬Ø¯ÛŒØ¯ÛŒ Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªÙ‚Ø§Ù„ Ø±Ø§ Ø¨Ø±Ø¬Ø³ØªÙ‡ Ú©Ù†Ù†Ø¯.",
         prompt_text: `You are a career transition specialist. Help the candidate present their experience for a new industry/role.

     APPROACH:
     1. Identify transferable skills:
        - Leadership and management
        - Communication and presentation
        - Problem-solving and analytical thinking
        - Project management
        - Technical skills that cross industries

     2. Reframe experience:
        - Use industry-neutral language
        - Focus on outcomes, not industry-specific processes
        - Highlight adaptability and learning agility
        - Emphasize relevant training or education

     3. Address the elephant in the room:
        - Acknowledge the transition positively
        - Show genuine interest in the new field
        - Demonstrate research into the industry
        - Highlight any bridge experiences

     4. Structure the CV to:
        - Lead with a strong summary explaining the transition
        - Group skills by relevance to new role
        - Include any relevant projects, courses, or certifications
        - De-emphasize irrelevant experience without hiding it

     Ask about their motivation for the change and any steps they've taken toward the new field.`,
         category: "cv_tailoring",
         is_active: true,
         sort_order: 4
       },
       {
         title_en: "ATS Optimization",
         title_fa: "Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ ATS",
         description_en: "Optimizes CV format and keywords for Applicant Tracking Systems.",
         description_fa: "ÙØ±Ù…Øª Ùˆ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø³ÛŒâ€ŒÙˆÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ÛŒ Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ù…ØªÙ‚Ø§Ø¶ÛŒØ§Ù† Ø¨Ù‡ÛŒÙ†Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.",
         prompt_text: `You are an ATS (Applicant Tracking System) optimization expert.

     OBJECTIVE:
     Ensure the CV passes through ATS filters while remaining readable for humans.

     KEY OPTIMIZATIONS:
     1. Keywords:
        - Extract exact keywords from job description
        - Include variations (e.g., "Project Management" and "PM")
        - Place keywords in context, not just listed
        - Include both spelled-out and acronym versions

     2. Formatting:
        - Use standard section headings (Experience, Education, Skills)
        - Avoid tables, columns, headers/footers
        - Use standard fonts
        - No images or graphics
        - Simple bullet points

     3. Structure:
        - Contact info at the top
        - Clear date formats (MM/YYYY)
        - Company name, title, dates in consistent order
        - Avoid creative layouts

     4. Content:
        - Match job title variations
        - Include required qualifications verbatim
        - Quantify achievements with numbers
        - Use industry-standard terminology

     Output the CV in a clean, ATS-friendly format while ensuring it's still engaging for human readers.`,
         category: "cv_tailoring",
         is_active: true,
         sort_order: 5
       }
     ];
     
     export const PROMPT_CATEGORIES = [
       { value: 'cv_tailoring', label_en: 'CV Tailoring', label_fa: 'ØªÙ†Ø¸ÛŒÙ… Ø³ÛŒâ€ŒÙˆÛŒ' },
       { value: 'cover_letter', label_en: 'Cover Letter', label_fa: 'Ú©Ø§ÙˆØ±Ù„ØªØ±' },
       { value: 'email', label_en: 'Application Email', label_fa: 'Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª' },
       { value: 'interview', label_en: 'Interview Prep', label_fa: 'Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØµØ§Ø­Ø¨Ù‡' },
       { value: 'general', label_en: 'General', label_fa: 'Ø¹Ù…ÙˆÙ…ÛŒ' },
     ];
     ```
  
  2. Create prompt-service.ts:
     ```typescript
     // ============================================
     // [F119] src/lib/prompts/prompt-service.ts
     // ============================================
     
     import { SupabaseClient } from '@supabase/supabase-js';
     import { Prompt } from '@/lib/types';
     import { DEFAULT_PROMPTS } from './default-prompts';
     
     export class PromptService {
       constructor(private supabase: SupabaseClient) {}
       
       async getAllPrompts(activeOnly: boolean = false): Promise<Prompt[]> {
         let query = this.supabase
           .from('prompts')
           .select('*')
           .order('sort_order', { ascending: true });
         
         if (activeOnly) {
           query = query.eq('is_active', true);
         }
         
         const { data, error } = await query;
         
         if (error) throw error;
         return data || [];
       }
       
       async getPromptById(id: string): Promise<Prompt | null> {
         const { data, error } = await this.supabase
           .from('prompts')
           .select('*')
           .eq('id', id)
           .single();
         
         if (error) {
           if (error.code === 'PGRST116') return null;
           throw error;
         }
         
         return data;
       }
       
       async getPromptsByCategory(category: string): Promise<Prompt[]> {
         const { data, error } = await this.supabase
           .from('prompts')
           .select('*')
           .eq('category', category)
           .eq('is_active', true)
           .order('sort_order', { ascending: true });
         
         if (error) throw error;
         return data || [];
       }
       
       async getPromptsByIds(ids: string[]): Promise<Prompt[]> {
         if (ids.length === 0) return [];
         
         const { data, error } = await this.supabase
           .from('prompts')
           .select('*')
           .in('id', ids);
         
         if (error) throw error;
         return data || [];
       }
       
       async createPrompt(prompt: Omit<Prompt, 'id' | 'created_at' | 'updated_at'>): Promise<Prompt> {
         const { data, error } = await this.supabase
           .from('prompts')
           .insert(prompt)
           .select()
           .single();
         
         if (error) throw error;
         return data;
       }
       
       async updatePrompt(id: string, updates: Partial<Prompt>): Promise<Prompt> {
         // Remove fields that shouldn't be updated
         const { id: _, created_at, updated_at, ...validUpdates } = updates as any;
         
         const { data, error } = await this.supabase
           .from('prompts')
           .update(validUpdates)
           .eq('id', id)
           .select()
           .single();
         
         if (error) throw error;
         return data;
       }
       
       async deletePrompt(id: string): Promise<void> {
         const { error } = await this.supabase
           .from('prompts')
           .delete()
           .eq('id', id);
         
         if (error) throw error;
       }
       
       async togglePromptActive(id: string): Promise<Prompt> {
         // Get current state
         const prompt = await this.getPromptById(id);
         if (!prompt) throw new Error('Prompt not found');
         
         // Toggle
         return this.updatePrompt(id, { is_active: !prompt.is_active });
       }
       
       async reorderPrompts(orderedIds: string[]): Promise<void> {
         // Update sort_order for each prompt
         const updates = orderedIds.map((id, index) => 
           this.supabase
             .from('prompts')
             .update({ sort_order: index })
             .eq('id', id)
         );
         
         await Promise.all(updates);
       }
       
       async seedDefaultPrompts(): Promise<void> {
         // Check if prompts already exist
         const existing = await this.getAllPrompts();
         if (existing.length > 0) {
           console.log('Prompts already exist, skipping seed');
           return;
         }
         
         // Insert default prompts
         const { error } = await this.supabase
           .from('prompts')
           .insert(DEFAULT_PROMPTS);
         
         if (error) throw error;
         console.log('Default prompts seeded successfully');
       }
       
       async searchPrompts(query: string, locale: 'en' | 'fa' = 'en'): Promise<Prompt[]> {
         const searchField = locale === 'fa' ? 'title_fa' : 'title_en';
         const descField = locale === 'fa' ? 'description_fa' : 'description_en';
         
         const { data, error } = await this.supabase
           .from('prompts')
           .select('*')
           .or(`${searchField}.ilike.%${query}%,${descField}.ilike.%${query}%`)
           .eq('is_active', true)
           .order('sort_order', { ascending: true });
         
         if (error) throw error;
         return data || [];
       }
     }
     
     export function createPromptService(supabase: SupabaseClient): PromptService {
       return new PromptService(supabase);
     }
     ```
  
  3. Create src/lib/prompts/index.ts:
     ```typescript
     // ============================================
     // [F120] src/lib/prompts/index.ts
     // ============================================
     
     export * from './prompt-service';
     export * from './default-prompts';
     ```
  
  4. Create API route for prompts (GET all, POST new):
     ```typescript
     // ============================================
     // [F024] src/app/api/prompts/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createPromptService } from '@/lib/prompts';
     
     // GET - List all prompts
     export async function GET(request: NextRequest) {
       try {
         const { searchParams } = new URL(request.url);
         const activeOnly = searchParams.get('active') === 'true';
         const category = searchParams.get('category');
         const search = searchParams.get('search');
         const locale = (searchParams.get('locale') || 'en') as 'en' | 'fa';
         
         const supabase = createServerSupabaseClient();
         const promptService = createPromptService(supabase);
         
         let prompts;
         
         if (search) {
           prompts = await promptService.searchPrompts(search, locale);
         } else if (category) {
           prompts = await promptService.getPromptsByCategory(category);
         } else {
           prompts = await promptService.getAllPrompts(activeOnly);
         }
         
         return NextResponse.json({ prompts });
         
       } catch (error: any) {
         console.error('GET /api/prompts error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to fetch prompts' },
           { status: 500 }
         );
       }
     }
     
     // POST - Create new prompt
     export async function POST(request: NextRequest) {
       try {
         const body = await request.json();
         
         const {
           title_en,
           title_fa,
           description_en,
           description_fa,
           prompt_text,
           category,
           is_active = true,
           sort_order = 0
         } = body;
         
         // Validation
         if (!title_en || !title_fa || !prompt_text) {
           return NextResponse.json(
             { error: 'title_en, title_fa, and prompt_text are required' },
             { status: 400 }
           );
         }
         
         const supabase = createServerSupabaseClient();
         const promptService = createPromptService(supabase);
         
         const prompt = await promptService.createPrompt({
           title_en,
           title_fa,
           description_en: description_en || '',
           description_fa: description_fa || '',
           prompt_text,
           category: category || 'general',
           is_active,
           sort_order
         });
         
         return NextResponse.json({ prompt, success: true });
         
       } catch (error: any) {
         console.error('POST /api/prompts error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to create prompt' },
           { status: 500 }
         );
       }
     }
     ```
  
  5. Create API route for single prompt:
     ```typescript
     // ============================================
     // [F118] src/app/api/prompts/[id]/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createPromptService } from '@/lib/prompts';
     
     interface RouteParams {
       params: { id: string };
     }
     
     // GET - Get single prompt
     export async function GET(request: NextRequest, { params }: RouteParams) {
       try {
         const { id } = params;
         
         const supabase = createServerSupabaseClient();
         const promptService = createPromptService(supabase);
         
         const prompt = await promptService.getPromptById(id);
         
         if (!prompt) {
           return NextResponse.json(
             { error: 'Prompt not found' },
             { status: 404 }
           );
         }
         
         return NextResponse.json({ prompt });
         
       } catch (error: any) {
         console.error('GET /api/prompts/[id] error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to fetch prompt' },
           { status: 500 }
         );
       }
     }
     
     // PUT - Update prompt
     export async function PUT(request: NextRequest, { params }: RouteParams) {
       try {
         const { id } = params;
         const body = await request.json();
         
         const supabase = createServerSupabaseClient();
         const promptService = createPromptService(supabase);
         
         // Check if prompt exists
         const existing = await promptService.getPromptById(id);
         if (!existing) {
           return NextResponse.json(
             { error: 'Prompt not found' },
             { status: 404 }
           );
         }
         
         const prompt = await promptService.updatePrompt(id, body);
         
         return NextResponse.json({ prompt, success: true });
         
       } catch (error: any) {
         console.error('PUT /api/prompts/[id] error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to update prompt' },
           { status: 500 }
         );
       }
     }
     
     // DELETE - Delete prompt
     export async function DELETE(request: NextRequest, { params }: RouteParams) {
       try {
         const { id } = params;
         
         const supabase = createServerSupabaseClient();
         const promptService = createPromptService(supabase);
         
         await promptService.deletePrompt(id);
         
         return NextResponse.json({ success: true });
         
       } catch (error: any) {
         console.error('DELETE /api/prompts/[id] error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to delete prompt' },
           { status: 500 }
         );
       }
     }
     
     // PATCH - Toggle active status
     export async function PATCH(request: NextRequest, { params }: RouteParams) {
       try {
         const { id } = params;
         
         const supabase = createServerSupabaseClient();
         const promptService = createPromptService(supabase);
         
         const prompt = await promptService.togglePromptActive(id);
         
         return NextResponse.json({ prompt, success: true });
         
       } catch (error: any) {
         console.error('PATCH /api/prompts/[id] error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to toggle prompt' },
           { status: 500 }
         );
       }
     }
     ```
  
  6. Create usePrompts hook:
     ```typescript
     // ============================================
     // [F083] src/hooks/usePrompts.ts
     // ============================================
     
     'use client';
     
     import { useState, useEffect, useCallback } from 'react';
     import { Prompt } from '@/lib/types';
     import { PROMPT_CATEGORIES } from '@/lib/prompts/default-prompts';
     
     interface UsePromptsOptions {
       activeOnly?: boolean;
       category?: string;
       autoFetch?: boolean;
     }
     
     interface UsePromptsReturn {
       prompts: Prompt[];
       loading: boolean;
       error: string | null;
       categories: typeof PROMPT_CATEGORIES;
       
       // Actions
       fetchPrompts: () => Promise<void>;
       searchPrompts: (query: string, locale?: 'en' | 'fa') => Promise<void>;
       createPrompt: (prompt: Omit<Prompt, 'id' | 'created_at' | 'updated_at'>) => Promise<Prompt>;
       updatePrompt: (id: string, updates: Partial<Prompt>) => Promise<Prompt>;
       deletePrompt: (id: string) => Promise<void>;
       togglePromptActive: (id: string) => Promise<Prompt>;
       getPromptsByIds: (ids: string[]) => Promise<Prompt[]>;
     }
     
     export function usePrompts(options: UsePromptsOptions = {}): UsePromptsReturn {
       const { activeOnly = false, category, autoFetch = true } = options;
       
       const [prompts, setPrompts] = useState<Prompt[]>([]);
       const [loading, setLoading] = useState(true);
       const [error, setError] = useState<string | null>(null);
       
       const fetchPrompts = useCallback(async () => {
         setLoading(true);
         setError(null);
         
         try {
           const params = new URLSearchParams();
           if (activeOnly) params.set('active', 'true');
           if (category) params.set('category', category);
           
           const res = await fetch(`/api/prompts?${params}`);
           const data = await res.json();
           
           if (data.error) throw new Error(data.error);
           
           setPrompts(data.prompts || []);
           
         } catch (err: any) {
           setError(err.message);
           setPrompts([]);
         } finally {
           setLoading(false);
         }
       }, [activeOnly, category]);
       
       const searchPrompts = useCallback(async (query: string, locale: 'en' | 'fa' = 'en') => {
         setLoading(true);
         setError(null);
         
         try {
           const params = new URLSearchParams({
             search: query,
             locale
           });
           
           const res = await fetch(`/api/prompts?${params}`);
           const data = await res.json();
           
           if (data.error) throw new Error(data.error);
           
           setPrompts(data.prompts || []);
           
         } catch (err: any) {
           setError(err.message);
         } finally {
           setLoading(false);
         }
       }, []);
       
       const createPrompt = useCallback(async (
         prompt: Omit<Prompt, 'id' | 'created_at' | 'updated_at'>
       ): Promise<Prompt> => {
         const res = await fetch('/api/prompts', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify(prompt)
         });
         
         const data = await res.json();
         if (data.error) throw new Error(data.error);
         
         // Add to local state
         setPrompts(prev => [...prev, data.prompt]);
         
         return data.prompt;
       }, []);
       
       const updatePrompt = useCallback(async (
         id: string,
         updates: Partial<Prompt>
       ): Promise<Prompt> => {
         const res = await fetch(`/api/prompts/${id}`, {
           method: 'PUT',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify(updates)
         });
         
         const data = await res.json();
         if (data.error) throw new Error(data.error);
         
         // Update local state
         setPrompts(prev => prev.map(p => p.id === id ? data.prompt : p));
         
         return data.prompt;
       }, []);
       
       const deletePrompt = useCallback(async (id: string): Promise<void> => {
         const res = await fetch(`/api/prompts/${id}`, {
           method: 'DELETE'
         });
         
         const data = await res.json();
         if (data.error) throw new Error(data.error);
         
         // Remove from local state
         setPrompts(prev => prev.filter(p => p.id !== id));
       }, []);
       
       const togglePromptActive = useCallback(async (id: string): Promise<Prompt> => {
         const res = await fetch(`/api/prompts/${id}`, {
           method: 'PATCH'
         });
         
         const data = await res.json();
         if (data.error) throw new Error(data.error);
         
         // Update local state
         setPrompts(prev => prev.map(p => p.id === id ? data.prompt : p));
         
         return data.prompt;
       }, []);
       
       const getPromptsByIds = useCallback(async (ids: string[]): Promise<Prompt[]> => {
         if (ids.length === 0) return [];
         
         // First check local cache
         const localPrompts = prompts.filter(p => ids.includes(p.id));
         if (localPrompts.length === ids.length) {
           return localPrompts;
         }
         
         // Fetch from API
         const res = await fetch(`/api/prompts?ids=${ids.join(',')}`);
         const data = await res.json();
         
         if (data.error) throw new Error(data.error);
         return data.prompts || [];
       }, [prompts]);
       
       // Auto fetch on mount
       useEffect(() => {
         if (autoFetch) {
           fetchPrompts();
         }
       }, [autoFetch, fetchPrompts]);
       
       return {
         prompts,
         loading,
         error,
         categories: PROMPT_CATEGORIES,
         fetchPrompts,
         searchPrompts,
         createPrompt,
         updatePrompt,
         deletePrompt,
         togglePromptActive,
         getPromptsByIds
       };
     }
     ```
  
  7. Create PromptCard.tsx:
     ```typescript
     // ============================================
     // [F122] src/components/prompts/PromptCard.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import { Prompt } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { 
       Pencil, Trash2, Eye, Power, PowerOff, GripVertical, Check 
     } from 'lucide-react';
     import { cn } from '@/lib/utils';
     import { PROMPT_CATEGORIES } from '@/lib/prompts/default-prompts';
     
     interface PromptCardProps {
       prompt: Prompt;
       onEdit?: (prompt: Prompt) => void;
       onDelete?: (prompt: Prompt) => void;
       onPreview?: (prompt: Prompt) => void;
       onToggleActive?: (prompt: Prompt) => void;
       onSelect?: (prompt: Prompt) => void;
       selected?: boolean;
       selectable?: boolean;
       editable?: boolean;
       draggable?: boolean;
       className?: string;
     }
     
     export function PromptCard({
       prompt,
       onEdit,
       onDelete,
       onPreview,
       onToggleActive,
       onSelect,
       selected = false,
       selectable = false,
       editable = false,
       draggable = false,
       className
     }: PromptCardProps) {
       const params = useParams();
       const locale = params.locale as 'en' | 'fa';
       const t = useTranslations('prompts');
       
       const title = locale === 'fa' ? prompt.title_fa : prompt.title_en;
       const description = locale === 'fa' ? prompt.description_fa : prompt.description_en;
       
       const categoryInfo = PROMPT_CATEGORIES.find(c => c.value === prompt.category);
       const categoryLabel = locale === 'fa' 
         ? categoryInfo?.label_fa 
         : categoryInfo?.label_en;
       
       const handleClick = () => {
         if (selectable && onSelect) {
           onSelect(prompt);
         }
       };
       
       return (
         <Card 
           className={cn(
             'relative transition-all',
             selectable && 'cursor-pointer hover:border-primary',
             selected && 'border-primary ring-2 ring-primary/20',
             !prompt.is_active && 'opacity-60',
             className
           )}
           onClick={handleClick}
         >
           {/* Drag Handle */}
           {draggable && (
             <div className="absolute left-2 top-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing">
               <GripVertical className="h-5 w-5 text-muted-foreground" />
             </div>
           )}
           
           {/* Selected Indicator */}
           {selected && (
             <div className="absolute top-3 right-3 bg-primary text-primary-foreground rounded-full p-1">
               <Check className="h-4 w-4" />
             </div>
           )}
           
           <CardHeader className={cn(draggable && 'pl-10')}>
             <div className="flex items-start justify-between gap-2">
               <div className="space-y-1 flex-1">
                 <CardTitle className="text-lg">{title}</CardTitle>
                 <CardDescription className="line-clamp-2">
                   {description}
                 </CardDescription>
               </div>
             </div>
             
             <div className="flex items-center gap-2 mt-2">
               <Badge variant="outline">{categoryLabel}</Badge>
               <Badge 
                 variant={prompt.is_active ? 'default' : 'secondary'}
                 className={cn(
                   prompt.is_active 
                     ? 'bg-green-100 text-green-700 hover:bg-green-100' 
                     : ''
                 )}
               >
                 {prompt.is_active ? t('active') : t('inactive')}
               </Badge>
             </div>
           </CardHeader>
           
           {editable && (
             <CardContent className={cn(draggable && 'pl-10')}>
               <div className="flex items-center gap-2">
                 <Button 
                   variant="ghost" 
                   size="sm"
                   onClick={(e) => { e.stopPropagation(); onPreview?.(prompt); }}
                 >
                   <Eye className="h-4 w-4 mr-1" />
                   {t('preview')}
                 </Button>
                 <Button 
                   variant="ghost" 
                   size="sm"
                   onClick={(e) => { e.stopPropagation(); onEdit?.(prompt); }}
                 >
                   <Pencil className="h-4 w-4 mr-1" />
                   {t('edit')}
                 </Button>
                 <Button 
                   variant="ghost" 
                   size="sm"
                   onClick={(e) => { e.stopPropagation(); onToggleActive?.(prompt); }}
                 >
                   {prompt.is_active ? (
                     <>
                       <PowerOff className="h-4 w-4 mr-1" />
                       {t('deactivate')}
                     </>
                   ) : (
                     <>
                       <Power className="h-4 w-4 mr-1" />
                       {t('activate')}
                     </>
                   )}
                 </Button>
                 <Button 
                   variant="ghost" 
                   size="sm"
                   className="text-destructive hover:text-destructive"
                   onClick={(e) => { e.stopPropagation(); onDelete?.(prompt); }}
                 >
                   <Trash2 className="h-4 w-4 mr-1" />
                   {t('delete')}
                 </Button>
               </div>
             </CardContent>
           )}
         </Card>
       );
     }
     ```
  
  8. Create PromptPreview.tsx:
     ```typescript
     // ============================================
     // [F123] src/components/prompts/PromptPreview.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import { Prompt } from '@/lib/types';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogDescription,
     } from '@/components/ui/dialog';
     import { Badge } from '@/components/ui/badge';
     import { ScrollArea } from '@/components/ui/scroll-area';
     import { PROMPT_CATEGORIES } from '@/lib/prompts/default-prompts';
     
     interface PromptPreviewProps {
       prompt: Prompt | null;
       open: boolean;
       onClose: () => void;
     }
     
     export function PromptPreview({ prompt, open, onClose }: PromptPreviewProps) {
       const params = useParams();
       const locale = params.locale as 'en' | 'fa';
       const t = useTranslations('prompts');
       
       if (!prompt) return null;
       
       const title = locale === 'fa' ? prompt.title_fa : prompt.title_en;
       const description = locale === 'fa' ? prompt.description_fa : prompt.description_en;
       
       const categoryInfo = PROMPT_CATEGORIES.find(c => c.value === prompt.category);
       const categoryLabel = locale === 'fa' 
         ? categoryInfo?.label_fa 
         : categoryInfo?.label_en;
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-3xl max-h-[90vh]">
             <DialogHeader>
               <div className="flex items-center gap-2 mb-2">
                 <Badge variant="outline">{categoryLabel}</Badge>
                 <Badge variant={prompt.is_active ? 'default' : 'secondary'}>
                   {prompt.is_active ? t('active') : t('inactive')}
                 </Badge>
               </div>
               <DialogTitle>{title}</DialogTitle>
               <DialogDescription>{description}</DialogDescription>
             </DialogHeader>
             
             <div className="mt-4">
               <h4 className="text-sm font-medium mb-2">{t('prompt_text')}</h4>
               <ScrollArea className="h-[400px] rounded-md border p-4 bg-muted/50">
                 <pre className="text-sm whitespace-pre-wrap font-mono">
                   {prompt.prompt_text}
                 </pre>
               </ScrollArea>
             </div>
           </DialogContent>
         </Dialog>
       );
     }
     ```
  
  9. Create PromptEditor.tsx:
     ```typescript
     // ============================================
     // [F046] src/components/prompts/PromptEditor.tsx
     // ============================================
     
     'use client';
     
     import { useState, useEffect } from 'react';
     import { useTranslations } from 'next-intl';
     import { Prompt } from '@/lib/types';
     import { PROMPT_CATEGORIES } from '@/lib/prompts/default-prompts';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogFooter,
     } from '@/components/ui/dialog';
     import { Button } from '@/components/ui/button';
     import { Input } from '@/components/ui/input';
     import { Label } from '@/components/ui/label';
     import { Textarea } from '@/components/ui/textarea';
     import {
       Select,
       SelectContent,
       SelectItem,
       SelectTrigger,
       SelectValue,
     } from '@/components/ui/select';
     import { Switch } from '@/components/ui/switch';
     import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
     import { Loader2 } from 'lucide-react';
     
     interface PromptEditorProps {
       prompt?: Prompt | null;  // null = create new
       open: boolean;
       onClose: () => void;
       onSave: (prompt: Omit<Prompt, 'id' | 'created_at' | 'updated_at'>) => Promise<void>;
     }
     
     const emptyPrompt = {
       title_en: '',
       title_fa: '',
       description_en: '',
       description_fa: '',
       prompt_text: '',
       category: 'general',
       is_active: true,
       sort_order: 0
     };
     
     export function PromptEditor({ prompt, open, onClose, onSave }: PromptEditorProps) {
       const t = useTranslations('prompts');
       const [formData, setFormData] = useState(emptyPrompt);
       const [saving, setSaving] = useState(false);
       const [activeTab, setActiveTab] = useState<'en' | 'fa'>('en');
       
       // Reset form when prompt changes
       useEffect(() => {
         if (prompt) {
           setFormData({
             title_en: prompt.title_en,
             title_fa: prompt.title_fa,
             description_en: prompt.description_en,
             description_fa: prompt.description_fa,
             prompt_text: prompt.prompt_text,
             category: prompt.category,
             is_active: prompt.is_active,
             sort_order: prompt.sort_order
           });
         } else {
           setFormData(emptyPrompt);
         }
       }, [prompt, open]);
       
       const handleChange = (field: string, value: any) => {
         setFormData(prev => ({ ...prev, [field]: value }));
       };
       
       const handleSubmit = async () => {
         // Validation
         if (!formData.title_en || !formData.title_fa || !formData.prompt_text) {
           return;
         }
         
         setSaving(true);
         try {
           await onSave(formData);
           onClose();
         } finally {
           setSaving(false);
         }
       };
       
       const isEditing = prompt !== null && prompt !== undefined;
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
             <DialogHeader>
               <DialogTitle>
                 {isEditing ? t('edit_prompt') : t('create_prompt')}
               </DialogTitle>
             </DialogHeader>
             
             <div className="space-y-6 py-4">
               {/* Title and Description - Bilingual */}
               <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'en' | 'fa')}>
                 <TabsList className="grid w-full grid-cols-2">
                   <TabsTrigger value="en">English</TabsTrigger>
                   <TabsTrigger value="fa">ÙØ§Ø±Ø³ÛŒ</TabsTrigger>
                 </TabsList>
                 
                 <TabsContent value="en" className="space-y-4 mt-4">
                   <div className="grid gap-2">
                     <Label htmlFor="title_en">{t('title')} (English) *</Label>
                     <Input
                       id="title_en"
                       value={formData.title_en}
                       onChange={(e) => handleChange('title_en', e.target.value)}
                       placeholder="Professional CV Tailoring"
                     />
                   </div>
                   <div className="grid gap-2">
                     <Label htmlFor="description_en">{t('description')} (English)</Label>
                     <Textarea
                       id="description_en"
                       value={formData.description_en}
                       onChange={(e) => handleChange('description_en', e.target.value)}
                       placeholder="A brief description of what this prompt does..."
                       rows={2}
                     />
                   </div>
                 </TabsContent>
                 
                 <TabsContent value="fa" className="space-y-4 mt-4" dir="rtl">
                   <div className="grid gap-2">
                     <Label htmlFor="title_fa">{t('title')} (ÙØ§Ø±Ø³ÛŒ) *</Label>
                     <Input
                       id="title_fa"
                       value={formData.title_fa}
                       onChange={(e) => handleChange('title_fa', e.target.value)}
                       placeholder="ØªÙ†Ø¸ÛŒÙ… Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø³ÛŒâ€ŒÙˆÛŒ"
                     />
                   </div>
                   <div className="grid gap-2">
                     <Label htmlFor="description_fa">{t('description')} (ÙØ§Ø±Ø³ÛŒ)</Label>
                     <Textarea
                       id="description_fa"
                       value={formData.description_fa}
                       onChange={(e) => handleChange('description_fa', e.target.value)}
                       placeholder="ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§ÛŒÙ† Ù¾Ø±Ø§Ù…Ù¾Øª..."
                       rows={2}
                     />
                   </div>
                 </TabsContent>
               </Tabs>
               
               {/* Category */}
               <div className="grid gap-2">
                 <Label htmlFor="category">{t('category')}</Label>
                 <Select
                   value={formData.category}
                   onValueChange={(v) => handleChange('category', v)}
                 >
                   <SelectTrigger>
                     <SelectValue />
                   </SelectTrigger>
                   <SelectContent>
                     {PROMPT_CATEGORIES.map((cat) => (
                       <SelectItem key={cat.value} value={cat.value}>
                         {cat.label_en} / {cat.label_fa}
                       </SelectItem>
                     ))}
                   </SelectContent>
                 </Select>
               </div>
               
               {/* Prompt Text */}
               <div className="grid gap-2">
                 <Label htmlFor="prompt_text">{t('prompt_text')} *</Label>
                 <Textarea
                   id="prompt_text"
                   value={formData.prompt_text}
                   onChange={(e) => handleChange('prompt_text', e.target.value)}
                   placeholder="You are an expert CV writer..."
                   rows={12}
                   className="font-mono text-sm"
                 />
                 <p className="text-xs text-muted-foreground">
                   {t('prompt_text_hint')}
                 </p>
               </div>
               
               {/* Active Status */}
               <div className="flex items-center justify-between">
                 <div>
                   <Label htmlFor="is_active">{t('active_status')}</Label>
                   <p className="text-sm text-muted-foreground">
                     {t('active_status_hint')}
                   </p>
                 </div>
                 <Switch
                   id="is_active"
                   checked={formData.is_active}
                   onCheckedChange={(v) => handleChange('is_active', v)}
                 />
               </div>
             </div>
             
             <DialogFooter>
               <Button variant="outline" onClick={onClose} disabled={saving}>
                 {t('cancel')}
               </Button>
               <Button onClick={handleSubmit} disabled={saving}>
                 {saving ? (
                   <>
                     <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                     {t('saving')}
                   </>
                 ) : (
                   t('save')
                 )}
               </Button>
             </DialogFooter>
           </DialogContent>
         </Dialog>
       );
     }
     ```
  
  10. Create PromptCategoryFilter.tsx:
      ```typescript
      // ============================================
      // [F048] src/components/prompts/PromptCategoryFilter.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { useParams } from 'next/navigation';
      import { PROMPT_CATEGORIES } from '@/lib/prompts/default-prompts';
      import { Badge } from '@/components/ui/badge';
      import { cn } from '@/lib/utils';
      
      interface PromptCategoryFilterProps {
        selectedCategory: string | null;
        onCategoryChange: (category: string | null) => void;
        className?: string;
      }
      
      export function PromptCategoryFilter({
        selectedCategory,
        onCategoryChange,
        className
      }: PromptCategoryFilterProps) {
        const params = useParams();
        const locale = params.locale as 'en' | 'fa';
        const t = useTranslations('prompts');
        
        return (
          <div className={cn('flex flex-wrap gap-2', className)}>
            <Badge
              variant={selectedCategory === null ? 'default' : 'outline'}
              className="cursor-pointer"
              onClick={() => onCategoryChange(null)}
            >
              {t('all_categories')}
            </Badge>
            {PROMPT_CATEGORIES.map((cat) => (
              <Badge
                key={cat.value}
                variant={selectedCategory === cat.value ? 'default' : 'outline'}
                className="cursor-pointer"
                onClick={() => onCategoryChange(cat.value)}
              >
                {locale === 'fa' ? cat.label_fa : cat.label_en}
              </Badge>
            ))}
          </div>
        );
      }
      ```
  
  11. Create PromptList.tsx:
      ```typescript
      // ============================================
      // [F045] src/components/prompts/PromptList.tsx
      // ============================================
      
      'use client';
      
      import { useState } from 'react';
      import { useTranslations } from 'next-intl';
      import { Prompt } from '@/lib/types';
      import { PromptCard } from './PromptCard';
      import { PromptCategoryFilter } from './PromptCategoryFilter';
      import { Input } from '@/components/ui/input';
      import { Search, Loader2 } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface PromptListProps {
        prompts: Prompt[];
        loading?: boolean;
        editable?: boolean;
        selectable?: boolean;
        selectedIds?: string[];
        onEdit?: (prompt: Prompt) => void;
        onDelete?: (prompt: Prompt) => void;
        onPreview?: (prompt: Prompt) => void;
        onToggleActive?: (prompt: Prompt) => void;
        onSelect?: (prompt: Prompt) => void;
        onSearch?: (query: string) => void;
        className?: string;
      }
      
      export function PromptList({
        prompts,
        loading = false,
        editable = false,
        selectable = false,
        selectedIds = [],
        onEdit,
        onDelete,
        onPreview,
        onToggleActive,
        onSelect,
        onSearch,
        className
      }: PromptListProps) {
        const t = useTranslations('prompts');
        const [searchQuery, setSearchQuery] = useState('');
        const [selectedCategory, setSelectedCategory] = useState<string | null>(null);
        
        // Filter prompts locally
        const filteredPrompts = prompts.filter(prompt => {
          // Category filter
          if (selectedCategory && prompt.category !== selectedCategory) {
            return false;
          }
          
          // Search filter (client-side for immediate feedback)
          if (searchQuery) {
            const query = searchQuery.toLowerCase();
            return (
              prompt.title_en.toLowerCase().includes(query) ||
              prompt.title_fa.includes(searchQuery) ||
              prompt.description_en.toLowerCase().includes(query) ||
              prompt.description_fa.includes(searchQuery)
            );
          }
          
          return true;
        });
        
        const handleSearchChange = (value: string) => {
          setSearchQuery(value);
          onSearch?.(value);
        };
        
        return (
          <div className={cn('space-y-4', className)}>
            {/* Search and Filter */}
            <div className="space-y-3">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                <Input
                  placeholder={t('search_prompts')}
                  value={searchQuery}
                  onChange={(e) => handleSearchChange(e.target.value)}
                  className="pl-10"
                />
              </div>
              
              <PromptCategoryFilter
                selectedCategory={selectedCategory}
                onCategoryChange={setSelectedCategory}
              />
            </div>
            
            {/* Loading State */}
            {loading && (
              <div className="flex items-center justify-center py-12">
                <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
              </div>
            )}
            
            {/* Empty State */}
            {!loading && filteredPrompts.length === 0 && (
              <div className="text-center py-12">
                <p className="text-muted-foreground">{t('no_prompts_found')}</p>
              </div>
            )}
            
            {/* Prompt Grid */}
            {!loading && filteredPrompts.length > 0 && (
              <div className="grid gap-4 md:grid-cols-2">
                {filteredPrompts.map((prompt) => (
                  <PromptCard
                    key={prompt.id}
                    prompt={prompt}
                    editable={editable}
                    selectable={selectable}
                    selected={selectedIds.includes(prompt.id)}
                    onEdit={onEdit}
                    onDelete={onDelete}
                    onPreview={onPreview}
                    onToggleActive={onToggleActive}
                    onSelect={onSelect}
                  />
                ))}
              </div>
            )}
          </div>
        );
      }
      ```
  
  12. Create PromptSelector.tsx (for use in application flow):
      ```typescript
      // ============================================
      // [F047] src/components/prompts/PromptSelector.tsx
      // ============================================
      
      'use client';
      
      import { useState, useCallback, useEffect } from 'react';
      import { useTranslations } from 'next-intl';
      import { Prompt } from '@/lib/types';
      import { usePrompts } from '@/hooks/usePrompts';
      import { PromptList } from './PromptList';
      import { PromptPreview } from './PromptPreview';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Badge } from '@/components/ui/badge';
      import { Button } from '@/components/ui/button';
      import { FileText, X } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface PromptSelectorProps {
        selectedIds: string[];
        onSelectionChange: (ids: string[]) => void;
        maxSelection?: number;  // null = unlimited
        className?: string;
      }
      
      export function PromptSelector({
        selectedIds,
        onSelectionChange,
        maxSelection = null,
        className
      }: PromptSelectorProps) {
        const t = useTranslations('prompts');
        const { prompts, loading } = usePrompts({ activeOnly: true });
        const [previewPrompt, setPreviewPrompt] = useState<Prompt | null>(null);
        
        const handleSelect = useCallback((prompt: Prompt) => {
          const isSelected = selectedIds.includes(prompt.id);
          
          if (isSelected) {
            // Deselect
            onSelectionChange(selectedIds.filter(id => id !== prompt.id));
          } else {
            // Select (check max)
            if (maxSelection && selectedIds.length >= maxSelection) {
              // Replace last selection
              onSelectionChange([...selectedIds.slice(0, -1), prompt.id]);
            } else {
              onSelectionChange([...selectedIds, prompt.id]);
            }
          }
        }, [selectedIds, maxSelection, onSelectionChange]);
        
        const handleRemove = useCallback((id: string) => {
          onSelectionChange(selectedIds.filter(i => i !== id));
        }, [selectedIds, onSelectionChange]);
        
        // Get selected prompt objects
        const selectedPrompts = prompts.filter(p => selectedIds.includes(p.id));
        
        return (
          <div className={cn('space-y-4', className)}>
            {/* Selected Prompts */}
            {selectedPrompts.length > 0 && (
              <Card>
                <CardHeader className="pb-3">
                  <CardTitle className="text-base flex items-center gap-2">
                    <FileText className="h-4 w-4" />
                    {t('selected_prompts')} ({selectedPrompts.length})
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="flex flex-wrap gap-2">
                    {selectedPrompts.map((prompt, index) => (
                      <Badge
                        key={prompt.id}
                        variant="secondary"
                        className="px-3 py-1.5"
                      >
                        <span className="mr-1 text-xs text-muted-foreground">
                          {index + 1}.
                        </span>
                        {prompt.title_en}
                        <button
                          onClick={() => handleRemove(prompt.id)}
                          className="ml-2 hover:text-destructive"
                        >
                          <X className="h-3 w-3" />
                        </button>
                      </Badge>
                    ))}
                  </div>
                </CardContent>
              </Card>
            )}
            
            {/* Prompt List */}
            <Card>
              <CardHeader>
                <CardTitle>{t('available_prompts')}</CardTitle>
                <CardDescription>
                  {maxSelection 
                    ? t('select_up_to', { count: maxSelection })
                    : t('select_prompts_hint')
                  }
                </CardDescription>
              </CardHeader>
              <CardContent>
                <PromptList
                  prompts={prompts}
                  loading={loading}
                  selectable
                  selectedIds={selectedIds}
                  onSelect={handleSelect}
                  onPreview={setPreviewPrompt}
                />
              </CardContent>
            </Card>
            
            {/* Preview Dialog */}
            <PromptPreview
              prompt={previewPrompt}
              open={previewPrompt !== null}
              onClose={() => setPreviewPrompt(null)}
            />
          </div>
        );
      }
      ```
  
  13. Create prompts/loading.tsx:
      ```typescript
      // ============================================
      // [F124] src/app/[locale]/prompts/loading.tsx
      // ============================================
      
      import { Skeleton } from '@/components/ui/skeleton';
      import { Card, CardContent, CardHeader } from '@/components/ui/card';
      
      export default function Loading() {
        return (
          <div className="container mx-auto p-6 space-y-6">
            {/* Header */}
            <div className="flex items-center justify-between">
              <div className="space-y-2">
                <Skeleton className="h-8 w-48" />
                <Skeleton className="h-4 w-72" />
              </div>
              <Skeleton className="h-10 w-32" />
            </div>
            
            {/* Search and filter */}
            <Skeleton className="h-10 w-full" />
            <div className="flex gap-2">
              {Array.from({ length: 5 }).map((_, i) => (
                <Skeleton key={i} className="h-6 w-20" />
              ))}
            </div>
            
            {/* Cards grid */}
            <div className="grid gap-4 md:grid-cols-2">
              {Array.from({ length: 4 }).map((_, i) => (
                <Card key={i}>
                  <CardHeader>
                    <Skeleton className="h-6 w-3/4" />
                    <Skeleton className="h-4 w-full" />
                  </CardHeader>
                  <CardContent>
                    <Skeleton className="h-8 w-full" />
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        );
      }
      ```
  
  14. Create prompts/page.tsx:
      ```typescript
      // ============================================
      // [F015] src/app/[locale]/prompts/page.tsx
      // ============================================
      
      'use client';
      
      import { useState } from 'react';
      import { useTranslations } from 'next-intl';
      import { AuthGuard } from '@/components/auth/AuthGuard';
      import { usePrompts } from '@/hooks/usePrompts';
      import { PromptList } from '@/components/prompts/PromptList';
      import { PromptEditor } from '@/components/prompts/PromptEditor';
      import { PromptPreview } from '@/components/prompts/PromptPreview';
      import { Button } from '@/components/ui/button';
      import { useToast } from '@/components/ui/use-toast';
      import {
        AlertDialog,
        AlertDialogAction,
        AlertDialogCancel,
        AlertDialogContent,
        AlertDialogDescription,
        AlertDialogFooter,
        AlertDialogHeader,
        AlertDialogTitle,
      } from '@/components/ui/alert-dialog';
      import { Prompt } from '@/lib/types';
      import { FileText, Plus, Loader2 } from 'lucide-react';
      
      export default function PromptsPage() {
        const t = useTranslations('prompts');
        const { toast } = useToast();
        
        const {
          prompts,
          loading,
          error,
          createPrompt,
          updatePrompt,
          deletePrompt,
          togglePromptActive,
          searchPrompts
        } = usePrompts();
        
        // UI state
        const [editorOpen, setEditorOpen] = useState(false);
        const [editingPrompt, setEditingPrompt] = useState<Prompt | null>(null);
        const [previewPrompt, setPreviewPrompt] = useState<Prompt | null>(null);
        const [deletePrompt_, setDeletePrompt] = useState<Prompt | null>(null);
        const [actionLoading, setActionLoading] = useState(false);
        
        // Handlers
        const handleCreate = () => {
          setEditingPrompt(null);
          setEditorOpen(true);
        };
        
        const handleEdit = (prompt: Prompt) => {
          setEditingPrompt(prompt);
          setEditorOpen(true);
        };
        
        const handleSave = async (data: Omit<Prompt, 'id' | 'created_at' | 'updated_at'>) => {
          try {
            if (editingPrompt) {
              await updatePrompt(editingPrompt.id, data);
              toast({ title: t('prompt_updated') });
            } else {
              await createPrompt(data);
              toast({ title: t('prompt_created') });
            }
          } catch (err: any) {
            toast({
              variant: 'destructive',
              title: t('save_error'),
              description: err.message
            });
            throw err;
          }
        };
        
        const handleDelete = async () => {
          if (!deletePrompt_) return;
          
          setActionLoading(true);
          try {
            await deletePrompt(deletePrompt_.id);
            toast({ title: t('prompt_deleted') });
            setDeletePrompt(null);
          } catch (err: any) {
            toast({
              variant: 'destructive',
              title: t('delete_error'),
              description: err.message
            });
          } finally {
            setActionLoading(false);
          }
        };
        
        const handleToggleActive = async (prompt: Prompt) => {
          try {
            await togglePromptActive(prompt.id);
            toast({
              title: prompt.is_active ? t('prompt_deactivated') : t('prompt_activated')
            });
          } catch (err: any) {
            toast({
              variant: 'destructive',
              title: t('toggle_error'),
              description: err.message
            });
          }
        };
        
        return (
          <AuthGuard>
            <div className="container mx-auto p-6 max-w-5xl">
              {/* Header */}
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h1 className="text-2xl font-bold flex items-center gap-2">
                    <FileText className="h-6 w-6" />
                    {t('title')}
                  </h1>
                  <p className="text-muted-foreground mt-1">
                    {t('description')}
                  </p>
                </div>
                
                <Button onClick={handleCreate}>
                  <Plus className="h-4 w-4 mr-2" />
                  {t('create_prompt')}
                </Button>
              </div>
              
              {/* Error State */}
              {error && (
                <div className="mb-6 p-4 bg-destructive/10 text-destructive rounded-lg">
                  {error}
                </div>
              )}
              
              {/* Prompt List */}
              <PromptList
                prompts={prompts}
                loading={loading}
                editable
                onEdit={handleEdit}
                onDelete={setDeletePrompt}
                onPreview={setPreviewPrompt}
                onToggleActive={handleToggleActive}
                onSearch={searchPrompts}
              />
              
              {/* Editor Dialog */}
              <PromptEditor
                prompt={editingPrompt}
                open={editorOpen}
                onClose={() => {
                  setEditorOpen(false);
                  setEditingPrompt(null);
                }}
                onSave={handleSave}
              />
              
              {/* Preview Dialog */}
              <PromptPreview
                prompt={previewPrompt}
                open={previewPrompt !== null}
                onClose={() => setPreviewPrompt(null)}
              />
              
              {/* Delete Confirmation */}
              <AlertDialog 
                open={deletePrompt_ !== null} 
                onOpenChange={() => setDeletePrompt(null)}
              >
                <AlertDialogContent>
                  <AlertDialogHeader>
                    <AlertDialogTitle>{t('delete_confirm_title')}</AlertDialogTitle>
                    <AlertDialogDescription>
                      {t('delete_confirm_description', { 
                        title: deletePrompt_?.title_en 
                      })}
                    </AlertDialogDescription>
                  </AlertDialogHeader>
                  <AlertDialogFooter>
                    <AlertDialogCancel disabled={actionLoading}>
                      {t('cancel')}
                    </AlertDialogCancel>
                    <AlertDialogAction
                      onClick={handleDelete}
                      disabled={actionLoading}
                      className="bg-destructive text-destructive-foreground hover:bg-destructive/90"
                    >
                      {actionLoading ? (
                        <Loader2 className="h-4 w-4 animate-spin" />
                      ) : (
                        t('delete')
                      )}
                    </AlertDialogAction>
                  </AlertDialogFooter>
                </AlertDialogContent>
              </AlertDialog>
            </div>
          </AuthGuard>
        );
      }
      ```
  
  15. Add translations to en.json under "prompts" key:
      ```json
      {
        "prompts": {
          "title": "Prompt Management",
          "description": "Create and manage prompts for CV tailoring",
          "create_prompt": "Create Prompt",
          "edit_prompt": "Edit Prompt",
          "search_prompts": "Search prompts...",
          "all_categories": "All",
          "no_prompts_found": "No prompts found",
          "active": "Active",
          "inactive": "Inactive",
          "preview": "Preview",
          "edit": "Edit",
          "delete": "Delete",
          "activate": "Activate",
          "deactivate": "Deactivate",
          "title_label": "Title",
          "description_label": "Description",
          "category": "Category",
          "prompt_text": "Prompt Text",
          "prompt_text_hint": "This is the instruction sent to the AI. Use clear, detailed instructions.",
          "active_status": "Active",
          "active_status_hint": "Only active prompts are available for selection",
          "save": "Save",
          "saving": "Saving...",
          "cancel": "Cancel",
          "prompt_created": "Prompt created successfully",
          "prompt_updated": "Prompt updated successfully",
          "prompt_deleted": "Prompt deleted successfully",
          "prompt_activated": "Prompt activated",
          "prompt_deactivated": "Prompt deactivated",
          "save_error": "Failed to save prompt",
          "delete_error": "Failed to delete prompt",
          "toggle_error": "Failed to toggle prompt status",
          "delete_confirm_title": "Delete Prompt?",
          "delete_confirm_description": "Are you sure you want to delete \"{title}\"? This action cannot be undone.",
          "selected_prompts": "Selected Prompts",
          "available_prompts": "Available Prompts",
          "select_prompts_hint": "Select one or more prompts to use",
          "select_up_to": "Select up to {count} prompts"
        }
      }
      ```
  
  16. Add translations to fa.json under "prompts" key:
      ```json
      {
        "prompts": {
          "title": "Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§",
          "description": "Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªÙ†Ø¸ÛŒÙ… Ø³ÛŒâ€ŒÙˆÛŒ",
          "create_prompt": "Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±Ø§Ù…Ù¾Øª",
          "edit_prompt": "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø§Ù…Ù¾Øª",
          "search_prompts": "Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§...",
          "all_categories": "Ù‡Ù…Ù‡",
          "no_prompts_found": "Ù¾Ø±Ø§Ù…Ù¾ØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯",
          "active": "ÙØ¹Ø§Ù„",
          "inactive": "ØºÛŒØ±ÙØ¹Ø§Ù„",
          "preview": "Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´",
          "edit": "ÙˆÛŒØ±Ø§ÛŒØ´",
          "delete": "Ø­Ø°Ù",
          "activate": "ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ",
          "deactivate": "ØºÛŒØ±ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ",
          "title_label": "Ø¹Ù†ÙˆØ§Ù†",
          "description_label": "ØªÙˆØ¶ÛŒØ­Ø§Øª",
          "category": "Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ",
          "prompt_text": "Ù…ØªÙ† Ù¾Ø±Ø§Ù…Ù¾Øª",
          "prompt_text_hint": "Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ±ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø§Ø² Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ùˆ Ø¯Ù‚ÛŒÙ‚ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
          "active_status": "ÙØ¹Ø§Ù„",
          "active_status_hint": "ÙÙ‚Ø· Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù‡Ø³ØªÙ†Ø¯",
          "save": "Ø°Ø®ÛŒØ±Ù‡",
          "saving": "Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡...",
          "cancel": "Ø§Ù†ØµØ±Ø§Ù",
          "prompt_created": "Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯",
          "prompt_updated": "Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯",
          "prompt_deleted": "Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯",
          "prompt_activated": "Ù¾Ø±Ø§Ù…Ù¾Øª ÙØ¹Ø§Ù„ Ø´Ø¯",
          "prompt_deactivated": "Ù¾Ø±Ø§Ù…Ù¾Øª ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯",
          "save_error": "Ø°Ø®ÛŒØ±Ù‡ Ù¾Ø±Ø§Ù…Ù¾Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯",
          "delete_error": "Ø­Ø°Ù Ù¾Ø±Ø§Ù…Ù¾Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯",
          "toggle_error": "ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯",
          "delete_confirm_title": "Ø­Ø°Ù Ù¾Ø±Ø§Ù…Ù¾ØªØŸ",
          "delete_confirm_description": "Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ \"{title}\" Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.",
          "selected_prompts": "Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡",
          "available_prompts": "Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯",
          "select_prompts_hint": "ÛŒÚ© ÛŒØ§ Ú†Ù†Ø¯ Ù¾Ø±Ø§Ù…Ù¾Øª Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯",
          "select_up_to": "Ø­Ø¯Ø§Ú©Ø«Ø± {count} Ù¾Ø±Ø§Ù…Ù¾Øª Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯"
        }
      }
      ```

checkpoint_tests:
  - id: T01
    description: "All prompt service files exist"
    type: "files_exist"
    files:
      - "src/lib/prompts/prompt-service.ts"
      - "src/lib/prompts/default-prompts.ts"
      - "src/lib/prompts/index.ts"

  - id: T02
    description: "All prompt API route files exist"
    type: "files_exist"
    files:
      - "src/app/api/prompts/route.ts"
      - "src/app/api/prompts/[id]/route.ts"

  - id: T03
    description: "usePrompts hook exists"
    type: "files_exist"
    files:
      - "src/hooks/usePrompts.ts"

  - id: T04
    description: "All prompt component files exist"
    type: "files_exist"
    files:
      - "src/components/prompts/PromptList.tsx"
      - "src/components/prompts/PromptEditor.tsx"
      - "src/components/prompts/PromptSelector.tsx"
      - "src/components/prompts/PromptCategoryFilter.tsx"
      - "src/components/prompts/PromptCard.tsx"
      - "src/components/prompts/PromptPreview.tsx"

  - id: T05
    description: "Prompts page exists"
    type: "files_exist"
    files:
      - "src/app/[locale]/prompts/page.tsx"
      - "src/app/[locale]/prompts/loading.tsx"

  - id: T06
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T07
    description: "Prompt service has all CRUD methods"
    type: "grep"
    file: "src/lib/prompts/prompt-service.ts"
    patterns:
      - "getAllPrompts"
      - "getPromptById"
      - "createPrompt"
      - "updatePrompt"
      - "deletePrompt"
      - "togglePromptActive"
      - "seedDefaultPrompts"

  - id: T08
    description: "API route has GET, POST methods"
    type: "grep"
    file: "src/app/api/prompts/route.ts"
    patterns:
      - "export async function GET"
      - "export async function POST"

  - id: T09
    description: "Single prompt API has GET, PUT, DELETE, PATCH"
    type: "grep"
    file: "src/app/api/prompts/[id]/route.ts"
    patterns:
      - "export async function GET"
      - "export async function PUT"
      - "export async function DELETE"
      - "export async function PATCH"

  - id: T10
    description: "usePrompts exports all functions"
    type: "grep"
    file: "src/hooks/usePrompts.ts"
    patterns:
      - "export function usePrompts"
      - "fetchPrompts"
      - "createPrompt"
      - "updatePrompt"
      - "deletePrompt"
      - "togglePromptActive"

  - id: T11
    description: "PromptEditor has bilingual support"
    type: "grep"
    file: "src/components/prompts/PromptEditor.tsx"
    patterns:
      - "title_en"
      - "title_fa"
      - "TabsList"
      - "English"
      - "ÙØ§Ø±Ø³ÛŒ"

  - id: T12
    description: "PromptSelector uses usePrompts hook"
    type: "grep"
    file: "src/components/prompts/PromptSelector.tsx"
    patterns:
      - "usePrompts"
      - "selectedIds"
      - "onSelectionChange"

  - id: T13
    description: "Default prompts include seed data"
    type: "grep"
    file: "src/lib/prompts/default-prompts.ts"
    patterns:
      - "DEFAULT_PROMPTS"
      - "Professional CV Tailoring"
      - "Cover Letter Generator"
      - "PROMPT_CATEGORIES"

  - id: T14
    description: "Prompts page uses AuthGuard"
    type: "grep"
    file: "src/app/[locale]/prompts/page.tsx"
    patterns:
      - "AuthGuard"
      - "<AuthGuard>"

  - id: T15
    description: "English translations have all prompt keys"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "prompts"
      - "create_prompt"
      - "edit_prompt"
      - "prompt_created"
      - "selected_prompts"

  - id: T16
    description: "Farsi translations have all prompt keys"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - "prompts"
      - "create_prompt"
      - "Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø§Ù…Ù¾Øª"

max_retries: 3

# blocks/B18.yaml

id: B18
name: "New Application Wizard - Core Workflow"
phase: 3
phase_name: "Core Application Flow"

goal: |
  Create the complete job application workflow - the core feature of the app.
  This is a multi-step wizard that:
  1. Collects job description
  2. Lets user select prompts
  3. Configures AI (provider/model for draft and final)
  4. Sets output language and tone
  5. Processes with AI (with clarification loop if needed)
  6. Shows editable draft output
  7. Generates 3 final documents (Tailored CV, Cover Letter, Application Email)
  8. Allows download in Word and Markdown formats

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B09, B10, B11, B12, B13, B14, B15, B16, B17]

files_to_create:
  # Service Layer
  - id: F125
    path: "src/lib/applications/application-service.ts"
    description: "Service for job application CRUD and workflow"

  - id: F126
    path: "src/lib/applications/application-processor.ts"
    description: "AI processing logic for applications"

  - id: F127
    path: "src/lib/applications/application-prompts.ts"
    description: "Prompt templates for application processing"

  - id: F128
    path: "src/lib/applications/index.ts"
    description: "Export all application modules"

  # API Routes
  - id: F129
    path: "src/app/api/applications/route.ts"
    description: "API for applications list and create"

  - id: F130
    path: "src/app/api/applications/[id]/route.ts"
    description: "API for single application CRUD"

  - id: F131
    path: "src/app/api/applications/[id]/process/route.ts"
    description: "API to start AI processing"

  - id: F132
    path: "src/app/api/applications/[id]/clarify/route.ts"
    description: "API for clarification responses"

  - id: F133
    path: "src/app/api/applications/[id]/finalize/route.ts"
    description: "API to generate final documents"

  # React Hook
  - id: F084
    path: "src/hooks/useApplication.ts"
    description: "React hook for application workflow"

  # Wizard Components
  - id: F134
    path: "src/components/application/ApplicationWizard.tsx"
    description: "Main wizard container with step navigation"

  - id: F135
    path: "src/components/application/WizardProgress.tsx"
    description: "Progress indicator for wizard steps"

  - id: F054
    path: "src/components/application/JobDescriptionInput.tsx"
    description: "Step 1: Job description input"

  - id: F136
    path: "src/components/application/PromptSelectionStep.tsx"
    description: "Step 2: Select prompts"

  - id: F137
    path: "src/components/application/AIConfigurationStep.tsx"
    description: "Step 3: Configure AI models"

  - id: F056
    path: "src/components/application/LanguageSelector.tsx"
    description: "Output language selection"

  - id: F055
    path: "src/components/application/ToneSelector.tsx"
    description: "Tone selection (preset or custom)"

  - id: F138
    path: "src/components/application/OutputSettingsStep.tsx"
    description: "Step 4: Language and tone settings"

  - id: F139
    path: "src/components/application/ProcessingStep.tsx"
    description: "Step 5: AI processing with clarification"

  - id: F052
    path: "src/components/ai/AIChatInterface.tsx"
    description: "Chat interface for AI clarification"

  - id: F057
    path: "src/components/application/OutputEditor.tsx"
    description: "Step 6: Edit draft output"

  - id: F140
    path: "src/components/application/FinalDocumentsStep.tsx"
    description: "Step 7: View and download final documents"

  - id: F058
    path: "src/components/application/DocumentPreview.tsx"
    description: "Preview a single document"

  - id: F059
    path: "src/components/application/DownloadPanel.tsx"
    description: "Download buttons for all formats"

  # Page
  - id: F014
    path: "src/app/[locale]/new-application/page.tsx"
    description: "New application page"

  - id: F141
    path: "src/app/[locale]/new-application/loading.tsx"
    description: "Loading state"

files_to_modify:
  - id: F079
    path: "src/lib/types.ts"
    description: "Add application workflow types"

  - id: F087
    path: "src/i18n/en.json"
    description: "Add application translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add application translations"

files_available:
  - id: F027
    path: "src/components/ui/button.tsx"
    from_block: B02
  - id: F028
    path: "src/components/ui/input.tsx"
    from_block: B02
  - id: F029
    path: "src/components/ui/card.tsx"
    from_block: B02
  - id: F030
    path: "src/components/ui/dialog.tsx"
    from_block: B02
  - id: F031
    path: "src/components/ui/select.tsx"
    from_block: B02
  - id: F032
    path: "src/components/ui/textarea.tsx"
    from_block: B02
  - id: F033
    path: "src/components/ui/tabs.tsx"
    from_block: B02
  - id: F034
    path: "src/components/ui/badge.tsx"
    from_block: B02
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F066
    path: "src/lib/ai/ai-provider.ts"
    from_block: B10
  - id: F070
    path: "src/lib/ai/ai-factory.ts"
    from_block: B10
  - id: F077
    path: "src/lib/encryption.ts"
    from_block: B11
  - id: F081
    path: "src/hooks/useAIKeys.ts"
    from_block: B11
  - id: F082
    path: "src/hooks/useCV.ts"
    from_block: B15
  - id: F047
    path: "src/components/prompts/PromptSelector.tsx"
    from_block: B17
  - id: F083
    path: "src/hooks/usePrompts.ts"
    from_block: B17
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07
  - id: F092
    path: "src/components/auth/AuthGuard.tsx"
    from_block: B07

commands: []

instructions: |
  1. First, add new types to types.ts:
     ```typescript
     // Add to existing types.ts file
     
     // ============================================
     // Application Workflow Types
     // ============================================
     
     export type ApplicationStatus = 
       | 'draft'           // Initial state, collecting inputs
       | 'processing'      // AI is processing
       | 'clarification'   // AI needs more info
       | 'draft_ready'     // Draft output ready for review
       | 'editing'         // User is editing draft
       | 'finalizing'      // Generating final documents
       | 'completed'       // All done
       | 'error';          // Something went wrong
     
     export type WizardStep = 
       | 'job_description'
       | 'prompts'
       | 'ai_config'
       | 'settings'
       | 'processing'
       | 'editing'
       | 'final';
     
     export interface AIModelSelection {
       provider: AIProviderName;
       model: string;
       role: 'draft' | 'final';
     }
     
     export interface ClarificationMessage {
       id: string;
       role: 'assistant' | 'user';
       content: string;
       timestamp: string;
     }
     
     export interface DraftDocument {
       type: 'cv' | 'cover_letter' | 'email';
       content: string;
       generatedAt: string;
       aiProvider: AIProviderName;
       aiModel: string;
     }
     
     export interface FinalDocuments {
       tailored_cv: string;
       cover_letter: string;
       application_email: string;
       generatedAt: string;
     }
     
     export interface JobApplication {
       id: string;
       user_id: string;
       
       // Inputs
       job_description: string;
       selected_prompt_ids: string[];
       ai_selections: AIModelSelection[];
       output_language: OutputLanguage;
       tone_setting: ToneSetting;
       
       // Processing state
       status: ApplicationStatus;
       current_step: WizardStep;
       clarification_messages: ClarificationMessage[];
       
       // Outputs
       draft_content: string | null;
       draft_documents: DraftDocument[] | null;
       edited_content: string | null;
       final_documents: FinalDocuments | null;
       
       // Metadata
       error_message: string | null;
       created_at: string;
       updated_at: string;
     }
     
     export interface CreateApplicationInput {
       job_description: string;
       selected_prompt_ids: string[];
       ai_selections: AIModelSelection[];
       output_language: OutputLanguage;
       tone_setting: ToneSetting;
     }
     ```

  2. Create application-prompts.ts:
     ```typescript
     // ============================================
     // [F127] src/lib/applications/application-prompts.ts
     // ============================================
     
     import { OutputLanguage, ToneSetting } from '@/lib/types';
     import { SUPPORTED_OUTPUT_LANGUAGES } from '@/lib/constants';
     
     export function buildSystemPrompt(
       selectedPromptTexts: string[],
       outputLanguage: OutputLanguage,
       toneSetting: ToneSetting
     ): string {
       const languageInfo = SUPPORTED_OUTPUT_LANGUAGES.find(l => l.code === outputLanguage);
       const languageName = languageInfo?.label_en || 'English';
       
       const toneInstruction = toneSetting.mode === 'preset'
         ? `Use a ${toneSetting.preset_value} tone.`
         : `Use the following tone: ${toneSetting.custom_text}`;
       
       return `You are an expert career consultant and professional CV writer.

     YOUR TASK:
     Analyze the candidate's CV and the target job description to create tailored application documents.

     SELECTED APPROACH(ES):
     ${selectedPromptTexts.map((text, i) => `--- Approach ${i + 1} ---\n${text}`).join('\n\n')}

     OUTPUT REQUIREMENTS:
     - Language: ${languageName}
     - ${toneInstruction}
     - Be professional, accurate, and compelling
     - Do not fabricate information - only use what's in the CV
     - Highlight relevant experience and skills for the specific job

     PROCESS:
     1. First, analyze both documents carefully
     2. If you need clarification about anything, ASK before proceeding
     3. Once you have all information, create the tailored content

     When ready to produce output, format it clearly with sections marked.`;
     }
     
     export function buildUserPrompt(
       cvContent: string,
       jobDescription: string
     ): string {
       return `Please analyze the following and create tailored application documents:

     ===== CANDIDATE'S CV =====
     ${cvContent}

     ===== TARGET JOB DESCRIPTION =====
     ${jobDescription}

     ===== INSTRUCTIONS =====
     1. First, tell me if you need any clarification
     2. If not, proceed to create:
        - A tailored CV for this specific job
        - A compelling cover letter
        - A professional application email

     Please begin your analysis.`;
     }
     
     export function buildClarificationPrompt(
       previousContext: string,
       userResponse: string
     ): string {
       return `${previousContext}

     User's response to your question:
     ${userResponse}

     Please continue with the analysis. If you need more clarification, ask. Otherwise, proceed to create the documents.`;
     }
     
     export function buildFinalizationPrompt(
       draftContent: string,
       userEdits: string | null,
       outputLanguage: OutputLanguage
     ): string {
       const languageInfo = SUPPORTED_OUTPUT_LANGUAGES.find(l => l.code === outputLanguage);
       const languageName = languageInfo?.label_en || 'English';
       
       const editNote = userEdits 
         ? `\n\nThe user has made the following edits/notes:\n${userEdits}`
         : '';
       
       return `Based on the analysis and draft below, please create the final polished documents.
     
     Output language: ${languageName}
     ${editNote}

     ===== DRAFT CONTENT =====
     ${draftContent}

     ===== REQUIRED OUTPUT FORMAT =====
     Please provide the final documents in this exact format:

     <<<TAILORED_CV>>>
     [The complete tailored CV here]
     <<<END_TAILORED_CV>>>

     <<<COVER_LETTER>>>
     [The complete cover letter here]
     <<<END_COVER_LETTER>>>

     <<<APPLICATION_EMAIL>>>
     [The complete application email here]
     <<<END_APPLICATION_EMAIL>>>

     Make sure each document is complete, professional, and ready to use.`;
     }
     
     export function parseFinalizationResponse(response: string): {
       tailored_cv: string;
       cover_letter: string;
       application_email: string;
     } | null {
       try {
         const cvMatch = response.match(/<<<TAILORED_CV>>>([\s\S]*?)<<<END_TAILORED_CV>>>/);
         const coverMatch = response.match(/<<<COVER_LETTER>>>([\s\S]*?)<<<END_COVER_LETTER>>>/);
         const emailMatch = response.match(/<<<APPLICATION_EMAIL>>>([\s\S]*?)<<<END_APPLICATION_EMAIL>>>/);
         
         if (!cvMatch || !coverMatch || !emailMatch) {
           return null;
         }
         
         return {
           tailored_cv: cvMatch[1].trim(),
           cover_letter: coverMatch[1].trim(),
           application_email: emailMatch[1].trim()
         };
       } catch {
         return null;
       }
     }
     
     export function detectClarificationNeeded(response: string): boolean {
       const clarificationIndicators = [
         /\?$/m,  // Ends with question mark
         /could you (please )?(clarify|explain|provide|tell)/i,
         /I need (more |additional )?(information|details|clarification)/i,
         /can you (please )?(specify|elaborate|describe)/i,
         /what (do you mean|is|are|would)/i,
         /which (one|option|role|position)/i,
         /please (clarify|explain|provide|specify)/i,
       ];
       
       return clarificationIndicators.some(pattern => pattern.test(response));
     }
     ```

  3. Create application-service.ts:
     ```typescript
     // ============================================
     // [F125] src/lib/applications/application-service.ts
     // ============================================
     
     import { SupabaseClient } from '@supabase/supabase-js';
     import { 
       JobApplication, 
       CreateApplicationInput,
       ApplicationStatus,
       WizardStep,
       ClarificationMessage 
     } from '@/lib/types';
     import { generateId } from '@/lib/utils';
     
     export class ApplicationService {
       constructor(private supabase: SupabaseClient) {}
       
       async createApplication(
         userId: string, 
         input: CreateApplicationInput
       ): Promise<JobApplication> {
         const application = {
           user_id: userId,
           job_description: input.job_description,
           selected_prompt_ids: input.selected_prompt_ids,
           ai_selections: input.ai_selections,
           output_language: input.output_language,
           tone_setting: input.tone_setting,
           status: 'draft' as ApplicationStatus,
           current_step: 'job_description' as WizardStep,
           clarification_messages: [],
           draft_content: null,
           draft_documents: null,
           edited_content: null,
           final_documents: null,
           error_message: null
         };
         
         const { data, error } = await this.supabase
           .from('job_applications')
           .insert(application)
           .select()
           .single();
         
         if (error) throw error;
         return this.mapToJobApplication(data);
       }
       
       async getApplication(id: string, userId: string): Promise<JobApplication | null> {
         const { data, error } = await this.supabase
           .from('job_applications')
           .select('*')
           .eq('id', id)
           .eq('user_id', userId)
           .single();
         
         if (error) {
           if (error.code === 'PGRST116') return null;
           throw error;
         }
         
         return this.mapToJobApplication(data);
       }
       
       async getUserApplications(userId: string): Promise<JobApplication[]> {
         const { data, error } = await this.supabase
           .from('job_applications')
           .select('*')
           .eq('user_id', userId)
           .order('created_at', { ascending: false });
         
         if (error) throw error;
         return (data || []).map(this.mapToJobApplication);
       }
       
       async updateApplication(
         id: string, 
         userId: string, 
         updates: Partial<JobApplication>
       ): Promise<JobApplication> {
         // Remove fields that shouldn't be updated directly
         const { id: _, user_id, created_at, ...validUpdates } = updates as any;
         
         const { data, error } = await this.supabase
           .from('job_applications')
           .update(validUpdates)
           .eq('id', id)
           .eq('user_id', userId)
           .select()
           .single();
         
         if (error) throw error;
         return this.mapToJobApplication(data);
       }
       
       async updateStatus(
         id: string, 
         userId: string, 
         status: ApplicationStatus,
         step?: WizardStep
       ): Promise<JobApplication> {
         const updates: any = { status };
         if (step) updates.current_step = step;
         
         return this.updateApplication(id, userId, updates);
       }
       
       async addClarificationMessage(
         id: string,
         userId: string,
         role: 'assistant' | 'user',
         content: string
       ): Promise<JobApplication> {
         const app = await this.getApplication(id, userId);
         if (!app) throw new Error('Application not found');
         
         const message: ClarificationMessage = {
           id: generateId(),
           role,
           content,
           timestamp: new Date().toISOString()
         };
         
         const messages = [...(app.clarification_messages || []), message];
         
         return this.updateApplication(id, userId, { 
           clarification_messages: messages,
           status: role === 'assistant' ? 'clarification' : 'processing'
         });
       }
       
       async saveDraftContent(
         id: string,
         userId: string,
         content: string
       ): Promise<JobApplication> {
         return this.updateApplication(id, userId, {
           draft_content: content,
           status: 'draft_ready',
           current_step: 'editing'
         });
       }
       
       async saveEditedContent(
         id: string,
         userId: string,
         content: string
       ): Promise<JobApplication> {
         return this.updateApplication(id, userId, {
           edited_content: content,
           status: 'editing'
         });
       }
       
       async saveFinalDocuments(
         id: string,
         userId: string,
         documents: {
           tailored_cv: string;
           cover_letter: string;
           application_email: string;
         }
       ): Promise<JobApplication> {
         return this.updateApplication(id, userId, {
           final_documents: {
             ...documents,
             generatedAt: new Date().toISOString()
           },
           status: 'completed',
           current_step: 'final'
         });
       }
       
       async setError(
         id: string,
         userId: string,
         errorMessage: string
       ): Promise<JobApplication> {
         return this.updateApplication(id, userId, {
           status: 'error',
           error_message: errorMessage
         });
       }
       
       async deleteApplication(id: string, userId: string): Promise<void> {
         const { error } = await this.supabase
           .from('job_applications')
           .delete()
           .eq('id', id)
           .eq('user_id', userId);
         
         if (error) throw error;
       }
       
       private mapToJobApplication(data: any): JobApplication {
         return {
           id: data.id,
           user_id: data.user_id,
           job_description: data.job_description,
           selected_prompt_ids: data.selected_prompt_ids || [],
           ai_selections: data.ai_selections || [],
           output_language: data.output_language,
           tone_setting: data.tone_setting,
           status: data.status,
           current_step: data.current_step,
           clarification_messages: data.clarification_messages || [],
           draft_content: data.draft_content,
           draft_documents: data.draft_documents,
           edited_content: data.edited_content,
           final_documents: data.final_documents,
           error_message: data.error_message,
           created_at: data.created_at,
           updated_at: data.updated_at
         };
       }
     }
     
     export function createApplicationService(supabase: SupabaseClient): ApplicationService {
       return new ApplicationService(supabase);
     }
     ```

  4. Create application-processor.ts:
     ```typescript
     // ============================================
     // [F126] src/lib/applications/application-processor.ts
     // ============================================
     
     import { getAIProvider } from '@/lib/ai';
     import { AIProviderConfig, AICompletionOptions } from '@/lib/ai/ai-provider';
     import { 
       JobApplication, 
       AIModelSelection, 
       ComprehensiveCV,
       Prompt,
       OutputLanguage,
       ToneSetting
     } from '@/lib/types';
     import {
       buildSystemPrompt,
       buildUserPrompt,
       buildClarificationPrompt,
       buildFinalizationPrompt,
       parseFinalizationResponse,
       detectClarificationNeeded
     } from './application-prompts';
     
     export interface ProcessingContext {
       application: JobApplication;
       cv: ComprehensiveCV;
       prompts: Prompt[];
       apiKeys: Record<string, string>;  // provider -> decrypted key
     }
     
     export interface ProcessingResult {
       success: boolean;
       needsClarification: boolean;
       content: string;
       error?: string;
     }
     
     export async function processApplication(
       context: ProcessingContext,
       onStream?: (chunk: string) => void
     ): Promise<ProcessingResult> {
       const { application, cv, prompts, apiKeys } = context;
       
       // Get the AI selection for draft (or first selection)
       const draftSelection = application.ai_selections.find(s => s.role === 'draft')
         || application.ai_selections[0];
       
       if (!draftSelection) {
         return { success: false, needsClarification: false, content: '', error: 'No AI model selected' };
       }
       
       const apiKey = apiKeys[draftSelection.provider];
       if (!apiKey) {
         return { success: false, needsClarification: false, content: '', error: `No API key for ${draftSelection.provider}` };
       }
       
       try {
         const provider = getAIProvider(draftSelection.provider);
         
         // Build prompts
         const promptTexts = prompts.map(p => p.prompt_text);
         const systemPrompt = buildSystemPrompt(
           promptTexts,
           application.output_language,
           application.tone_setting
         );
         
         // Build CV content string
         const cvContent = formatCVForPrompt(cv);
         const userPrompt = buildUserPrompt(cvContent, application.job_description);
         
         // Include any previous clarification context
         let messages = [
           { role: 'system' as const, content: systemPrompt },
           { role: 'user' as const, content: userPrompt }
         ];
         
         // Add clarification history if exists
         if (application.clarification_messages && application.clarification_messages.length > 0) {
           for (const msg of application.clarification_messages) {
             messages.push({
               role: msg.role as 'assistant' | 'user',
               content: msg.content
             });
           }
         }
         
         const config: AIProviderConfig = {
           apiKey,
           temperature: 0.7,
           maxTokens: 4096
         };
         
         const options: AICompletionOptions = {
           model: draftSelection.model,
           messages
         };
         
         let response: string;
         
         if (onStream) {
           response = await provider.streamComplete(config, options, onStream);
         } else {
           response = await provider.complete(config, options);
         }
         
         const needsClarification = detectClarificationNeeded(response);
         
         return {
           success: true,
           needsClarification,
           content: response
         };
         
       } catch (error: any) {
         return {
           success: false,
           needsClarification: false,
           content: '',
           error: error.message || 'Processing failed'
         };
       }
     }
     
     export async function generateFinalDocuments(
       context: ProcessingContext,
       draftContent: string,
       userEdits: string | null,
       onStream?: (chunk: string) => void
     ): Promise<{
       success: boolean;
       documents?: {
         tailored_cv: string;
         cover_letter: string;
         application_email: string;
       };
       error?: string;
     }> {
       const { application, apiKeys } = context;
       
       // Get the AI selection for final (or draft selection)
       const finalSelection = application.ai_selections.find(s => s.role === 'final')
         || application.ai_selections.find(s => s.role === 'draft')
         || application.ai_selections[0];
       
       if (!finalSelection) {
         return { success: false, error: 'No AI model selected for finalization' };
       }
       
       const apiKey = apiKeys[finalSelection.provider];
       if (!apiKey) {
         return { success: false, error: `No API key for ${finalSelection.provider}` };
       }
       
       try {
         const provider = getAIProvider(finalSelection.provider);
         
         const finalizationPrompt = buildFinalizationPrompt(
           draftContent,
           userEdits,
           application.output_language
         );
         
         const config: AIProviderConfig = {
           apiKey,
           temperature: 0.3,  // Lower temperature for consistent output
           maxTokens: 8192
         };
         
         const options: AICompletionOptions = {
           model: finalSelection.model,
           messages: [
             { role: 'user', content: finalizationPrompt }
           ]
         };
         
         let response: string;
         
         if (onStream) {
           response = await provider.streamComplete(config, options, onStream);
         } else {
           response = await provider.complete(config, options);
         }
         
         const documents = parseFinalizationResponse(response);
         
         if (!documents) {
           return { 
             success: false, 
             error: 'Failed to parse AI response into documents. The AI may not have followed the required format.'
           };
         }
         
         return { success: true, documents };
         
       } catch (error: any) {
         return {
           success: false,
           error: error.message || 'Finalization failed'
         };
       }
     }
     
     function formatCVForPrompt(cv: ComprehensiveCV): string {
       const sections: string[] = [];
       
       // Personal Info
       if (cv.personal_info) {
         const pi = cv.personal_info;
         sections.push(`PERSONAL INFORMATION:
     Name: ${pi.full_name || 'N/A'}
     Email: ${pi.email || 'N/A'}
     Phone: ${pi.phone || 'N/A'}
     Location: ${pi.location || 'N/A'}
     LinkedIn: ${pi.linkedin_url || 'N/A'}
     Website: ${pi.website_url || 'N/A'}

     Summary:
     ${pi.summary || 'N/A'}`);
       }
       
       // Work Experience
       if (cv.work_experience && cv.work_experience.length > 0) {
         const exp = cv.work_experience.map(e => 
           `- ${e.job_title} at ${e.company}
        ${e.location || ''} | ${e.start_date} - ${e.is_current ? 'Present' : e.end_date}
        ${e.description || ''}
        ${e.achievements?.length ? 'Achievements:\n' + e.achievements.map(a => `  â€¢ ${a}`).join('\n') : ''}`
         ).join('\n\n');
         sections.push(`WORK EXPERIENCE:\n${exp}`);
       }
       
       // Education
       if (cv.education && cv.education.length > 0) {
         const edu = cv.education.map(e =>
           `- ${e.degree} from ${e.institution}
        ${e.location || ''} | ${e.start_date} - ${e.end_date}${e.gpa ? ` | GPA: ${e.gpa}` : ''}
        ${e.description || ''}`
         ).join('\n\n');
         sections.push(`EDUCATION:\n${edu}`);
       }
       
       // Skills
       if (cv.skills && cv.skills.length > 0) {
         sections.push(`SKILLS:\n${cv.skills.join(', ')}`);
       }
       
       // Certifications
       if (cv.certifications && cv.certifications.length > 0) {
         const certs = cv.certifications.map(c =>
           `- ${c.name} by ${c.issuer} (${c.date_obtained})`
         ).join('\n');
         sections.push(`CERTIFICATIONS:\n${certs}`);
       }
       
       // Languages
       if (cv.languages && cv.languages.length > 0) {
         const langs = cv.languages.map(l =>
           `- ${l.language}: ${l.proficiency}`
         ).join('\n');
         sections.push(`LANGUAGES:\n${langs}`);
       }
       
       // Projects
       if (cv.projects && cv.projects.length > 0) {
         const projs = cv.projects.map(p =>
           `- ${p.name}: ${p.description}${p.url ? ` (${p.url})` : ''}`
         ).join('\n');
         sections.push(`PROJECTS:\n${projs}`);
       }
       
       return sections.join('\n\n---\n\n');
     }
     ```

  5. Create src/lib/applications/index.ts:
     ```typescript
     // ============================================
     // [F128] src/lib/applications/index.ts
     // ============================================
     
     export * from './application-service';
     export * from './application-processor';
     export * from './application-prompts';
     ```

  6. Create API route for applications list and create:
     ```typescript
     // ============================================
     // [F129] src/app/api/applications/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createApplicationService } from '@/lib/applications';
     
     // GET - List user's applications
     export async function GET(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const supabase = createServerSupabaseClient();
         const service = createApplicationService(supabase);
         
         const applications = await service.getUserApplications(userId);
         
         return NextResponse.json({ applications });
         
       } catch (error: any) {
         console.error('GET /api/applications error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to fetch applications' },
           { status: 500 }
         );
       }
     }
     
     // POST - Create new application
     export async function POST(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const body = await request.json();
         
         const {
           job_description,
           selected_prompt_ids,
           ai_selections,
           output_language,
           tone_setting
         } = body;
         
         // Validation
         if (!job_description || !selected_prompt_ids?.length || !ai_selections?.length) {
           return NextResponse.json(
             { error: 'Missing required fields' },
             { status: 400 }
           );
         }
         
         const supabase = createServerSupabaseClient();
         const service = createApplicationService(supabase);
         
         const application = await service.createApplication(userId, {
           job_description,
           selected_prompt_ids,
           ai_selections,
           output_language: output_language || 'en',
           tone_setting: tone_setting || { mode: 'preset', preset_value: 'professional', custom_text: null }
         });
         
         return NextResponse.json({ application, success: true });
         
       } catch (error: any) {
         console.error('POST /api/applications error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to create application' },
           { status: 500 }
         );
       }
     }
     ```

  7. Create API route for single application:
     ```typescript
     // ============================================
     // [F130] src/app/api/applications/[id]/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createApplicationService } from '@/lib/applications';
     
     interface RouteParams {
       params: { id: string };
     }
     
     // GET - Get single application
     export async function GET(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const supabase = createServerSupabaseClient();
         const service = createApplicationService(supabase);
         
         const application = await service.getApplication(params.id, userId);
         
         if (!application) {
           return NextResponse.json({ error: 'Not found' }, { status: 404 });
         }
         
         return NextResponse.json({ application });
         
       } catch (error: any) {
         return NextResponse.json(
           { error: error.message || 'Failed to fetch application' },
           { status: 500 }
         );
       }
     }
     
     // PUT - Update application
     export async function PUT(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const body = await request.json();
         
         const supabase = createServerSupabaseClient();
         const service = createApplicationService(supabase);
         
         const application = await service.updateApplication(params.id, userId, body);
         
         return NextResponse.json({ application, success: true });
         
       } catch (error: any) {
         return NextResponse.json(
           { error: error.message || 'Failed to update application' },
           { status: 500 }
         );
       }
     }
     
     // DELETE - Delete application
     export async function DELETE(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const supabase = createServerSupabaseClient();
         const service = createApplicationService(supabase);
         
         await service.deleteApplication(params.id, userId);
         
         return NextResponse.json({ success: true });
         
       } catch (error: any) {
         return NextResponse.json(
           { error: error.message || 'Failed to delete application' },
           { status: 500 }
         );
       }
     }
     ```

  8. Create API route for processing:
     ```typescript
     // ============================================
     // [F131] src/app/api/applications/[id]/process/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createApplicationService, processApplication } from '@/lib/applications';
     import { createPromptService } from '@/lib/prompts';
     import { createCVService } from '@/lib/cv';
     import { decryptApiKey } from '@/lib/encryption';
     
     interface RouteParams {
       params: { id: string };
     }
     
     export async function POST(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const supabase = createServerSupabaseClient();
         const appService = createApplicationService(supabase);
         const promptService = createPromptService(supabase);
         const cvService = createCVService(supabase);
         
         // Get application
         const application = await appService.getApplication(params.id, userId);
         if (!application) {
           return NextResponse.json({ error: 'Application not found' }, { status: 404 });
         }
         
         // Get user's CV
         const cv = await cvService.getCV(userId);
         if (!cv) {
           return NextResponse.json({ 
             error: 'No CV found. Please upload your CV first.' 
           }, { status: 400 });
         }
         
         // Get selected prompts
         const prompts = await promptService.getPromptsByIds(application.selected_prompt_ids);
         if (prompts.length === 0) {
           return NextResponse.json({ 
             error: 'No prompts selected' 
           }, { status: 400 });
         }
         
         // Get API keys
         const { data: keys } = await supabase
           .from('ai_api_keys')
           .select('provider_name, api_key_encrypted')
           .eq('user_id', userId);
         
         const apiKeys: Record<string, string> = {};
         for (const key of keys || []) {
           try {
             apiKeys[key.provider_name] = decryptApiKey(key.api_key_encrypted);
           } catch {}
         }
         
         // Update status to processing
         await appService.updateStatus(params.id, userId, 'processing', 'processing');
         
         // Process with AI
         const result = await processApplication({
           application,
           cv,
           prompts,
           apiKeys
         });
         
         if (!result.success) {
           await appService.setError(params.id, userId, result.error || 'Processing failed');
           return NextResponse.json({ error: result.error }, { status: 500 });
         }
         
         // Handle result
         if (result.needsClarification) {
           // Save AI's question
           await appService.addClarificationMessage(
             params.id, userId, 'assistant', result.content
           );
           
           return NextResponse.json({
             status: 'clarification',
             message: result.content,
             success: true
           });
         } else {
           // Save draft
           await appService.saveDraftContent(params.id, userId, result.content);
           
           return NextResponse.json({
             status: 'draft_ready',
             content: result.content,
             success: true
           });
         }
         
       } catch (error: any) {
         console.error('POST /api/applications/[id]/process error:', error);
         return NextResponse.json(
           { error: error.message || 'Processing failed' },
           { status: 500 }
         );
       }
     }
     ```

  9. Create API route for clarification:
     ```typescript
     // ============================================
     // [F132] src/app/api/applications/[id]/clarify/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createApplicationService, processApplication } from '@/lib/applications';
     import { createPromptService } from '@/lib/prompts';
     import { createCVService } from '@/lib/cv';
     import { decryptApiKey } from '@/lib/encryption';
     
     interface RouteParams {
       params: { id: string };
     }
     
     export async function POST(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const { response: userResponse } = await request.json();
         if (!userResponse) {
           return NextResponse.json({ error: 'Response is required' }, { status: 400 });
         }
         
         const supabase = createServerSupabaseClient();
         const appService = createApplicationService(supabase);
         const promptService = createPromptService(supabase);
         const cvService = createCVService(supabase);
         
         // Add user's response
         let application = await appService.addClarificationMessage(
           params.id, userId, 'user', userResponse
         );
         
         // Get updated application with all messages
         application = await appService.getApplication(params.id, userId);
         if (!application) {
           return NextResponse.json({ error: 'Application not found' }, { status: 404 });
         }
         
         // Get CV and prompts
         const cv = await cvService.getCV(userId);
         if (!cv) {
           return NextResponse.json({ error: 'CV not found' }, { status: 400 });
         }
         
         const prompts = await promptService.getPromptsByIds(application.selected_prompt_ids);
         
         // Get API keys
         const { data: keys } = await supabase
           .from('ai_api_keys')
           .select('provider_name, api_key_encrypted')
           .eq('user_id', userId);
         
         const apiKeys: Record<string, string> = {};
         for (const key of keys || []) {
           try {
             apiKeys[key.provider_name] = decryptApiKey(key.api_key_encrypted);
           } catch {}
         }
         
         // Continue processing
         const result = await processApplication({
           application,
           cv,
           prompts,
           apiKeys
         });
         
         if (!result.success) {
           await appService.setError(params.id, userId, result.error || 'Processing failed');
           return NextResponse.json({ error: result.error }, { status: 500 });
         }
         
         if (result.needsClarification) {
           await appService.addClarificationMessage(
             params.id, userId, 'assistant', result.content
           );
           
           return NextResponse.json({
             status: 'clarification',
             message: result.content,
             success: true
           });
         } else {
           await appService.saveDraftContent(params.id, userId, result.content);
           
           return NextResponse.json({
             status: 'draft_ready',
             content: result.content,
             success: true
           });
         }
         
       } catch (error: any) {
         console.error('POST /api/applications/[id]/clarify error:', error);
         return NextResponse.json(
           { error: error.message || 'Clarification failed' },
           { status: 500 }
         );
       }
     }
     ```

  10. Create API route for finalization:
      ```typescript
      // ============================================
      // [F133] src/app/api/applications/[id]/finalize/route.ts
      // ============================================
      
      import { NextRequest, NextResponse } from 'next/server';
      import { createServerSupabaseClient } from '@/lib/supabase/server';
      import { createApplicationService, generateFinalDocuments } from '@/lib/applications';
      import { createPromptService } from '@/lib/prompts';
      import { createCVService } from '@/lib/cv';
      import { decryptApiKey } from '@/lib/encryption';
      
      interface RouteParams {
        params: { id: string };
      }
      
      export async function POST(request: NextRequest, { params }: RouteParams) {
        try {
          const userId = request.headers.get('x-user-id');
          if (!userId) {
            return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
          }
          
          const { edited_content } = await request.json();
          
          const supabase = createServerSupabaseClient();
          const appService = createApplicationService(supabase);
          const promptService = createPromptService(supabase);
          const cvService = createCVService(supabase);
          
          // Get application
          const application = await appService.getApplication(params.id, userId);
          if (!application) {
            return NextResponse.json({ error: 'Application not found' }, { status: 404 });
          }
          
          if (!application.draft_content) {
            return NextResponse.json({ error: 'No draft content to finalize' }, { status: 400 });
          }
          
          // Update status
          await appService.updateStatus(params.id, userId, 'finalizing');
          
          // Save edited content if provided
          if (edited_content) {
            await appService.saveEditedContent(params.id, userId, edited_content);
          }
          
          // Get CV
          const cv = await cvService.getCV(userId);
          if (!cv) {
            return NextResponse.json({ error: 'CV not found' }, { status: 400 });
          }
          
          // Get prompts
          const prompts = await promptService.getPromptsByIds(application.selected_prompt_ids);
          
          // Get API keys
          const { data: keys } = await supabase
            .from('ai_api_keys')
            .select('provider_name, api_key_encrypted')
            .eq('user_id', userId);
          
          const apiKeys: Record<string, string> = {};
          for (const key of keys || []) {
            try {
              apiKeys[key.provider_name] = decryptApiKey(key.api_key_encrypted);
            } catch {}
          }
          
          // Generate final documents
          const result = await generateFinalDocuments(
            { application, cv, prompts, apiKeys },
            application.draft_content,
            edited_content || application.edited_content
          );
          
          if (!result.success) {
            await appService.setError(params.id, userId, result.error || 'Finalization failed');
            return NextResponse.json({ error: result.error }, { status: 500 });
          }
          
          // Save final documents
          await appService.saveFinalDocuments(params.id, userId, result.documents!);
          
          return NextResponse.json({
            status: 'completed',
            documents: result.documents,
            success: true
          });
          
        } catch (error: any) {
          console.error('POST /api/applications/[id]/finalize error:', error);
          return NextResponse.json(
            { error: error.message || 'Finalization failed' },
            { status: 500 }
          );
        }
      }
      ```

  11. Create useApplication hook:
      ```typescript
      // ============================================
      // [F084] src/hooks/useApplication.ts
      // ============================================
      
      'use client';
      
      import { useState, useCallback } from 'react';
      import { useAuth } from '@/context/AuthContext';
      import {
        JobApplication,
        CreateApplicationInput,
        WizardStep,
        AIModelSelection,
        OutputLanguage,
        ToneSetting
      } from '@/lib/types';
      
      interface UseApplicationReturn {
        application: JobApplication | null;
        loading: boolean;
        processing: boolean;
        error: string | null;
        
        // Wizard state
        currentStep: WizardStep;
        setCurrentStep: (step: WizardStep) => void;
        
        // Form state
        jobDescription: string;
        setJobDescription: (value: string) => void;
        selectedPromptIds: string[];
        setSelectedPromptIds: (ids: string[]) => void;
        aiSelections: AIModelSelection[];
        setAISelections: (selections: AIModelSelection[]) => void;
        outputLanguage: OutputLanguage;
        setOutputLanguage: (lang: OutputLanguage) => void;
        toneSetting: ToneSetting;
        setToneSetting: (tone: ToneSetting) => void;
        
        // Actions
        createApplication: () => Promise<JobApplication>;
        loadApplication: (id: string) => Promise<void>;
        startProcessing: () => Promise<void>;
        sendClarification: (response: string) => Promise<void>;
        updateDraft: (content: string) => void;
        finalize: () => Promise<void>;
        reset: () => void;
        
        // Computed
        canProceedToNext: boolean;
        draftContent: string | null;
        clarificationMessages: Array<{ role: string; content: string }>;
        finalDocuments: {
          tailored_cv: string;
          cover_letter: string;
          application_email: string;
        } | null;
      }
      
      const initialToneSetting: ToneSetting = {
        mode: 'preset',
        preset_value: 'professional',
        custom_text: null
      };
      
      export function useApplication(): UseApplicationReturn {
        const { user } = useAuth();
        
        // Application state
        const [application, setApplication] = useState<JobApplication | null>(null);
        const [loading, setLoading] = useState(false);
        const [processing, setProcessing] = useState(false);
        const [error, setError] = useState<string | null>(null);
        
        // Wizard state
        const [currentStep, setCurrentStep] = useState<WizardStep>('job_description');
        
        // Form state
        const [jobDescription, setJobDescription] = useState('');
        const [selectedPromptIds, setSelectedPromptIds] = useState<string[]>([]);
        const [aiSelections, setAISelections] = useState<AIModelSelection[]>([]);
        const [outputLanguage, setOutputLanguage] = useState<OutputLanguage>('en');
        const [toneSetting, setToneSetting] = useState<ToneSetting>(initialToneSetting);
        
        // Draft state (local)
        const [localDraftContent, setLocalDraftContent] = useState<string | null>(null);
        
        const createApplication = useCallback(async (): Promise<JobApplication> => {
          if (!user) throw new Error('Not authenticated');
          
          setLoading(true);
          setError(null);
          
          try {
            const res = await fetch('/api/applications', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'x-user-id': user.id
              },
              body: JSON.stringify({
                job_description: jobDescription,
                selected_prompt_ids: selectedPromptIds,
                ai_selections: aiSelections,
                output_language: outputLanguage,
                tone_setting: toneSetting
              })
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            setApplication(data.application);
            return data.application;
            
          } catch (err: any) {
            setError(err.message);
            throw err;
          } finally {
            setLoading(false);
          }
        }, [user, jobDescription, selectedPromptIds, aiSelections, outputLanguage, toneSetting]);
        
        const loadApplication = useCallback(async (id: string) => {
          if (!user) return;
          
          setLoading(true);
          setError(null);
          
          try {
            const res = await fetch(`/api/applications/${id}`, {
              headers: { 'x-user-id': user.id }
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            const app = data.application;
            setApplication(app);
            
            // Restore form state from application
            setJobDescription(app.job_description);
            setSelectedPromptIds(app.selected_prompt_ids);
            setAISelections(app.ai_selections);
            setOutputLanguage(app.output_language);
            setToneSetting(app.tone_setting);
            setCurrentStep(app.current_step);
            setLocalDraftContent(app.draft_content);
            
          } catch (err: any) {
            setError(err.message);
          } finally {
            setLoading(false);
          }
        }, [user]);
        
        const startProcessing = useCallback(async () => {
          if (!user || !application) return;
          
          setProcessing(true);
          setError(null);
          setCurrentStep('processing');
          
          try {
            const res = await fetch(`/api/applications/${application.id}/process`, {
              method: 'POST',
              headers: { 'x-user-id': user.id }
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            if (data.status === 'clarification') {
              setApplication(prev => prev ? {
                ...prev,
                status: 'clarification',
                clarification_messages: [
                  ...(prev.clarification_messages || []),
                  { id: Date.now().toString(), role: 'assistant', content: data.message, timestamp: new Date().toISOString() }
                ]
              } : null);
            } else if (data.status === 'draft_ready') {
              setLocalDraftContent(data.content);
              setApplication(prev => prev ? {
                ...prev,
                status: 'draft_ready',
                draft_content: data.content,
                current_step: 'editing'
              } : null);
              setCurrentStep('editing');
            }
            
          } catch (err: any) {
            setError(err.message);
          } finally {
            setProcessing(false);
          }
        }, [user, application]);
        
        const sendClarification = useCallback(async (response: string) => {
          if (!user || !application) return;
          
          setProcessing(true);
          setError(null);
          
          // Optimistically add user message
          setApplication(prev => prev ? {
            ...prev,
            clarification_messages: [
              ...(prev.clarification_messages || []),
              { id: Date.now().toString(), role: 'user', content: response, timestamp: new Date().toISOString() }
            ]
          } : null);
          
          try {
            const res = await fetch(`/api/applications/${application.id}/clarify`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'x-user-id': user.id
              },
              body: JSON.stringify({ response })
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            if (data.status === 'clarification') {
              setApplication(prev => prev ? {
                ...prev,
                clarification_messages: [
                  ...(prev.clarification_messages || []),
                  { id: Date.now().toString(), role: 'assistant', content: data.message, timestamp: new Date().toISOString() }
                ]
              } : null);
            } else if (data.status === 'draft_ready') {
              setLocalDraftContent(data.content);
              setApplication(prev => prev ? {
                ...prev,
                status: 'draft_ready',
                draft_content: data.content,
                current_step: 'editing'
              } : null);
              setCurrentStep('editing');
            }
            
          } catch (err: any) {
            setError(err.message);
          } finally {
            setProcessing(false);
          }
        }, [user, application]);
        
        const updateDraft = useCallback((content: string) => {
          setLocalDraftContent(content);
        }, []);
        
        const finalize = useCallback(async () => {
          if (!user || !application) return;
          
          setProcessing(true);
          setError(null);
          
          try {
            const res = await fetch(`/api/applications/${application.id}/finalize`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'x-user-id': user.id
              },
              body: JSON.stringify({
                edited_content: localDraftContent
              })
            });
            
            const data = await res.json();
            if (data.error) throw new Error(data.error);
            
            setApplication(prev => prev ? {
              ...prev,
              status: 'completed',
              current_step: 'final',
              final_documents: {
                ...data.documents,
                generatedAt: new Date().toISOString()
              }
            } : null);
            setCurrentStep('final');
            
          } catch (err: any) {
            setError(err.message);
          } finally {
            setProcessing(false);
          }
        }, [user, application, localDraftContent]);
        
        const reset = useCallback(() => {
          setApplication(null);
          setCurrentStep('job_description');
          setJobDescription('');
          setSelectedPromptIds([]);
          setAISelections([]);
          setOutputLanguage('en');
          setToneSetting(initialToneSetting);
          setLocalDraftContent(null);
          setError(null);
        }, []);
        
        // Computed
        const canProceedToNext = (() => {
          switch (currentStep) {
            case 'job_description':
              return jobDescription.trim().length > 50;
            case 'prompts':
              return selectedPromptIds.length > 0;
            case 'ai_config':
              return aiSelections.length > 0;
            case 'settings':
              return true;
            default:
              return false;
          }
        })();
        
        return {
          application,
          loading,
          processing,
          error,
          currentStep,
          setCurrentStep,
          jobDescription,
          setJobDescription,
          selectedPromptIds,
          setSelectedPromptIds,
          aiSelections,
          setAISelections,
          outputLanguage,
          setOutputLanguage,
          toneSetting,
          setToneSetting,
          createApplication,
          loadApplication,
          startProcessing,
          sendClarification,
          updateDraft,
          finalize,
          reset,
          canProceedToNext,
          draftContent: localDraftContent,
          clarificationMessages: application?.clarification_messages || [],
          finalDocuments: application?.final_documents || null
        };
      }
      ```

  12. Create WizardProgress.tsx:
      ```typescript
      // ============================================
      // [F135] src/components/application/WizardProgress.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { WizardStep } from '@/lib/types';
      import { cn } from '@/lib/utils';
      import { Check, FileText, Sparkles, Settings, Loader2, Edit, Download } from 'lucide-react';
      
      interface WizardProgressProps {
        currentStep: WizardStep;
        completedSteps: WizardStep[];
        onStepClick?: (step: WizardStep) => void;
        className?: string;
      }
      
      const STEPS: { key: WizardStep; icon: React.ElementType }[] = [
        { key: 'job_description', icon: FileText },
        { key: 'prompts', icon: Sparkles },
        { key: 'ai_config', icon: Settings },
        { key: 'settings', icon: Settings },
        { key: 'processing', icon: Loader2 },
        { key: 'editing', icon: Edit },
        { key: 'final', icon: Download }
      ];
      
      export function WizardProgress({
        currentStep,
        completedSteps,
        onStepClick,
        className
      }: WizardProgressProps) {
        const t = useTranslations('application');
        
        const currentIndex = STEPS.findIndex(s => s.key === currentStep);
        
        return (
          <div className={cn('flex items-center justify-between', className)}>
            {STEPS.map((step, index) => {
              const Icon = step.icon;
              const isCompleted = completedSteps.includes(step.key);
              const isCurrent = step.key === currentStep;
              const isClickable = isCompleted && onStepClick;
              
              return (
                <div key={step.key} className="flex items-center">
                  {/* Step circle */}
                  <button
                    onClick={() => isClickable && onStepClick(step.key)}
                    disabled={!isClickable}
                    className={cn(
                      'flex items-center justify-center w-10 h-10 rounded-full border-2 transition-all',
                      isCompleted && 'bg-primary border-primary text-primary-foreground',
                      isCurrent && !isCompleted && 'border-primary text-primary',
                      !isCompleted && !isCurrent && 'border-muted-foreground/30 text-muted-foreground',
                      isClickable && 'cursor-pointer hover:scale-105'
                    )}
                  >
                    {isCompleted ? (
                      <Check className="h-5 w-5" />
                    ) : (
                      <Icon className={cn('h-5 w-5', isCurrent && step.key === 'processing' && 'animate-spin')} />
                    )}
                  </button>
                  
                  {/* Connector line */}
                  {index < STEPS.length - 1 && (
                    <div className={cn(
                      'w-full h-0.5 mx-2 min-w-[20px] max-w-[60px]',
                      index < currentIndex ? 'bg-primary' : 'bg-muted-foreground/30'
                    )} />
                  )}
                </div>
              );
            })}
          </div>
        );
      }
      ```

  13. Create JobDescriptionInput.tsx:
      ```typescript
      // ============================================
      // [F054] src/components/application/JobDescriptionInput.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Textarea } from '@/components/ui/textarea';
      import { Badge } from '@/components/ui/badge';
      import { FileText, AlertCircle } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface JobDescriptionInputProps {
        value: string;
        onChange: (value: string) => void;
        minLength?: number;
        disabled?: boolean;
        className?: string;
      }
      
      export function JobDescriptionInput({
        value,
        onChange,
        minLength = 50,
        disabled = false,
        className
      }: JobDescriptionInputProps) {
        const t = useTranslations('application');
        
        const charCount = value.length;
        const wordCount = value.trim().split(/\s+/).filter(Boolean).length;
        const isValid = charCount >= minLength;
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <FileText className="h-5 w-5" />
                {t('job_description_title')}
              </CardTitle>
              <CardDescription>
                {t('job_description_hint')}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <Textarea
                value={value}
                onChange={(e) => onChange(e.target.value)}
                placeholder={t('job_description_placeholder')}
                rows={12}
                disabled={disabled}
                className="resize-none font-mono text-sm"
                dir="auto"
              />
              
              <div className="flex items-center justify-between text-sm">
                <div className="flex items-center gap-4 text-muted-foreground">
                  <span>{t('characters')}: {charCount}</span>
                  <span>{t('words')}: {wordCount}</span>
                </div>
                
                {!isValid && charCount > 0 && (
                  <Badge variant="outline" className="text-yellow-600 border-yellow-300">
                    <AlertCircle className="h-3 w-3 mr-1" />
                    {t('min_chars_required', { count: minLength })}
                  </Badge>
                )}
                
                {isValid && (
                  <Badge variant="outline" className="text-green-600 border-green-300">
                    {t('ready')}
                  </Badge>
                )}
              </div>
            </CardContent>
          </Card>
        );
      }
      ```

  14. Create LanguageSelector.tsx:
      ```typescript
      // ============================================
      // [F056] src/components/application/LanguageSelector.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { useParams } from 'next/navigation';
      import { OutputLanguage } from '@/lib/types';
      import { SUPPORTED_OUTPUT_LANGUAGES } from '@/lib/constants';
      import { Label } from '@/components/ui/label';
      import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
      import { cn } from '@/lib/utils';
      
      interface LanguageSelectorProps {
        value: OutputLanguage;
        onChange: (value: OutputLanguage) => void;
        disabled?: boolean;
        className?: string;
      }
      
      export function LanguageSelector({
        value,
        onChange,
        disabled = false,
        className
      }: LanguageSelectorProps) {
        const t = useTranslations('application');
        const params = useParams();
        const locale = params.locale as 'en' | 'fa';
        
        return (
          <div className={cn('space-y-3', className)}>
            <Label>{t('output_language')}</Label>
            <RadioGroup
              value={value}
              onValueChange={(v) => onChange(v as OutputLanguage)}
              disabled={disabled}
              className="grid grid-cols-2 md:grid-cols-4 gap-3"
            >
              {SUPPORTED_OUTPUT_LANGUAGES.map((lang) => (
                <div key={lang.code}>
                  <RadioGroupItem
                    value={lang.code}
                    id={`lang-${lang.code}`}
                    className="peer sr-only"
                  />
                  <Label
                    htmlFor={`lang-${lang.code}`}
                    className={cn(
                      'flex items-center justify-center px-3 py-2 border rounded-lg cursor-pointer',
                      'peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5',
                      'hover:bg-muted transition-colors',
                      disabled && 'opacity-50 cursor-not-allowed'
                    )}
                  >
                    {locale === 'fa' ? lang.label_fa : lang.label_en}
                  </Label>
                </div>
              ))}
            </RadioGroup>
          </div>
        );
      }
      ```

  15. Create ToneSelector.tsx:
      ```typescript
      // ============================================
      // [F055] src/components/application/ToneSelector.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { useParams } from 'next/navigation';
      import { ToneSetting } from '@/lib/types';
      import { TONE_PRESETS } from '@/lib/constants';
      import { Label } from '@/components/ui/label';
      import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
      import { Textarea } from '@/components/ui/textarea';
      import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
      import { cn } from '@/lib/utils';
      
      interface ToneSelectorProps {
        value: ToneSetting;
        onChange: (value: ToneSetting) => void;
        disabled?: boolean;
        className?: string;
      }
      
      export function ToneSelector({
        value,
        onChange,
        disabled = false,
        className
      }: ToneSelectorProps) {
        const t = useTranslations('application');
        const params = useParams();
        const locale = params.locale as 'en' | 'fa';
        
        const handleModeChange = (mode: 'preset' | 'custom') => {
          onChange({
            mode,
            preset_value: mode === 'preset' ? (value.preset_value || 'professional') : null,
            custom_text: mode === 'custom' ? (value.custom_text || '') : null
          });
        };
        
        const handlePresetChange = (preset: string) => {
          onChange({
            ...value,
            mode: 'preset',
            preset_value: preset
          });
        };
        
        const handleCustomChange = (text: string) => {
          onChange({
            ...value,
            mode: 'custom',
            custom_text: text
          });
        };
        
        return (
          <div className={cn('space-y-3', className)}>
            <Label>{t('response_tone')}</Label>
            
            <Tabs 
              value={value.mode} 
              onValueChange={(v) => handleModeChange(v as 'preset' | 'custom')}
            >
              <TabsList className="grid w-full grid-cols-2">
                <TabsTrigger value="preset" disabled={disabled}>
                  {t('tone_preset')}
                </TabsTrigger>
                <TabsTrigger value="custom" disabled={disabled}>
                  {t('tone_custom')}
                </TabsTrigger>
              </TabsList>
              
              <TabsContent value="preset" className="mt-4">
                <RadioGroup
                  value={value.preset_value || 'professional'}
                  onValueChange={handlePresetChange}
                  disabled={disabled}
                  className="grid grid-cols-2 md:grid-cols-3 gap-3"
                >
                  {TONE_PRESETS.map((tone) => (
                    <div key={tone.value}>
                      <RadioGroupItem
                        value={tone.value}
                        id={`tone-${tone.value}`}
                        className="peer sr-only"
                      />
                      <Label
                        htmlFor={`tone-${tone.value}`}
                        className={cn(
                          'flex items-center justify-center px-3 py-2 border rounded-lg cursor-pointer',
                          'peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5',
                          'hover:bg-muted transition-colors',
                          disabled && 'opacity-50 cursor-not-allowed'
                        )}
                      >
                        {locale === 'fa' ? tone.label_fa : tone.label_en}
                      </Label>
                    </div>
                  ))}
                </RadioGroup>
              </TabsContent>
              
              <TabsContent value="custom" className="mt-4">
                <Textarea
                  value={value.custom_text || ''}
                  onChange={(e) => handleCustomChange(e.target.value)}
                  placeholder={t('tone_custom_placeholder')}
                  rows={3}
                  disabled={disabled}
                  dir="auto"
                />
                <p className="text-xs text-muted-foreground mt-2">
                  {t('tone_custom_hint')}
                </p>
              </TabsContent>
            </Tabs>
          </div>
        );
      }
      ```

  (Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø± Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ÛŒ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø·ÙˆÙ„...)
# Ø§Ø¯Ø§Ù…Ù‡ B18.yaml - ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡

  16. Create PromptSelectionStep.tsx:
      ```typescript
      // ============================================
      // [F136] src/components/application/PromptSelectionStep.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { PromptSelector } from '@/components/prompts/PromptSelector';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Sparkles } from 'lucide-react';
      
      interface PromptSelectionStepProps {
        selectedIds: string[];
        onSelectionChange: (ids: string[]) => void;
        disabled?: boolean;
        className?: string;
      }
      
      export function PromptSelectionStep({
        selectedIds,
        onSelectionChange,
        disabled = false,
        className
      }: PromptSelectionStepProps) {
        const t = useTranslations('application');
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Sparkles className="h-5 w-5" />
                {t('select_prompts_title')}
              </CardTitle>
              <CardDescription>
                {t('select_prompts_description')}
              </CardDescription>
            </CardHeader>
            <CardContent>
              <PromptSelector
                selectedIds={selectedIds}
                onSelectionChange={onSelectionChange}
                maxSelection={null}
              />
            </CardContent>
          </Card>
        );
      }
      ```

  17. Create AIConfigurationStep.tsx:
      ```typescript
      // ============================================
      // [F137] src/components/application/AIConfigurationStep.tsx
      // ============================================
      
      'use client';
      
      import { useState } from 'react';
      import { useTranslations } from 'next-intl';
      import { useParams } from 'next/navigation';
      import { useAIKeys } from '@/hooks/useAIKeys';
      import { AIModelSelection, AIProviderName } from '@/lib/types';
      import { SUPPORTED_AI_PROVIDERS } from '@/lib/constants';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Label } from '@/components/ui/label';
      import { Badge } from '@/components/ui/badge';
      import { Button } from '@/components/ui/button';
      import {
        Select,
        SelectContent,
        SelectItem,
        SelectTrigger,
        SelectValue,
      } from '@/components/ui/select';
      import { Switch } from '@/components/ui/switch';
      import { 
        Settings, CheckCircle, AlertCircle, Plus, Trash2, Cpu 
      } from 'lucide-react';
      import { cn } from '@/lib/utils';
      import Link from 'next/link';
      
      interface AIConfigurationStepProps {
        selections: AIModelSelection[];
        onSelectionsChange: (selections: AIModelSelection[]) => void;
        disabled?: boolean;
        className?: string;
      }
      
      export function AIConfigurationStep({
        selections,
        onSelectionsChange,
        disabled = false,
        className
      }: AIConfigurationStepProps) {
        const t = useTranslations('application');
        const params = useParams();
        const locale = params.locale as 'en' | 'fa';
        
        const { keys, loading, hasValidKey, getModelsForProvider, getValidProviders } = useAIKeys();
        
        const [useSeparateFinal, setUseSeparateFinal] = useState(
          selections.some(s => s.role === 'final')
        );
        
        const validProviders = getValidProviders();
        const hasAnyValidKey = validProviders.length > 0;
        
        // Get current draft and final selections
        const draftSelection = selections.find(s => s.role === 'draft');
        const finalSelection = selections.find(s => s.role === 'final');
        
        const updateSelection = (role: 'draft' | 'final', provider: AIProviderName | null, model: string | null) => {
          let newSelections = selections.filter(s => s.role !== role);
          
          if (provider && model) {
            newSelections.push({ provider, model, role });
          }
          
          onSelectionsChange(newSelections);
        };
        
        const handleUseSeparateFinalChange = (checked: boolean) => {
          setUseSeparateFinal(checked);
          if (!checked) {
            // Remove final selection
            onSelectionsChange(selections.filter(s => s.role !== 'final'));
          }
        };
        
        if (loading) {
          return (
            <Card className={className}>
              <CardContent className="py-8">
                <div className="flex items-center justify-center">
                  <div className="animate-spin h-8 w-8 border-2 border-primary border-t-transparent rounded-full" />
                </div>
              </CardContent>
            </Card>
          );
        }
        
        if (!hasAnyValidKey) {
          return (
            <Card className={className}>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Settings className="h-5 w-5" />
                  {t('ai_config_title')}
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="flex flex-col items-center justify-center py-8 text-center">
                  <AlertCircle className="h-12 w-12 text-yellow-500 mb-4" />
                  <h3 className="text-lg font-medium mb-2">{t('no_ai_keys')}</h3>
                  <p className="text-muted-foreground mb-4">{t('no_ai_keys_hint')}</p>
                  <Link href={`/${locale}/settings`}>
                    <Button>
                      <Settings className="h-4 w-4 mr-2" />
                      {t('go_to_settings')}
                    </Button>
                  </Link>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Cpu className="h-5 w-5" />
                {t('ai_config_title')}
              </CardTitle>
              <CardDescription>
                {t('ai_config_description')}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              
              {/* Draft AI Selection */}
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <Label className="text-base font-medium">
                    {t('draft_ai')}
                  </Label>
                  <Badge variant="outline">{t('required')}</Badge>
                </div>
                <p className="text-sm text-muted-foreground">
                  {t('draft_ai_hint')}
                </p>
                
                <div className="grid grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label>{t('provider')}</Label>
                    <Select
                      value={draftSelection?.provider || ''}
                      onValueChange={(v) => {
                        updateSelection('draft', v as AIProviderName, '');
                      }}
                      disabled={disabled}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder={t('select_provider')} />
                      </SelectTrigger>
                      <SelectContent>
                        {SUPPORTED_AI_PROVIDERS.map((provider) => {
                          const isValid = hasValidKey(provider.name);
                          return (
                            <SelectItem
                              key={provider.name}
                              value={provider.name}
                              disabled={!isValid}
                            >
                              <div className="flex items-center gap-2">
                                {isValid ? (
                                  <CheckCircle className="h-3 w-3 text-green-500" />
                                ) : (
                                  <AlertCircle className="h-3 w-3 text-muted-foreground" />
                                )}
                                {provider.label}
                              </div>
                            </SelectItem>
                          );
                        })}
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div className="space-y-2">
                    <Label>{t('model')}</Label>
                    <Select
                      value={draftSelection?.model || ''}
                      onValueChange={(v) => {
                        if (draftSelection?.provider) {
                          updateSelection('draft', draftSelection.provider, v);
                        }
                      }}
                      disabled={disabled || !draftSelection?.provider}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder={t('select_model')} />
                      </SelectTrigger>
                      <SelectContent>
                        {draftSelection?.provider && 
                          getModelsForProvider(draftSelection.provider).map((model) => (
                            <SelectItem key={model.model_id} value={model.model_id}>
                              {model.model_name}
                            </SelectItem>
                          ))
                        }
                      </SelectContent>
                    </Select>
                  </div>
                </div>
              </div>
              
              {/* Separator */}
              <div className="border-t pt-6">
                <div className="flex items-center justify-between mb-4">
                  <div>
                    <Label className="text-base font-medium">
                      {t('use_different_final')}
                    </Label>
                    <p className="text-sm text-muted-foreground">
                      {t('use_different_final_hint')}
                    </p>
                  </div>
                  <Switch
                    checked={useSeparateFinal}
                    onCheckedChange={handleUseSeparateFinalChange}
                    disabled={disabled}
                  />
                </div>
                
                {/* Final AI Selection */}
                {useSeparateFinal && (
                  <div className="space-y-4 mt-4 p-4 bg-muted/50 rounded-lg">
                    <Label className="text-base font-medium">
                      {t('final_ai')}
                    </Label>
                    <p className="text-sm text-muted-foreground">
                      {t('final_ai_hint')}
                    </p>
                    
                    <div className="grid grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>{t('provider')}</Label>
                        <Select
                          value={finalSelection?.provider || ''}
                          onValueChange={(v) => {
                            updateSelection('final', v as AIProviderName, '');
                          }}
                          disabled={disabled}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder={t('select_provider')} />
                          </SelectTrigger>
                          <SelectContent>
                            {SUPPORTED_AI_PROVIDERS.map((provider) => {
                              const isValid = hasValidKey(provider.name);
                              return (
                                <SelectItem
                                  key={provider.name}
                                  value={provider.name}
                                  disabled={!isValid}
                                >
                                  <div className="flex items-center gap-2">
                                    {isValid ? (
                                      <CheckCircle className="h-3 w-3 text-green-500" />
                                    ) : (
                                      <AlertCircle className="h-3 w-3 text-muted-foreground" />
                                    )}
                                    {provider.label}
                                  </div>
                                </SelectItem>
                              );
                            })}
                          </SelectContent>
                        </Select>
                      </div>
                      
                      <div className="space-y-2">
                        <Label>{t('model')}</Label>
                        <Select
                          value={finalSelection?.model || ''}
                          onValueChange={(v) => {
                            if (finalSelection?.provider) {
                              updateSelection('final', finalSelection.provider, v);
                            }
                          }}
                          disabled={disabled || !finalSelection?.provider}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder={t('select_model')} />
                          </SelectTrigger>
                          <SelectContent>
                            {finalSelection?.provider && 
                              getModelsForProvider(finalSelection.provider).map((model) => (
                                <SelectItem key={model.model_id} value={model.model_id}>
                                  {model.model_name}
                                </SelectItem>
                              ))
                            }
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>
                )}
              </div>
              
              {/* Summary */}
              {(draftSelection?.model || finalSelection?.model) && (
                <div className="border-t pt-4">
                  <Label className="text-sm text-muted-foreground mb-2 block">
                    {t('config_summary')}
                  </Label>
                  <div className="flex flex-wrap gap-2">
                    {draftSelection?.model && (
                      <Badge variant="secondary">
                        {t('draft')}: {draftSelection.provider} / {draftSelection.model}
                      </Badge>
                    )}
                    {finalSelection?.model && (
                      <Badge variant="secondary">
                        {t('final')}: {finalSelection.provider} / {finalSelection.model}
                      </Badge>
                    )}
                  </div>
                </div>
              )}
              
            </CardContent>
          </Card>
        );
      }
      ```

  18. Create OutputSettingsStep.tsx:
      ```typescript
      // ============================================
      // [F138] src/components/application/OutputSettingsStep.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { OutputLanguage, ToneSetting } from '@/lib/types';
      import { LanguageSelector } from './LanguageSelector';
      import { ToneSelector } from './ToneSelector';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Settings2 } from 'lucide-react';
      
      interface OutputSettingsStepProps {
        outputLanguage: OutputLanguage;
        onOutputLanguageChange: (lang: OutputLanguage) => void;
        toneSetting: ToneSetting;
        onToneSettingChange: (tone: ToneSetting) => void;
        disabled?: boolean;
        className?: string;
      }
      
      export function OutputSettingsStep({
        outputLanguage,
        onOutputLanguageChange,
        toneSetting,
        onToneSettingChange,
        disabled = false,
        className
      }: OutputSettingsStepProps) {
        const t = useTranslations('application');
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Settings2 className="h-5 w-5" />
                {t('output_settings_title')}
              </CardTitle>
              <CardDescription>
                {t('output_settings_description')}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-8">
              <LanguageSelector
                value={outputLanguage}
                onChange={onOutputLanguageChange}
                disabled={disabled}
              />
              
              <ToneSelector
                value={toneSetting}
                onChange={onToneSettingChange}
                disabled={disabled}
              />
            </CardContent>
          </Card>
        );
      }
      ```

  19. Create AIChatInterface.tsx:
      ```typescript
      // ============================================
      // [F052] src/components/ai/AIChatInterface.tsx
      // ============================================
      
      'use client';
      
      import { useState, useRef, useEffect } from 'react';
      import { useTranslations } from 'next-intl';
      import { ClarificationMessage } from '@/lib/types';
      import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
      import { Button } from '@/components/ui/button';
      import { Textarea } from '@/components/ui/textarea';
      import { ScrollArea } from '@/components/ui/scroll-area';
      import { Avatar, AvatarFallback } from '@/components/ui/avatar';
      import { MessageSquare, Send, Loader2, Bot, User } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface AIChatInterfaceProps {
        messages: ClarificationMessage[];
        onSendMessage: (message: string) => void;
        isProcessing?: boolean;
        disabled?: boolean;
        className?: string;
      }
      
      export function AIChatInterface({
        messages,
        onSendMessage,
        isProcessing = false,
        disabled = false,
        className
      }: AIChatInterfaceProps) {
        const t = useTranslations('application');
        const [input, setInput] = useState('');
        const scrollRef = useRef<HTMLDivElement>(null);
        const textareaRef = useRef<HTMLTextAreaElement>(null);
        
        // Scroll to bottom when messages change
        useEffect(() => {
          if (scrollRef.current) {
            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
          }
        }, [messages]);
        
        const handleSend = () => {
          if (input.trim() && !isProcessing && !disabled) {
            onSendMessage(input.trim());
            setInput('');
          }
        };
        
        const handleKeyDown = (e: React.KeyboardEvent) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSend();
          }
        };
        
        return (
          <Card className={cn('flex flex-col', className)}>
            <CardHeader className="pb-3">
              <CardTitle className="flex items-center gap-2 text-lg">
                <MessageSquare className="h-5 w-5" />
                {t('ai_clarification')}
              </CardTitle>
            </CardHeader>
            
            <CardContent className="flex-1 flex flex-col min-h-0">
              {/* Messages Area */}
              <ScrollArea 
                ref={scrollRef}
                className="flex-1 pr-4 mb-4"
                style={{ maxHeight: '400px' }}
              >
                <div className="space-y-4">
                  {messages.map((message) => (
                    <div
                      key={message.id}
                      className={cn(
                        'flex gap-3',
                        message.role === 'user' && 'flex-row-reverse'
                      )}
                    >
                      <Avatar className={cn(
                        'h-8 w-8',
                        message.role === 'assistant' ? 'bg-primary' : 'bg-secondary'
                      )}>
                        <AvatarFallback>
                          {message.role === 'assistant' ? (
                            <Bot className="h-4 w-4" />
                          ) : (
                            <User className="h-4 w-4" />
                          )}
                        </AvatarFallback>
                      </Avatar>
                      
                      <div className={cn(
                        'flex-1 max-w-[80%]',
                        message.role === 'user' && 'text-right'
                      )}>
                        <div className={cn(
                          'inline-block p-3 rounded-lg text-sm',
                          message.role === 'assistant' 
                            ? 'bg-muted text-foreground' 
                            : 'bg-primary text-primary-foreground'
                        )}>
                          <p className="whitespace-pre-wrap">{message.content}</p>
                        </div>
                        <p className="text-xs text-muted-foreground mt-1">
                          {new Date(message.timestamp).toLocaleTimeString()}
                        </p>
                      </div>
                    </div>
                  ))}
                  
                  {/* Processing indicator */}
                  {isProcessing && (
                    <div className="flex gap-3">
                      <Avatar className="h-8 w-8 bg-primary">
                        <AvatarFallback>
                          <Bot className="h-4 w-4" />
                        </AvatarFallback>
                      </Avatar>
                      <div className="bg-muted p-3 rounded-lg">
                        <Loader2 className="h-4 w-4 animate-spin" />
                      </div>
                    </div>
                  )}
                </div>
              </ScrollArea>
              
              {/* Input Area */}
              <div className="flex gap-2">
                <Textarea
                  ref={textareaRef}
                  value={input}
                  onChange={(e) => setInput(e.target.value)}
                  onKeyDown={handleKeyDown}
                  placeholder={t('type_response')}
                  disabled={disabled || isProcessing}
                  rows={2}
                  className="resize-none"
                  dir="auto"
                />
                <Button
                  onClick={handleSend}
                  disabled={!input.trim() || isProcessing || disabled}
                  className="self-end"
                >
                  {isProcessing ? (
                    <Loader2 className="h-4 w-4 animate-spin" />
                  ) : (
                    <Send className="h-4 w-4" />
                  )}
                </Button>
              </div>
            </CardContent>
          </Card>
        );
      }
      ```

  20. Create ProcessingStep.tsx:
      ```typescript
      // ============================================
      // [F139] src/components/application/ProcessingStep.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { ApplicationStatus, ClarificationMessage } from '@/lib/types';
      import { AIChatInterface } from '@/components/ai/AIChatInterface';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Button } from '@/components/ui/button';
      import { Loader2, Sparkles, MessageSquare, CheckCircle, AlertCircle } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface ProcessingStepProps {
        status: ApplicationStatus;
        clarificationMessages: ClarificationMessage[];
        onStartProcessing: () => void;
        onSendClarification: (message: string) => void;
        onContinueToEdit: () => void;
        isProcessing: boolean;
        error: string | null;
        draftReady: boolean;
        className?: string;
      }
      
      export function ProcessingStep({
        status,
        clarificationMessages,
        onStartProcessing,
        onSendClarification,
        onContinueToEdit,
        isProcessing,
        error,
        draftReady,
        className
      }: ProcessingStepProps) {
        const t = useTranslations('application');
        
        // Initial state - not started
        if (status === 'draft' && clarificationMessages.length === 0 && !isProcessing) {
          return (
            <Card className={className}>
              <CardContent className="py-12">
                <div className="flex flex-col items-center justify-center text-center">
                  <div className="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-4">
                    <Sparkles className="h-8 w-8 text-primary" />
                  </div>
                  <h3 className="text-xl font-semibold mb-2">{t('ready_to_process')}</h3>
                  <p className="text-muted-foreground mb-6 max-w-md">
                    {t('ready_to_process_hint')}
                  </p>
                  <Button onClick={onStartProcessing} size="lg">
                    <Sparkles className="h-4 w-4 mr-2" />
                    {t('start_processing')}
                  </Button>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        // Processing state
        if (isProcessing && status !== 'clarification') {
          return (
            <Card className={className}>
              <CardContent className="py-12">
                <div className="flex flex-col items-center justify-center text-center">
                  <Loader2 className="h-12 w-12 animate-spin text-primary mb-4" />
                  <h3 className="text-xl font-semibold mb-2">{t('processing')}</h3>
                  <p className="text-muted-foreground">
                    {t('processing_hint')}
                  </p>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        // Error state
        if (error) {
          return (
            <Card className={cn('border-destructive', className)}>
              <CardContent className="py-12">
                <div className="flex flex-col items-center justify-center text-center">
                  <AlertCircle className="h-12 w-12 text-destructive mb-4" />
                  <h3 className="text-xl font-semibold mb-2">{t('processing_error')}</h3>
                  <p className="text-muted-foreground mb-4">{error}</p>
                  <Button onClick={onStartProcessing} variant="outline">
                    {t('try_again')}
                  </Button>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        // Clarification state
        if (status === 'clarification' || clarificationMessages.length > 0) {
          return (
            <div className={cn('space-y-4', className)}>
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <MessageSquare className="h-5 w-5" />
                    {t('ai_needs_info')}
                  </CardTitle>
                  <CardDescription>
                    {t('ai_needs_info_hint')}
                  </CardDescription>
                </CardHeader>
              </Card>
              
              <AIChatInterface
                messages={clarificationMessages}
                onSendMessage={onSendClarification}
                isProcessing={isProcessing}
                className="min-h-[400px]"
              />
            </div>
          );
        }
        
        // Draft ready state
        if (draftReady || status === 'draft_ready') {
          return (
            <Card className={className}>
              <CardContent className="py-12">
                <div className="flex flex-col items-center justify-center text-center">
                  <div className="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-4">
                    <CheckCircle className="h-8 w-8 text-green-600" />
                  </div>
                  <h3 className="text-xl font-semibold mb-2">{t('draft_ready')}</h3>
                  <p className="text-muted-foreground mb-6">
                    {t('draft_ready_hint')}
                  </p>
                  <Button onClick={onContinueToEdit} size="lg">
                    {t('review_and_edit')}
                  </Button>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        return null;
      }
      ```

  21. Create OutputEditor.tsx:
      ```typescript
      // ============================================
      // [F057] src/components/application/OutputEditor.tsx
      // ============================================
      
      'use client';
      
      import { useState, useCallback } from 'react';
      import { useTranslations } from 'next-intl';
      import { useEditor, EditorContent } from '@tiptap/react';
      import StarterKit from '@tiptap/starter-kit';
      import Placeholder from '@tiptap/extension-placeholder';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Button } from '@/components/ui/button';
      import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
      import { 
        Edit, Eye, Bold, Italic, List, ListOrdered, 
        Heading1, Heading2, Undo, Redo, Save 
      } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface OutputEditorProps {
        content: string;
        onChange: (content: string) => void;
        onFinalize: () => void;
        isProcessing?: boolean;
        disabled?: boolean;
        className?: string;
      }
      
      export function OutputEditor({
        content,
        onChange,
        onFinalize,
        isProcessing = false,
        disabled = false,
        className
      }: OutputEditorProps) {
        const t = useTranslations('application');
        const [activeTab, setActiveTab] = useState<'edit' | 'preview'>('edit');
        
        const editor = useEditor({
          extensions: [
            StarterKit,
            Placeholder.configure({
              placeholder: t('editor_placeholder'),
            }),
          ],
          content: content,
          editable: !disabled,
          onUpdate: ({ editor }) => {
            onChange(editor.getHTML());
          },
        });
        
        const ToolbarButton = ({ 
          onClick, 
          active, 
          disabled: btnDisabled,
          children 
        }: { 
          onClick: () => void; 
          active?: boolean;
          disabled?: boolean;
          children: React.ReactNode;
        }) => (
          <Button
            type="button"
            variant="ghost"
            size="sm"
            onClick={onClick}
            disabled={btnDisabled}
            className={cn(
              'h-8 w-8 p-0',
              active && 'bg-muted'
            )}
          >
            {children}
          </Button>
        );
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Edit className="h-5 w-5" />
                {t('edit_draft')}
              </CardTitle>
              <CardDescription>
                {t('edit_draft_description')}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'edit' | 'preview')}>
                <div className="flex items-center justify-between mb-4">
                  <TabsList>
                    <TabsTrigger value="edit">
                      <Edit className="h-4 w-4 mr-2" />
                      {t('edit')}
                    </TabsTrigger>
                    <TabsTrigger value="preview">
                      <Eye className="h-4 w-4 mr-2" />
                      {t('preview')}
                    </TabsTrigger>
                  </TabsList>
                  
                  {/* Toolbar - only in edit mode */}
                  {activeTab === 'edit' && editor && (
                    <div className="flex items-center gap-1 border rounded-lg p-1">
                      <ToolbarButton
                        onClick={() => editor.chain().focus().toggleBold().run()}
                        active={editor.isActive('bold')}
                        disabled={disabled}
                      >
                        <Bold className="h-4 w-4" />
                      </ToolbarButton>
                      <ToolbarButton
                        onClick={() => editor.chain().focus().toggleItalic().run()}
                        active={editor.isActive('italic')}
                        disabled={disabled}
                      >
                        <Italic className="h-4 w-4" />
                      </ToolbarButton>
                      <div className="w-px h-4 bg-border mx-1" />
                      <ToolbarButton
                        onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}
                        active={editor.isActive('heading', { level: 1 })}
                        disabled={disabled}
                      >
                        <Heading1 className="h-4 w-4" />
                      </ToolbarButton>
                      <ToolbarButton
                        onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}
                        active={editor.isActive('heading', { level: 2 })}
                        disabled={disabled}
                      >
                        <Heading2 className="h-4 w-4" />
                      </ToolbarButton>
                      <div className="w-px h-4 bg-border mx-1" />
                      <ToolbarButton
                        onClick={() => editor.chain().focus().toggleBulletList().run()}
                        active={editor.isActive('bulletList')}
                        disabled={disabled}
                      >
                        <List className="h-4 w-4" />
                      </ToolbarButton>
                      <ToolbarButton
                        onClick={() => editor.chain().focus().toggleOrderedList().run()}
                        active={editor.isActive('orderedList')}
                        disabled={disabled}
                      >
                        <ListOrdered className="h-4 w-4" />
                      </ToolbarButton>
                      <div className="w-px h-4 bg-border mx-1" />
                      <ToolbarButton
                        onClick={() => editor.chain().focus().undo().run()}
                        disabled={disabled || !editor.can().undo()}
                      >
                        <Undo className="h-4 w-4" />
                      </ToolbarButton>
                      <ToolbarButton
                        onClick={() => editor.chain().focus().redo().run()}
                        disabled={disabled || !editor.can().redo()}
                      >
                        <Redo className="h-4 w-4" />
                      </ToolbarButton>
                    </div>
                  )}
                </div>
                
                <TabsContent value="edit" className="mt-0">
                  <div className="border rounded-lg min-h-[400px] p-4">
                    <EditorContent 
                      editor={editor} 
                      className="prose prose-sm max-w-none min-h-[350px] focus:outline-none"
                    />
                  </div>
                </TabsContent>
                
                <TabsContent value="preview" className="mt-0">
                  <div 
                    className="border rounded-lg min-h-[400px] p-4 prose prose-sm max-w-none"
                    dangerouslySetInnerHTML={{ __html: content }}
                  />
                </TabsContent>
              </Tabs>
              
              <div className="flex justify-end pt-4 border-t">
                <Button
                  onClick={onFinalize}
                  disabled={isProcessing || disabled}
                  size="lg"
                >
                  {isProcessing ? (
                    <>
                      <span className="animate-spin mr-2">â³</span>
                      {t('generating')}
                    </>
                  ) : (
                    <>
                      <Save className="h-4 w-4 mr-2" />
                      {t('generate_final')}
                    </>
                  )}
                </Button>
              </div>
            </CardContent>
          </Card>
        );
      }
      ```

  22. Create DocumentPreview.tsx:
      ```typescript
      // ============================================
      // [F058] src/components/application/DocumentPreview.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
      import { ScrollArea } from '@/components/ui/scroll-area';
      import { FileText, Mail, FileCheck } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      type DocumentType = 'cv' | 'cover_letter' | 'email';
      
      interface DocumentPreviewProps {
        type: DocumentType;
        content: string;
        className?: string;
      }
      
      const iconMap: Record<DocumentType, React.ElementType> = {
        cv: FileCheck,
        cover_letter: FileText,
        email: Mail
      };
      
      export function DocumentPreview({
        type,
        content,
        className
      }: DocumentPreviewProps) {
        const t = useTranslations('application');
        const Icon = iconMap[type];
        
        const titleMap: Record<DocumentType, string> = {
          cv: t('tailored_cv'),
          cover_letter: t('cover_letter'),
          email: t('application_email')
        };
        
        return (
          <Card className={className}>
            <CardHeader className="pb-3">
              <CardTitle className="flex items-center gap-2 text-lg">
                <Icon className="h-5 w-5" />
                {titleMap[type]}
              </CardTitle>
            </CardHeader>
            <CardContent>
              <ScrollArea className="h-[400px] rounded-md border p-4 bg-muted/30">
                <div className="prose prose-sm max-w-none whitespace-pre-wrap">
                  {content}
                </div>
              </ScrollArea>
            </CardContent>
          </Card>
        );
      }
      ```

  23. Create DownloadPanel.tsx:
      ```typescript
      // ============================================
      // [F059] src/components/application/DownloadPanel.tsx
      // ============================================
      
      'use client';
      
      import { useState } from 'react';
      import { useTranslations } from 'next-intl';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Button } from '@/components/ui/button';
      import { 
        Download, FileText, File, Mail, FileCheck, 
        Loader2, CheckCircle 
      } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface DownloadPanelProps {
        documents: {
          tailored_cv: string;
          cover_letter: string;
          application_email: string;
        };
        jobTitle?: string;
        className?: string;
      }
      
      type DocumentType = 'cv' | 'cover_letter' | 'email';
      type FileFormat = 'docx' | 'md';
      
      export function DownloadPanel({
        documents,
        jobTitle = 'application',
        className
      }: DownloadPanelProps) {
        const t = useTranslations('application');
        const [downloading, setDownloading] = useState<string | null>(null);
        const [downloaded, setDownloaded] = useState<string[]>([]);
        
        const downloadDocument = async (
          type: DocumentType, 
          format: FileFormat,
          content: string
        ) => {
          const key = `${type}-${format}`;
          setDownloading(key);
          
          try {
            // For markdown, just download as text
            if (format === 'md') {
              const blob = new Blob([content], { type: 'text/markdown' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `${jobTitle}-${type}.md`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
            } else {
              // For DOCX, call API
              const response = await fetch('/api/export/docx', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                  content, 
                  filename: `${jobTitle}-${type}`,
                  type 
                })
              });
              
              if (!response.ok) throw new Error('Download failed');
              
              const blob = await response.blob();
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `${jobTitle}-${type}.docx`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
            }
            
            setDownloaded(prev => [...prev, key]);
            
          } catch (error) {
            console.error('Download error:', error);
          } finally {
            setDownloading(null);
          }
        };
        
        const documentTypes: { type: DocumentType; icon: React.ElementType; content: string }[] = [
          { type: 'cv', icon: FileCheck, content: documents.tailored_cv },
          { type: 'cover_letter', icon: FileText, content: documents.cover_letter },
          { type: 'email', icon: Mail, content: documents.application_email },
        ];
        
        const titleMap: Record<DocumentType, string> = {
          cv: t('tailored_cv'),
          cover_letter: t('cover_letter'),
          email: t('application_email')
        };
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <Download className="h-5 w-5" />
                {t('download_documents')}
              </CardTitle>
              <CardDescription>
                {t('download_description')}
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div className="space-y-4">
                {documentTypes.map(({ type, icon: Icon, content }) => (
                  <div 
                    key={type}
                    className="flex items-center justify-between p-4 border rounded-lg"
                  >
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                        <Icon className="h-5 w-5 text-primary" />
                      </div>
                      <div>
                        <p className="font-medium">{titleMap[type]}</p>
                        <p className="text-sm text-muted-foreground">
                          {content.length} {t('characters')}
                        </p>
                      </div>
                    </div>
                    
                    <div className="flex items-center gap-2">
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => downloadDocument(type, 'docx', content)}
                        disabled={downloading !== null}
                      >
                        {downloading === `${type}-docx` ? (
                          <Loader2 className="h-4 w-4 animate-spin" />
                        ) : downloaded.includes(`${type}-docx`) ? (
                          <CheckCircle className="h-4 w-4 text-green-500" />
                        ) : (
                          <File className="h-4 w-4" />
                        )}
                        <span className="ml-2">Word</span>
                      </Button>
                      
                      <Button
                        variant="outline"
                        size="sm"
                        onClick={() => downloadDocument(type, 'md', content)}
                        disabled={downloading !== null}
                      >
                        {downloading === `${type}-md` ? (
                          <Loader2 className="h-4 w-4 animate-spin" />
                        ) : downloaded.includes(`${type}-md`) ? (
                          <CheckCircle className="h-4 w-4 text-green-500" />
                        ) : (
                          <FileText className="h-4 w-4" />
                        )}
                        <span className="ml-2">Markdown</span>
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
              
              {/* Download All Button */}
              <div className="mt-6 pt-4 border-t">
                <Button
                  className="w-full"
                  onClick={async () => {
                    for (const doc of documentTypes) {
                      await downloadDocument(doc.type, 'docx', doc.content);
                    }
                  }}
                  disabled={downloading !== null}
                >
                  <Download className="h-4 w-4 mr-2" />
                  {t('download_all')}
                </Button>
              </div>
            </CardContent>
          </Card>
        );
      }
      ```

  24. Create FinalDocumentsStep.tsx:
      ```typescript
      // ============================================
      // [F140] src/components/application/FinalDocumentsStep.tsx
      // ============================================
      
      'use client';
      
      import { useState } from 'react';
      import { useTranslations } from 'next-intl';
      import { DocumentPreview } from './DocumentPreview';
      import { DownloadPanel } from './DownloadPanel';
      import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
      import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
      import { Button } from '@/components/ui/button';
      import { 
        CheckCircle, FileCheck, FileText, Mail, Download, Plus 
      } from 'lucide-react';
      import { cn } from '@/lib/utils';
      
      interface FinalDocumentsStepProps {
        documents: {
          tailored_cv: string;
          cover_letter: string;
          application_email: string;
        };
        onNewApplication: () => void;
        className?: string;
      }
      
      export function FinalDocumentsStep({
        documents,
        onNewApplication,
        className
      }: FinalDocumentsStepProps) {
        const t = useTranslations('application');
        const [activeDoc, setActiveDoc] = useState<'cv' | 'cover_letter' | 'email'>('cv');
        
        return (
          <div className={cn('space-y-6', className)}>
            {/* Success Header */}
            <Card className="bg-green-50 dark:bg-green-950 border-green-200">
              <CardContent className="py-6">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
                    <CheckCircle className="h-6 w-6 text-green-600" />
                  </div>
                  <div>
                    <h2 className="text-xl font-semibold text-green-800 dark:text-green-200">
                      {t('documents_ready')}
                    </h2>
                    <p className="text-green-700 dark:text-green-300">
                      {t('documents_ready_hint')}
                    </p>
                  </div>
                </div>
              </CardContent>
            </Card>
            
            <div className="grid lg:grid-cols-3 gap-6">
              {/* Document Previews - 2 columns */}
              <div className="lg:col-span-2">
                <Card>
                  <CardHeader>
                    <CardTitle>{t('preview_documents')}</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <Tabs value={activeDoc} onValueChange={(v) => setActiveDoc(v as any)}>
                      <TabsList className="grid w-full grid-cols-3">
                        <TabsTrigger value="cv" className="flex items-center gap-2">
                          <FileCheck className="h-4 w-4" />
                          <span className="hidden sm:inline">{t('cv')}</span>
                        </TabsTrigger>
                        <TabsTrigger value="cover_letter" className="flex items-center gap-2">
                          <FileText className="h-4 w-4" />
                          <span className="hidden sm:inline">{t('cover_letter_short')}</span>
                        </TabsTrigger>
                        <TabsTrigger value="email" className="flex items-center gap-2">
                          <Mail className="h-4 w-4" />
                          <span className="hidden sm:inline">{t('email')}</span>
                        </TabsTrigger>
                      </TabsList>
                      
                      <TabsContent value="cv" className="mt-4">
                        <DocumentPreview type="cv" content={documents.tailored_cv} />
                      </TabsContent>
                      <TabsContent value="cover_letter" className="mt-4">
                        <DocumentPreview type="cover_letter" content={documents.cover_letter} />
                      </TabsContent>
                      <TabsContent value="email" className="mt-4">
                        <DocumentPreview type="email" content={documents.application_email} />
                      </TabsContent>
                    </Tabs>
                  </CardContent>
                </Card>
              </div>
              
              {/* Download Panel - 1 column */}
              <div className="space-y-4">
                <DownloadPanel documents={documents} />
                
                {/* New Application Button */}
                <Button
                  variant="outline"
                  className="w-full"
                  onClick={onNewApplication}
                >
                  <Plus className="h-4 w-4 mr-2" />
                  {t('new_application')}
                </Button>
              </div>
            </div>
          </div>
        );
      }
      ```

  25. Create ApplicationWizard.tsx:
      ```typescript
      // ============================================
      // [F134] src/components/application/ApplicationWizard.tsx
      // ============================================
      
      'use client';
      
      import { useEffect } from 'react';
      import { useTranslations } from 'next-intl';
      import { useApplication } from '@/hooks/useApplication';
      import { useCV } from '@/hooks/useCV';
      import { WizardStep } from '@/lib/types';
      import { WizardProgress } from './WizardProgress';
      import { JobDescriptionInput } from './JobDescriptionInput';
      import { PromptSelectionStep } from './PromptSelectionStep';
      import { AIConfigurationStep } from './AIConfigurationStep';
      import { OutputSettingsStep } from './OutputSettingsStep';
      import { ProcessingStep } from './ProcessingStep';
      import { OutputEditor } from './OutputEditor';
      import { FinalDocumentsStep } from './FinalDocumentsStep';
      import { Button } from '@/components/ui/button';
      import { Card, CardContent } from '@/components/ui/card';
      import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
      import { 
        ArrowLeft, ArrowRight, AlertCircle, FileText, Loader2 
      } from 'lucide-react';
      import { cn } from '@/lib/utils';
      import Link from 'next/link';
      import { useParams } from 'next/navigation';
      
      interface ApplicationWizardProps {
        className?: string;
      }
      
      const STEP_ORDER: WizardStep[] = [
        'job_description',
        'prompts',
        'ai_config',
        'settings',
        'processing',
        'editing',
        'final'
      ];
      
      export function ApplicationWizard({ className }: ApplicationWizardProps) {
        const t = useTranslations('application');
        const params = useParams();
        const locale = params.locale as string;
        
        const {
          application,
          loading,
          processing,
          error,
          currentStep,
          setCurrentStep,
          jobDescription,
          setJobDescription,
          selectedPromptIds,
          setSelectedPromptIds,
          aiSelections,
          setAISelections,
          outputLanguage,
          setOutputLanguage,
          toneSetting,
          setToneSetting,
          createApplication,
          startProcessing,
          sendClarification,
          updateDraft,
          finalize,
          reset,
          canProceedToNext,
          draftContent,
          clarificationMessages,
          finalDocuments
        } = useApplication();
        
        const { cv, loading: cvLoading } = useCV();
        
        const currentStepIndex = STEP_ORDER.indexOf(currentStep);
        const completedSteps = STEP_ORDER.slice(0, currentStepIndex);
        
        const canGoBack = currentStepIndex > 0 && currentStepIndex < 4; // Can go back before processing
        const canGoNext = canProceedToNext && currentStepIndex < 4;
        
        const goBack = () => {
          if (canGoBack) {
            setCurrentStep(STEP_ORDER[currentStepIndex - 1]);
          }
        };
        
        const goNext = async () => {
          if (!canGoNext) return;
          
          if (currentStepIndex === 3) {
            // Moving to processing - create application first
            try {
              await createApplication();
              setCurrentStep('processing');
            } catch {}
          } else {
            setCurrentStep(STEP_ORDER[currentStepIndex + 1]);
          }
        };
        
        // Check if CV exists
        if (!cvLoading && !cv) {
          return (
            <Card className={className}>
              <CardContent className="py-12">
                <div className="flex flex-col items-center justify-center text-center">
                  <AlertCircle className="h-12 w-12 text-yellow-500 mb-4" />
                  <h2 className="text-xl font-semibold mb-2">{t('cv_required')}</h2>
                  <p className="text-muted-foreground mb-6 max-w-md">
                    {t('cv_required_hint')}
                  </p>
                  <Link href={`/${locale}/cv-manager`}>
                    <Button>
                      <FileText className="h-4 w-4 mr-2" />
                      {t('go_to_cv_manager')}
                    </Button>
                  </Link>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        if (loading || cvLoading) {
          return (
            <Card className={className}>
              <CardContent className="py-12">
                <div className="flex flex-col items-center justify-center">
                  <Loader2 className="h-8 w-8 animate-spin text-primary mb-4" />
                  <p className="text-muted-foreground">{t('loading')}</p>
                </div>
              </CardContent>
            </Card>
          );
        }
        
        return (
          <div className={cn('space-y-6', className)}>
            {/* Progress */}
            {currentStep !== 'final' && (
              <Card>
                <CardContent className="py-4">
                  <WizardProgress
                    currentStep={currentStep}
                    completedSteps={completedSteps}
                  />
                </CardContent>
              </Card>
            )}
            
            {/* Error Alert */}
            {error && (
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertTitle>{t('error')}</AlertTitle>
                <AlertDescription>{error}</AlertDescription>
              </Alert>
            )}
            
            {/* Step Content */}
            <div className="min-h-[400px]">
              {currentStep === 'job_description' && (
                <JobDescriptionInput
                  value={jobDescription}
                  onChange={setJobDescription}
                  disabled={processing}
                />
              )}
              
              {currentStep === 'prompts' && (
                <PromptSelectionStep
                  selectedIds={selectedPromptIds}
                  onSelectionChange={setSelectedPromptIds}
                  disabled={processing}
                />
              )}
              
              {currentStep === 'ai_config' && (
                <AIConfigurationStep
                  selections={aiSelections}
                  onSelectionsChange={setAISelections}
                  disabled={processing}
                />
              )}
              
              {currentStep === 'settings' && (
                <OutputSettingsStep
                  outputLanguage={outputLanguage}
                  onOutputLanguageChange={setOutputLanguage}
                  toneSetting={toneSetting}
                  onToneSettingChange={setToneSetting}
                  disabled={processing}
                />
              )}
              
              {currentStep === 'processing' && (
                <ProcessingStep
                  status={application?.status || 'draft'}
                  clarificationMessages={clarificationMessages}
                  onStartProcessing={startProcessing}
                  onSendClarification={sendClarification}
                  onContinueToEdit={() => setCurrentStep('editing')}
                  isProcessing={processing}
                  error={error}
                  draftReady={!!draftContent}
                />
              )}
              
              {currentStep === 'editing' && draftContent && (
                <OutputEditor
                  content={draftContent}
                  onChange={updateDraft}
                  onFinalize={finalize}
                  isProcessing={processing}
                />
              )}
              
              {currentStep === 'final' && finalDocuments && (
                <FinalDocumentsStep
                  documents={finalDocuments}
                  onNewApplication={reset}
                />
              )}
            </div>
            
            {/* Navigation Buttons */}
            {currentStep !== 'processing' && currentStep !== 'editing' && currentStep !== 'final' && (
              <div className="flex items-center justify-between pt-4 border-t">
                <Button
                  variant="outline"
                  onClick={goBack}
                  disabled={!canGoBack || processing}
                >
                  <ArrowLeft className="h-4 w-4 mr-2" />
                  {t('back')}
                </Button>
                
                <div className="text-sm text-muted-foreground">
                  {t('step_of', { current: currentStepIndex + 1, total: 4 })}
                </div>
                
                <Button
                  onClick={goNext}
                  disabled={!canGoNext || processing}
                >
                  {currentStepIndex === 3 ? t('start_processing') : t('next')}
                  <ArrowRight className="h-4 w-4 ml-2" />
                </Button>
              </div>
            )}
          </div>
        );
      }
      ```

  26. Create new-application/loading.tsx:
      ```typescript
      // ============================================
      // [F141] src/app/[locale]/new-application/loading.tsx
      // ============================================
      
      import { Skeleton } from '@/components/ui/skeleton';
      import { Card, CardContent, CardHeader } from '@/components/ui/card';
      
      export default function Loading() {
        return (
          <div className="container mx-auto p-6 max-w-4xl space-y-6">
            {/* Header */}
            <div className="space-y-2">
              <Skeleton className="h-8 w-64" />
              <Skeleton className="h-4 w-96" />
            </div>
            
            {/* Progress */}
            <Card>
              <CardContent className="py-4">
                <div className="flex items-center justify-between">
                  {Array.from({ length: 7 }).map((_, i) => (
                    <div key={i} className="flex items-center">
                      <Skeleton className="h-10 w-10 rounded-full" />
                      {i < 6 && <Skeleton className="h-0.5 w-12 mx-2" />}
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
            
            {/* Content */}
            <Card>
              <CardHeader>
                <Skeleton className="h-6 w-48" />
                <Skeleton className="h-4 w-72" />
              </CardHeader>
              <CardContent className="space-y-4">
                <Skeleton className="h-64 w-full" />
                <div className="flex justify-between">
                  <Skeleton className="h-10 w-24" />
                  <Skeleton className="h-10 w-24" />
                </div>
              </CardContent>
            </Card>
          </div>
        );
      }
      ```

  27. Create new-application/page.tsx:
      ```typescript
      // ============================================
      // [F014] src/app/[locale]/new-application/page.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { AuthGuard } from '@/components/auth/AuthGuard';
      import { ApplicationWizard } from '@/components/application/ApplicationWizard';
      import { FileEdit } from 'lucide-react';
      
      export default function NewApplicationPage() {
        const t = useTranslations('application');
        
        return (
          <AuthGuard>
            <div className="container mx-auto p-6 max-w-4xl">
              {/* Header */}
              <div className="mb-6">
                <h1 className="text-2xl font-bold flex items-center gap-2">
                  <FileEdit className="h-6 w-6" />
                  {t('new_application_title')}
                </h1>
                <p className="text-muted-foreground mt-1">
                  {t('new_application_description')}
                </p>
              </div>
              
              {/* Wizard */}
              <ApplicationWizard />
            </div>
          </AuthGuard>
        );
      }
      ```

  28. Add translations to en.json under "application" key:
      ```json
      {
        "application": {
          "new_application_title": "New Job Application",
          "new_application_description": "Create tailored CV, cover letter, and application email for a specific job",
          
          "job_description_title": "Job Description",
          "job_description_hint": "Paste the complete job description including requirements, responsibilities, and qualifications",
          "job_description_placeholder": "Paste the job description here...\n\nInclude:\n- Job title and company\n- Required skills and qualifications\n- Responsibilities\n- Any other relevant information",
          "characters": "Characters",
          "words": "Words",
          "min_chars_required": "Minimum {count} characters required",
          "ready": "Ready",
          
          "select_prompts_title": "Select Prompts",
          "select_prompts_description": "Choose one or more prompts that define how your application documents will be created",
          
          "ai_config_title": "AI Configuration",
          "ai_config_description": "Select which AI model to use for generating your documents",
          "no_ai_keys": "No AI API Keys Configured",
          "no_ai_keys_hint": "You need to add at least one AI API key to use this feature",
          "go_to_settings": "Go to Settings",
          "draft_ai": "Draft AI Model",
          "draft_ai_hint": "This model will analyze your CV and job description to create the initial draft",
          "final_ai": "Final AI Model",
          "final_ai_hint": "This model will polish and format the final documents",
          "use_different_final": "Use Different Model for Final Output",
          "use_different_final_hint": "Optionally use a different (possibly more powerful) model for the final documents",
          "provider": "Provider",
          "model": "Model",
          "select_provider": "Select provider",
          "select_model": "Select model",
          "required": "Required",
          "config_summary": "Configuration Summary",
          "draft": "Draft",
          "final": "Final",
          
          "output_settings_title": "Output Settings",
          "output_settings_description": "Configure the language and tone of your application documents",
          "output_language": "Output Language",
          "response_tone": "Response Tone",
          "tone_preset": "Choose Preset",
          "tone_custom": "Custom Description",
          "tone_custom_placeholder": "Describe the tone you want, e.g., 'Confident but humble, with emphasis on technical expertise'",
          "tone_custom_hint": "Describe in your own words how you want the AI to write",
          
          "ready_to_process": "Ready to Process",
          "ready_to_process_hint": "Your CV and job description will be analyzed by AI to create tailored application documents",
          "start_processing": "Start Processing",
          "processing": "Processing...",
          "processing_hint": "AI is analyzing your CV and the job description",
          "processing_error": "Processing Error",
          "try_again": "Try Again",
          
          "ai_clarification": "AI Clarification",
          "ai_needs_info": "AI Needs More Information",
          "ai_needs_info_hint": "Please answer the AI's questions to continue",
          "type_response": "Type your response...",
          
          "draft_ready": "Draft Ready",
          "draft_ready_hint": "The AI has created a draft. Review and edit before generating final documents.",
          "review_and_edit": "Review & Edit",
          
          "edit_draft": "Edit Draft",
          "edit_draft_description": "Review and edit the AI-generated content before creating final documents",
          "edit": "Edit",
          "preview": "Preview",
          "editor_placeholder": "Content will appear here...",
          "generate_final": "Generate Final Documents",
          "generating": "Generating...",
          
          "documents_ready": "Documents Ready!",
          "documents_ready_hint": "Your tailored application documents have been generated successfully",
          "preview_documents": "Preview Documents",
          "tailored_cv": "Tailored CV",
          "cover_letter": "Cover Letter",
          "cover_letter_short": "Cover Letter",
          "application_email": "Application Email",
          "email": "Email",
          "cv": "CV",
          
          "download_documents": "Download Documents",
          "download_description": "Download your documents in Word or Markdown format",
          "download_all": "Download All (Word)",
          
          "new_application": "Start New Application",
          
          "cv_required": "CV Required",
          "cv_required_hint": "You need to upload your CV before creating a job application",
          "go_to_cv_manager": "Go to CV Manager",
          
          "loading": "Loading...",
          "error": "Error",
          "back": "Back",
          "next": "Next",
          "step_of": "Step {current} of {total}"
        }
      }
      ```

  29. Add translations to fa.json under "application" key:
      ```json
      {
        "application": {
          "new_application_title": "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´ØºÙ„ÛŒ Ø¬Ø¯ÛŒØ¯",
          "new_application_description": "Ø§ÛŒØ¬Ø§Ø¯ Ø³ÛŒâ€ŒÙˆÛŒØŒ Ú©Ø§ÙˆØ±Ù„ØªØ± Ùˆ Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø´ØºÙ„ Ø®Ø§Øµ",
          
          "job_description_title": "Ø´Ø±Ø­ Ø´ØºÙ„",
          "job_description_hint": "Ø´Ø±Ø­ Ø´ØºÙ„ Ú©Ø§Ù…Ù„ Ø´Ø§Ù…Ù„ Ø§Ù„Ø²Ø§Ù…Ø§ØªØŒ Ù…Ø³Ø¦ÙˆÙ„ÛŒØªâ€ŒÙ‡Ø§ Ùˆ ØµÙ„Ø§Ø­ÛŒØªâ€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
          "job_description_placeholder": "Ø´Ø±Ø­ Ø´ØºÙ„ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú†Ø³Ø¨Ø§Ù†ÛŒØ¯...\n\nØ´Ø§Ù…Ù„:\n- Ø¹Ù†ÙˆØ§Ù† Ø´ØºÙ„ Ùˆ Ø´Ø±Ú©Øª\n- Ù…Ù‡Ø§Ø±Øªâ€ŒÙ‡Ø§ Ùˆ ØµÙ„Ø§Ø­ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²\n- Ù…Ø³Ø¦ÙˆÙ„ÛŒØªâ€ŒÙ‡Ø§\n- Ø³Ø§ÛŒØ± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø±ØªØ¨Ø·",
          "characters": "Ú©Ø§Ø±Ø§Ú©ØªØ±",
          "words": "Ú©Ù„Ù…Ù‡",
          "min_chars_required": "Ø­Ø¯Ø§Ù‚Ù„ {count} Ú©Ø§Ø±Ø§Ú©ØªØ± Ù„Ø§Ø²Ù… Ø§Ø³Øª",
          "ready": "Ø¢Ù…Ø§Ø¯Ù‡",
          
          "select_prompts_title": "Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø±Ø§Ù…Ù¾Øªâ€ŒÙ‡Ø§",
          "select_prompts_description": "ÛŒÚ© ÛŒØ§ Ú†Ù†Ø¯ Ù¾Ø±Ø§Ù…Ù¾Øª Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ú©Ù‡ Ù†Ø­ÙˆÙ‡ Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø§ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯",
          
          "ai_config_title": "Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "ai_config_description": "Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ú©Ø¯Ø§Ù… Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯",
          "no_ai_keys": "Ú©Ù„ÛŒØ¯ API ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª",
          "no_ai_keys_hint": "Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† ÙˆÛŒÚ˜Ú¯ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ú©Ù„ÛŒØ¯ API Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯",
          "go_to_settings": "Ø±ÙØªÙ† Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª",
          "draft_ai": "Ù…Ø¯Ù„ AI Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³",
          "draft_ai_hint": "Ø§ÛŒÙ† Ù…Ø¯Ù„ Ø³ÛŒâ€ŒÙˆÛŒ Ùˆ Ø´Ø±Ø­ Ø´ØºÙ„ Ø±Ø§ ØªØ­Ù„ÛŒÙ„ Ú©Ø±Ø¯Ù‡ Ùˆ Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø§ÙˆÙ„ÛŒÙ‡ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯",
          "final_ai": "Ù…Ø¯Ù„ AI Ù†Ù‡Ø§ÛŒÛŒ",
          "final_ai_hint": "Ø§ÛŒÙ† Ù…Ø¯Ù„ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ùˆ ÙØ±Ù…Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯",
          "use_different_final": "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø¯Ù„ Ù…ØªÙØ§ÙˆØª Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù‡Ø§ÛŒÛŒ",
          "use_different_final_hint": "Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ø§Ø² ÛŒÚ© Ù…Ø¯Ù„ Ù…ØªÙØ§ÙˆØª (Ø§Ø­ØªÙ…Ø§Ù„Ø§Ù‹ Ù‚ÙˆÛŒâ€ŒØªØ±) Ø¨Ø±Ø§ÛŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯",
          "provider": "Ø³Ø±ÙˆÛŒØ³â€ŒØ¯Ù‡Ù†Ø¯Ù‡",
          "model": "Ù…Ø¯Ù„",
          "select_provider": "Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÙˆÛŒØ³",
          "select_model": "Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¯Ù„",
          "required": "Ø§Ù„Ø²Ø§Ù…ÛŒ",
          "config_summary": "Ø®Ù„Ø§ØµÙ‡ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ",
          "draft": "Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³",
          "final": "Ù†Ù‡Ø§ÛŒÛŒ",
          
          "output_settings_title": "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø±ÙˆØ¬ÛŒ",
          "output_settings_description": "Ø²Ø¨Ø§Ù† Ùˆ Ù„Ø­Ù† Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø±Ø§ Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯",
          "output_language": "Ø²Ø¨Ø§Ù† Ø®Ø±ÙˆØ¬ÛŒ",
          "response_tone": "Ù„Ø­Ù† Ù¾Ø§Ø³Ø®",
          "tone_preset": "Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶",
          "tone_custom": "ØªÙˆØ¶ÛŒØ­ Ø³ÙØ§Ø±Ø´ÛŒ",
          "tone_custom_placeholder": "Ù„Ø­Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ ØªÙˆØµÛŒÙ Ú©Ù†ÛŒØ¯ØŒ Ù…Ø«Ù„Ø§Ù‹ 'Ù…Ø·Ù…Ø¦Ù† Ø§Ù…Ø§ ÙØ±ÙˆØªÙ†ØŒ Ø¨Ø§ ØªØ£Ú©ÛŒØ¯ Ø¨Ø± ØªØ®ØµØµ ÙÙ†ÛŒ'",
          "tone_custom_hint": "Ø¨Ø§ Ú©Ù„Ù…Ø§Øª Ø®ÙˆØ¯ØªØ§Ù† ØªÙˆØ¶ÛŒØ­ Ø¯Ù‡ÛŒØ¯ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ AI Ú†Ú¯ÙˆÙ†Ù‡ Ø¨Ù†ÙˆÛŒØ³Ø¯",
          
          "ready_to_process": "Ø¢Ù…Ø§Ø¯Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´",
          "ready_to_process_hint": "Ø³ÛŒâ€ŒÙˆÛŒ Ùˆ Ø´Ø±Ø­ Ø´ØºÙ„ Ø´Ù…Ø§ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ­Ù„ÛŒÙ„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯",
          "start_processing": "Ø´Ø±ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø²Ø´",
          "processing": "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...",
          "processing_hint": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø³ÛŒâ€ŒÙˆÛŒ Ùˆ Ø´Ø±Ø­ Ø´ØºÙ„ Ø§Ø³Øª",
          "processing_error": "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´",
          "try_again": "ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯",
          
          "ai_clarification": "ØªÙˆØ¶ÛŒØ­Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",
          "ai_needs_info": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯",
          "ai_needs_info_hint": "Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯",
          "type_response": "Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...",
          
          "draft_ready": "Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª",
          "draft_ready_hint": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ù‚Ø¨Ù„ Ø§Ø² ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯.",
          "review_and_edit": "Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´",
          
          "edit_draft": "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³",
          "edit_draft_description": "Ù…Ø­ØªÙˆØ§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· AI Ø±Ø§ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒØ¯",
          "edit": "ÙˆÛŒØ±Ø§ÛŒØ´",
          "preview": "Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´",
          "editor_placeholder": "Ù…Ø­ØªÙˆØ§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯...",
          "generate_final": "ØªÙˆÙ„ÛŒØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù†Ù‡Ø§ÛŒÛŒ",
          "generating": "Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯...",
          
          "documents_ready": "Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!",
          "documents_ready_hint": "Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´ØºÙ„ÛŒ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯",
          "preview_documents": "Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ù…Ø³ØªÙ†Ø¯Ø§Øª",
          "tailored_cv": "Ø³ÛŒâ€ŒÙˆÛŒ Ø§Ø®ØªØµØ§ØµÛŒ",
          "cover_letter": "Ú©Ø§ÙˆØ±Ù„ØªØ±",
          "cover_letter_short": "Ú©Ø§ÙˆØ±Ù„ØªØ±",
          "application_email": "Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª",
          "email": "Ø§ÛŒÙ…ÛŒÙ„",
          "cv": "Ø³ÛŒâ€ŒÙˆÛŒ",
          
          "download_documents": "Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø³ØªÙ†Ø¯Ø§Øª",
          "download_description": "Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Word ÛŒØ§ Markdown Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯",
          "download_all": "Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ù…Ù‡ (Word)",
          
          "new_application": "Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¬Ø¯ÛŒØ¯",
          
          "cv_required": "Ø³ÛŒâ€ŒÙˆÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª",
          "cv_required_hint": "Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´ØºÙ„ÛŒ Ø¨Ø§ÛŒØ¯ Ø³ÛŒâ€ŒÙˆÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯",
          "go_to_cv_manager": "Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÛŒâ€ŒÙˆÛŒ",
          
          "loading": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...",
          "error": "Ø®Ø·Ø§",
          "back": "Ø¨Ø§Ø²Ú¯Ø´Øª",
          "next": "Ø¨Ø¹Ø¯ÛŒ",
          "step_of": "Ù…Ø±Ø­Ù„Ù‡ {current} Ø§Ø² {total}"
        }
      }
      ```

checkpoint_tests:
  - id: T01
    description: "All application service files exist"
    type: "files_exist"
    files:
      - "src/lib/applications/application-service.ts"
      - "src/lib/applications/application-processor.ts"
      - "src/lib/applications/application-prompts.ts"
      - "src/lib/applications/index.ts"

  - id: T02
    description: "All API route files exist"
    type: "files_exist"
    files:
      - "src/app/api/applications/route.ts"
      - "src/app/api/applications/[id]/route.ts"
      - "src/app/api/applications/[id]/process/route.ts"
      - "src/app/api/applications/[id]/clarify/route.ts"
      - "src/app/api/applications/[id]/finalize/route.ts"

  - id: T03
    description: "useApplication hook exists"
    type: "files_exist"
    files:
      - "src/hooks/useApplication.ts"

  - id: T04
    description: "All wizard component files exist"
    type: "files_exist"
    files:
      - "src/components/application/ApplicationWizard.tsx"
      - "src/components/application/WizardProgress.tsx"
      - "src/components/application/JobDescriptionInput.tsx"
      - "src/components/application/PromptSelectionStep.tsx"
      - "src/components/application/AIConfigurationStep.tsx"
      - "src/components/application/OutputSettingsStep.tsx"
      - "src/components/application/LanguageSelector.tsx"
      - "src/components/application/ToneSelector.tsx"
      - "src/components/application/ProcessingStep.tsx"
      - "src/components/application/OutputEditor.tsx"
      - "src/components/application/FinalDocumentsStep.tsx"
      - "src/components/application/DocumentPreview.tsx"
      - "src/components/application/DownloadPanel.tsx"

  - id: T05
    description: "AIChatInterface component exists"
    type: "files_exist"
    files:
      - "src/components/ai/AIChatInterface.tsx"

  - id: T06
    description: "Page files exist"
    type: "files_exist"
    files:
      - "src/app/[locale]/new-application/page.tsx"
      - "src/app/[locale]/new-application/loading.tsx"

  - id: T07
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T08
    description: "Application service has all CRUD methods"
    type: "grep"
    file: "src/lib/applications/application-service.ts"
    patterns:
      - "createApplication"
      - "getApplication"
      - "updateApplication"
      - "deleteApplication"
      - "saveDraftContent"
      - "saveFinalDocuments"
      - "addClarificationMessage"

  - id: T09
    description: "Application processor uses AI providers"
    type: "grep"
    file: "src/lib/applications/application-processor.ts"
    patterns:
      - "getAIProvider"
      - "processApplication"
      - "generateFinalDocuments"

  - id: T10
    description: "useApplication hook has all state and actions"
    type: "grep"
    file: "src/hooks/useApplication.ts"
    patterns:
      - "jobDescription"
      - "selectedPromptIds"
      - "aiSelections"
      - "createApplication"
      - "startProcessing"
      - "sendClarification"
      - "finalize"

  - id: T11
    description: "ApplicationWizard integrates all steps"
    type: "grep"
    file: "src/components/application/ApplicationWizard.tsx"
    patterns:
      - "JobDescriptionInput"
      - "PromptSelectionStep"
      - "AIConfigurationStep"
      - "OutputSettingsStep"
      - "ProcessingStep"
      - "OutputEditor"
      - "FinalDocumentsStep"

  - id: T12
    description: "Page uses AuthGuard"
    type: "grep"
    file: "src/app/[locale]/new-application/page.tsx"
    patterns:
      - "AuthGuard"
      - "ApplicationWizard"

  - id: T13
    description: "English translations have all application keys"
    type: "grep"
    file: "src/i18n/en.json"
    patterns:
      - "new_application_title"
      - "job_description_title"
      - "select_prompts_title"
      - "ai_config_title"
      - "documents_ready"

  - id: T14
    description: "Farsi translations have all application keys"
    type: "grep"
    file: "src/i18n/fa.json"
    patterns:
      - "new_application_title"
      - "job_description_title"
      - "documents_ready"

  - id: T15
    description: "Types include application workflow types"
    type: "grep"
    file: "src/lib/types.ts"
    patterns:
      - "ApplicationStatus"
      - "WizardStep"
      - "AIModelSelection"
      - "ClarificationMessage"
      - "FinalDocuments"

max_retries: 3

# blocks/B19.yaml

id: B19
name: "Export System (Word & Markdown)"
phase: 4
phase_name: "Export & Templates"

goal: |
  Create the export system that generates downloadable Word (.docx) and Markdown (.md) files
  from the generated documents. This includes proper formatting, styling, and template support.

dependencies: [B01, B02, B03, B04, B05, B06]

files_to_create:
  - id: F075
    path: "src/lib/generators/docx-generator.ts"
    description: "Generate formatted Word documents"

  - id: F076
    path: "src/lib/generators/markdown-generator.ts"
    description: "Generate Markdown files"

  - id: F142
    path: "src/lib/generators/document-formatter.ts"
    description: "Common formatting utilities"

  - id: F143
    path: "src/lib/generators/index.ts"
    description: "Export all generators"

  - id: F025
    path: "src/app/api/export/docx/route.ts"
    description: "API route for Word export"

  - id: F026
    path: "src/app/api/export/markdown/route.ts"
    description: "API route for Markdown export"

  - id: F144
    path: "src/app/api/export/all/route.ts"
    description: "API route to export all documents as ZIP"

files_to_modify: []

files_available:
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F080
    path: "src/lib/utils.ts"
    from_block: B04

commands: []

instructions: |
  1. Create document-formatter.ts:
     ```typescript
     // ============================================
     // [F142] src/lib/generators/document-formatter.ts
     // ============================================
     
     export interface DocumentSection {
       type: 'heading' | 'paragraph' | 'list' | 'divider';
       level?: 1 | 2 | 3;  // For headings
       content?: string;
       items?: string[];   // For lists
     }
     
     export function parseContentToSections(content: string): DocumentSection[] {
       const sections: DocumentSection[] = [];
       const lines = content.split('\n');
       let currentList: string[] = [];
       
       for (let i = 0; i < lines.length; i++) {
         const line = lines[i].trim();
         
         // Skip empty lines
         if (!line) {
           // Flush any pending list
           if (currentList.length > 0) {
             sections.push({ type: 'list', items: [...currentList] });
             currentList = [];
           }
           continue;
         }
         
         // Check for headings (Markdown style)
         if (line.startsWith('### ')) {
           if (currentList.length > 0) {
             sections.push({ type: 'list', items: [...currentList] });
             currentList = [];
           }
           sections.push({ type: 'heading', level: 3, content: line.slice(4) });
         } else if (line.startsWith('## ')) {
           if (currentList.length > 0) {
             sections.push({ type: 'list', items: [...currentList] });
             currentList = [];
           }
           sections.push({ type: 'heading', level: 2, content: line.slice(3) });
         } else if (line.startsWith('# ')) {
           if (currentList.length > 0) {
             sections.push({ type: 'list', items: [...currentList] });
             currentList = [];
           }
           sections.push({ type: 'heading', level: 1, content: line.slice(2) });
         }
         // Check for list items
         else if (line.startsWith('- ') || line.startsWith('â€¢ ') || line.startsWith('* ')) {
           currentList.push(line.slice(2));
         }
         // Check for numbered list
         else if (/^\d+\.\s/.test(line)) {
           currentList.push(line.replace(/^\d+\.\s/, ''));
         }
         // Check for divider
         else if (line === '---' || line === '***' || line === '___') {
           if (currentList.length > 0) {
             sections.push({ type: 'list', items: [...currentList] });
             currentList = [];
           }
           sections.push({ type: 'divider' });
         }
         // Regular paragraph
         else {
           if (currentList.length > 0) {
             sections.push({ type: 'list', items: [...currentList] });
             currentList = [];
           }
           sections.push({ type: 'paragraph', content: line });
         }
       }
       
       // Flush any remaining list
       if (currentList.length > 0) {
         sections.push({ type: 'list', items: currentList });
       }
       
       return sections;
     }
     
     export function cleanText(text: string): string {
       return text
         .replace(/\*\*(.*?)\*\*/g, '$1')  // Remove bold markdown
         .replace(/\*(.*?)\*/g, '$1')       // Remove italic markdown
         .replace(/`(.*?)`/g, '$1')         // Remove code markdown
         .replace(/\[(.*?)\]\(.*?\)/g, '$1') // Remove links, keep text
         .trim();
     }
     
     export function formatDate(date: Date, locale: string = 'en'): string {
       return date.toLocaleDateString(locale === 'fa' ? 'fa-IR' : 'en-US', {
         year: 'numeric',
         month: 'long',
         day: 'numeric'
       });
     }
     ```

  2. Create docx-generator.ts:
     ```typescript
     // ============================================
     // [F075] src/lib/generators/docx-generator.ts
     // ============================================
     
     import {
       Document,
       Paragraph,
       TextRun,
       HeadingLevel,
       AlignmentType,
       BorderStyle,
       Packer,
       PageBreak,
       Table,
       TableCell,
       TableRow,
       WidthType,
     } from 'docx';
     import { parseContentToSections, DocumentSection, cleanText } from './document-formatter';
     
     export interface DocxOptions {
       title?: string;
       author?: string;
       type: 'cv' | 'cover_letter' | 'email';
       locale?: 'en' | 'fa';
     }
     
     export async function generateDocx(
       content: string,
       options: DocxOptions
     ): Promise<Buffer> {
       const sections = parseContentToSections(content);
       const paragraphs = sectionsToDocxParagraphs(sections, options);
       
       const doc = new Document({
         creator: options.author || 'CV Tailor',
         title: options.title || 'Document',
         description: `Generated ${options.type} document`,
         styles: {
           paragraphStyles: [
             {
               id: 'Normal',
               name: 'Normal',
               basedOn: 'Normal',
               next: 'Normal',
               run: {
                 font: 'Arial',
                 size: 24,  // 12pt
               },
               paragraph: {
                 spacing: {
                   after: 200,
                   line: 276,  // 1.15 line spacing
                 },
               },
             },
             {
               id: 'Heading1',
               name: 'Heading 1',
               basedOn: 'Normal',
               next: 'Normal',
               run: {
                 font: 'Arial',
                 size: 36,  // 18pt
                 bold: true,
                 color: '2E74B5',
               },
               paragraph: {
                 spacing: {
                   before: 400,
                   after: 200,
                 },
               },
             },
             {
               id: 'Heading2',
               name: 'Heading 2',
               basedOn: 'Normal',
               next: 'Normal',
               run: {
                 font: 'Arial',
                 size: 28,  // 14pt
                 bold: true,
                 color: '404040',
               },
               paragraph: {
                 spacing: {
                   before: 300,
                   after: 150,
                 },
               },
             },
           ],
         },
         sections: [
           {
             properties: {
               page: {
                 margin: {
                   top: 1440,    // 1 inch
                   right: 1440,
                   bottom: 1440,
                   left: 1440,
                 },
               },
             },
             children: paragraphs,
           },
         ],
       });
       
       const buffer = await Packer.toBuffer(doc);
       return Buffer.from(buffer);
     }
     
     function sectionsToDocxParagraphs(
       sections: DocumentSection[],
       options: DocxOptions
     ): Paragraph[] {
       const paragraphs: Paragraph[] = [];
       const isRTL = options.locale === 'fa';
       
       for (const section of sections) {
         switch (section.type) {
           case 'heading':
             paragraphs.push(
               new Paragraph({
                 text: cleanText(section.content || ''),
                 heading: section.level === 1 
                   ? HeadingLevel.HEADING_1 
                   : section.level === 2 
                     ? HeadingLevel.HEADING_2 
                     : HeadingLevel.HEADING_3,
                 alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT,
                 bidirectional: isRTL,
               })
             );
             break;
             
           case 'paragraph':
             paragraphs.push(
               new Paragraph({
                 children: [
                   new TextRun({
                     text: cleanText(section.content || ''),
                     font: 'Arial',
                     size: 24,
                   }),
                 ],
                 alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT,
                 bidirectional: isRTL,
               })
             );
             break;
             
           case 'list':
             for (const item of section.items || []) {
               paragraphs.push(
                 new Paragraph({
                   children: [
                     new TextRun({
                       text: `â€¢ ${cleanText(item)}`,
                       font: 'Arial',
                       size: 24,
                     }),
                   ],
                   indent: {
                     left: 720,  // 0.5 inch
                   },
                   alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT,
                   bidirectional: isRTL,
                 })
               );
             }
             break;
             
           case 'divider':
             paragraphs.push(
               new Paragraph({
                 children: [],
                 border: {
                   bottom: {
                     color: 'CCCCCC',
                     space: 1,
                     style: BorderStyle.SINGLE,
                     size: 6,
                   },
                 },
                 spacing: {
                   before: 200,
                   after: 200,
                 },
               })
             );
             break;
         }
       }
       
       return paragraphs;
     }
     
     export async function generateCVDocx(
       content: string,
       name: string,
       locale: 'en' | 'fa' = 'en'
     ): Promise<Buffer> {
       return generateDocx(content, {
         title: `${name} - CV`,
         author: name,
         type: 'cv',
         locale,
       });
     }
     
     export async function generateCoverLetterDocx(
       content: string,
       name: string,
       locale: 'en' | 'fa' = 'en'
     ): Promise<Buffer> {
       return generateDocx(content, {
         title: `${name} - Cover Letter`,
         author: name,
         type: 'cover_letter',
         locale,
       });
     }
     
     export async function generateEmailDocx(
       content: string,
       name: string,
       locale: 'en' | 'fa' = 'en'
     ): Promise<Buffer> {
       return generateDocx(content, {
         title: `${name} - Application Email`,
         author: name,
         type: 'email',
         locale,
       });
     }
     ```

  3. Create markdown-generator.ts:
     ```typescript
     // ============================================
     // [F076] src/lib/generators/markdown-generator.ts
     // ============================================
     
     export interface MarkdownOptions {
       title?: string;
       includeMetadata?: boolean;
       type: 'cv' | 'cover_letter' | 'email';
     }
     
     export function generateMarkdown(
       content: string,
       options: MarkdownOptions
     ): string {
       let markdown = '';
       
       // Add YAML frontmatter if requested
       if (options.includeMetadata) {
         markdown += '---\n';
         markdown += `title: "${options.title || 'Document'}"\n`;
         markdown += `type: ${options.type}\n`;
         markdown += `generated: ${new Date().toISOString()}\n`;
         markdown += '---\n\n';
       }
       
       // Add title if provided
       if (options.title) {
         markdown += `# ${options.title}\n\n`;
       }
       
       // Add content (already in markdown format or plain text)
       markdown += content;
       
       // Ensure proper line endings
       markdown = markdown.replace(/\r\n/g, '\n');
       
       return markdown;
     }
     
     export function generateCVMarkdown(
       content: string,
       name: string
     ): string {
       return generateMarkdown(content, {
         title: `${name} - CV`,
         type: 'cv',
         includeMetadata: true,
       });
     }
     
     export function generateCoverLetterMarkdown(
       content: string,
       name: string
     ): string {
       return generateMarkdown(content, {
         title: `${name} - Cover Letter`,
         type: 'cover_letter',
         includeMetadata: true,
       });
     }
     
     export function generateEmailMarkdown(
       content: string,
       name: string
     ): string {
       return generateMarkdown(content, {
         title: `${name} - Application Email`,
         type: 'email',
         includeMetadata: true,
       });
     }
     
     // Convert HTML to Markdown (basic)
     export function htmlToMarkdown(html: string): string {
       let md = html;
       
       // Headers
       md = md.replace(/<h1[^>]*>(.*?)<\/h1>/gi, '# $1\n\n');
       md = md.replace(/<h2[^>]*>(.*?)<\/h2>/gi, '## $1\n\n');
       md = md.replace(/<h3[^>]*>(.*?)<\/h3>/gi, '### $1\n\n');
       
       // Bold and italic
       md = md.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**');
       md = md.replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**');
       md = md.replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*');
       md = md.replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*');
       
       // Lists
       md = md.replace(/<ul[^>]*>/gi, '');
       md = md.replace(/<\/ul>/gi, '\n');
       md = md.replace(/<ol[^>]*>/gi, '');
       md = md.replace(/<\/ol>/gi, '\n');
       md = md.replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1\n');
       
       // Paragraphs and line breaks
       md = md.replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n');
       md = md.replace(/<br\s*\/?>/gi, '\n');
       
       // Links
       md = md.replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)');
       
       // Remove remaining HTML tags
       md = md.replace(/<[^>]+>/g, '');
       
       // Decode HTML entities
       md = md.replace(/&nbsp;/g, ' ');
       md = md.replace(/&amp;/g, '&');
       md = md.replace(/&lt;/g, '<');
       md = md.replace(/&gt;/g, '>');
       md = md.replace(/&quot;/g, '"');
       
       // Clean up extra whitespace
       md = md.replace(/\n{3,}/g, '\n\n');
       md = md.trim();
       
       return md;
     }
     ```

  4. Create index.ts:
     ```typescript
     // ============================================
     // [F143] src/lib/generators/index.ts
     // ============================================
     
     export * from './docx-generator';
     export * from './markdown-generator';
     export * from './document-formatter';
     ```

  5. Create API route for Word export:
     ```typescript
     // ============================================
     // [F025] src/app/api/export/docx/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { generateDocx } from '@/lib/generators';
     
     export async function POST(request: NextRequest) {
       try {
         const { content, filename, type, locale } = await request.json();
         
         if (!content) {
           return NextResponse.json(
             { error: 'Content is required' },
             { status: 400 }
           );
         }
         
         const buffer = await generateDocx(content, {
           title: filename || 'Document',
           type: type || 'cv',
           locale: locale || 'en',
         });
         
         return new NextResponse(buffer, {
           headers: {
             'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
             'Content-Disposition': `attachment; filename="${filename || 'document'}.docx"`,
           },
         });
         
       } catch (error: any) {
         console.error('DOCX export error:', error);
         return NextResponse.json(
           { error: error.message || 'Export failed' },
           { status: 500 }
         );
       }
     }
     ```

  6. Create API route for Markdown export:
     ```typescript
     // ============================================
     // [F026] src/app/api/export/markdown/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { generateMarkdown, htmlToMarkdown } from '@/lib/generators';
     
     export async function POST(request: NextRequest) {
       try {
         const { content, filename, type, isHtml } = await request.json();
         
         if (!content) {
           return NextResponse.json(
             { error: 'Content is required' },
             { status: 400 }
           );
         }
         
         // Convert HTML to Markdown if needed
         const markdownContent = isHtml ? htmlToMarkdown(content) : content;
         
         const markdown = generateMarkdown(markdownContent, {
           title: filename,
           type: type || 'cv',
           includeMetadata: true,
         });
         
         return new NextResponse(markdown, {
           headers: {
             'Content-Type': 'text/markdown; charset=utf-8',
             'Content-Disposition': `attachment; filename="${filename || 'document'}.md"`,
           },
         });
         
       } catch (error: any) {
         console.error('Markdown export error:', error);
         return NextResponse.json(
           { error: error.message || 'Export failed' },
           { status: 500 }
         );
       }
     }
     ```

  7. Create API route for ZIP export (all documents):
     ```typescript
     // ============================================
     // [F144] src/app/api/export/all/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { generateDocx } from '@/lib/generators';
     import JSZip from 'jszip';
     
     export async function POST(request: NextRequest) {
       try {
         const { documents, name, format, locale } = await request.json();
         
         if (!documents || !documents.tailored_cv || !documents.cover_letter || !documents.application_email) {
           return NextResponse.json(
             { error: 'All documents are required' },
             { status: 400 }
           );
         }
         
         const zip = new JSZip();
         const baseName = name || 'application';
         
         if (format === 'docx' || format === 'both') {
           // Generate Word documents
           const cvBuffer = await generateDocx(documents.tailored_cv, {
             title: `${baseName} - CV`,
             type: 'cv',
             locale,
           });
           zip.file(`${baseName}-cv.docx`, cvBuffer);
           
           const coverBuffer = await generateDocx(documents.cover_letter, {
             title: `${baseName} - Cover Letter`,
             type: 'cover_letter',
             locale,
           });
           zip.file(`${baseName}-cover-letter.docx`, coverBuffer);
           
           const emailBuffer = await generateDocx(documents.application_email, {
             title: `${baseName} - Application Email`,
             type: 'email',
             locale,
           });
           zip.file(`${baseName}-email.docx`, emailBuffer);
         }
         
         if (format === 'md' || format === 'both') {
           // Add Markdown files
           zip.file(`${baseName}-cv.md`, documents.tailored_cv);
           zip.file(`${baseName}-cover-letter.md`, documents.cover_letter);
           zip.file(`${baseName}-email.md`, documents.application_email);
         }
         
         const zipBuffer = await zip.generateAsync({ type: 'nodebuffer' });
         
         return new NextResponse(zipBuffer, {
           headers: {
             'Content-Type': 'application/zip',
             'Content-Disposition': `attachment; filename="${baseName}-documents.zip"`,
           },
         });
         
       } catch (error: any) {
         console.error('ZIP export error:', error);
         return NextResponse.json(
           { error: error.message || 'Export failed' },
           { status: 500 }
         );
       }
     }
     ```

checkpoint_tests:
  - id: T01
    description: "All generator files exist"
    type: "files_exist"
    files:
      - "src/lib/generators/docx-generator.ts"
      - "src/lib/generators/markdown-generator.ts"
      - "src/lib/generators/document-formatter.ts"
      - "src/lib/generators/index.ts"

  - id: T02
    description: "All export API routes exist"
    type: "files_exist"
    files:
      - "src/app/api/export/docx/route.ts"
      - "src/app/api/export/markdown/route.ts"
      - "src/app/api/export/all/route.ts"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "docx-generator exports generate functions"
    type: "grep"
    file: "src/lib/generators/docx-generator.ts"
    patterns:
      - "export async function generateDocx"
      - "generateCVDocx"
      - "generateCoverLetterDocx"
      - "Document"
      - "Packer"

  - id: T05
    description: "markdown-generator exports functions"
    type: "grep"
    file: "src/lib/generators/markdown-generator.ts"
    patterns:
      - "export function generateMarkdown"
      - "htmlToMarkdown"

  - id: T06
    description: "Export routes return correct content types"
    type: "grep"
    file: "src/app/api/export/docx/route.ts"
    patterns:
      - "application/vnd.openxmlformats"
      - "Content-Disposition"

max_retries: 3
B20.yaml â€” Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Templates
YAML

# blocks/B20.yaml

id: B20
name: "Template Management System"
phase: 4
phase_name: "Export & Templates"

goal: |
  Create a system for managing document templates. Users can upload Word or Markdown
  templates that will be used when generating final documents. Templates can have
  placeholders that get replaced with actual content.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B19]

files_to_create:
  - id: F145
    path: "src/lib/templates/template-service.ts"
    description: "Template CRUD service"

  - id: F146
    path: "src/lib/templates/template-parser.ts"
    description: "Parse and apply templates"

  - id: F147
    path: "src/lib/templates/index.ts"
    description: "Export all template modules"

  - id: F148
    path: "src/app/api/templates/route.ts"
    description: "API for templates CRUD"

  - id: F149
    path: "src/app/api/templates/[id]/route.ts"
    description: "API for single template"

  - id: F150
    path: "src/hooks/useTemplates.ts"
    description: "React hook for templates"

  - id: F060
    path: "src/components/templates/TemplateUploader.tsx"
    description: "Upload template files"

  - id: F061
    path: "src/components/templates/TemplateSelector.tsx"
    description: "Select templates for documents"

  - id: F062
    path: "src/components/templates/TemplatePreview.tsx"
    description: "Preview template content"

  - id: F151
    path: "src/components/templates/TemplateList.tsx"
    description: "List all templates"

  - id: F152
    path: "src/components/templates/TemplateCard.tsx"
    description: "Template card display"

files_to_modify:
  - id: F087
    path: "src/i18n/en.json"
    description: "Add template translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Add template translations"

files_available:
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F072
    path: "src/lib/parsers/docx-parser.ts"
    from_block: B09
  - id: F073
    path: "src/lib/parsers/markdown-parser.ts"
    from_block: B09
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07

commands: []

instructions: |
  1. Create template-service.ts:
     ```typescript
     // ============================================
     // [F145] src/lib/templates/template-service.ts
     // ============================================
     
     import { SupabaseClient } from '@supabase/supabase-js';
     import { Template, TemplateType, FileFormat } from '@/lib/types';
     
     export class TemplateService {
       constructor(private supabase: SupabaseClient) {}
       
       async getTemplates(userId: string): Promise<Template[]> {
         const { data, error } = await this.supabase
           .from('templates')
           .select('*')
           .eq('user_id', userId)
           .order('created_at', { ascending: false });
         
         if (error) throw error;
         return data || [];
       }
       
       async getTemplatesByType(userId: string, type: TemplateType): Promise<Template[]> {
         const { data, error } = await this.supabase
           .from('templates')
           .select('*')
           .eq('user_id', userId)
           .eq('template_type', type)
           .order('created_at', { ascending: false });
         
         if (error) throw error;
         return data || [];
       }
       
       async getTemplate(id: string, userId: string): Promise<Template | null> {
         const { data, error } = await this.supabase
           .from('templates')
           .select('*')
           .eq('id', id)
           .eq('user_id', userId)
           .single();
         
         if (error) {
           if (error.code === 'PGRST116') return null;
           throw error;
         }
         
         return data;
       }
       
       async createTemplate(
         userId: string,
         template: {
           template_name: string;
           template_type: TemplateType;
           file_format: FileFormat;
           file_content: string;
         }
       ): Promise<Template> {
         const { data, error } = await this.supabase
           .from('templates')
           .insert({
             user_id: userId,
             ...template
           })
           .select()
           .single();
         
         if (error) throw error;
         return data;
       }
       
       async updateTemplate(
         id: string,
         userId: string,
         updates: Partial<Template>
       ): Promise<Template> {
         const { id: _, user_id, created_at, ...validUpdates } = updates as any;
         
         const { data, error } = await this.supabase
           .from('templates')
           .update(validUpdates)
           .eq('id', id)
           .eq('user_id', userId)
           .select()
           .single();
         
         if (error) throw error;
         return data;
       }
       
       async deleteTemplate(id: string, userId: string): Promise<void> {
         const { error } = await this.supabase
           .from('templates')
           .delete()
           .eq('id', id)
           .eq('user_id', userId);
         
         if (error) throw error;
       }
     }
     
     export function createTemplateService(supabase: SupabaseClient): TemplateService {
       return new TemplateService(supabase);
     }
     ```

  2. Create template-parser.ts:
     ```typescript
     // ============================================
     // [F146] src/lib/templates/template-parser.ts
     // ============================================
     
     export interface TemplatePlaceholders {
       // Personal Info
       '{{NAME}}': string;
       '{{EMAIL}}': string;
       '{{PHONE}}': string;
       '{{LOCATION}}': string;
       '{{LINKEDIN}}': string;
       '{{WEBSITE}}': string;
       
       // Content
       '{{CONTENT}}': string;
       '{{CV_CONTENT}}': string;
       '{{COVER_LETTER_CONTENT}}': string;
       '{{EMAIL_CONTENT}}': string;
       
       // Job Info
       '{{JOB_TITLE}}': string;
       '{{COMPANY}}': string;
       
       // Date
       '{{DATE}}': string;
       '{{YEAR}}': string;
       
       [key: string]: string;
     }
     
     export function applyTemplate(
       templateContent: string,
       placeholders: Partial<TemplatePlaceholders>
     ): string {
       let result = templateContent;
       
       for (const [placeholder, value] of Object.entries(placeholders)) {
         if (value) {
           const regex = new RegExp(escapeRegex(placeholder), 'g');
           result = result.replace(regex, value);
         }
       }
       
       // Remove any remaining placeholders
       result = result.replace(/\{\{[A-Z_]+\}\}/g, '');
       
       return result;
     }
     
     function escapeRegex(string: string): string {
       return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
     }
     
     export function extractPlaceholders(templateContent: string): string[] {
       const matches = templateContent.match(/\{\{[A-Z_]+\}\}/g);
       return matches ? [...new Set(matches)] : [];
     }
     
     export function validateTemplate(templateContent: string): {
       isValid: boolean;
       errors: string[];
       placeholders: string[];
     } {
       const errors: string[] = [];
       const placeholders = extractPlaceholders(templateContent);
       
       // Check for required placeholders
       if (!placeholders.includes('{{CONTENT}}') && 
           !placeholders.includes('{{CV_CONTENT}}') &&
           !placeholders.includes('{{COVER_LETTER_CONTENT}}') &&
           !placeholders.includes('{{EMAIL_CONTENT}}')) {
         errors.push('Template must include at least one content placeholder ({{CONTENT}}, {{CV_CONTENT}}, etc.)');
       }
       
       // Check for unclosed placeholders
       const unclosed = templateContent.match(/\{\{[^}]*$/gm);
       if (unclosed) {
         errors.push('Template has unclosed placeholders');
       }
       
       return {
         isValid: errors.length === 0,
         errors,
         placeholders
       };
     }
     
     export const DEFAULT_CV_TEMPLATE = `# {{NAME}}

     {{EMAIL}} | {{PHONE}} | {{LOCATION}}
     {{LINKEDIN}} | {{WEBSITE}}

     ---

     {{CV_CONTENT}}
     `;
     
     export const DEFAULT_COVER_LETTER_TEMPLATE = `{{DATE}}

     Dear Hiring Manager,

     {{COVER_LETTER_CONTENT}}

     Sincerely,
     {{NAME}}
     {{EMAIL}}
     {{PHONE}}
     `;
     
     export const DEFAULT_EMAIL_TEMPLATE = `Subject: Application for {{JOB_TITLE}} Position

     {{EMAIL_CONTENT}}

     Best regards,
     {{NAME}}
     `;
     ```

  3. Create index.ts:
     ```typescript
     // ============================================
     // [F147] src/lib/templates/index.ts
     // ============================================
     
     export * from './template-service';
     export * from './template-parser';
     ```

  4. Create API routes:
     ```typescript
     // ============================================
     // [F148] src/app/api/templates/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createTemplateService } from '@/lib/templates';
     
     export async function GET(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const { searchParams } = new URL(request.url);
         const type = searchParams.get('type');
         
         const supabase = createServerSupabaseClient();
         const service = createTemplateService(supabase);
         
         const templates = type
           ? await service.getTemplatesByType(userId, type as any)
           : await service.getTemplates(userId);
         
         return NextResponse.json({ templates });
         
       } catch (error: any) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
     }
     
     export async function POST(request: NextRequest) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const body = await request.json();
         const { template_name, template_type, file_format, file_content } = body;
         
         if (!template_name || !template_type || !file_format || !file_content) {
           return NextResponse.json({ error: 'Missing required fields' }, { status: 400 });
         }
         
         const supabase = createServerSupabaseClient();
         const service = createTemplateService(supabase);
         
         const template = await service.createTemplate(userId, {
           template_name,
           template_type,
           file_format,
           file_content
         });
         
         return NextResponse.json({ template, success: true });
         
       } catch (error: any) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
     }
     ```

     ```typescript
     // ============================================
     // [F149] src/app/api/templates/[id]/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { createTemplateService } from '@/lib/templates';
     
     interface RouteParams {
       params: { id: string };
     }
     
     export async function GET(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const supabase = createServerSupabaseClient();
         const service = createTemplateService(supabase);
         
         const template = await service.getTemplate(params.id, userId);
         
         if (!template) {
           return NextResponse.json({ error: 'Not found' }, { status: 404 });
         }
         
         return NextResponse.json({ template });
         
       } catch (error: any) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
     }
     
     export async function PUT(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const body = await request.json();
         
         const supabase = createServerSupabaseClient();
         const service = createTemplateService(supabase);
         
         const template = await service.updateTemplate(params.id, userId, body);
         
         return NextResponse.json({ template, success: true });
         
       } catch (error: any) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
     }
     
     export async function DELETE(request: NextRequest, { params }: RouteParams) {
       try {
         const userId = request.headers.get('x-user-id');
         if (!userId) {
           return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
         }
         
         const supabase = createServerSupabaseClient();
         const service = createTemplateService(supabase);
         
         await service.deleteTemplate(params.id, userId);
         
         return NextResponse.json({ success: true });
         
       } catch (error: any) {
         return NextResponse.json({ error: error.message }, { status: 500 });
       }
     }
     ```

  5. Create useTemplates hook:
     ```typescript
     // ============================================
     // [F150] src/hooks/useTemplates.ts
     // ============================================
     
     'use client';
     
     import { useState, useEffect, useCallback } from 'react';
     import { useAuth } from '@/context/AuthContext';
     import { Template, TemplateType, FileFormat } from '@/lib/types';
     
     export function useTemplates(type?: TemplateType) {
       const { user } = useAuth();
       const [templates, setTemplates] = useState<Template[]>([]);
       const [loading, setLoading] = useState(true);
       const [error, setError] = useState<string | null>(null);
       
       const fetchTemplates = useCallback(async () => {
         if (!user) return;
         
         setLoading(true);
         setError(null);
         
         try {
           const params = type ? `?type=${type}` : '';
           const res = await fetch(`/api/templates${params}`, {
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           if (data.error) throw new Error(data.error);
           
           setTemplates(data.templates || []);
           
         } catch (err: any) {
           setError(err.message);
         } finally {
           setLoading(false);
         }
       }, [user, type]);
       
       useEffect(() => {
         fetchTemplates();
       }, [fetchTemplates]);
       
       const createTemplate = useCallback(async (
         template: {
           template_name: string;
           template_type: TemplateType;
           file_format: FileFormat;
           file_content: string;
         }
       ): Promise<Template> => {
         if (!user) throw new Error('Not authenticated');
         
         const res = await fetch('/api/templates', {
           method: 'POST',
           headers: {
             'Content-Type': 'application/json',
             'x-user-id': user.id
           },
           body: JSON.stringify(template)
         });
         
         const data = await res.json();
         if (data.error) throw new Error(data.error);
         
         setTemplates(prev => [data.template, ...prev]);
         return data.template;
       }, [user]);
       
       const deleteTemplate = useCallback(async (id: string) => {
         if (!user) throw new Error('Not authenticated');
         
         const res = await fetch(`/api/templates/${id}`, {
           method: 'DELETE',
           headers: { 'x-user-id': user.id }
         });
         
         const data = await res.json();
         if (data.error) throw new Error(data.error);
         
         setTemplates(prev => prev.filter(t => t.id !== id));
       }, [user]);
       
       return {
         templates,
         loading,
         error,
         fetchTemplates,
         createTemplate,
         deleteTemplate
       };
     }
     ```

  6. Create TemplateCard.tsx:
     ```typescript
     // ============================================
     // [F152] src/components/templates/TemplateCard.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Template } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { FileText, File, Trash2, Eye } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     interface TemplateCardProps {
       template: Template;
       onPreview?: () => void;
       onDelete?: () => void;
       onSelect?: () => void;
       selected?: boolean;
       selectable?: boolean;
       className?: string;
     }
     
     export function TemplateCard({
       template,
       onPreview,
       onDelete,
       onSelect,
       selected = false,
       selectable = false,
       className
     }: TemplateCardProps) {
       const t = useTranslations('templates');
       
       const typeLabels: Record<string, string> = {
         cv: t('type_cv'),
         cover_letter: t('type_cover_letter'),
         email: t('type_email')
       };
       
       const formatIcon = template.file_format === 'docx' ? File : FileText;
       const FormatIcon = formatIcon;
       
       return (
         <Card 
           className={cn(
             'cursor-pointer transition-all hover:border-primary',
             selected && 'border-primary ring-2 ring-primary/20',
             className
           )}
           onClick={() => selectable && onSelect?.()}
         >
           <CardHeader className="pb-2">
             <div className="flex items-center justify-between">
               <CardTitle className="text-base flex items-center gap-2">
                 <FormatIcon className="h-4 w-4" />
                 {template.template_name}
               </CardTitle>
               <Badge variant="outline" className="text-xs">
                 {typeLabels[template.template_type]}
               </Badge>
             </div>
           </CardHeader>
           <CardContent>
             <div className="flex items-center justify-between">
               <Badge variant="secondary" className="text-xs">
                 .{template.file_format}
               </Badge>
               <div className="flex gap-1">
                 {onPreview && (
                   <Button 
                     variant="ghost" 
                     size="sm"
                     onClick={(e) => { e.stopPropagation(); onPreview(); }}
                   >
                     <Eye className="h-4 w-4" />
                   </Button>
                 )}
                 {onDelete && (
                   <Button 
                     variant="ghost" 
                     size="sm"
                     onClick={(e) => { e.stopPropagation(); onDelete(); }}
                   >
                     <Trash2 className="h-4 w-4 text-destructive" />
                   </Button>
                 )}
               </div>
             </div>
           </CardContent>
         </Card>
       );
     }
     ```

  7. Create TemplateUploader.tsx:
     ```typescript
     // ============================================
     // [F060] src/components/templates/TemplateUploader.tsx
     // ============================================
     
     'use client';
     
     import { useState, useCallback } from 'react';
     import { useTranslations } from 'next-intl';
     import { useTemplates } from '@/hooks/useTemplates';
     import { TemplateType, FileFormat } from '@/lib/types';
     import { parseFile } from '@/lib/parsers';
     import { validateTemplate } from '@/lib/templates';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogFooter,
     } from '@/components/ui/dialog';
     import { Button } from '@/components/ui/button';
     import { Input } from '@/components/ui/input';
     import { Label } from '@/components/ui/label';
     import {
       Select,
       SelectContent,
       SelectItem,
       SelectTrigger,
       SelectValue,
     } from '@/components/ui/select';
     import { FileDropZone } from '@/components/cv/FileDropZone';
     import { Alert, AlertDescription } from '@/components/ui/alert';
     import { Loader2, AlertCircle, CheckCircle } from 'lucide-react';
     
     interface TemplateUploaderProps {
       open: boolean;
       onClose: () => void;
       onSuccess?: () => void;
     }
     
     export function TemplateUploader({ open, onClose, onSuccess }: TemplateUploaderProps) {
       const t = useTranslations('templates');
       const { createTemplate } = useTemplates();
       
       const [name, setName] = useState('');
       const [type, setType] = useState<TemplateType>('cv');
       const [content, setContent] = useState('');
       const [format, setFormat] = useState<FileFormat>('md');
       const [errors, setErrors] = useState<string[]>([]);
       const [saving, setSaving] = useState(false);
       
       const handleFileSelect = useCallback(async (file: File) => {
         try {
           const parsed = await parseFile(file);
           setContent(parsed.text);
           
           // Detect format
           const ext = file.name.split('.').pop()?.toLowerCase();
           setFormat(ext === 'docx' ? 'docx' : 'md');
           
           // Use filename as template name if not set
           if (!name) {
             setName(file.name.replace(/\.[^/.]+$/, ''));
           }
           
           // Validate
           const validation = validateTemplate(parsed.text);
           setErrors(validation.errors);
           
         } catch (err: any) {
           setErrors([err.message]);
         }
       }, [name]);
       
       const handleSave = async () => {
         if (!name || !content) return;
         
         setSaving(true);
         try {
           await createTemplate({
             template_name: name,
             template_type: type,
             file_format: format,
             file_content: content
           });
           
           onSuccess?.();
           onClose();
           
           // Reset form
           setName('');
           setContent('');
           setErrors([]);
           
         } catch (err: any) {
           setErrors([err.message]);
         } finally {
           setSaving(false);
         }
       };
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-lg">
             <DialogHeader>
               <DialogTitle>{t('upload_template')}</DialogTitle>
             </DialogHeader>
             
             <div className="space-y-4 py-4">
               <div className="grid gap-2">
                 <Label>{t('template_name')}</Label>
                 <Input
                   value={name}
                   onChange={(e) => setName(e.target.value)}
                   placeholder={t('template_name_placeholder')}
                 />
               </div>
               
               <div className="grid gap-2">
                 <Label>{t('template_type')}</Label>
                 <Select value={type} onValueChange={(v) => setType(v as TemplateType)}>
                   <SelectTrigger>
                     <SelectValue />
                   </SelectTrigger>
                   <SelectContent>
                     <SelectItem value="cv">{t('type_cv')}</SelectItem>
                     <SelectItem value="cover_letter">{t('type_cover_letter')}</SelectItem>
                     <SelectItem value="email">{t('type_email')}</SelectItem>
                   </SelectContent>
                 </Select>
               </div>
               
               <div className="grid gap-2">
                 <Label>{t('upload_file')}</Label>
                 <FileDropZone
                   onFileSelect={handleFileSelect}
                   acceptedTypes={['.docx', '.md', '.txt']}
                 />
               </div>
               
               {content && errors.length === 0 && (
                 <Alert className="bg-green-50 border-green-200">
                   <CheckCircle className="h-4 w-4 text-green-600" />
                   <AlertDescription className="text-green-700">
                     {t('template_valid')}
                   </AlertDescription>
                 </Alert>
               )}
               
               {errors.length > 0 && (
                 <Alert variant="destructive">
                   <AlertCircle className="h-4 w-4" />
                   <AlertDescription>
                     {errors.map((e, i) => <div key={i}>{e}</div>)}
                   </AlertDescription>
                 </Alert>
               )}
             </div>
             
             <DialogFooter>
               <Button variant="outline" onClick={onClose} disabled={saving}>
                 {t('cancel')}
               </Button>
               <Button 
                 onClick={handleSave} 
                 disabled={!name || !content || errors.length > 0 || saving}
               >
                 {saving ? <Loader2 className="h-4 w-4 animate-spin mr-2" /> : null}
                 {t('save')}
               </Button>
             </DialogFooter>
           </DialogContent>
         </Dialog>
       );
     }
     ```

  8. Create TemplateList.tsx:
     ```typescript
     // ============================================
     // [F151] src/components/templates/TemplateList.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { Template } from '@/lib/types';
     import { TemplateCard } from './TemplateCard';
     import { TemplatePreview } from './TemplatePreview';
     import { Loader2 } from 'lucide-react';
     
     interface TemplateListProps {
       templates: Template[];
       loading?: boolean;
       onDelete?: (template: Template) => void;
       className?: string;
     }
     
     export function TemplateList({
       templates,
       loading = false,
       onDelete,
       className
     }: TemplateListProps) {
       const t = useTranslations('templates');
       const [previewTemplate, setPreviewTemplate] = useState<Template | null>(null);
       
       if (loading) {
         return (
           <div className="flex items-center justify-center py-12">
             <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
           </div>
         );
       }
       
       if (templates.length === 0) {
         return (
           <div className="text-center py-12 text-muted-foreground">
             {t('no_templates')}
           </div>
         );
       }
       
       return (
         <>
           <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
             {templates.map((template) => (
               <TemplateCard
                 key={template.id}
                 template={template}
                 onPreview={() => setPreviewTemplate(template)}
                 onDelete={() => onDelete?.(template)}
               />
             ))}
           </div>
           
           <TemplatePreview
             template={previewTemplate}
             open={previewTemplate !== null}
             onClose={() => setPreviewTemplate(null)}
           />
         </>
       );
     }
     ```

  9. Create TemplatePreview.tsx:
     ```typescript
     // ============================================
     // [F062] src/components/templates/TemplatePreview.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Template } from '@/lib/types';
     import { extractPlaceholders } from '@/lib/templates';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
     } from '@/components/ui/dialog';
     import { Badge } from '@/components/ui/badge';
     import { ScrollArea } from '@/components/ui/scroll-area';
     
     interface TemplatePreviewProps {
       template: Template | null;
       open: boolean;
       onClose: () => void;
     }
     
     export function TemplatePreview({ template, open, onClose }: TemplatePreviewProps) {
       const t = useTranslations('templates');
       
       if (!template) return null;
       
       const placeholders = extractPlaceholders(template.file_content);
       
       return (
         <Dialog open={open} onOpenChange={onClose}>
           <DialogContent className="max-w-2xl max-h-[80vh]">
             <DialogHeader>
               <DialogTitle>{template.template_name}</DialogTitle>
             </DialogHeader>
             
             <div className="space-y-4">
               <div className="flex flex-wrap gap-2">
                 <Badge>{template.template_type}</Badge>
                 <Badge variant="outline">.{template.file_format}</Badge>
               </div>
               
               {placeholders.length > 0 && (
                 <div>
                   <p className="text-sm font-medium mb-2">{t('placeholders')}:</p>
                   <div className="flex flex-wrap gap-1">
                     {placeholders.map((p) => (
                       <Badge key={p} variant="secondary" className="text-xs">
                         {p}
                       </Badge>
                     ))}
                   </div>
                 </div>
               )}
               
               <ScrollArea className="h-[400px] border rounded-md p-4 bg-muted/30">
                 <pre className="text-sm whitespace-pre-wrap font-mono">
                   {template.file_content}
                 </pre>
               </ScrollArea>
             </div>
           </DialogContent>
         </Dialog>
       );
     }
     ```

  10. Create TemplateSelector.tsx:
      ```typescript
      // ============================================
      // [F061] src/components/templates/TemplateSelector.tsx
      // ============================================
      
      'use client';
      
      import { useTranslations } from 'next-intl';
      import { useTemplates } from '@/hooks/useTemplates';
      import { Template, TemplateType } from '@/lib/types';
      import { TemplateCard } from './TemplateCard';
      import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
      import { Loader2, FileText } from 'lucide-react';
      
      interface TemplateSelectorProps {
        type: TemplateType;
        selectedId: string | null;
        onSelect: (template: Template | null) => void;
        className?: string;
      }
      
      export function TemplateSelector({
        type,
        selectedId,
        onSelect,
        className
      }: TemplateSelectorProps) {
        const t = useTranslations('templates');
        const { templates, loading } = useTemplates(type);
        
        return (
          <Card className={className}>
            <CardHeader>
              <CardTitle className="text-base flex items-center gap-2">
                <FileText className="h-4 w-4" />
                {t('select_template')}
              </CardTitle>
            </CardHeader>
            <CardContent>
              {loading ? (
                <div className="flex items-center justify-center py-8">
                  <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />
                </div>
              ) : templates.length === 0 ? (
                <p className="text-sm text-muted-foreground text-center py-8">
                  {t('no_templates_for_type')}
                </p>
              ) : (
                <div className="grid gap-3">
                  {/* Default option */}
                  <div 
                    className={`p-3 border rounded-lg cursor-pointer transition-all hover:border-primary ${!selectedId ? 'border-primary bg-primary/5' : ''}`}
                    onClick={() => onSelect(null)}
                  >
                    <p className="font-medium">{t('use_default')}</p>
                    <p className="text-sm text-muted-foreground">{t('use_default_hint')}</p>
                  </div>
                  
                  {templates.map((template) => (
                    <TemplateCard
                      key={template.id}
                      template={template}
                      selected={selectedId === template.id}
                      selectable
                      onSelect={() => onSelect(template)}
                    />
                  ))}
                </div>
              )}
            </CardContent>
          </Card>
        );
      }
      ```

  11. Add translations to en.json under "templates":
      ```json
      {
        "templates": {
          "title": "Template Management",
          "upload_template": "Upload Template",
          "template_name": "Template Name",
          "template_name_placeholder": "My CV Template",
          "template_type": "Template Type",
          "type_cv": "CV",
          "type_cover_letter": "Cover Letter",
          "type_email": "Application Email",
          "upload_file": "Upload File",
          "template_valid": "Template is valid and ready to use",
          "save": "Save Template",
          "cancel": "Cancel",
          "no_templates": "No templates yet. Upload your first template!",
          "no_templates_for_type": "No templates available for this type",
          "placeholders": "Placeholders",
          "select_template": "Select Template (Optional)",
          "use_default": "Use Default Template",
          "use_default_hint": "No custom formatting, just the content"
        }
      }
      ```

  12. Add same translations to fa.json

checkpoint_tests:
  - id: T01
    description: "All template files exist"
    type: "files_exist"
    files:
      - "src/lib/templates/template-service.ts"
      - "src/lib/templates/template-parser.ts"
      - "src/lib/templates/index.ts"
      - "src/app/api/templates/route.ts"
      - "src/app/api/templates/[id]/route.ts"
      - "src/hooks/useTemplates.ts"

  - id: T02
    description: "All template components exist"
    type: "files_exist"
    files:
      - "src/components/templates/TemplateUploader.tsx"
      - "src/components/templates/TemplateSelector.tsx"
      - "src/components/templates/TemplatePreview.tsx"
      - "src/components/templates/TemplateList.tsx"
      - "src/components/templates/TemplateCard.tsx"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "Template parser has placeholder functions"
    type: "grep"
    file: "src/lib/templates/template-parser.ts"
    patterns:
      - "applyTemplate"
      - "extractPlaceholders"
      - "validateTemplate"

max_retries: 3
B21.yaml â€” Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
YAML

# blocks/B21.yaml

id: B21
name: "Dashboard Page"
phase: 5
phase_name: "Dashboard & Lists"

goal: |
  Create the main dashboard page that shows:
  - Summary statistics (applications count, CV status)
  - Recent applications
  - Quick actions (new application, update CV)
  - AI key status

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B15, B16, B17, B18]

files_to_create:
  - id: F153
    path: "src/components/dashboard/StatsCards.tsx"
    description: "Statistics cards component"

  - id: F154
    path: "src/components/dashboard/RecentApplications.tsx"
    description: "Recent applications list"

  - id: F155
    path: "src/components/dashboard/QuickActions.tsx"
    description: "Quick action buttons"

  - id: F156
    path: "src/components/dashboard/CVStatusCard.tsx"
    description: "CV completion status"

  - id: F157
    path: "src/components/dashboard/AIKeyStatus.tsx"
    description: "AI API key status"

  - id: F158
    path: "src/hooks/useDashboard.ts"
    description: "Dashboard data hook"

files_to_modify:
  - id: F012
    path: "src/app/[locale]/dashboard/page.tsx"
    description: "Dashboard page"

  - id: F087
    path: "src/i18n/en.json"
    description: "Dashboard translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Dashboard translations"

files_available:
  - id: F082
    path: "src/hooks/useCV.ts"
    from_block: B15
  - id: F081
    path: "src/hooks/useAIKeys.ts"
    from_block: B11
  - id: F084
    path: "src/hooks/useApplication.ts"
    from_block: B18
  - id: F090
    path: "src/context/AuthContext.tsx"
    from_block: B07
  - id: F092
    path: "src/components/auth/AuthGuard.tsx"
    from_block: B07

commands: []

instructions: |
  1. Create useDashboard.ts:
     ```typescript
     // ============================================
     // [F158] src/hooks/useDashboard.ts
     // ============================================
     
     'use client';
     
     import { useState, useEffect, useCallback } from 'react';
     import { useAuth } from '@/context/AuthContext';
     import { JobApplication } from '@/lib/types';
     
     interface DashboardStats {
       totalApplications: number;
       completedApplications: number;
       draftApplications: number;
       recentApplications: JobApplication[];
     }
     
     export function useDashboard() {
       const { user } = useAuth();
       const [stats, setStats] = useState<DashboardStats>({
         totalApplications: 0,
         completedApplications: 0,
         draftApplications: 0,
         recentApplications: []
       });
       const [loading, setLoading] = useState(true);
       const [error, setError] = useState<string | null>(null);
       
       const fetchStats = useCallback(async () => {
         if (!user) return;
         
         setLoading(true);
         setError(null);
         
         try {
           const res = await fetch('/api/applications', {
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           if (data.error) throw new Error(data.error);
           
           const applications = data.applications || [];
           
           setStats({
             totalApplications: applications.length,
             completedApplications: applications.filter((a: JobApplication) => a.status === 'completed').length,
             draftApplications: applications.filter((a: JobApplication) => a.status === 'draft').length,
             recentApplications: applications.slice(0, 5)
           });
           
         } catch (err: any) {
           setError(err.message);
         } finally {
           setLoading(false);
         }
       }, [user]);
       
       useEffect(() => {
         fetchStats();
       }, [fetchStats]);
       
       return { stats, loading, error, refresh: fetchStats };
     }
     ```

  2. Create StatsCards.tsx:
     ```typescript
     // ============================================
     // [F153] src/components/dashboard/StatsCards.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { FileText, CheckCircle, Clock, TrendingUp } from 'lucide-react';
     
     interface StatsCardsProps {
       totalApplications: number;
       completedApplications: number;
       draftApplications: number;
       className?: string;
     }
     
     export function StatsCards({
       totalApplications,
       completedApplications,
       draftApplications,
       className
     }: StatsCardsProps) {
       const t = useTranslations('dashboard');
       
       const cards = [
         {
           title: t('total_applications'),
           value: totalApplications,
           icon: FileText,
           color: 'text-blue-600',
           bg: 'bg-blue-100'
         },
         {
           title: t('completed'),
           value: completedApplications,
           icon: CheckCircle,
           color: 'text-green-600',
           bg: 'bg-green-100'
         },
         {
           title: t('in_progress'),
           value: draftApplications,
           icon: Clock,
           color: 'text-yellow-600',
           bg: 'bg-yellow-100'
         },
         {
           title: t('success_rate'),
           value: totalApplications > 0 
             ? `${Math.round((completedApplications / totalApplications) * 100)}%`
             : '0%',
           icon: TrendingUp,
           color: 'text-purple-600',
           bg: 'bg-purple-100'
         }
       ];
       
       return (
         <div className={`grid gap-4 md:grid-cols-2 lg:grid-cols-4 ${className}`}>
           {cards.map((card, i) => {
             const Icon = card.icon;
             return (
               <Card key={i}>
                 <CardHeader className="flex flex-row items-center justify-between pb-2">
                   <CardTitle className="text-sm font-medium text-muted-foreground">
                     {card.title}
                   </CardTitle>
                   <div className={`p-2 rounded-full ${card.bg}`}>
                     <Icon className={`h-4 w-4 ${card.color}`} />
                   </div>
                 </CardHeader>
                 <CardContent>
                   <p className="text-2xl font-bold">{card.value}</p>
                 </CardContent>
               </Card>
             );
           })}
         </div>
       );
     }
     ```

  3. Create RecentApplications.tsx:
     ```typescript
     // ============================================
     // [F154] src/components/dashboard/RecentApplications.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { JobApplication } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { formatDate } from '@/lib/utils';
     import { FileText, ArrowRight, Clock, CheckCircle, AlertCircle } from 'lucide-react';
     
     interface RecentApplicationsProps {
       applications: JobApplication[];
       className?: string;
     }
     
     const statusConfig: Record<string, { icon: React.ElementType; color: string }> = {
       completed: { icon: CheckCircle, color: 'text-green-600' },
       draft: { icon: Clock, color: 'text-yellow-600' },
       processing: { icon: Clock, color: 'text-blue-600' },
       error: { icon: AlertCircle, color: 'text-red-600' }
     };
     
     export function RecentApplications({ applications, className }: RecentApplicationsProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       
       return (
         <Card className={className}>
           <CardHeader className="flex flex-row items-center justify-between">
             <CardTitle className="flex items-center gap-2">
               <FileText className="h-5 w-5" />
               {t('recent_applications')}
             </CardTitle>
             <Link href={`/${locale}/applications`}>
               <Button variant="ghost" size="sm">
                 {t('view_all')}
                 <ArrowRight className="h-4 w-4 ml-1" />
               </Button>
             </Link>
           </CardHeader>
           <CardContent>
             {applications.length === 0 ? (
               <p className="text-muted-foreground text-center py-8">
                 {t('no_applications_yet')}
               </p>
             ) : (
               <div className="space-y-4">
                 {applications.map((app) => {
                   const config = statusConfig[app.status] || statusConfig.draft;
                   const Icon = config.icon;
                   const jobTitle = app.job_description.slice(0, 50) + (app.job_description.length > 50 ? '...' : '');
                   
                   return (
                     <Link 
                       key={app.id}
                       href={`/${locale}/applications/${app.id}`}
                       className="block"
                     >
                       <div className="flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50 transition-colors">
                         <div className="flex items-center gap-3">
                           <Icon className={`h-5 w-5 ${config.color}`} />
                           <div>
                             <p className="font-medium line-clamp-1">{jobTitle}</p>
                             <p className="text-sm text-muted-foreground">
                               {formatDate(app.created_at, locale)}
                             </p>
                           </div>
                         </div>
                         <Badge variant="outline">
                           {t(`status_${app.status}`)}
                         </Badge>
                       </div>
                     </Link>
                   );
                 })}
               </div>
             )}
           </CardContent>
         </Card>
       );
     }
     ```

  4. Create QuickActions.tsx:
     ```typescript
     // ============================================
     // [F155] src/components/dashboard/QuickActions.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { PlusCircle, FileText, Settings, Sparkles } from 'lucide-react';
     
     interface QuickActionsProps {
       className?: string;
     }
     
     export function QuickActions({ className }: QuickActionsProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       
       const actions = [
         {
           label: t('new_application'),
           href: `/${locale}/new-application`,
           icon: PlusCircle,
           variant: 'default' as const
         },
         {
           label: t('manage_cv'),
           href: `/${locale}/cv-manager`,
           icon: FileText,
           variant: 'outline' as const
         },
         {
           label: t('manage_prompts'),
           href: `/${locale}/prompts`,
           icon: Sparkles,
           variant: 'outline' as const
         },
         {
           label: t('settings'),
           href: `/${locale}/settings`,
           icon: Settings,
           variant: 'outline' as const
         }
       ];
       
       return (
         <Card className={className}>
           <CardHeader>
             <CardTitle>{t('quick_actions')}</CardTitle>
           </CardHeader>
           <CardContent>
             <div className="grid gap-3 sm:grid-cols-2">
               {actions.map((action) => {
                 const Icon = action.icon;
                 return (
                   <Link key={action.href} href={action.href}>
                     <Button variant={action.variant} className="w-full justify-start">
                       <Icon className="h-4 w-4 mr-2" />
                       {action.label}
                     </Button>
                   </Link>
                 );
               })}
             </div>
           </CardContent>
         </Card>
       );
     }
     ```

  5. Create CVStatusCard.tsx:
     ```typescript
     // ============================================
     // [F156] src/components/dashboard/CVStatusCard.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { useCV } from '@/hooks/useCV';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { Progress } from '@/components/ui/progress';
     import { FileText, CheckCircle, AlertCircle, ArrowRight } from 'lucide-react';
     
     interface CVStatusCardProps {
       className?: string;
     }
     
     export function CVStatusCard({ className }: CVStatusCardProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       const { cv, loading, completionPercentage } = useCV();
       
       if (loading) {
         return (
           <Card className={className}>
             <CardContent className="py-6">
               <div className="animate-pulse space-y-3">
                 <div className="h-4 bg-muted rounded w-1/2" />
                 <div className="h-2 bg-muted rounded" />
               </div>
             </CardContent>
           </Card>
         );
       }
       
       return (
         <Card className={className}>
           <CardHeader className="flex flex-row items-center justify-between pb-2">
             <CardTitle className="flex items-center gap-2 text-base">
               <FileText className="h-5 w-5" />
               {t('cv_status')}
             </CardTitle>
             {cv ? (
               completionPercentage === 100 ? (
                 <CheckCircle className="h-5 w-5 text-green-600" />
               ) : (
                 <AlertCircle className="h-5 w-5 text-yellow-600" />
               )
             ) : null}
           </CardHeader>
           <CardContent>
             {cv ? (
               <div className="space-y-3">
                 <div className="flex items-center justify-between text-sm">
                   <span className="text-muted-foreground">{t('completion')}</span>
                   <span className="font-medium">{completionPercentage}%</span>
                 </div>
                 <Progress value={completionPercentage} />
                 <Link href={`/${locale}/cv-manager`}>
                   <Button variant="outline" size="sm" className="w-full mt-2">
                     {completionPercentage < 100 ? t('complete_cv') : t('update_cv')}
                     <ArrowRight className="h-4 w-4 ml-2" />
                   </Button>
                 </Link>
               </div>
             ) : (
               <div className="text-center py-4">
                 <p className="text-muted-foreground mb-3">{t('no_cv_yet')}</p>
                 <Link href={`/${locale}/cv-manager`}>
                   <Button>
                     {t('upload_cv')}
                     <ArrowRight className="h-4 w-4 ml-2" />
                   </Button>
                 </Link>
               </div>
             )}
           </CardContent>
         </Card>
       );
     }
     ```

  6. Create AIKeyStatus.tsx:
     ```typescript
     // ============================================
     // [F157] src/components/dashboard/AIKeyStatus.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { useAIKeys } from '@/hooks/useAIKeys';
     import { SUPPORTED_AI_PROVIDERS } from '@/lib/constants';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { Key, CheckCircle, XCircle, ArrowRight } from 'lucide-react';
     
     interface AIKeyStatusProps {
       className?: string;
     }
     
     export function AIKeyStatus({ className }: AIKeyStatusProps) {
       const t = useTranslations('dashboard');
       const params = useParams();
       const locale = params.locale as string;
       const { keys, loading, hasValidKey, getValidProviders } = useAIKeys();
       
       const validProviders = getValidProviders();
       
       if (loading) {
         return (
           <Card className={className}>
             <CardContent className="py-6">
               <div className="animate-pulse space-y-2">
                 <div className="h-4 bg-muted rounded w-1/2" />
                 <div className="h-4 bg-muted rounded w-1/3" />
               </div>
             </CardContent>
           </Card>
         );
       }
       
       return (
         <Card className={className}>
           <CardHeader className="flex flex-row items-center justify-between pb-2">
             <CardTitle className="flex items-center gap-2 text-base">
               <Key className="h-5 w-5" />
               {t('ai_status')}
             </CardTitle>
           </CardHeader>
           <CardContent>
             <div className="space-y-2">
               {SUPPORTED_AI_PROVIDERS.map((provider) => {
                 const isValid = hasValidKey(provider.name);
                 return (
                   <div 
                     key={provider.name}
                     className="flex items-center justify-between py-2"
                   >
                     <span className="text-sm">{provider.label}</span>
                     {isValid ? (
                       <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
                         <CheckCircle className="h-3 w-3 mr-1" />
                         {t('connected')}
                       </Badge>
                     ) : (
                       <Badge variant="outline" className="bg-gray-50 text-gray-500">
                         <XCircle className="h-3 w-3 mr-1" />
                         {t('not_configured')}
                       </Badge>
                     )}
                   </div>
                 );
               })}
             </div>
             
             {validProviders.length === 0 && (
               <Link href={`/${locale}/settings`}>
                 <Button variant="outline" size="sm" className="w-full mt-4">
                   {t('configure_ai')}
                   <ArrowRight className="h-4 w-4 ml-2" />
                 </Button>
               </Link>
             )}
           </CardContent>
         </Card>
       );
     }
     ```

  7. Update dashboard/page.tsx:
     ```typescript
     // ============================================
     // [F012] src/app/[locale]/dashboard/page.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { AuthGuard } from '@/components/auth/AuthGuard';
     import { useDashboard } from '@/hooks/useDashboard';
     import { StatsCards } from '@/components/dashboard/StatsCards';
     import { RecentApplications } from '@/components/dashboard/RecentApplications';
     import { QuickActions } from '@/components/dashboard/QuickActions';
     import { CVStatusCard } from '@/components/dashboard/CVStatusCard';
     import { AIKeyStatus } from '@/components/dashboard/AIKeyStatus';
     import { useAuth } from '@/context/AuthContext';
     import { LayoutDashboard, Loader2 } from 'lucide-react';
     
     export default function DashboardPage() {
       const t = useTranslations('dashboard');
       const { user } = useAuth();
       const { stats, loading, error } = useDashboard();
       
       return (
         <AuthGuard>
           <div className="container mx-auto p-6 max-w-7xl">
             {/* Header */}
             <div className="mb-6">
               <h1 className="text-2xl font-bold flex items-center gap-2">
                 <LayoutDashboard className="h-6 w-6" />
                 {t('title')}
               </h1>
               <p className="text-muted-foreground mt-1">
                 {t('welcome', { name: user?.name || '' })}
               </p>
             </div>
             
             {loading ? (
               <div className="flex items-center justify-center py-12">
                 <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
               </div>
             ) : (
               <div className="space-y-6">
                 {/* Stats */}
                 <StatsCards
                   totalApplications={stats.totalApplications}
                   completedApplications={stats.completedApplications}
                   draftApplications={stats.draftApplications}
                 />
                 
                 {/* Main Grid */}
                 <div className="grid gap-6 lg:grid-cols-3">
                   {/* Left Column - Recent Applications */}
                   <div className="lg:col-span-2">
                     <RecentApplications applications={stats.recentApplications} />
                   </div>
                   
                   {/* Right Column - Status Cards */}
                   <div className="space-y-6">
                     <QuickActions />
                     <CVStatusCard />
                     <AIKeyStatus />
                   </div>
                 </div>
               </div>
             )}
           </div>
         </AuthGuard>
       );
     }
     ```

  8. Add translations to en.json under "dashboard":
     ```json
     {
       "dashboard": {
         "title": "Dashboard",
         "welcome": "Welcome back, {name}!",
         "total_applications": "Total Applications",
         "completed": "Completed",
         "in_progress": "In Progress",
         "success_rate": "Completion Rate",
         "recent_applications": "Recent Applications",
         "view_all": "View All",
         "no_applications_yet": "No applications yet. Create your first one!",
         "status_completed": "Completed",
         "status_draft": "Draft",
         "status_processing": "Processing",
         "status_error": "Error",
         "quick_actions": "Quick Actions",
         "new_application": "New Application",
         "manage_cv": "Manage CV",
         "manage_prompts": "Manage Prompts",
         "settings": "Settings",
         "cv_status": "CV Status",
         "completion": "Completion",
         "complete_cv": "Complete Your CV",
         "update_cv": "Update CV",
         "no_cv_yet": "You haven't uploaded your CV yet",
         "upload_cv": "Upload CV",
         "ai_status": "AI Services",
         "connected": "Connected",
         "not_configured": "Not Configured",
         "configure_ai": "Configure AI Keys"
       }
     }
     ```

  9. Add same translations to fa.json

checkpoint_tests:
  - id: T01
    description: "All dashboard component files exist"
    type: "files_exist"
    files:
      - "src/components/dashboard/StatsCards.tsx"
      - "src/components/dashboard/RecentApplications.tsx"
      - "src/components/dashboard/QuickActions.tsx"
      - "src/components/dashboard/CVStatusCard.tsx"
      - "src/components/dashboard/AIKeyStatus.tsx"
      - "src/hooks/useDashboard.ts"

  - id: T02
    description: "Dashboard page exists"
    type: "files_exist"
    files:
      - "src/app/[locale]/dashboard/page.tsx"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "Dashboard page uses all components"
    type: "grep"
    file: "src/app/[locale]/dashboard/page.tsx"
    patterns:
      - "StatsCards"
      - "RecentApplications"
      - "QuickActions"
      - "CVStatusCard"
      - "AIKeyStatus"

max_retries: 3
B22.yaml â€” Ù„ÛŒØ³Øª Applications
YAML

# blocks/B22.yaml

id: B22
name: "Applications List & Detail Pages"
phase: 5
phase_name: "Dashboard & Lists"

goal: |
  Create the applications list page showing all user's job applications,
  and detail page for viewing/continuing a specific application.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B18]

files_to_create:
  - id: F159
    path: "src/components/applications/ApplicationList.tsx"
    description: "List of applications with filters"

  - id: F160
    path: "src/components/applications/ApplicationCard.tsx"
    description: "Card for single application"

  - id: F161
    path: "src/components/applications/ApplicationFilters.tsx"
    description: "Filter by status, date"

  - id: F162
    path: "src/hooks/useApplications.ts"
    description: "Hook for applications list"

  - id: F017
    path: "src/app/[locale]/applications/page.tsx"
    description: "Applications list page"

  - id: F163
    path: "src/app/[locale]/applications/loading.tsx"
    description: "Loading state"

  - id: F018
    path: "src/app/[locale]/applications/[id]/page.tsx"
    description: "Application detail page"

  - id: F164
    path: "src/app/[locale]/applications/[id]/loading.tsx"
    description: "Detail loading state"

files_to_modify:
  - id: F087
    path: "src/i18n/en.json"
    description: "Applications translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Applications translations"

files_available:
  - id: F084
    path: "src/hooks/useApplication.ts"
    from_block: B18
  - id: F140
    path: "src/components/application/FinalDocumentsStep.tsx"
    from_block: B18
  - id: F059
    path: "src/components/application/DownloadPanel.tsx"
    from_block: B18

commands: []

instructions: |
  1. Create useApplications.ts (list hook):
     ```typescript
     // ============================================
     // [F162] src/hooks/useApplications.ts
     // ============================================
     
     'use client';
     
     import { useState, useEffect, useCallback } from 'react';
     import { useAuth } from '@/context/AuthContext';
     import { JobApplication, ApplicationStatus } from '@/lib/types';
     
     interface UseApplicationsOptions {
       status?: ApplicationStatus;
       limit?: number;
     }
     
     export function useApplications(options: UseApplicationsOptions = {}) {
       const { user } = useAuth();
       const [applications, setApplications] = useState<JobApplication[]>([]);
       const [loading, setLoading] = useState(true);
       const [error, setError] = useState<string | null>(null);
       
       const fetchApplications = useCallback(async () => {
         if (!user) return;
         
         setLoading(true);
         setError(null);
         
         try {
           const res = await fetch('/api/applications', {
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           if (data.error) throw new Error(data.error);
           
           let apps = data.applications || [];
           
           // Filter by status if specified
           if (options.status) {
             apps = apps.filter((a: JobApplication) => a.status === options.status);
           }
           
           // Limit if specified
           if (options.limit) {
             apps = apps.slice(0, options.limit);
           }
           
           setApplications(apps);
           
         } catch (err: any) {
           setError(err.message);
         } finally {
           setLoading(false);
         }
       }, [user, options.status, options.limit]);
       
       useEffect(() => {
         fetchApplications();
       }, [fetchApplications]);
       
       const deleteApplication = useCallback(async (id: string) => {
         if (!user) return;
         
         try {
           const res = await fetch(`/api/applications/${id}`, {
             method: 'DELETE',
             headers: { 'x-user-id': user.id }
           });
           
           const data = await res.json();
           if (data.error) throw new Error(data.error);
           
           setApplications(prev => prev.filter(a => a.id !== id));
           
         } catch (err: any) {
           setError(err.message);
           throw err;
         }
       }, [user]);
       
       return {
         applications,
         loading,
         error,
         refresh: fetchApplications,
         deleteApplication
       };
     }
     ```

  2. Create ApplicationCard.tsx:
     ```typescript
     // ============================================
     // [F160] src/components/applications/ApplicationCard.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { JobApplication } from '@/lib/types';
     import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
     import { Badge } from '@/components/ui/badge';
     import { Button } from '@/components/ui/button';
     import { formatDate, truncateText } from '@/lib/utils';
     import { 
       FileText, Clock, CheckCircle, AlertCircle, 
       ArrowRight, Trash2, Download 
     } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     interface ApplicationCardProps {
       application: JobApplication;
       onDelete?: () => void;
       className?: string;
     }
     
     const statusConfig: Record<string, { 
       icon: React.ElementType; 
       color: string;
       bgColor: string;
     }> = {
       completed: { icon: CheckCircle, color: 'text-green-600', bgColor: 'bg-green-100' },
       draft: { icon: Clock, color: 'text-gray-600', bgColor: 'bg-gray-100' },
       processing: { icon: Clock, color: 'text-blue-600', bgColor: 'bg-blue-100' },
       clarification: { icon: AlertCircle, color: 'text-yellow-600', bgColor: 'bg-yellow-100' },
       draft_ready: { icon: FileText, color: 'text-purple-600', bgColor: 'bg-purple-100' },
       editing: { icon: FileText, color: 'text-purple-600', bgColor: 'bg-purple-100' },
       error: { icon: AlertCircle, color: 'text-red-600', bgColor: 'bg-red-100' }
     };
     
     export function ApplicationCard({ 
       application, 
       onDelete,
       className 
     }: ApplicationCardProps) {
       const t = useTranslations('applications');
       const params = useParams();
       const locale = params.locale as string;
       
       const config = statusConfig[application.status] || statusConfig.draft;
       const Icon = config.icon;
       const jobPreview = truncateText(application.job_description, 100);
       
       return (
         <Card className={cn('hover:shadow-md transition-shadow', className)}>
           <CardHeader className="pb-2">
             <div className="flex items-start justify-between">
               <div className="flex items-center gap-3">
                 <div className={cn('p-2 rounded-full', config.bgColor)}>
                   <Icon className={cn('h-4 w-4', config.color)} />
                 </div>
                 <div>
                   <CardTitle className="text-base line-clamp-1">
                     {jobPreview}
                   </CardTitle>
                   <p className="text-sm text-muted-foreground">
                     {formatDate(application.created_at, locale)}
                   </p>
                 </div>
               </div>
               <Badge 
                 variant="outline" 
                 className={cn(config.bgColor, config.color, 'border-0')}
               >
                 {t(`status_${application.status}`)}
               </Badge>
             </div>
           </CardHeader>
           <CardContent>
             <div className="flex items-center justify-between mt-2">
               <div className="flex items-center gap-2 text-sm text-muted-foreground">
                 <span>{application.selected_prompt_ids.length} {t('prompts_used')}</span>
                 <span>â€¢</span>
                 <span>{application.output_language.toUpperCase()}</span>
               </div>
               
               <div className="flex items-center gap-2">
                 {onDelete && (
                   <Button 
                     variant="ghost" 
                     size="sm"
                     onClick={(e) => { e.preventDefault(); onDelete(); }}
                   >
                     <Trash2 className="h-4 w-4 text-destructive" />
                   </Button>
                 )}
                 
                 <Link href={`/${locale}/applications/${application.id}`}>
                   <Button variant="outline" size="sm">
                     {application.status === 'completed' ? (
                       <>
                         <Download className="h-4 w-4 mr-1" />
                         {t('view')}
                       </>
                     ) : (
                       <>
                         {t('continue')}
                         <ArrowRight className="h-4 w-4 ml-1" />
                       </>
                     )}
                   </Button>
                 </Link>
               </div>
             </div>
           </CardContent>
         </Card>
       );
     }
     ```

  3. Create ApplicationFilters.tsx:
     ```typescript
     // ============================================
     // [F161] src/components/applications/ApplicationFilters.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { ApplicationStatus } from '@/lib/types';
     import { Badge } from '@/components/ui/badge';
     import { cn } from '@/lib/utils';
     
     interface ApplicationFiltersProps {
       selectedStatus: ApplicationStatus | 'all';
       onStatusChange: (status: ApplicationStatus | 'all') => void;
       className?: string;
     }
     
     const statuses: (ApplicationStatus | 'all')[] = [
       'all',
       'completed',
       'draft',
       'processing',
       'draft_ready',
       'error'
     ];
     
     export function ApplicationFilters({
       selectedStatus,
       onStatusChange,
       className
     }: ApplicationFiltersProps) {
       const t = useTranslations('applications');
       
       return (
         <div className={cn('flex flex-wrap gap-2', className)}>
           {statuses.map((status) => (
             <Badge
               key={status}
               variant={selectedStatus === status ? 'default' : 'outline'}
               className="cursor-pointer"
               onClick={() => onStatusChange(status)}
             >
               {status === 'all' ? t('all') : t(`status_${status}`)}
             </Badge>
           ))}
         </div>
       );
     }
     ```

  4. Create ApplicationList.tsx:
     ```typescript
     // ============================================
     // [F159] src/components/applications/ApplicationList.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { JobApplication, ApplicationStatus } from '@/lib/types';
     import { ApplicationCard } from './ApplicationCard';
     import { ApplicationFilters } from './ApplicationFilters';
     import { Loader2 } from 'lucide-react';
     
     interface ApplicationListProps {
       applications: JobApplication[];
       loading?: boolean;
       onDelete?: (app: JobApplication) => void;
       className?: string;
     }
     
     export function ApplicationList({
       applications,
       loading = false,
       onDelete,
       className
     }: ApplicationListProps) {
       const t = useTranslations('applications');
       const [statusFilter, setStatusFilter] = useState<ApplicationStatus | 'all'>('all');
       
       const filteredApps = statusFilter === 'all'
         ? applications
         : applications.filter(a => a.status === statusFilter);
       
       if (loading) {
         return (
           <div className="flex items-center justify-center py-12">
             <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
           </div>
         );
       }
       
       return (
         <div className={className}>
           <ApplicationFilters
             selectedStatus={statusFilter}
             onStatusChange={setStatusFilter}
             className="mb-6"
           />
           
           {filteredApps.length === 0 ? (
             <div className="text-center py-12 text-muted-foreground">
               {t('no_applications')}
             </div>
           ) : (
             <div className="space-y-4">
               {filteredApps.map((app) => (
                 <ApplicationCard
                   key={app.id}
                   application={app}
                   onDelete={onDelete ? () => onDelete(app) : undefined}
                 />
               ))}
             </div>
           )}
         </div>
       );
     }
     ```

  5. Create applications/page.tsx:
     ```typescript
     // ============================================
     // [F017] src/app/[locale]/applications/page.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { useParams } from 'next/navigation';
     import Link from 'next/link';
     import { AuthGuard } from '@/components/auth/AuthGuard';
     import { useApplications } from '@/hooks/useApplications';
     import { ApplicationList } from '@/components/applications/ApplicationList';
     import { Button } from '@/components/ui/button';
     import { useToast } from '@/components/ui/use-toast';
     import { FileText, Plus } from 'lucide-react';
     
     export default function ApplicationsPage() {
       const t = useTranslations('applications');
       const params = useParams();
       const locale = params.locale as string;
       const { toast } = useToast();
       
       const { applications, loading, error, deleteApplication } = useApplications();
       
       const handleDelete = async (app: any) => {
         if (!confirm(t('delete_confirm'))) return;
         
         try {
           await deleteApplication(app.id);
           toast({ title: t('deleted') });
         } catch {
           toast({ variant: 'destructive', title: t('delete_error') });
         }
       };
       
       return (
         <AuthGuard>
           <div className="container mx-auto p-6 max-w-4xl">
             <div className="flex items-center justify-between mb-6">
               <div>
                 <h1 className="text-2xl font-bold flex items-center gap-2">
                   <FileText className="h-6 w-6" />
                   {t('title')}
                 </h1>
                 <p className="text-muted-foreground mt-1">
                   {t('description')}
                 </p>
               </div>
               
               <Link href={`/${locale}/new-application`}>
                 <Button>
                   <Plus className="h-4 w-4 mr-2" />
                   {t('new')}
                 </Button>
               </Link>
             </div>
             
             {error && (
               <div className="mb-6 p-4 bg-destructive/10 text-destructive rounded-lg">
                 {error}
               </div>
             )}
             
             <ApplicationList
               applications={applications}
               loading={loading}
               onDelete={handleDelete}
             />
           </div>
         </AuthGuard>
       );
     }
     ```

  6. Create applications/[id]/page.tsx:
     ```typescript
     // ============================================
     // [F018] src/app/[locale]/applications/[id]/page.tsx
     // ============================================
     
     'use client';
     
     import { useEffect } from 'react';
     import { useTranslations } from 'next-intl';
     import { useParams, useRouter } from 'next/navigation';
     import { AuthGuard } from '@/components/auth/AuthGuard';
     import { useApplication } from '@/hooks/useApplication';
     import { ApplicationWizard } from '@/components/application/ApplicationWizard';
     import { FinalDocumentsStep } from '@/components/application/FinalDocumentsStep';
     import { Card, CardContent } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { Loader2, ArrowLeft, FileText } from 'lucide-react';
     import Link from 'next/link';
     
     export default function ApplicationDetailPage() {
       const t = useTranslations('applications');
       const params = useParams();
       const router = useRouter();
       const locale = params.locale as string;
       const id = params.id as string;
       
       const { 
         application, 
         loading, 
         error,
         loadApplication,
         reset,
         finalDocuments
       } = useApplication();
       
       useEffect(() => {
         if (id) {
           loadApplication(id);
         }
       }, [id, loadApplication]);
       
       const handleNewApplication = () => {
         reset();
         router.push(`/${locale}/new-application`);
       };
       
       if (loading) {
         return (
           <AuthGuard>
             <div className="container mx-auto p-6 max-w-4xl">
               <Card>
                 <CardContent className="py-12">
                   <div className="flex flex-col items-center justify-center">
                     <Loader2 className="h-8 w-8 animate-spin text-primary mb-4" />
                     <p className="text-muted-foreground">{t('loading')}</p>
                   </div>
                 </CardContent>
               </Card>
             </div>
           </AuthGuard>
         );
       }
       
       if (error || !application) {
         return (
           <AuthGuard>
             <div className="container mx-auto p-6 max-w-4xl">
               <Card>
                 <CardContent className="py-12 text-center">
                   <p className="text-destructive mb-4">{error || t('not_found')}</p>
                   <Link href={`/${locale}/applications`}>
                     <Button variant="outline">
                       <ArrowLeft className="h-4 w-4 mr-2" />
                       {t('back_to_list')}
                     </Button>
                   </Link>
                 </CardContent>
               </Card>
             </div>
           </AuthGuard>
         );
       }
       
       // If completed, show final documents
       if (application.status === 'completed' && finalDocuments) {
         return (
           <AuthGuard>
             <div className="container mx-auto p-6 max-w-4xl">
               <div className="mb-6">
                 <Link href={`/${locale}/applications`}>
                   <Button variant="ghost" size="sm">
                     <ArrowLeft className="h-4 w-4 mr-2" />
                     {t('back_to_list')}
                   </Button>
                 </Link>
               </div>
               
               <div className="mb-6">
                 <h1 className="text-2xl font-bold flex items-center gap-2">
                   <FileText className="h-6 w-6" />
                   {t('application_details')}
                 </h1>
               </div>
               
               <FinalDocumentsStep
                 documents={finalDocuments}
                 onNewApplication={handleNewApplication}
               />
             </div>
           </AuthGuard>
         );
       }
       
       // Otherwise show wizard to continue
       return (
         <AuthGuard>
           <div className="container mx-auto p-6 max-w-4xl">
             <div className="mb-6">
               <Link href={`/${locale}/applications`}>
                 <Button variant="ghost" size="sm">
                   <ArrowLeft className="h-4 w-4 mr-2" />
                   {t('back_to_list')}
                 </Button>
               </Link>
             </div>
             
             <ApplicationWizard />
           </div>
         </AuthGuard>
       );
     }
     ```

  7. Create loading states:
     ```typescript
     // [F163] src/app/[locale]/applications/loading.tsx
     // [F164] src/app/[locale]/applications/[id]/loading.tsx
     // Standard skeleton loading components
     ```

  8. Add translations to en.json under "applications":
     ```json
     {
       "applications": {
         "title": "My Applications",
         "description": "View and manage your job applications",
         "new": "New Application",
         "all": "All",
         "status_completed": "Completed",
         "status_draft": "Draft",
         "status_processing": "Processing",
         "status_clarification": "Needs Info",
         "status_draft_ready": "Draft Ready",
         "status_editing": "Editing",
         "status_error": "Error",
         "prompts_used": "prompts",
         "view": "View",
         "continue": "Continue",
         "no_applications": "No applications found",
         "delete_confirm": "Are you sure you want to delete this application?",
         "deleted": "Application deleted",
         "delete_error": "Failed to delete",
         "loading": "Loading application...",
         "not_found": "Application not found",
         "back_to_list": "Back to Applications",
         "application_details": "Application Details"
       }
     }
     ```

  9. Add same translations to fa.json

checkpoint_tests:
  - id: T01
    description: "All application list files exist"
    type: "files_exist"
    files:
      - "src/components/applications/ApplicationList.tsx"
      - "src/components/applications/ApplicationCard.tsx"
      - "src/components/applications/ApplicationFilters.tsx"
      - "src/hooks/useApplications.ts"
      - "src/app/[locale]/applications/page.tsx"
      - "src/app/[locale]/applications/[id]/page.tsx"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

max_retries: 3
B23.yaml â€” ØµÙØ­Ù‡ Settings
YAML

# blocks/B23.yaml

id: B23
name: "Settings Page"
phase: 5
phase_name: "Dashboard & Lists"

goal: |
  Create a complete settings page with:
  - AI API key management
  - Template management
  - Language preferences
  - Profile settings

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B11, B20]

files_to_create:
  - id: F049
    path: "src/components/ai/AIKeyManager.tsx"
    description: "Full AI key management component"

  - id: F165
    path: "src/components/settings/SettingsNav.tsx"
    description: "Settings navigation tabs"

  - id: F166
    path: "src/components/settings/ProfileSettings.tsx"
    description: "User profile settings"

  - id: F167
    path: "src/components/settings/LanguageSettings.tsx"
    description: "Language preferences"

  - id: F168
    path: "src/components/settings/TemplateSettings.tsx"
    description: "Template management section"

files_to_modify:
  - id: F016
    path: "src/app/[locale]/settings/page.tsx"
    description: "Settings page"

  - id: F087
    path: "src/i18n/en.json"
    description: "Settings translations"

  - id: F088
    path: "src/i18n/fa.json"
    description: "Settings translations"

files_available:
  - id: F081
    path: "src/hooks/useAIKeys.ts"
    from_block: B11
  - id: F150
    path: "src/hooks/useTemplates.ts"
    from_block: B20
  - id: F060
    path: "src/components/templates/TemplateUploader.tsx"
    from_block: B20
  - id: F151
    path: "src/components/templates/TemplateList.tsx"
    from_block: B20

commands: []

instructions: |
  1. Create AIKeyManager.tsx:
     ```typescript
     // ============================================
     // [F049] src/components/ai/AIKeyManager.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { useAIKeys } from '@/hooks/useAIKeys';
     import { AIProviderName } from '@/lib/types';
     import { SUPPORTED_AI_PROVIDERS } from '@/lib/constants';
     import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';
     import { Button } from '@/components/ui/button';
     import { Input } from '@/components/ui/input';
     import { Label } from '@/components/ui/label';
     import { Badge } from '@/components/ui/badge';
     import {
       Dialog,
       DialogContent,
       DialogHeader,
       DialogTitle,
       DialogFooter,
     } from '@/components/ui/dialog';
     import {
       Select,
       SelectContent,
       SelectItem,
       SelectTrigger,
       SelectValue,
     } from '@/components/ui/select';
     import { 
       Key, Plus, Trash2, CheckCircle, XCircle, 
       Loader2, Eye, EyeOff, ExternalLink 
     } from 'lucide-react';
     import { cn } from '@/lib/utils';
     
     export function AIKeyManager() {
       const t = useTranslations('settings');
       const { keys, loading, addKey, removeKey, validateKey, hasValidKey } = useAIKeys();
       
       const [dialogOpen, setDialogOpen] = useState(false);
       const [selectedProvider, setSelectedProvider] = useState<AIProviderName | ''>('');
       const [apiKey, setApiKey] = useState('');
       const [showKey, setShowKey] = useState(false);
       const [validating, setValidating] = useState(false);
       const [validationResult, setValidationResult] = useState<{
         valid: boolean;
         error?: string;
       } | null>(null);
       const [saving, setSaving] = useState(false);
       
       const handleValidate = async () => {
         if (!selectedProvider || !apiKey) return;
         
         setValidating(true);
         setValidationResult(null);
         
         try {
           const result = await validateKey(selectedProvider, apiKey);
           setValidationResult(result);
         } finally {
           setValidating(false);
         }
       };
       
       const handleSave = async () => {
         if (!selectedProvider || !apiKey || !validationResult?.valid) return;
         
         setSaving(true);
         try {
           await addKey(selectedProvider, apiKey);
           setDialogOpen(false);
           resetForm();
         } finally {
           setSaving(false);
         }
       };
       
       const handleRemove = async (provider: AIProviderName) => {
         if (confirm(t('confirm_remove_key'))) {
           await removeKey(provider);
         }
       };
       
       const resetForm = () => {
         setSelectedProvider('');
         setApiKey('');
         setShowKey(false);
         setValidationResult(null);
       };
       
       if (loading) {
         return (
           <Card>
             <CardContent className="py-8">
               <div className="flex items-center justify-center">
                 <Loader2 className="h-6 w-6 animate-spin" />
               </div>
             </CardContent>
           </Card>
         );
       }
       
       return (
         <>
           <Card>
             <CardHeader>
               <div className="flex items-center justify-between">
                 <div>
                   <CardTitle className="flex items-center gap-2">
                     <Key className="h-5 w-5" />
                     {t('ai_keys_title')}
                   </CardTitle>
                   <CardDescription>{t('ai_keys_description')}</CardDescription>
                 </div>
                 <Button onClick={() => setDialogOpen(true)}>
                   <Plus className="h-4 w-4 mr-2" />
                   {t('add_key')}
                 </Button>
               </div>
             </CardHeader>
             <CardContent>
               <div className="space-y-4">
                 {SUPPORTED_AI_PROVIDERS.map((provider) => {
                   const keyInfo = keys.find(k => k.provider_name === provider.name);
                   const isValid = hasValidKey(provider.name);
                   
                   return (
                     <div 
                       key={provider.name}
                       className="flex items-center justify-between p-4 border rounded-lg"
                     >
                       <div className="flex items-center gap-4">
                         <div className={cn(
                           'w-10 h-10 rounded-full flex items-center justify-center',
                           isValid ? 'bg-green-100' : 'bg-gray-100'
                         )}>
                           {isValid ? (
                             <CheckCircle className="h-5 w-5 text-green-600" />
                           ) : (
                             <XCircle className="h-5 w-5 text-gray-400" />
                           )}
                         </div>
                         <div>
                           <p className="font-medium">{provider.label}</p>
                           <div className="flex items-center gap-2">
                             {isValid ? (
                               <>
                                 <Badge variant="outline" className="text-green-600 border-green-200 bg-green-50">
                                   {t('connected')}
                                 </Badge>
                                 <span className="text-xs text-muted-foreground">
                                   {keyInfo?.available_models?.length || 0} {t('models_available')}
                                 </span>
                               </>
                             ) : (
                               <Badge variant="outline">{t('not_configured')}</Badge>
                             )}
                           </div>
                         </div>
                       </div>
                       
                       <div className="flex items-center gap-2">
                         <a 
                           href={provider.website} 
                           target="_blank" 
                           rel="noopener noreferrer"
                         >
                           <Button variant="ghost" size="sm">
                             <ExternalLink className="h-4 w-4" />
                           </Button>
                         </a>
                         {isValid && (
                           <Button 
                             variant="ghost" 
                             size="sm"
                             onClick={() => handleRemove(provider.name)}
                           >
                             <Trash2 className="h-4 w-4 text-destructive" />
                           </Button>
                         )}
                       </div>
                     </div>
                   );
                 })}
               </div>
             </CardContent>
           </Card>
           
           {/* Add Key Dialog */}
           <Dialog open={dialogOpen} onOpenChange={(open) => {
             setDialogOpen(open);
             if (!open) resetForm();
           }}>
             <DialogContent>
               <DialogHeader>
                 <DialogTitle>{t('add_api_key')}</DialogTitle>
               </DialogHeader>
               
               <div className="space-y-4 py-4">
                 <div className="space-y-2">
                   <Label>{t('provider')}</Label>
                   <Select
                     value={selectedProvider}
                     onValueChange={(v) => {
                       setSelectedProvider(v as AIProviderName);
                       setValidationResult(null);
                     }}
                   >
                     <SelectTrigger>
                       <SelectValue placeholder={t('select_provider')} />
                     </SelectTrigger>
                     <SelectContent>
                       {SUPPORTED_AI_PROVIDERS.map((p) => (
                         <SelectItem key={p.name} value={p.name}>
                           {p.label}
                         </SelectItem>
                       ))}
                     </SelectContent>
                   </Select>
                 </div>
                 
                 <div className="space-y-2">
                   <Label>{t('api_key')}</Label>
                   <div className="relative">
                     <Input
                       type={showKey ? 'text' : 'password'}
                       value={apiKey}
                       onChange={(e) => {
                         setApiKey(e.target.value);
                         setValidationResult(null);
                       }}
                       placeholder="sk-..."
                       className="pr-10"
                     />
                     <Button
                       type="button"
                       variant="ghost"
                       size="sm"
                       className="absolute right-0 top-0 h-full px-3"
                       onClick={() => setShowKey(!showKey)}
                     >
                       {showKey ? (
                         <EyeOff className="h-4 w-4" />
                       ) : (
                         <Eye className="h-4 w-4" />
                       )}
                     </Button>
                   </div>
                 </div>
                 
                 {validationResult && (
                   <div className={cn(
                     'p-3 rounded-lg text-sm',
                     validationResult.valid 
                       ? 'bg-green-50 text-green-700'
                       : 'bg-red-50 text-red-700'
                   )}>
                     {validationResult.valid ? (
                       <div className="flex items-center gap-2">
                         <CheckCircle className="h-4 w-4" />
                         {t('key_valid')}
                       </div>
                     ) : (
                       <div className="flex items-center gap-2">
                         <XCircle className="h-4 w-4" />
                         {validationResult.error || t('key_invalid')}
                       </div>
                     )}
                   </div>
                 )}
               </div>
               
               <DialogFooter>
                 <Button
                   variant="outline"
                   onClick={handleValidate}
                   disabled={!selectedProvider || !apiKey || validating}
                 >
                   {validating ? (
                     <Loader2 className="h-4 w-4 animate-spin mr-2" />
                   ) : null}
                   {t('validate')}
                 </Button>
                 <Button
                   onClick={handleSave}
                   disabled={!validationResult?.valid || saving}
                 >
                   {saving ? (
                     <Loader2 className="h-4 w-4 animate-spin mr-2" />
                   ) : null}
                   {t('save')}
                 </Button>
               </DialogFooter>
             </DialogContent>
           </Dialog>
         </>
       );
     }
     ```

  2. Create SettingsNav.tsx:
     ```typescript
     // ============================================
     // [F165] src/components/settings/SettingsNav.tsx
     // ============================================
     
     'use client';
     
     import { useTranslations } from 'next-intl';
     import { Tabs, TabsList, TabsTrigger } from '@/components/ui/tabs';
     import { Key, User, Globe, FileText } from 'lucide-react';
     
     type SettingsTab = 'ai' | 'profile' | 'language' | 'templates';
     
     interface SettingsNavProps {
       activeTab: SettingsTab;
       onTabChange: (tab: SettingsTab) => void;
     }
     
     export function SettingsNav({ activeTab, onTabChange }: SettingsNavProps) {
       const t = useTranslations('settings');
       
       return (
         <Tabs value={activeTab} onValueChange={(v) => onTabChange(v as SettingsTab)}>
           <TabsList className="grid w-full grid-cols-4">
             <TabsTrigger value="ai" className="flex items-center gap-2">
               <Key className="h-4 w-4" />
               <span className="hidden sm:inline">{t('tab_ai')}</span>
             </TabsTrigger>
             <TabsTrigger value="templates" className="flex items-center gap-2">
               <FileText className="h-4 w-4" />
               <span className="hidden sm:inline">{t('tab_templates')}</span>
             </TabsTrigger>
             <TabsTrigger value="language" className="flex items-center gap-2">
               <Globe className="h-4 w-4" />
               <span className="hidden sm:inline">{t('tab_language')}</span>
             </TabsTrigger>
             <TabsTrigger value="profile" className="flex items-center gap-2">
               <User className="h-4 w-4" />
               <span className="hidden sm:inline">{t('tab_profile')}</span>
             </TabsTrigger>
           </TabsList>
         </Tabs>
       );
     }
     ```

  3. Create other settings components and page:
     ```typescript
     // [F166] ProfileSettings.tsx - User profile editing
     // [F167] LanguageSettings.tsx - UI language preference
     // [F168] TemplateSettings.tsx - Wraps TemplateUploader and TemplateList
     // [F016] settings/page.tsx - Main settings page combining all
     ```

  4. Add translations

checkpoint_tests:
  - id: T01
    description: "All settings files exist"
    type: "files_exist"
    files:
      - "src/components/ai/AIKeyManager.tsx"
      - "src/components/settings/SettingsNav.tsx"
      - "src/app/[locale]/settings/page.tsx"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

max_retries: 3
B24.yaml â€” Google OAuth (ÙØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ)
YAML

# blocks/B24.yaml

id: B24
name: "Google OAuth Authentication"
phase: 6
phase_name: "Final Authentication"

goal: |
  Replace the development authentication with Google OAuth using Supabase Auth.
  This is the final phase that should be implemented after all other features work.

dependencies: [B01, B02, B03, B04, B05, B06, B07, B08, B21, B22, B23]

files_to_create:
  - id: F169
    path: "src/lib/supabase/auth.ts"
    description: "Google OAuth helper functions"

  - id: F170
    path: "src/components/auth/GoogleLoginButton.tsx"
    description: "Google sign-in button"

  - id: F171
    path: "src/app/auth/callback/route.ts"
    description: "OAuth callback handler"

files_to_modify:
  - id: F090
    path: "src/context/AuthContext.tsx"
    description: "Update to use Supabase Auth"

  - id: F011
    path: "src/app/[locale]/page.tsx"
    description: "Update login page with Google button"

  - id: F030
    path: "src/middleware.ts"
    description: "Add auth protection"

  - id: F065
    path: "src/lib/supabase/middleware.ts"
    description: "Supabase auth middleware"

files_available:
  - id: F063
    path: "src/lib/supabase/client.ts"
    from_block: B06
  - id: F064
    path: "src/lib/supabase/server.ts"
    from_block: B06

commands: []

instructions: |
  1. Create auth.ts for Google OAuth:
     ```typescript
     // ============================================
     // [F169] src/lib/supabase/auth.ts
     // ============================================
     
     import { createClient } from './client';
     
     export async function signInWithGoogle() {
       const supabase = createClient();
       
       const { data, error } = await supabase.auth.signInWithOAuth({
         provider: 'google',
         options: {
           redirectTo: `${window.location.origin}/auth/callback`,
           queryParams: {
             access_type: 'offline',
             prompt: 'consent',
           },
         },
       });
       
       if (error) throw error;
       return data;
     }
     
     export async function signOut() {
       const supabase = createClient();
       const { error } = await supabase.auth.signOut();
       if (error) throw error;
     }
     
     export async function getSession() {
       const supabase = createClient();
       const { data: { session }, error } = await supabase.auth.getSession();
       if (error) throw error;
       return session;
     }
     
     export async function getUser() {
       const supabase = createClient();
       const { data: { user }, error } = await supabase.auth.getUser();
       if (error) throw error;
       return user;
     }
     ```

  2. Create GoogleLoginButton.tsx:
     ```typescript
     // ============================================
     // [F170] src/components/auth/GoogleLoginButton.tsx
     // ============================================
     
     'use client';
     
     import { useState } from 'react';
     import { useTranslations } from 'next-intl';
     import { signInWithGoogle } from '@/lib/supabase/auth';
     import { Button } from '@/components/ui/button';
     import { Loader2 } from 'lucide-react';
     
     // Google Icon SVG
     function GoogleIcon() {
       return (
         <svg className="h-5 w-5 mr-2" viewBox="0 0 24 24">
           <path
             fill="#4285F4"
             d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
           />
           <path
             fill="#34A853"
             d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
           />
           <path
             fill="#FBBC05"
             d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
           />
           <path
             fill="#EA4335"
             d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
           />
         </svg>
       );
     }
     
     export function GoogleLoginButton() {
       const t = useTranslations('auth');
       const [loading, setLoading] = useState(false);
       
       const handleLogin = async () => {
         setLoading(true);
         try {
           await signInWithGoogle();
         } catch (error) {
           console.error('Login error:', error);
         } finally {
           setLoading(false);
         }
       };
       
       return (
         <Button
           variant="outline"
           size="lg"
           className="w-full"
           onClick={handleLogin}
           disabled={loading}
         >
           {loading ? (
             <Loader2 className="h-5 w-5 mr-2 animate-spin" />
           ) : (
             <GoogleIcon />
           )}
           {t('login_with_google')}
         </Button>
       );
     }
     ```

  3. Create OAuth callback handler:
     ```typescript
     // ============================================
     // [F171] src/app/auth/callback/route.ts
     // ============================================
     
     import { createServerSupabaseClient } from '@/lib/supabase/server';
     import { NextResponse } from 'next/server';
     
     export async function GET(request: Request) {
       const requestUrl = new URL(request.url);
       const code = requestUrl.searchParams.get('code');
       const origin = requestUrl.origin;
       
       if (code) {
         const supabase = createServerSupabaseClient();
         
         const { error } = await supabase.auth.exchangeCodeForSession(code);
         
         if (!error) {
           // Get user and create/update in our users table
           const { data: { user } } = await supabase.auth.getUser();
           
           if (user) {
             await supabase.from('users').upsert({
               id: user.id,
               google_id: user.user_metadata.sub,
               email: user.email,
               name: user.user_metadata.full_name || user.email?.split('@')[0],
               avatar_url: user.user_metadata.avatar_url,
             }, { onConflict: 'id' });
           }
           
           return NextResponse.redirect(`${origin}/en/dashboard`);
         }
       }
       
       return NextResponse.redirect(`${origin}/en?error=auth_failed`);
     }
     ```

  4. Update AuthContext.tsx to use Supabase Auth:
     ```typescript
     // Update the existing AuthContext to use Supabase Auth
     // instead of the development auth system
     ```

  5. Update middleware.ts for route protection:
     ```typescript
     // Add auth checks to protect routes
     // Redirect unauthenticated users to login
     ```

  6. Update RLS policies in Supabase:
     ```sql
     -- Update policies to use auth.uid() instead of x-user-id header
     -- This is done in Supabase Dashboard
     ```

checkpoint_tests:
  - id: T01
    description: "OAuth files exist"
    type: "files_exist"
    files:
      - "src/lib/supabase/auth.ts"
      - "src/components/auth/GoogleLoginButton.tsx"
      - "src/app/auth/callback/route.ts"

  - id: T02
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T03
    description: "GoogleLoginButton uses signInWithGoogle"
    type: "grep"
    file: "src/components/auth/GoogleLoginButton.tsx"
    patterns:
      - "signInWithGoogle"
      - "google"

max_retries: 3
B25.yaml â€” Ø³ÛŒØ³ØªÙ… ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ Word (DOCX Generator)
YAML

# blocks/B25.yaml

id: B25
name: "DOCX File Generator"
phase: 4
phase_name: "Export & Templates"

goal: |
  Create a system to generate formatted Word (.docx) files from document content.
  This includes API routes for exporting CV, cover letter, and email as Word files.
  Uses the 'docx' library to create professional, formatted documents.

dependencies: [B01, B02, B03, B04, B05, B06]

files_to_create:
  - id: F075
    path: "src/lib/generators/docx-generator.ts"
    description: "Core DOCX generation logic"

  - id: F142
    path: "src/lib/generators/docx-styles.ts"
    description: "Predefined styles for DOCX documents"

  - id: F143
    path: "src/lib/generators/docx-templates.ts"
    description: "Document templates for CV, cover letter, email"

  - id: F025
    path: "src/app/api/export/docx/route.ts"
    description: "API route for DOCX export"

  - id: F144
    path: "src/lib/generators/index.ts"
    description: "Export all generator modules"

files_to_modify: []

files_available:
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F080
    path: "src/lib/utils.ts"
    from_block: B04

commands: []

instructions: |
  1. Create docx-styles.ts:
     ```typescript
     // ============================================
     // [F142] src/lib/generators/docx-styles.ts
     // ============================================
     
     import {
       HeadingLevel,
       AlignmentType,
       TabStopPosition,
       TabStopType,
       convertInchesToTwip,
       BorderStyle,
     } from 'docx';
     
     // Color palette
     export const COLORS = {
       primary: '2563EB',      // Blue
       secondary: '64748B',    // Slate
       text: '1E293B',         // Dark slate
       lightText: '64748B',    // Light slate
       accent: '0EA5E9',       // Sky blue
       border: 'E2E8F0',       // Light border
       background: 'F8FAFC',   // Light background
     };
     
     // Font sizes in half-points (1 point = 2 half-points)
     export const FONT_SIZES = {
       title: 48,          // 24pt
       heading1: 36,       // 18pt
       heading2: 28,       // 14pt
       heading3: 24,       // 12pt
       body: 22,           // 11pt
       small: 20,          // 10pt
       caption: 18,        // 9pt
     };
     
     // Spacing in twips (1 inch = 1440 twips)
     export const SPACING = {
       paragraph: 240,     // 12pt after paragraph
       section: 480,       // 24pt after section
       line: 276,          // 1.15 line spacing
     };
     
     // Common text run styles
     export const TEXT_STYLES = {
       title: {
         bold: true,
         size: FONT_SIZES.title,
         color: COLORS.text,
         font: 'Calibri',
       },
       heading1: {
         bold: true,
         size: FONT_SIZES.heading1,
         color: COLORS.primary,
         font: 'Calibri',
       },
       heading2: {
         bold: true,
         size: FONT_SIZES.heading2,
         color: COLORS.text,
         font: 'Calibri',
       },
       heading3: {
         bold: true,
         size: FONT_SIZES.heading3,
         color: COLORS.text,
         font: 'Calibri',
       },
       body: {
         size: FONT_SIZES.body,
         color: COLORS.text,
         font: 'Calibri',
       },
       bodyBold: {
         bold: true,
         size: FONT_SIZES.body,
         color: COLORS.text,
         font: 'Calibri',
       },
       subtle: {
         size: FONT_SIZES.small,
         color: COLORS.lightText,
         font: 'Calibri',
       },
       link: {
         size: FONT_SIZES.body,
         color: COLORS.primary,
         font: 'Calibri',
         underline: {},
       },
     };
     
     // Paragraph styles
     export const PARAGRAPH_STYLES = {
       title: {
         alignment: AlignmentType.CENTER,
         spacing: { after: SPACING.paragraph },
       },
       heading: {
         spacing: { before: SPACING.section, after: SPACING.paragraph },
       },
       body: {
         spacing: { after: SPACING.paragraph, line: SPACING.line },
       },
       bullet: {
         spacing: { after: 120, line: SPACING.line },
       },
       contact: {
         alignment: AlignmentType.CENTER,
         spacing: { after: 60 },
       },
     };
     
     // Page margins
     export const PAGE_MARGINS = {
       top: convertInchesToTwip(0.75),
       right: convertInchesToTwip(0.75),
       bottom: convertInchesToTwip(0.75),
       left: convertInchesToTwip(0.75),
     };
     
     // Section properties
     export const SECTION_PROPERTIES = {
       page: {
         margin: PAGE_MARGINS,
       },
     };
     ```

  2. Create docx-templates.ts:
     ```typescript
     // ============================================
     // [F143] src/lib/generators/docx-templates.ts
     // ============================================
     
     import {
       Document,
       Paragraph,
       TextRun,
       HeadingLevel,
       AlignmentType,
       BorderStyle,
       Table,
       TableRow,
       TableCell,
       WidthType,
       Header,
       Footer,
       PageNumber,
       NumberFormat,
     } from 'docx';
     import { TEXT_STYLES, PARAGRAPH_STYLES, SECTION_PROPERTIES, COLORS, SPACING } from './docx-styles';
     
     // Helper to create a styled text run
     export function createTextRun(
       text: string, 
       style: keyof typeof TEXT_STYLES = 'body'
     ): TextRun {
       return new TextRun({
         text,
         ...TEXT_STYLES[style],
       });
     }
     
     // Helper to create a paragraph with runs
     export function createParagraph(
       runs: TextRun | TextRun[],
       options: {
         heading?: HeadingLevel;
         alignment?: AlignmentType;
         spacing?: { before?: number; after?: number };
         bullet?: { level: number };
       } = {}
     ): Paragraph {
       const runsArray = Array.isArray(runs) ? runs : [runs];
       
       return new Paragraph({
         children: runsArray,
         heading: options.heading,
         alignment: options.alignment,
         spacing: options.spacing || PARAGRAPH_STYLES.body.spacing,
         bullet: options.bullet,
       });
     }
     
     // Create section header with line
     export function createSectionHeader(title: string): Paragraph[] {
       return [
         new Paragraph({
           children: [createTextRun(title, 'heading1')],
           spacing: { before: SPACING.section, after: 120 },
           border: {
             bottom: {
               color: COLORS.primary,
               space: 4,
               size: 12,
               style: BorderStyle.SINGLE,
             },
           },
         }),
       ];
     }
     
     // Create contact info line
     export function createContactLine(items: string[]): Paragraph {
       const runs: TextRun[] = [];
       
       items.forEach((item, index) => {
         if (index > 0) {
           runs.push(new TextRun({
             text: '  â€¢  ',
             ...TEXT_STYLES.subtle,
           }));
         }
         runs.push(new TextRun({
           text: item,
           ...TEXT_STYLES.subtle,
         }));
       });
       
       return new Paragraph({
         children: runs,
         alignment: AlignmentType.CENTER,
         spacing: { after: 60 },
       });
     }
     
     // Create experience/education entry
     export function createExperienceEntry(
       title: string,
       subtitle: string,
       dateRange: string,
       description?: string,
       bullets?: string[]
     ): Paragraph[] {
       const paragraphs: Paragraph[] = [];
       
       // Title and date on same line
       paragraphs.push(new Paragraph({
         children: [
           createTextRun(title, 'bodyBold'),
           new TextRun({ text: '\t' }),
           createTextRun(dateRange, 'subtle'),
         ],
         tabStops: [
           {
             type: 'right' as any,
             position: 9360, // Right align at 6.5 inches
           },
         ],
         spacing: { after: 60 },
       }));
       
       // Subtitle (company/institution)
       paragraphs.push(new Paragraph({
         children: [createTextRun(subtitle, 'subtle')],
         spacing: { after: 120 },
       }));
       
       // Description
       if (description) {
         paragraphs.push(new Paragraph({
           children: [createTextRun(description, 'body')],
           spacing: { after: 120 },
         }));
       }
       
       // Bullet points
       if (bullets && bullets.length > 0) {
         bullets.forEach(bullet => {
           paragraphs.push(new Paragraph({
             children: [createTextRun(bullet, 'body')],
             bullet: { level: 0 },
             spacing: { after: 60 },
           }));
         });
       }
       
       return paragraphs;
     }
     
     // Create skills section
     export function createSkillsSection(skills: string[]): Paragraph[] {
       const skillText = skills.join('  â€¢  ');
       
       return [
         ...createSectionHeader('Skills'),
         new Paragraph({
           children: [createTextRun(skillText, 'body')],
           spacing: { after: SPACING.paragraph },
         }),
       ];
     }
     
     // Create footer with page numbers
     export function createFooter(): Footer {
       return new Footer({
         children: [
           new Paragraph({
             alignment: AlignmentType.CENTER,
             children: [
               new TextRun({
                 children: [PageNumber.CURRENT],
                 ...TEXT_STYLES.caption,
               }),
               new TextRun({
                 text: ' / ',
                 ...TEXT_STYLES.caption,
               }),
               new TextRun({
                 children: [PageNumber.TOTAL_PAGES],
                 ...TEXT_STYLES.caption,
               }),
             ],
           }),
         ],
       });
     }
     ```

  3. Create docx-generator.ts:
     ```typescript
     // ============================================
     // [F075] src/lib/generators/docx-generator.ts
     // ============================================
     
     import {
       Document,
       Paragraph,
       TextRun,
       Packer,
       AlignmentType,
       HeadingLevel,
       Header,
       Footer,
       PageNumber,
     } from 'docx';
     import {
       TEXT_STYLES,
       PARAGRAPH_STYLES,
       SECTION_PROPERTIES,
       COLORS,
       SPACING,
     } from './docx-styles';
     import {
       createTextRun,
       createParagraph,
       createSectionHeader,
       createContactLine,
       createExperienceEntry,
       createSkillsSection,
       createFooter,
     } from './docx-templates';
     
     export type DocumentType = 'cv' | 'cover_letter' | 'email';
     
     export interface GenerateDocxOptions {
       content: string;
       type: DocumentType;
       title?: string;
       metadata?: {
         author?: string;
         company?: string;
         jobTitle?: string;
       };
     }
     
     // Parse markdown-like content into paragraphs
     function parseContent(content: string): Paragraph[] {
       const paragraphs: Paragraph[] = [];
       const lines = content.split('\n');
       
       let currentBullets: string[] = [];
       
       const flushBullets = () => {
         if (currentBullets.length > 0) {
           currentBullets.forEach(bullet => {
             paragraphs.push(new Paragraph({
               children: [createTextRun(bullet.replace(/^[-â€¢*]\s*/, ''), 'body')],
               bullet: { level: 0 },
               spacing: { after: 60 },
             }));
           });
           currentBullets = [];
         }
       };
       
       for (const line of lines) {
         const trimmedLine = line.trim();
         
         if (!trimmedLine) {
           flushBullets();
           continue;
         }
         
         // Heading 1: # Title or === underline
         if (trimmedLine.startsWith('# ') || trimmedLine.startsWith('## ')) {
           flushBullets();
           const headingText = trimmedLine.replace(/^#+\s*/, '');
           const level = trimmedLine.startsWith('## ') ? 'heading2' : 'heading1';
           
           if (level === 'heading1') {
             paragraphs.push(...createSectionHeader(headingText));
           } else {
             paragraphs.push(new Paragraph({
               children: [createTextRun(headingText, 'heading2')],
               spacing: { before: SPACING.paragraph, after: 120 },
             }));
           }
           continue;
         }
         
         // Heading 3: ### Subtitle
         if (trimmedLine.startsWith('### ')) {
           flushBullets();
           const headingText = trimmedLine.replace(/^###\s*/, '');
           paragraphs.push(new Paragraph({
             children: [createTextRun(headingText, 'heading3')],
             spacing: { before: 120, after: 60 },
           }));
           continue;
         }
         
         // Bullet points
         if (/^[-â€¢*]\s/.test(trimmedLine)) {
           currentBullets.push(trimmedLine);
           continue;
         }
         
         // Bold text: **text**
         if (trimmedLine.includes('**')) {
           flushBullets();
           const parts = trimmedLine.split(/\*\*(.*?)\*\*/g);
           const runs: TextRun[] = [];
           
           parts.forEach((part, index) => {
             if (index % 2 === 1) {
               // Bold part
               runs.push(createTextRun(part, 'bodyBold'));
             } else if (part) {
               runs.push(createTextRun(part, 'body'));
             }
           });
           
           paragraphs.push(new Paragraph({
             children: runs,
             spacing: { after: SPACING.paragraph },
           }));
           continue;
         }
         
         // Regular paragraph
         flushBullets();
         paragraphs.push(new Paragraph({
           children: [createTextRun(trimmedLine, 'body')],
           spacing: { after: SPACING.paragraph },
         }));
       }
       
       flushBullets();
       return paragraphs;
     }
     
     // Generate CV document
     function generateCVDocument(content: string, options: GenerateDocxOptions): Document {
       const paragraphs = parseContent(content);
       
       return new Document({
         creator: options.metadata?.author || 'CV Tailor',
         title: options.title || 'Tailored CV',
         description: 'CV generated by CV Tailor',
         sections: [
           {
             properties: SECTION_PROPERTIES,
             footers: {
               default: createFooter(),
             },
             children: paragraphs,
           },
         ],
       });
     }
     
     // Generate Cover Letter document
     function generateCoverLetterDocument(content: string, options: GenerateDocxOptions): Document {
       const paragraphs = parseContent(content);
       
       // Add date at the top
       const today = new Date().toLocaleDateString('en-US', {
         year: 'numeric',
         month: 'long',
         day: 'numeric',
       });
       
       const headerParagraphs: Paragraph[] = [
         new Paragraph({
           children: [createTextRun(today, 'body')],
           spacing: { after: SPACING.section },
         }),
       ];
       
       return new Document({
         creator: options.metadata?.author || 'CV Tailor',
         title: options.title || 'Cover Letter',
         description: 'Cover letter generated by CV Tailor',
         sections: [
           {
             properties: SECTION_PROPERTIES,
             children: [...headerParagraphs, ...paragraphs],
           },
         ],
       });
     }
     
     // Generate Email document
     function generateEmailDocument(content: string, options: GenerateDocxOptions): Document {
       const paragraphs = parseContent(content);
       
       return new Document({
         creator: options.metadata?.author || 'CV Tailor',
         title: options.title || 'Application Email',
         description: 'Application email generated by CV Tailor',
         sections: [
           {
             properties: SECTION_PROPERTIES,
             children: paragraphs,
           },
         ],
       });
     }
     
     // Main export function
     export async function generateDocx(options: GenerateDocxOptions): Promise<Buffer> {
       let document: Document;
       
       switch (options.type) {
         case 'cv':
           document = generateCVDocument(options.content, options);
           break;
         case 'cover_letter':
           document = generateCoverLetterDocument(options.content, options);
           break;
         case 'email':
           document = generateEmailDocument(options.content, options);
           break;
         default:
           document = generateCVDocument(options.content, options);
       }
       
       const buffer = await Packer.toBuffer(document);
       return Buffer.from(buffer);
     }
     
     // Generate all three documents as a zip (optional future feature)
     export async function generateAllDocx(
       documents: {
         cv: string;
         coverLetter: string;
         email: string;
       },
       metadata?: GenerateDocxOptions['metadata']
     ): Promise<{
       cv: Buffer;
       coverLetter: Buffer;
       email: Buffer;
     }> {
       const [cv, coverLetter, email] = await Promise.all([
         generateDocx({ content: documents.cv, type: 'cv', metadata }),
         generateDocx({ content: documents.coverLetter, type: 'cover_letter', metadata }),
         generateDocx({ content: documents.email, type: 'email', metadata }),
       ]);
       
       return { cv, coverLetter, email };
     }
     ```

  4. Create API route for DOCX export:
     ```typescript
     // ============================================
     // [F025] src/app/api/export/docx/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { generateDocx, DocumentType } from '@/lib/generators/docx-generator';
     
     export async function POST(request: NextRequest) {
       try {
         const body = await request.json();
         const { content, type, filename, metadata } = body;
         
         if (!content) {
           return NextResponse.json(
             { error: 'Content is required' },
             { status: 400 }
           );
         }
         
         const docType: DocumentType = type || 'cv';
         const buffer = await generateDocx({
           content,
           type: docType,
           title: filename,
           metadata,
         });
         
         const fileName = filename 
           ? `${filename}.docx` 
           : `${docType}-${Date.now()}.docx`;
         
         return new NextResponse(buffer, {
           status: 200,
           headers: {
             'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
             'Content-Disposition': `attachment; filename="${fileName}"`,
             'Content-Length': buffer.length.toString(),
           },
         });
         
       } catch (error: any) {
         console.error('DOCX generation error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to generate document' },
           { status: 500 }
         );
       }
     }
     ```

  5. Create generators index:
     ```typescript
     // ============================================
     // [F144] src/lib/generators/index.ts
     // ============================================
     
     export * from './docx-generator';
     export * from './docx-styles';
     export * from './docx-templates';
     ```

checkpoint_tests:
  - id: T01
    description: "All generator files exist"
    type: "files_exist"
    files:
      - "src/lib/generators/docx-generator.ts"
      - "src/lib/generators/docx-styles.ts"
      - "src/lib/generators/docx-templates.ts"
      - "src/lib/generators/index.ts"

  - id: T02
    description: "API route exists"
    type: "files_exist"
    files:
      - "src/app/api/export/docx/route.ts"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "DOCX generator exports main function"
    type: "grep"
    file: "src/lib/generators/docx-generator.ts"
    patterns:
      - "export async function generateDocx"
      - "generateCVDocument"
      - "generateCoverLetterDocument"
      - "generateEmailDocument"
      - "Packer.toBuffer"

  - id: T05
    description: "Styles are properly defined"
    type: "grep"
    file: "src/lib/generators/docx-styles.ts"
    patterns:
      - "TEXT_STYLES"
      - "PARAGRAPH_STYLES"
      - "PAGE_MARGINS"
      - "COLORS"

  - id: T06
    description: "Templates have helper functions"
    type: "grep"
    file: "src/lib/generators/docx-templates.ts"
    patterns:
      - "createTextRun"
      - "createParagraph"
      - "createSectionHeader"
      - "createExperienceEntry"

  - id: T07
    description: "API route handles POST"
    type: "grep"
    file: "src/app/api/export/docx/route.ts"
    patterns:
      - "export async function POST"
      - "generateDocx"
      - "Content-Disposition"

max_retries: 3
B26.yaml â€” Ø³ÛŒØ³ØªÙ… ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ Markdown
YAML

# blocks/B26.yaml

id: B26
name: "Markdown File Generator"
phase: 4
phase_name: "Export & Templates"

goal: |
  Create a system to generate and export Markdown (.md) files.
  Also includes HTML to Markdown conversion for content from the editor.
  API route for Markdown export.

dependencies: [B01, B02, B03, B04, B25]

files_to_create:
  - id: F076
    path: "src/lib/generators/markdown-generator.ts"
    description: "Markdown generation and conversion logic"

  - id: F026
    path: "src/app/api/export/markdown/route.ts"
    description: "API route for Markdown export"

files_to_modify:
  - id: F144
    path: "src/lib/generators/index.ts"
    description: "Add markdown generator export"

files_available:
  - id: F079
    path: "src/lib/types.ts"
    from_block: B03
  - id: F078
    path: "src/lib/constants.ts"
    from_block: B04
  - id: F144
    path: "src/lib/generators/index.ts"
    from_block: B25

commands: []

instructions: |
  1. Create markdown-generator.ts:
     ```typescript
     // ============================================
     // [F076] src/lib/generators/markdown-generator.ts
     // ============================================
     
     export type DocumentType = 'cv' | 'cover_letter' | 'email';
     
     export interface GenerateMarkdownOptions {
       content: string;
       type: DocumentType;
       title?: string;
       includeMetadata?: boolean;
       metadata?: {
         author?: string;
         date?: string;
         company?: string;
         jobTitle?: string;
       };
     }
     
     // Convert HTML to Markdown
     export function htmlToMarkdown(html: string): string {
       let markdown = html;
       
       // Remove extra whitespace
       markdown = markdown.replace(/\s+/g, ' ');
       
       // Headers
       markdown = markdown.replace(/<h1[^>]*>(.*?)<\/h1>/gi, '\n# $1\n');
       markdown = markdown.replace(/<h2[^>]*>(.*?)<\/h2>/gi, '\n## $1\n');
       markdown = markdown.replace(/<h3[^>]*>(.*?)<\/h3>/gi, '\n### $1\n');
       markdown = markdown.replace(/<h4[^>]*>(.*?)<\/h4>/gi, '\n#### $1\n');
       markdown = markdown.replace(/<h5[^>]*>(.*?)<\/h5>/gi, '\n##### $1\n');
       markdown = markdown.replace(/<h6[^>]*>(.*?)<\/h6>/gi, '\n###### $1\n');
       
       // Bold and italic
       markdown = markdown.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '**$1**');
       markdown = markdown.replace(/<b[^>]*>(.*?)<\/b>/gi, '**$1**');
       markdown = markdown.replace(/<em[^>]*>(.*?)<\/em>/gi, '*$1*');
       markdown = markdown.replace(/<i[^>]*>(.*?)<\/i>/gi, '*$1*');
       
       // Links
       markdown = markdown.replace(/<a[^>]*href="([^"]*)"[^>]*>(.*?)<\/a>/gi, '[$2]($1)');
       
       // Line breaks and paragraphs
       markdown = markdown.replace(/<br\s*\/?>/gi, '\n');
       markdown = markdown.replace(/<\/p>/gi, '\n\n');
       markdown = markdown.replace(/<p[^>]*>/gi, '');
       
       // Lists
       markdown = markdown.replace(/<ul[^>]*>/gi, '\n');
       markdown = markdown.replace(/<\/ul>/gi, '\n');
       markdown = markdown.replace(/<ol[^>]*>/gi, '\n');
       markdown = markdown.replace(/<\/ol>/gi, '\n');
       markdown = markdown.replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1\n');
       
       // Blockquotes
       markdown = markdown.replace(/<blockquote[^>]*>(.*?)<\/blockquote>/gi, '\n> $1\n');
       
       // Code
       markdown = markdown.replace(/<code[^>]*>(.*?)<\/code>/gi, '`$1`');
       markdown = markdown.replace(/<pre[^>]*>(.*?)<\/pre>/gi, '\n```\n$1\n```\n');
       
       // Horizontal rule
       markdown = markdown.replace(/<hr\s*\/?>/gi, '\n---\n');
       
       // Remove remaining HTML tags
       markdown = markdown.replace(/<[^>]+>/g, '');
       
       // Decode HTML entities
       markdown = markdown.replace(/&nbsp;/g, ' ');
       markdown = markdown.replace(/&amp;/g, '&');
       markdown = markdown.replace(/&lt;/g, '<');
       markdown = markdown.replace(/&gt;/g, '>');
       markdown = markdown.replace(/&quot;/g, '"');
       markdown = markdown.replace(/&#39;/g, "'");
       
       // Clean up extra newlines
       markdown = markdown.replace(/\n{3,}/g, '\n\n');
       markdown = markdown.trim();
       
       return markdown;
     }
     
     // Clean and normalize content
     function normalizeContent(content: string): string {
       // Check if content is HTML
       if (content.includes('<') && content.includes('>')) {
         return htmlToMarkdown(content);
       }
       return content;
     }
     
     // Generate frontmatter for metadata
     function generateFrontmatter(options: GenerateMarkdownOptions): string {
       if (!options.includeMetadata || !options.metadata) {
         return '';
       }
       
       const lines = ['---'];
       
       if (options.title) {
         lines.push(`title: "${options.title}"`);
       }
       if (options.metadata.author) {
         lines.push(`author: "${options.metadata.author}"`);
       }
       if (options.metadata.date) {
         lines.push(`date: "${options.metadata.date}"`);
       } else {
         lines.push(`date: "${new Date().toISOString().split('T')[0]}"`);
       }
       if (options.metadata.company) {
         lines.push(`company: "${options.metadata.company}"`);
       }
       if (options.metadata.jobTitle) {
         lines.push(`job_title: "${options.metadata.jobTitle}"`);
       }
       lines.push(`type: "${options.type}"`);
       lines.push('---\n');
       
       return lines.join('\n');
     }
     
     // Generate CV markdown with structure
     function generateCVMarkdown(content: string, options: GenerateMarkdownOptions): string {
       const normalized = normalizeContent(content);
       const frontmatter = generateFrontmatter(options);
       
       return `${frontmatter}${normalized}`;
     }
     
     // Generate Cover Letter markdown
     function generateCoverLetterMarkdown(content: string, options: GenerateMarkdownOptions): string {
       const normalized = normalizeContent(content);
       const frontmatter = generateFrontmatter(options);
       
       const date = new Date().toLocaleDateString('en-US', {
         year: 'numeric',
         month: 'long',
         day: 'numeric',
       });
       
       return `${frontmatter}${date}\n\n${normalized}`;
     }
     
     // Generate Email markdown
     function generateEmailMarkdown(content: string, options: GenerateMarkdownOptions): string {
       const normalized = normalizeContent(content);
       const frontmatter = generateFrontmatter(options);
       
       return `${frontmatter}${normalized}`;
     }
     
     // Main export function
     export function generateMarkdown(options: GenerateMarkdownOptions): string {
       switch (options.type) {
         case 'cv':
           return generateCVMarkdown(options.content, options);
         case 'cover_letter':
           return generateCoverLetterMarkdown(options.content, options);
         case 'email':
           return generateEmailMarkdown(options.content, options);
         default:
           return generateCVMarkdown(options.content, options);
       }
     }
     
     // Convert markdown to plain text (for AI processing)
     export function markdownToPlainText(markdown: string): string {
       let text = markdown;
       
       // Remove frontmatter
       text = text.replace(/^---[\s\S]*?---\n*/m, '');
       
       // Remove headers markers but keep text
       text = text.replace(/^#{1,6}\s+/gm, '');
       
       // Remove bold/italic markers
       text = text.replace(/\*\*(.*?)\*\*/g, '$1');
       text = text.replace(/\*(.*?)\*/g, '$1');
       text = text.replace(/__(.*?)__/g, '$1');
       text = text.replace(/_(.*?)_/g, '$1');
       
       // Remove link formatting, keep text
       text = text.replace(/\[([^\]]+)\]\([^)]+\)/g, '$1');
       
       // Remove code formatting
       text = text.replace(/`{1,3}[^`]*`{1,3}/g, '');
       
       // Remove horizontal rules
       text = text.replace(/^---+$/gm, '');
       
       // Remove blockquote markers
       text = text.replace(/^>\s*/gm, '');
       
       // Remove list markers
       text = text.replace(/^[-*+]\s+/gm, '');
       text = text.replace(/^\d+\.\s+/gm, '');
       
       // Clean up whitespace
       text = text.replace(/\n{3,}/g, '\n\n');
       text = text.trim();
       
       return text;
     }
     
     // Generate all documents as markdown object
     export function generateAllMarkdown(
       documents: {
         cv: string;
         coverLetter: string;
         email: string;
       },
       options?: Partial<GenerateMarkdownOptions>
     ): {
       cv: string;
       coverLetter: string;
       email: string;
     } {
       return {
         cv: generateMarkdown({ ...options, content: documents.cv, type: 'cv' }),
         coverLetter: generateMarkdown({ ...options, content: documents.coverLetter, type: 'cover_letter' }),
         email: generateMarkdown({ ...options, content: documents.email, type: 'email' }),
       };
     }
     ```

  2. Create API route for Markdown export:
     ```typescript
     // ============================================
     // [F026] src/app/api/export/markdown/route.ts
     // ============================================
     
     import { NextRequest, NextResponse } from 'next/server';
     import { generateMarkdown, DocumentType } from '@/lib/generators/markdown-generator';
     
     export async function POST(request: NextRequest) {
       try {
         const body = await request.json();
         const { content, type, filename, includeMetadata, metadata } = body;
         
         if (!content) {
           return NextResponse.json(
             { error: 'Content is required' },
             { status: 400 }
           );
         }
         
         const docType: DocumentType = type || 'cv';
         const markdown = generateMarkdown({
           content,
           type: docType,
           title: filename,
           includeMetadata: includeMetadata ?? false,
           metadata,
         });
         
         const fileName = filename 
           ? `${filename}.md` 
           : `${docType}-${Date.now()}.md`;
         
         return new NextResponse(markdown, {
           status: 200,
           headers: {
             'Content-Type': 'text/markdown; charset=utf-8',
             'Content-Disposition': `attachment; filename="${fileName}"`,
             'Content-Length': Buffer.byteLength(markdown, 'utf8').toString(),
           },
         });
         
       } catch (error: any) {
         console.error('Markdown generation error:', error);
         return NextResponse.json(
           { error: error.message || 'Failed to generate markdown' },
           { status: 500 }
         );
       }
     }
     
     // GET - Convert HTML to Markdown (utility endpoint)
     export async function PUT(request: NextRequest) {
       try {
         const body = await request.json();
         const { html } = body;
         
         if (!html) {
           return NextResponse.json(
             { error: 'HTML content is required' },
             { status: 400 }
           );
         }
         
         const { htmlToMarkdown } = await import('@/lib/generators/markdown-generator');
         const markdown = htmlToMarkdown(html);
         
         return NextResponse.json({ markdown });
         
       } catch (error: any) {
         return NextResponse.json(
           { error: error.message || 'Conversion failed' },
           { status: 500 }
         );
       }
     }
     ```

  3. Update generators index:
     ```typescript
     // ============================================
     // [F144] src/lib/generators/index.ts (updated)
     // ============================================
     
     export * from './docx-generator';
     export * from './docx-styles';
     export * from './docx-templates';
     export * from './markdown-generator';
     ```

checkpoint_tests:
  - id: T01
    description: "Markdown generator file exists"
    type: "files_exist"
    files:
      - "src/lib/generators/markdown-generator.ts"

  - id: T02
    description: "API route exists"
    type: "files_exist"
    files:
      - "src/app/api/export/markdown/route.ts"

  - id: T03
    description: "TypeScript compiles without errors"
    type: "command"
    command: "npx tsc --noEmit"
    expected_exit_code: 0

  - id: T04
    description: "Markdown generator exports main functions"
    type: "grep"
    file: "src/lib/generators/markdown-generator.ts"
    patterns:
      - "export function generateMarkdown"
      - "export function htmlToMarkdown"
      - "export function markdownToPlainText"
      - "generateCVMarkdown"
      - "generateCoverLetterMarkdown"

  - id: T05
    description: "API route handles POST and PUT"
    type: "grep"
    file: "src/app/api/export/markdown/route.ts"
    patterns:
      - "export async function POST"
      - "export async function PUT"
      - "generateMarkdown"
      - "Content-Disposition"

  - id: T06
    description: "Index exports markdown generator"
    type: "grep"
    file: "src/lib/generators/index.ts"
    patterns:
      - "markdown-generator"

max_retries: 3








# blocks/B27.yaml

id: B27
name: "Multi-AI Draft Panel"
phase: 5
phase_name: "Core Workflow"

goal: |
  Create a panel to manage multiple AI drafts.
  Features:
  - Select multiple AI models for drafting
  - Display each draft outcome separately
  - Select the final AI model for consolidation
  - Combine drafts and send to the final model

dependencies: [B20, B26]

files_to_create:
  - id: F053
    path: "src/components/ai/AIMultiDraftPanel.tsx"
    description: "Component for managing multiple AI drafts"

checkpoint_tests:
  - id: T01
    description: "Select multiple AIs for Draft"
    type: "manual"
  - id: T02
    description: "Each Draft is displayed separately"
    type: "manual"
  - id: T03
    description: "Select Final AI"
    type: "manual"
  - id: T04
    description: "Combine drafts and send to Final"
    type: "manual"

max_retries: 3

---

# blocks/B28.yaml

id: B28
name: "Output Editor (Rich Text Editor)"
phase: 5
phase_name: "Core Workflow"

goal: |
  Implement a Rich Text Editor for editing AI-generated CVs and cover letters.
  Features:
  - Basic formatting (Bold, Italic, Heading, List, Link)
  - Load initial content from AI output
  - Allow manual editing
  - Approval button for finalization
  - RTL support for Persian

dependencies: [B02, B27]

files_to_create:
  - id: F057
    path: "src/components/application/OutputEditor.tsx"
    description: "Rich Text Editor based on TipTap"

checkpoint_tests:
  - id: T01
    description: "Editor loads with sample content"
    type: "manual"
  - id: T02
    description: "Text editing is possible"
    type: "manual"
  - id: T03
    description: "Bold, Italic, Heading tools work"
    type: "manual"
  - id: T04
    description: "RTL layout is correct for Persian"
    type: "manual"

max_retries: 3

---

# blocks/B29.yaml

id: B29
name: "Output File Generator"
phase: 5
phase_name: "Core Workflow"

goal: |
  Create logic to generate Word (.docx) and Markdown (.md) files from plain text or HTML.
  Features:
  - DOCX generation with professional formatting
  - Markdown generation
  - API routes for exporting files

dependencies: [B04, B28]

files_to_create:
  - id: F075
    path: "src/lib/generators/docx-generator.ts"
    description: "Core DOCX generation logic"
  - id: F076
    path: "src/lib/generators/markdown-generator.ts"
    description: "Markdown generation and conversion"
  - id: F025
    path: "src/app/api/export/docx/route.ts"
    description: "API route for DOCX export"
  - id: F026
    path: "src/app/api/export/markdown/route.ts"
    description: "API route for Markdown export"

checkpoint_tests:
  - id: T01
    description: "Generate formatted .docx from text"
    type: "manual"
  - id: T02
    description: "Generate .md from text"
    type: "manual"
  - id: T03
    description: "Word file is readable in MS Word"
    type: "manual"
  - id: T04
    description: "Formatting (headings, lists) is preserved"
    type: "manual"

max_retries: 3

---

# blocks/B30.yaml

id: B30
name: "Download & Preview Panel"
phase: 5
phase_name: "Core Workflow"

goal: |
  Create a panel for previewing and downloading generated documents.
  Features:
  - Preview CV, Cover Letter, and Email in separate tabs
  - Download buttons for Word and Markdown formats

dependencies: [B29]

files_to_create:
  - id: F058
    path: "src/components/application/DocumentPreview.tsx"
    description: "Component for previewing generated documents"
  - id: F059
    path: "src/components/application/DownloadPanel.tsx"
    description: "Panel with download buttons"

checkpoint_tests:
  - id: T01
    description: "All 3 documents are previewable in tabs"
    type: "manual"
  - id: T02
    description: "Word and Markdown download buttons work"
    type: "manual"
  - id: T03
    description: "Files are downloaded correctly"
    type: "manual"

max_retries: 3

---

# blocks/B31.yaml

id: B31
name: "Hook & State Management (Core Backend)"
phase: 5
phase_name: "Core Workflow"

goal: |
  Manage the state of the entire application process with service layer and API routes.
  Features:
  - Service for application CRUD and workflow logic
  - AI processing logic and prompt templates
  - API routes for list, create, process, clarify, and finalize
  - React hook for frontend state management

dependencies: [B30]

files_to_create:
  - id: F125
    path: "src/lib/applications/application-service.ts"
    description: "Service for job application CRUD and workflow"
  - id: F126
    path: "src/lib/applications/application-processor.ts"
    description: "AI processing logic for applications"
  - id: F127
    path: "src/lib/applications/application-prompts.ts"
    description: "Prompt templates for application processing"
  - id: F128
    path: "src/lib/applications/index.ts"
    description: "Export all application modules"
  - id: F129
    path: "src/app/api/applications/route.ts"
    description: "API for applications list and create"
  - id: F130
    path: "src/app/api/applications/[id]/route.ts"
    description: "API for single application CRUD"
  - id: F131
    path: "src/app/api/applications/[id]/process/route.ts"
    description: "API to start AI processing"
  - id: F132
    path: "src/app/api/applications/[id]/clarify/route.ts"
    description: "API for clarification responses"
  - id: F133
    path: "src/app/api/applications/[id]/finalize/route.ts"
    description: "API to generate final documents"
  - id: F084
    path: "src/hooks/useApplication.ts"
    description: "Main hook for application workflow state"

checkpoint_tests:
  - id: T01
    description: "Create new application record via API"
    type: "manual"
  - id: T02
    description: "Update application status and persist to Supabase"
    type: "manual"
  - id: T03
    description: "Save and load draft/final outputs correctly"
    type: "manual"

max_retries: 3

---

# blocks/B32.yaml

id: B32
name: "New Application Page (Wizard Integration)"
phase: 5
phase_name: "Core Workflow"

goal: |
  Integrate all components into a multi-step wizard on the New Application page.
  Steps:
  1. Job Description Input (F054)
  2. Prompt Selection (F136)
  3. AI Configuration (F137)
  4. Language/Tone Selection (F055, F056)
  5. Template Selection (F061)
  6. AI Processing & Clarification (F052)
  7. Multi-AI Drafts (F053)
  8. Editor (F057)
  9. Final Documents (F058, F059)

dependencies: [B31, B17, B14, B23, B24, B25, B26, B27, B28, B29, B30]

files_to_create:
  - id: F134
    path: "src/components/application/ApplicationWizard.tsx"
    description: "Main wizard container with step navigation"
  - id: F135
    path: "src/components/application/WizardProgress.tsx"
    description: "Progress indicator for wizard steps"
  - id: F136
    path: "src/components/application/PromptSelectionStep.tsx"
    description: "Wizard step for prompt selection"
  - id: F137
    path: "src/components/application/AIConfigurationStep.tsx"
    description: "Wizard step for AI provider/model selection"
  - id: F138
    path: "src/components/application/ProcessingStep.tsx"
    description: "Wizard step for AI processing with status"
  - id: F139
    path: "src/components/application/FinalDocumentsStep.tsx"
    description: "Wizard step for final document preview and download"

files_to_modify:
  - id: F014
    path: "src/app/[locale]/new-application/page.tsx"
    description: "Full implementation of the multi-step wizard"

checkpoint_tests:
  - id: T01
    description: "Complete workflow from input to download works without errors"
    type: "manual"
  - id: T02
    description: "Step navigation works correctly (Next/Back)"
    type: "manual"
  - id: T03
    description: "All intermediate steps reflect the current state"
    type: "manual"

max_retries: 3

---

# blocks/B33.yaml

id: B33
name: "Template Management System"
phase: 6
phase_name: "Templates"

goal: |
  Complete template management system for custom document styling.
  Features:
  - Upload Word/Markdown templates
  - List and preview templates
  - Apply templates to output generation
  - Service layer and API routes for template CRUD

dependencies: [B29]

files_to_create:
  - id: F145
    path: "src/lib/templates/template-service.ts"
    description: "Template CRUD service"
  - id: F146
    path: "src/lib/templates/template-processor.ts"
    description: "Apply templates to content"
  - id: F147
    path: "src/lib/templates/index.ts"
    description: "Export template modules"
  - id: F148
    path: "src/app/api/templates/route.ts"
    description: "Templates list and create API"
  - id: F149
    path: "src/app/api/templates/[id]/route.ts"
    description: "Single template CRUD API"
  - id: F150
    path: "src/hooks/useTemplates.ts"
    description: "React hook for templates"
  - id: F060
    path: "src/components/templates/TemplateUploader.tsx"
    description: "Upload template component"
  - id: F061
    path: "src/components/templates/TemplateSelector.tsx"
    description: "Select template component"
  - id: F062
    path: "src/components/templates/TemplatePreview.tsx"
    description: "Preview template component"
  - id: F151
    path: "src/components/templates/TemplateCard.tsx"
    description: "Template card display"
  - id: F152
    path: "src/components/templates/TemplateList.tsx"
    description: "List of templates"

checkpoint_tests:
  - id: T01
    description: "Upload .docx and .md templates"
    type: "manual"
  - id: T02
    description: "Template list displays correctly by type"
    type: "manual"
  - id: T03
    description: "Delete template works"
    type: "manual"

max_retries: 3

---

# blocks/B34.yaml

id: B34
name: "Dashboard"
phase: 7
phase_name: "Dashboard & Lists"

goal: |
  Main dashboard providing a summary of user activity and quick access to features.
  Features:
  - Application stats summary
  - Comprehensive CV status (Complete/Incomplete)
  - Recent applications list
  - Quick action to start New Application

dependencies: [B32]

files_to_modify:
  - id: F012
    path: "src/app/[locale]/dashboard/page.tsx"
    description: "Update dashboard with real data and stats"

checkpoint_tests:
  - id: T01
    description: "Summary stats are correct"
    type: "manual"
  - id: T02
    description: "CV status reflects reality"
    type: "manual"
  - id: T03
    description: "Recent applications list is shown"
    type: "manual"

max_retries: 3

---

# blocks/B35.yaml

id: B35
name: "Applications List & Details"
phase: 7
phase_name: "Dashboard & Lists"

goal: |
  Pages for viewing the history of applications and re-downloading documents.
  Features:
  - List of all applications with status
  - Detailed view of a single application
  - Re-downloading documents from detail page

dependencies: [B34]

files_to_modify:
  - id: F017
    path: "src/app/[locale]/applications/page.tsx"
    description: "Applications list page"
  - id: F018
    path: "src/app/[locale]/applications/[id]/page.tsx"
    description: "Application details page"

checkpoint_tests:
  - id: T01
    description: "All applications are listed with correct status"
    type: "manual"
  - id: T02
    description: "Clicking an application opens detail page"
    type: "manual"
  - id: T03
    description: "Detail page allows re-downloading files"
    type: "manual"

max_retries: 3

---

# blocks/B36.yaml

id: B36
name: "Google OAuth"
phase: 8
phase_name: "Final Authentication"

goal: |
  Replace development login with Google OAuth.
  Features:
  - Login with Google button
  - Supabase Auth integration
  - Auth callback handler
  - Protected routes

dependencies: [B35]

files_to_modify:
  - id: F011
    path: "src/app/[locale]/page.tsx"
    description: "Update landing page with Google login"
  - id: F030
    path: "src/middleware.ts"
    description: "Update middleware for auth protection"

files_to_create:
  - id: F065
    path: "src/lib/supabase/middleware.ts"
    description: "Supabase auth middleware"
  - id: F169
    path: "src/lib/supabase/auth.ts"
    description: "Google OAuth helper functions"
  - id: F170
    path: "src/components/auth/GoogleLoginButton.tsx"
    description: "Google sign-in button"
  - id: F171
    path: "src/app/auth/callback/route.ts"
    description: "OAuth callback handler"

checkpoint_tests:
  - id: T01
    description: "Login with Google button works"
    type: "manual"
  - id: T02
    description: "User is correctly redirected after login"
    type: "manual"
  - id: T03
    description: "UserInfo is stored in Supabase"
    type: "manual"
  - id: T04
    description: "Logout works"
    type: "manual"

max_retries: 3

---

# blocks/B37.yaml

id: B37
name: "RLS Policies Update"
phase: 8
phase_name: "Final Authentication"

goal: |
  Apply secure Row Level Security (RLS) policies in Supabase.
  Features:
  - Ensure each user can only see their own data
  - Secure and production-ready policies

dependencies: [B36]

commands:
  - "Apply SQL script for production RLS policies in Supabase Dashboard"

checkpoint_tests:
  - id: T01
    description: "User A cannot see User B's data"
    type: "manual"
  - id: T02
    description: "Unauthorized users cannot access API routes"
    type: "manual"

max_retries: 3

---

# blocks/B38.yaml

id: B38
name: "Final E2E Test"
phase: 9
phase_name: "Final"

goal: |
  Perform a complete end-to-end test of the entire application.
  Scenarios:
  - Full workflow with one/multiple AIs
  - UI language toggle (EN/FA)
  - Output language and tone variations
  - Mobile responsiveness
  - RTL testing

dependencies: [B37]

checkpoint_tests:
  - id: T01
    description: "Complete workflow works in all scenarios"
    type: "manual"
  - id: T02
    description: "Responsiveness and RTL are correct"
    type: "manual"

max_retries: 3

---

# blocks/B39.yaml

id: B39
name: "Vercel Deploy"
phase: 9
phase_name: "Final"

goal: |
  Deploy the final version of CV Tailor to Vercel.
  Steps:
  - Push latest code to GitHub
  - Set Environment Variables in Vercel
  - Update Supabase Redirect URLs
  - Verify on production URL

dependencies: [B38]

checkpoint_tests:
  - id: T01
    description: "Site is accessible on Vercel domain"
    type: "manual"
  - id: T02
    description: "Google Login works on production"
    type: "manual"

max_retries: 3
